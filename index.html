<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Mautic Developer Documentation</title>

    <link href="stylesheets/screen.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" type="text/css" media="print" />

      <script src="javascripts/all.js" type="text/javascript"></script>

      <script>
        $(function() {
          setupLanguages(["php","json"]);
        });
      </script>
  </head>

  <body class="index">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <a class="mautic-brand" href="#">
          <!-- logo figure -->
          <svg version="1.1" class="mautic-logo-figure" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 128 128" enable-background="new 0 0 128 128" xml:space="preserve">
                  <path class="circle" d="M64,119.843c-30.937,0-56.108-25.17-56.108-56.108C7.893,32.799,33.063,7.629,64,7.629
                  c7.474,0,14.734,1.446,21.578,4.301c1.936,0.807,2.85,3.03,2.041,4.964c-0.805,1.937-3.029,2.849-4.963,2.043
                  C76.742,16.472,70.465,15.221,64,15.221c-26.751,0-48.514,21.763-48.514,48.514c0,26.752,21.763,48.516,48.514,48.516
                  c26.751,0,48.513-21.764,48.513-48.516c0-5.735-0.988-11.345-2.939-16.677c-0.723-1.968,0.289-4.149,2.258-4.869
                  c1.971-0.721,4.15,0.291,4.871,2.259c2.258,6.171,3.404,12.661,3.404,19.287C120.107,94.673,94.938,119.843,64,119.843"></path>
              <polygon class="m" points="88.545,57.987 79.807,67.055 84.664,87.332 95.621,87.332 "></polygon>
              <polygon class="m-arrow" points="84.982,31.157 88.004,34.176 63.933,59.605 43.446,38.475 31.664,87.332 42.621,87.332
                  49.122,60.198 63.933,76.399 95.699,41.815 98.738,44.875 101.75,27.784 "></polygon>
              </svg>
          <!--/ logo figure -->
          <!-- logo text -->
          <svg version="1.1" class="mautic-logo-text mnl-3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 260 65" enable-background="new 0 0 260 65" xml:space="preserve">
                  <g>
                      <path class="m" d="M39.336,57.983V37.951c0-4.932-2.58-9.409-7.664-9.409
                      c-5.008,0-7.967,4.477-7.967,9.409v20.032h-9.258V20.498h8.575l0.683,4.553c1.972-3.794,6.298-5.16,9.864-5.16
                      c4.477,0,8.955,1.822,11.079,6.981c3.339-5.311,7.664-6.829,12.521-6.829c10.623,0,15.859,6.526,15.859,17.756v20.185H63.77V37.799
                      c0-4.932-2.049-9.106-7.057-9.106s-8.119,4.326-8.119,9.258v20.032H39.336z"></path>
                      <path class="a" d="M109.031,20.574h8.879v37.41h-8.728l-0.456-5.464
                      c-2.124,4.402-7.967,6.527-12.14,6.604c-11.079,0.074-19.275-6.754-19.275-19.883c0-12.898,8.575-19.652,19.502-19.577
                      c5.01,0,9.789,2.352,11.913,6.07L109.031,20.574z M86.569,39.24c0,7.134,4.934,11.384,11.079,11.384
                      c14.569,0,14.569-22.689,0-22.689C91.503,27.935,86.569,32.108,86.569,39.24"></path>
                      <path class="u" d="M133.101,20.574v19.578c0,5.69,3.11,10.016,9.03,10.016
                      c5.69,0,9.561-4.781,9.561-10.471V20.574h9.181v37.486h-8.27l-0.607-5.084c-3.871,3.794-7.437,5.614-12.672,5.614
                      c-8.954,0-15.48-6.754-15.48-18.363V20.574H133.101z"></path>
                      <path class="t" d="M182.123,10.026V20.65h10.319v7.967h-10.396V44.78
                      c0,3.567,1.973,5.313,4.855,5.313c1.443,0,3.112-0.455,4.479-1.14l2.58,7.893c-2.656,1.062-4.857,1.518-7.664,1.594
                      c-8.12,0.303-13.432-4.326-13.432-13.659V28.617h-6.98V20.65h6.98v-9.637L182.123,10.026z"></path>
                      <path class="i" d="M209.441,10.026c0,7.209-10.929,7.209-10.929,0 C198.513,2.818,209.441,2.818,209.441,10.026 M199.348,57.984h9.259V20.422h-9.259V57.984z"></path>
                      <path class="c" d="M247.803,53.203c-4.326,4.249-8.879,5.92-14.418,5.92
                      c-10.853,0-19.881-6.526-19.881-19.807c0-13.279,9.028-19.805,19.881-19.805c5.312,0,9.409,1.518,13.507,5.54l-5.843,6.146
                      c-2.2-1.973-4.934-2.959-7.514-2.959c-6.221,0-10.773,4.553-10.773,11.078c0,7.133,4.855,10.927,10.623,10.927
                      c2.959,0,5.919-0.834,8.194-3.11L247.803,53.203z"></path>
                  </g>
              </svg>
          <!--/ logo text -->
      </a>
        <div class="lang-selector">
              <a href="#" data-language-name="php">php</a>
              <a href="#" data-language-name="json">json</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
        <ul class="toc-footer">
            <li><a href='https://github.com/mautic/mautic'>Download Mautic source</a></li>
            <li><a href='http://github.com/tripit/slate'>Documentation powered by Slate</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        
          <h1 id="introduction">Introduction</h1>

<p>Welcome to the Mautic Developer Documentation. This documentation will go over how to build a Mautic Addon that extends the features of Mautic, how to build custom themes, and and how to integrate applications outside of Mautic using its REST API. </p>

<h2 id="submitting-code-to-mautic">Submitting Code to Mautic</h2>

<p>Development is open and available to any member of the Mautic community. All fixes and improvements are done through pull requests to the code on <a href="https://github.com/mautic/mautic">GitHub</a>. This code is open source and publicly available. </p>

<p>Read more about the PR process on the Mautic <a href="https://www.mautic.org/about/governance">Governance</a> page.</p>

<p>The code should try to follow <a href="http://symfony.com/doc/current/contributing/code/standards.html">Symfony&rsquo;s Coding Standards</a></p>

<h2 id="symfony">Symfony</h2>

<p>Mautic is built on <a href="http://symfony.com">Symfony</a>, the popular PHP framework (Mautic 1.0.x uses Symfony version 2.5). This document will go over the basics but most of <a href="http://symfony.com/doc/2.5/book/index.html">their documentation</a> applies to Mautic as well which can be used to obtain more advanced Symfony functionality.</p>

<p>There are some structural differences between Mautic and standard Symfony. Below is a list of where you will find some of standard Symfony locations in Mautic:</p>

<table><thead>
<tr>
<th>Symfony</th>
<th>Mautic</th>
</tr>
</thead><tbody>
<tr>
<td>src/</td>
<td>app/bundles (Mautic core) or addons/ (Mautic addons)</td>
</tr>
<tr>
<td>web/</td>
<td>/</td>
</tr>
<tr>
<td>AcmeBundle/Resources/config</td>
<td>AcmeBundle/Config</td>
</tr>
<tr>
<td>AcmeBundle/Resources/views</td>
<td>AcmeBundle/Views</td>
</tr>
<tr>
<td>AcmeBundle/Resources/public</td>
<td>AcmeBundle/Assets</td>
</tr>
<tr>
<td>AcmeBundle/Resources/translations/domain.en_US.ini</td>
<td>AcmeBundle/Translations/en_US/domain.ini</td>
</tr>
</tbody></table>

<p>Most of Symfony&rsquo;s standard locations, such as the Resources/views and Resources/translations directories, should still function with Mautic. However, it may be required to handle service registration, etc with native Symfony processes if not using the Mautic methods defined in this document. </p>

<h2 id="development-environment">Development Environment</h2>

<h3 id="setup">Setup</h3>

<p>It is assumed that the system already has <a href="https://getcomposer.org">composer</a> and <a href="http://git-scm.com">git</a> installed and configured.</p>

<p>To setup the developer environment, simply fork and clone the source from <a href="https://github.com/mautic/mautic">GitHub</a>. Then Run <code class="prettyprint">composer install</code> on the source. </p>

<p>Open your browser and complete the installation through the Mautic installer.</p>

<h3 id="environments">Environments</h3>

<p>There are three environments in Mautic: prod, dev, and test.</p>

<p><strong>prod</strong> is used when accessing the site through index.php.</p>

<p><strong>dev</strong> is used when accessing the site through index_dev.php. Using Mautic in the dev environment will activate Symfony&rsquo;s profiler toolbar, has more strict error handling, will display information about exceptions, and will not cache as much (see below). Note that steps should be taken to ensure index_dev.php is not accessible to the public as it could potentially reveal sensitive information. It is restricted to localhost by default.</p>

<p><strong>test</strong> is used mainly for PHP Unit Tests.</p>

<h3 id="cache">Cache</h3>

<p>Symfony makes heavy use of a filesystem cache. Frequently clearing this cache will be required when developing for Mautic. By default, the cache is located in app/cache/ENV where ENV is the environment currently accessed (i.e. dev or prod). To rebuild the cache, the ENV can just be deleted or run the Symfony command <code class="prettyprint">php app/console cache:clear --env=ENV</code> If a specific environment is not passed to the command via <code class="prettyprint">--env=ENV</code>, the dev environment will be used by default.</p>

<p>In the dev environment, translations, views, and assets are not cached. However, changes to these files will require the cache to be cleared for them to take effect in the prod environment. Changes to Mautic config files, Symfony config files, etc will require the cache to be cleared regardless of environment.</p>

<p><aside class="notice">
 The typical rule of thumb is, if Mautic is not acting as you expect after making changes, try clearing your cache.
 </aside></p>

<p><aside class="warning">
 If you get class could not be found or cannot redeclare class errors when using the cache:clear command, manually delete the app/cache/ENV folder then run the command and/or browse to the site to rebuild.
 </aside></p>

          <h1 id="addons">Addons</h1>

<p>Addons are bundles that can extend the functionality of Mautic. They can be very simple or very complex and have access to leverage pretty much all that Symfony offers. Just as as reminder, the basics are covered in this document. If more advanced processes are required, the <a href="http://symfony.com/doc/2.5/book/index.html">Symfony book</a> and <a href="http://symfony.com/doc/2.5/cookbook/index.html">cookbook</a> will be valuable resources.</p>

<aside class="notice">
Mautic addons are located in the addons/ directory and must be namespaced with MauticAddons.
 </aside>

          <h2 id="addon-directory-structure">Addon Directory Structure</h2>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="c1">// addons/HelloWorldBundle/HelloWorldBundle.php
</span>
<span class="k">namespace</span> <span class="nx">MauticAddon\HelloWorldBundle</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Mautic\AddonBundle\Bundle\AddonBundleBase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">HelloWorldBundle</span> <span class="k">extends</span> <span class="nx">AddonBundleBase</span>
<span class="p">{</span>
    <span class="c1">// Nothing more required
</span><span class="p">}</span>

</code></pre>

<p>The directory structure of an addon will vary based on the features implemented. </p>

<p>At a minimum, the following structure is required:</p>

<p>HelloWorldBundle/<br />
- - - Config/<br />
- - - - - config.php<br />
- - - HelloWorldBundle.php</p>

<p>Read more about the <a href="#addon-config-file">config file</a>.</p>

<p>The HelloWorldBundle.php file registers the bundle with Symfony. See the code block for the minimum required code.</p>

<p>A typical MVC addon may look something like:</p>

<p>HelloWorldBundle/<br />
- - - <a href="#asset-helper">Assets/</a><br />
- - - - - - images/ <br />
- - - - - - - - - earth.png<br />
- - - - - - - - - mars.png<br />
- - - - - - helloworld.js<br />
- - - - - - helloworld.css<br />
- - - <a href="#addon-config-file">Config/</a><br />
- - - - - - config.php<br />
- - - <a href="#controllers">Controller/</a><br />
- - - - - - DefaultController.php<br />
- - - <a href="#models">Model/</a><br />
- - - - - - ContactModel.php<br />
- - - - - - WorldModel.php<br />
- - - <a href="#translations">Translations/</a>/<br />
- - - - - - en_US/<br />
- - - - - - - - - flashes.ini<br />
- - - - - - - - - messages.ini<br />
- - - <a href="#views">Views/</a><br />
- - - - - - Contact/<br />
- - - - - - - - - form.html.php<br />
- - - - - - World/<br />
- - - - - - - - - index.html.php<br />
- - - - - - - - - list.html.php<br />
- - - HelloWorldBundle.php</p>

<p>Each of the other directories and files are explained elsewhere in the document. </p>

          <h2 id="install/upgrade">Install/Upgrade</h2>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="c1">// addons/HelloWorldBundle/HelloWorldBundle.php
</span>
<span class="k">namespace</span> <span class="nx">MauticAddon\HelloWorldBundle</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Mautic\AddonBundle\Bundle\AddonBundleBase</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Mautic\AddonBundle\Entity\Addon</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Mautic\CoreBundle\Factory\MauticFactory</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">HelloWorldBundle</span> <span class="k">extends</span> <span class="nx">AddonBundleBase</span>
<span class="p">{</span>

    <span class="sd">/**
     * Called by AddonController::reloadAction when adding a new addon that's not already installed
     *
     * @param MauticFactory $factory
     */</span>
    <span class="k">static</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">onInstall</span><span class="p">(</span><span class="nx">MauticFactory</span> <span class="nv">$factory</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Execute install stuff such as installing database schema
</span>
        <span class="nv">$db</span>     <span class="o">=</span> <span class="nv">$factory</span><span class="o">-&gt;</span><span class="na">getDatabase</span><span class="p">();</span>
        <span class="nv">$schema</span> <span class="o">=</span> <span class="nv">$db</span><span class="o">-&gt;</span><span class="na">getSchemaManager</span><span class="p">();</span>

        <span class="c1">// Do stuff with $schema
</span>    <span class="p">}</span>

    <span class="sd">/**
     * Called by AddonController::reloadAction when the addon version does not match what's installed
     *
     * @param Addon         $addon
     * @param MauticFactory $factory
     */</span>
    <span class="k">static</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">onUpdate</span><span class="p">(</span><span class="nx">Addon</span> <span class="nv">$addon</span><span class="p">,</span> <span class="nx">MauticFactory</span> <span class="nv">$factory</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Execute update stuff such as upgrading the database schema
</span>        <span class="c1">// $addon is the Addon entity with details of what was installed previously
</span>
        <span class="nv">$oldVersion</span> <span class="o">=</span> <span class="nv">$addon</span><span class="o">-&gt;</span><span class="na">getVersion</span><span class="p">();</span>

        <span class="nv">$db</span>     <span class="o">=</span> <span class="nv">$factory</span><span class="o">-&gt;</span><span class="na">getDatabase</span><span class="p">();</span>
        <span class="nv">$schema</span> <span class="o">=</span> <span class="nv">$db</span><span class="o">-&gt;</span><span class="na">getSchemaManager</span><span class="p">();</span>

        <span class="c1">// Do stuff with $schema
</span>    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>Currently, addons are installed by uploading the addon to the addons folder. Then, the admin must click the Install/Upgrade Addons button. When that happens, new addons found will have the static method <code class="prettyprint">onInstall()</code> called from the <a href="#addon-directory-structure">addon&rsquo;s bundle file</a>. If the addon has already been installed, and the version has changed, then <code class="prettyprint">onUpdate()</code> is called.</p>

          <h2 id="addon-config-file">Addon Config File</h2>

<p>Mautic leverages a simple array config file that will register routes, menu items, services and custom configuration parameters.</p>

<h3 id="general">General</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="c1">// addons/HelloWorldBundle/Config/config.php
</span>
<span class="k">return</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">'name'</span>        <span class="o">=&gt;</span> <span class="s1">'Hello World'</span><span class="p">,</span>
    <span class="s1">'description'</span> <span class="o">=&gt;</span> <span class="s1">'This is an example config file for a simple Hellow World addon.'</span><span class="p">,</span>
    <span class="s1">'author'</span>      <span class="o">=&gt;</span> <span class="s1">'Marty Mautibot'</span><span class="p">,</span>
    <span class="s1">'version'</span>     <span class="o">=&gt;</span> <span class="s1">'1.0.0'</span><span class="p">,</span>
</code></pre>

<p>The general config options will define what should be listed in the Addon manager.</p>

<p>The version should be &ldquo;<a href="http://php.net/manual/en/function.version-compare.php">PHP-standardized</a>&rdquo; as the Addon manager will use version_compare() to determine if the <a href="#update">onUpdate callback</a> should be executed.  </p>

<h3 id="routes">Routes</h3>

<blockquote>
<p>If copying, do not copy <code class="prettyprint">&lt;?php //continued</code> as it is simply used to force sytax highlighting.</p>
</blockquote>
<pre><code class="highlight php"><span class="cp">&lt;?php</span> <span class="c1">// continued
</span>
    <span class="s1">'routes'</span>   <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">'main'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">'addon_helloworld_world'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">'path'</span>       <span class="o">=&gt;</span> <span class="s1">'/hello/{world}'</span><span class="p">,</span>
                <span class="s1">'controller'</span> <span class="o">=&gt;</span> <span class="s1">'HelloWorldBundle:Default:world'</span><span class="p">,</span>
                <span class="s1">'defaults'</span>    <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                    <span class="s1">'world'</span> <span class="o">=&gt;</span> <span class="s1">'earth'</span>
                <span class="p">),</span>
                <span class="s1">'requirements'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                    <span class="s1">'world'</span> <span class="o">=&gt;</span> <span class="s1">'earth|mars'</span>
                <span class="p">)</span>
            <span class="p">),</span>
            <span class="s1">'addon_helloworld_list'</span>  <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">'path'</span>       <span class="o">=&gt;</span> <span class="s1">'/hello/{page}'</span><span class="p">,</span>
                <span class="s1">'controller'</span> <span class="o">=&gt;</span> <span class="s1">'HelloWorldBundle:Default:index'</span>
             <span class="p">),</span>
            <span class="s1">'addon_helloworld_admin'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">'path'</span>       <span class="o">=&gt;</span> <span class="s1">'/hello/admin'</span><span class="p">,</span>
                <span class="s1">'controller'</span> <span class="o">=&gt;</span> <span class="s1">'HelloWorldBundle:Default:admin'</span>
            <span class="p">),</span>
        <span class="p">),</span>
        <span class="s1">'public'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">'addon_helloworld_goodbye'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">'path'</span>       <span class="o">=&gt;</span> <span class="s1">'/hello/goodbye'</span><span class="p">,</span>
                <span class="s1">'controller'</span> <span class="o">=&gt;</span> <span class="s1">'HelloWorldBundle:Default:goodbye'</span>
            <span class="p">),</span>
            <span class="s1">'addon_helloworld_contact'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">'path'</span>       <span class="o">=&gt;</span> <span class="s1">'/hello/contact'</span><span class="p">,</span>
                <span class="s1">'controller'</span> <span class="o">=&gt;</span> <span class="s1">'HelloWorldBundle:Default:contact'</span>
            <span class="p">)</span>
        <span class="p">),</span>
        <span class="s1">'api'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">'addon_helloworld_api'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">'path'</span>       <span class="o">=&gt;</span> <span class="s1">'/hello'</span><span class="p">,</span>
                <span class="s1">'controller'</span> <span class="o">=&gt;</span> <span class="s1">'HelloWorldBundle:Api:howdy'</span><span class="p">,</span>
                <span class="s1">'method'</span>     <span class="o">=&gt;</span> <span class="s1">'GET'</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="p">),</span>
</code></pre>

<p>Routes define the URL paths that will be used to execute the addon&rsquo;s controller actions. See <a href="#routing">Routing</a> for specifics on how routes work.</p>

<h4 id="firewalls">Firewalls</h4>

<p>There are three firewalls to define the routes behind.</p>

<table><thead>
<tr>
<th>Firewall</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>main</strong></td>
<td>Secure area of Mautic (/s/ will be auto prepended to the path). The user will be required to login to access this path.</td>
</tr>
<tr>
<td><strong>public</strong></td>
<td>Public access without needing authentication. The URL will be appended directly to Mautic&rsquo;s base URL.</td>
</tr>
<tr>
<td><strong>api</strong></td>
<td>Secure API area of Mautic (/api/ will be auto prepended to the path). OAuth authorization will be required to access the path.</td>
</tr>
</tbody></table>

<p>Each firewall accepts an array of defined routes. Each key, the route&rsquo;s name, must be unique across all bundles and firewalls. Paths must be unique across the same firewall.  <strong>Order does matter</strong> as the first matching route will be used.</p>

<h4 id="route-definitions">Route definitions</h4>

<table><thead>
<tr>
<th>Array Key</th>
<th>Required</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>path</strong></td>
<td>REQUIRED</td>
<td>string</td>
<td>Defines the path for the URL. Placeholders can be defined using curly brackets. Parameters are passed into the controller function as arguments.</td>
</tr>
<tr>
<td><strong>controller</strong></td>
<td>REQUIRED</td>
<td>string</td>
<td>Defines the controller and function to call when the path is accessed. This should be in Symfony&rsquo;s controller notation of BundleName:ControllerClass:controllerMethod. See <a href="#controllers">Controllers</a> for more information.</td>
</tr>
<tr>
<td><strong>method</strong></td>
<td>OPTIONAL</td>
<td>string</td>
<td>Restricts the route to a specific method, i.e. GET, POST, etc</td>
</tr>
<tr>
<td><strong>defaults</strong></td>
<td>OPTIONAL</td>
<td>array</td>
<td>Defines default values for path placeholders. If a default is defined, it is not required in the URL. In the code example, /hello will be the same as /hello/earth and the controller&rsquo;s $world argument will default to &lsquo;earth&rsquo; as well.</td>
</tr>
<tr>
<td><strong>requirements</strong></td>
<td>OPTIONAL</td>
<td>array</td>
<td>Defines regex matches placeholders must match in order for the route to be recognized. For example, for addon_helloworld_world in the code example, world is restricted to earth or mars.  Anything else will not be recognized by the route.</td>
</tr>
<tr>
<td><strong>format</strong></td>
<td>OPTIONAL</td>
<td>string</td>
<td>Sets the request format for the Request response, i.e. Content-Type header. The api firewall will automatically set this to json.</td>
</tr>
<tr>
<td><strong>condition</strong></td>
<td>OPTIONAL</td>
<td>string</td>
<td>Very flexible expression to set when the route should match. Refer to <a href="http://symfony.com/doc/2.5/book/routing.html#completely-customized-route-matching-with-conditions">Symfony docs</a>.</td>
</tr>
</tbody></table>

<p>Note that there are some internally used placeholders that Mautic will set defaults and requirements for (if not overridden by the route)</p>

<p>{page} will default to 1 with a requirement of \d+</p>

<p>{objectId} will default to 0 </p>

<p>{id} will have a requirement of \d+ if under the api firewall</p>

<aside class="notice">
Each route&rsquo;s name must be unique across all bundles and firewalls and paths must be unique with the same firewall.
</aside>

<aside class="notice">
Order does matter.  The first route the path matches will be used.
</aside>

<p><strong>Debugging Routes</strong>
There are a few CLI commands that make help with debugging routes.</p>

<pre class="inline">
php app/console router:debug
</pre>

<pre class="inline">
php app/console router:debug article_show
</pre>

<pre class="inline">
php app/console router:match /blog/my-latest-post
</pre>

<h3 id="menu">Menu</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span> <span class="c1">// continued
</span>
    <span class="s1">'menu'</span>     <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">'main'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">'priority'</span> <span class="o">=&gt;</span> <span class="mi">4</span><span class="p">,</span>
            <span class="s1">'items'</span>    <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">'addon.helloworld.index'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                    <span class="s1">'id'</span>        <span class="o">=&gt;</span> <span class="s1">'addon_helloworld_index'</span><span class="p">,</span>
                    <span class="s1">'iconClass'</span> <span class="o">=&gt;</span> <span class="s1">'fa-globe'</span><span class="p">,</span>
                    <span class="s1">'access'</span>    <span class="o">=&gt;</span> <span class="s1">'addon:helloworld:worlds:view'</span><span class="p">,</span>
                    <span class="s1">'children'</span>  <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                        <span class="s1">'addon.helloworld.manage_worlds'</span>     <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                            <span class="s1">'route'</span> <span class="o">=&gt;</span> <span class="s1">'addon_helloworld_list'</span>
                        <span class="p">),</span>
                        <span class="s1">'mautic.category.menu.index'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                            <span class="s1">'bundle'</span> <span class="o">=&gt;</span> <span class="s1">'addon:helloWorld'</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="s1">'admin'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">'addon.helloworld.admin'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">'route'</span>     <span class="o">=&gt;</span> <span class="s1">'addon_helloworld_admin'</span><span class="p">,</span>
                <span class="s1">'iconClass'</span> <span class="o">=&gt;</span> <span class="s1">'fa-gears'</span><span class="p">,</span>
                <span class="s1">'access'</span>    <span class="o">=&gt;</span> <span class="s1">'admin'</span><span class="p">,</span>
                <span class="s1">'checks'</span>    <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                    <span class="s1">'parameters'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                        <span class="s1">'helloworld_api_enabled'</span> <span class="o">=&gt;</span> <span class="kc">true</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="p">),</span>
</code></pre>

<p>Menu defines the menu items to display in the main left menu and/or admin menu.</p>

<p>The main and admin arrays are configured exactly the same.</p>

<h4 id="priority">Priority</h4>

<p>To control the placement of the menu items, set an array with &#39;priority&rsquo; and &#39;items&rsquo; keys. Priority can be negative to position the items lower than others or positive to position them higher. If the menu items are returned without setting priority, like the admin menu in the code example, priority is treated as 9999.</p>

<h4 id="items">Items</h4>

<p>The menu item&rsquo;s name should be the <a href="#translations">language string key</a> that will be displayed as the item&rsquo;s link. </p>

<p>Item definitions:</p>

<table><thead>
<tr>
<th>Array Key</th>
<th>Required</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>route</strong></td>
<td>OPTIONAL</td>
<td>string</td>
<td>The route name as defined in <a href="#routes">routes</a>. Do not set a route to treat the item as a parent to activate a submenu.</td>
</tr>
<tr>
<td><strong>routeParameters</strong></td>
<td>OPTIONAL</td>
<td>array</td>
<td>Route placeholder values to use when generating the URL</td>
</tr>
<tr>
<td><strong>id</strong></td>
<td>OPTIONAL</td>
<td>string</td>
<td>Sets the id of the &lt;a /&gt; attribute. This will default to what is set as route.</td>
</tr>
<tr>
<td><strong>iconClass</strong></td>
<td>OPTIONAL</td>
<td>string</td>
<td>Font Awesome class to set the icon for the menu item.</td>
</tr>
<tr>
<td><strong>access</strong></td>
<td>OPTIONAL</td>
<td>string</td>
<td>Set the <a href="#security">permission</a> required for this item to display to the user currently logged in. Can also set &#39;admin&rsquo; to restrict to Administrators only.</td>
</tr>
<tr>
<td><strong>checks</strong></td>
<td>OPTIONAL</td>
<td>array</td>
<td>Restricts display of the link based on either configured parameters or the GET request. It will accept a &#39;parameters&rsquo; and/or &#39;request&rsquo; array of key =&gt; value pairs that must be true to display the menu item.</td>
</tr>
<tr>
<td><strong>bundle</strong></td>
<td>OPTIONAL</td>
<td>string</td>
<td>Required only for <a href="#categories">category integration</a>.</td>
</tr>
</tbody></table>

<h3 id="services">Services</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span> <span class="c1">// continued 
</span>
    <span class="s1">'services'</span>    <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">'events'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">'addon.helloworld.leadbundle.subscriber'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">'class'</span> <span class="o">=&gt;</span> <span class="s1">'MauticAddon\HelloWorldBundle\EventListener\LeadSubscriber'</span>
            <span class="p">)</span>
        <span class="p">),</span>
        <span class="s1">'forms'</span>  <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">'addon.helloworld.form'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">'class'</span> <span class="o">=&gt;</span> <span class="s1">'MauticAddon\HelloWorldBundle\Form\Type\HelloWorldType'</span><span class="p">,</span>
                <span class="s1">'alias'</span> <span class="o">=&gt;</span> <span class="s1">'helloworld'</span>
            <span class="p">)</span>
        <span class="p">),</span>
        <span class="s1">'helpers'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">'mautic.helper.helloworld'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">'class'</span>     <span class="o">=&gt;</span> <span class="s1">'MauticAddon\HelloWorldBundle\Helper\HelloWorldHelper'</span><span class="p">,</span>
                <span class="s1">'arguments'</span> <span class="o">=&gt;</span> <span class="s1">'mautic.factory'</span><span class="p">,</span>
                <span class="s1">'alias'</span>     <span class="o">=&gt;</span> <span class="s1">'helloworld'</span>
            <span class="p">)</span>
        <span class="p">),</span>
        <span class="s1">'other'</span>   <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">'addon.helloworld.mars.validator'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">'class'</span>     <span class="o">=&gt;</span> <span class="s1">'MauticAddon\HelloWorldBundle\Form\Validator\Constraints\MarsValidator'</span><span class="p">,</span>
                <span class="s1">'arguments'</span> <span class="o">=&gt;</span> <span class="s1">'mautic.factory'</span><span class="p">,</span>
                <span class="s1">'tag'</span>       <span class="o">=&gt;</span> <span class="s1">'validator.constraint_validator'</span><span class="p">,</span>
                <span class="s1">'alias'</span>     <span class="o">=&gt;</span> <span class="s1">'helloworld_mars'</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="p">),</span>

</code></pre>

<p>Services are PHP objects stored in the service container and are used all throughout Mautic. They can be as simple or as complex as required. Read more about Symfony&rsquo;s service container <a href="http://symfony.com/doc/2.5/book/service_container.html">here</a>. </p>

<h4 id="service-types">Service types</h4>

<p>Mautic allows easy configuration for four types of services:</p>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>events</strong></td>
<td>Defines event subscriber classes used to listen to events dispatched throughout Mautic and auto-tagged with &#39;kernel.event_subscriber.&rsquo; The defined class must extend \Mautic\CoreBundle\EventListener\CommonSubscriber. Read more about subscribers <a href="#subscribers">here</a>.</td>
</tr>
<tr>
<td><strong>forms</strong></td>
<td>Defines custom <a href="#forms">form types</a> and auto-tagged with &#39;form.type.&rsquo;</td>
</tr>
<tr>
<td><strong>helpers</strong></td>
<td>Defines custom template helpers available through the $view variable in <a href="#views">views</a>. These services are auto-tagged with &#39;templating.helper.&rsquo;</td>
</tr>
<tr>
<td><strong>other</strong></td>
<td>All other custom services.</td>
</tr>
</tbody></table>

<h4 id="service-definitions">Service definitions</h4>

<p>Each key within the service types array is the name of the service and must be unique. Use the following to define the service:</p>

<table><thead>
<tr>
<th>Array Key</th>
<th>Required</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>class</strong></td>
<td>REQUIRED</td>
<td>string</td>
<td>Namespace to the service class (not that it does not start with a backslash)</td>
</tr>
<tr>
<td><strong>arguments</strong></td>
<td>OPTIONAL</td>
<td>string or array</td>
<td>String of a single argument to pass to the construct or an array of arguments to pass. Arguments enclosed with %% will be treated as a <a href="#parameters">parameter</a>. To pass a specific string, enclose the argument with double quotations &ldquo;&rdquo;. Anything else that is not a boolean or a namespaced class (string with \ in it) will be treated as the name of another registered service. Often, this will simply be <a href="#factory-service">mautic.factory</a>.</td>
</tr>
<tr>
<td><strong>alias</strong></td>
<td>OPTIONAL</td>
<td>string</td>
<td>Sets the alias used by the service. For example, the key for the template helpers, $view, array or the string to retrieve a specific form type.</td>
</tr>
<tr>
<td><strong>tag</strong></td>
<td>OPTIONAL</td>
<td>string</td>
<td><a href="http://symfony.com/doc/2.5/components/dependency_injection/tags.html">Tags</a> the service used by bundles to get a list of specific services (for example form types and event subscribers).</td>
</tr>
<tr>
<td><strong>tags</strong></td>
<td>OPTIONAL</td>
<td>array</td>
<td>Array of of tags</td>
</tr>
<tr>
<td><strong>tagArguments</strong></td>
<td>OPTIONAL</td>
<td>array</td>
<td>Array of attributes for the tag. See <a href="http://symfony.com/doc/2.5/components/dependency_injection/tags.html#adding-additional-attributes-on-tags">Symfony docs</a> for more information.</td>
</tr>
<tr>
<td><strong>scope</strong></td>
<td>OPTIONAL</td>
<td>string</td>
<td>Defines the <a href="http://symfony.com/doc/2.5/cookbook/service_container/scopes.html">service scope</a></td>
</tr>
<tr>
<td><strong>factoryService</strong></td>
<td>OPTIONAL</td>
<td>string</td>
<td><a href="http://symfony.com/doc/2.5/components/dependency_injection/factories.html">Factory class</a> for managing creating the service</td>
</tr>
<tr>
<td><strong>factoryMethod</strong></td>
<td>OPTIONAL</td>
<td>string</td>
<td>Method name in the <a href="http://symfony.com/doc/2.5/components/dependency_injection/factories.html">factory service</a> called to create the service</td>
</tr>
<tr>
<td><strong>methodCalls</strong></td>
<td>OPTIONAL</td>
<td>array</td>
<td>Array of methods to be called after a service is created passing in the array of arguments provided. Should be in the format of &#39;methodName&rsquo; =&gt; array(&#39;service_name&rsquo;, &rsquo;%parameter%&rsquo;)</td>
</tr>
</tbody></table>

<h3 id="parameters">Parameters</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span> <span class="c1">// continued
</span>
    <span class="s1">'parameters'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">'helloworld_api_enabled'</span> <span class="o">=&gt;</span> <span class="kc">false</span>
    <span class="p">)</span>
<span class="p">);</span>
</code></pre>

<p>The parameters array define and set default values for <a href="#custom-config-params">custom configuration parameters</a> specific to the addon. </p>

<aside class="notice">
Any parameter to be written to the system&rsquo;s local config file should be defined here.
</aside>

          <h2 id="translations">Translations</h2>

<p>Mautic uses INI files for translations.</p>

<p>HelloWorldBundle/<br />
- - - Translations/<br />
- - - - - - en_US/<br />
- - - - - - - - - messages.ini</p>

<aside class="notice">
All addons should include strings for the United States English locale (en_US) as it is the default for the system. 
</aside>

<p>The directory structure for translations should be <code class="prettyprint">Translations/locale/domain.ini</code>.</p>

<h3 id="domains">Domains</h3>

<p>Language strings can be organized into domains. Each domain should be its own file in the addon&rsquo;s language locale folder(s). The addon can use any domain it wants but Mautic makes consistent use of three domains:</p>

<table><thead>
<tr>
<th>Domain</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>messages</td>
<td>Default domain for the translator service when no domain is specified</td>
</tr>
<tr>
<td>flashes</td>
<td>Domain for <a href="#flash-messages">flash messages</a></td>
</tr>
<tr>
<td>validators</td>
<td>Domain for <a href="#validation">form validation</a> messages</td>
</tr>
</tbody></table>

<h3 id="ini-files">INI files</h3>

<blockquote>
<p>Sample INI files</p>
</blockquote>
<pre><code class="highlight plaintext">; addons/HelloWorldBundle/Translations/en_US/messages.ini

addon.helloworld.contact_us="Contact Us"
addon.helloworld.goodbye="Goodbye and have a good day!"
addon.helloworld.greeting="Hello %name%!"
addon.helloworld.index="Hello World"
addon.helloworld.manage_worlds="Manage Worlds"
addon.helloworld.number_of_planets="{0}0 planets|{1}1 planet|]1,Inf[%planets% planets"
addon.helloworld.world="World"
addon.helloworld.worlds="%world% Description"
</code></pre>
<pre><code class="highlight plaintext">; addons/HelloWorldBundle/Translations/en_US/flashes.ini

addon.helloworld.notice.thank_you="Thank you %name% for your interest! We will be in contact soon." 
addon.helloworld.notice.planet_demoted="%planet% has been demoted to a dwarf planet." 
addon.helloworld.error.planet_demotion_failed="%planet% could not be demoted because the scientists say so."
</code></pre>

<p>General guidelines for the translation keys:</p>

<ol>
<li>Segment the key using a period</li>
<li>Use underscores to separate words</li>
<li>Must be unique</li>
<li>Be short yet descriptive</li>
<li>Use all lowercase letters and numbers (no punctuation in the key other than period or underscore)</li>
</ol>

<p>Guidelines for translation strings:</p>

<ol>
<li>Wrap placeholders with %%</li>
<li>Use a single key for duplicate translation strings.</li>
<li>Use &ldquo; for double quotes</li>
<li>HTML is allowed</li>
</ol>

<h3 id="using-the-translator">Using the translator</h3>

<p>Refer to the <a href="#translator">translator service</a> to learn how to use translations in the code.</p>

          <h2 id="mvc">MVC</h2>

<p>Mautic uses a Model-View-Controller structure to manage user interaction on the frontend (views) with the underlying code processes (controllers and models). (<a href="#database">Entity and Repository classes</a> are also used to manage interaction with the database).</p>

<p>In Symfony, and thus Mautic, the controller is the center of the MVC structure. The route requested by the user determines the controller method to call. The controller will then communicate with the model to get or manipulate data then display it to the user through the view.</p>

          <h3 id="controllers">Controllers</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="c1">// addons/HelloWorldBundle/Controller/DefaultController.php
</span>
<span class="k">namespace</span> <span class="nx">MauticAddons\HelloWorldBundle\Controller</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Mautic\CoreBundle\Controller\FormController</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">DefaultController</span> <span class="k">extends</span> <span class="nx">FormController</span>
<span class="p">{</span>
    <span class="sd">/**
     * Display the world view
     *
     * @param string $world
     *
     * @return JsonResponse|\Symfony\Component\HttpFoundation\Response
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">worldAction</span><span class="p">(</span><span class="nv">$world</span> <span class="o">=</span> <span class="s1">'earth'</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="sd">/** @var \MauticAddon\HelloBundleBundle\Model\WorldModel $model */</span>
        <span class="nv">$model</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">factory</span><span class="o">-&gt;</span><span class="na">getModel</span><span class="p">(</span><span class="s1">'addon.helloWorld.world'</span><span class="p">);</span>

        <span class="c1">// Retrieve details about the world
</span>        <span class="nv">$worldDetails</span> <span class="o">=</span> <span class="nv">$model</span><span class="o">-&gt;</span><span class="na">getWorldDetails</span><span class="p">(</span><span class="nv">$world</span><span class="p">);</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">delegateView</span><span class="p">(</span>
            <span class="k">array</span><span class="p">(</span>
                <span class="s1">'viewParameters'</span>  <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                    <span class="s1">'world'</span>   <span class="o">=&gt;</span> <span class="nv">$world</span><span class="p">,</span>
                    <span class="s1">'details'</span> <span class="o">=&gt;</span> <span class="nv">$worldDetails</span>
                <span class="p">),</span>
                <span class="s1">'contentTemplate'</span> <span class="o">=&gt;</span> <span class="s1">'HelloWorldBundle:World:details.html.php'</span><span class="p">,</span>
                <span class="s1">'passthroughVars'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                    <span class="s1">'activeLink'</span>    <span class="o">=&gt;</span> <span class="s1">'addon_helloworld_world'</span><span class="p">,</span>
                    <span class="s1">'route'</span>         <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">generateUrl</span><span class="p">(</span><span class="s1">'addon_helloworld_world'</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'world'</span> <span class="o">=&gt;</span> <span class="nv">$world</span><span class="p">)),</span>
                    <span class="s1">'mauticContent'</span> <span class="o">=&gt;</span> <span class="s1">'helloWorldDetails'</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**
     * Contact form
     *
     * @return JsonResponse|\Symfony\Component\HttpFoundation\Response
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">contactAction</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// Create the form object
</span>        <span class="nv">$form</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'form.factory'</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">(</span><span class="s1">'helloworld_contact'</span><span class="p">);</span>

        <span class="c1">// Handle form submission if POST        
</span>        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">getMethod</span><span class="p">()</span> <span class="o">==</span> <span class="s1">'POST'</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$flashes</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>

            <span class="c1">// isFormCancelled() checks if the cancel button was clicked
</span>            <span class="k">if</span> <span class="p">(</span><span class="nv">$cancelled</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">isFormCancelled</span><span class="p">(</span><span class="nv">$form</span><span class="p">))</span> <span class="p">{</span>

                <span class="c1">// isFormValid() will bind the request to the form object and validate the data
</span>                <span class="k">if</span> <span class="p">(</span><span class="nv">$valid</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">isFormValid</span><span class="p">(</span><span class="nv">$form</span><span class="p">))</span> <span class="p">{</span>

                    <span class="sd">/** @var \MauticAddon\HelloBundleBundle\Model\ContactModel $model */</span>
                    <span class="nv">$model</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">factory</span><span class="o">-&gt;</span><span class="na">getModel</span><span class="p">(</span><span class="s1">'addon.helloWorld.contact'</span><span class="p">);</span>

                    <span class="c1">// Send the email
</span>                    <span class="nv">$model</span><span class="o">-&gt;</span><span class="na">sendContactEmail</span><span class="p">(</span><span class="nv">$form</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">());</span>

                    <span class="c1">// Set success flash message
</span>                    <span class="nv">$flashes</span><span class="p">[]</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
                        <span class="s1">'type'</span>    <span class="o">=&gt;</span> <span class="s1">'notice'</span><span class="p">,</span>
                        <span class="s1">'msg'</span>     <span class="o">=&gt;</span> <span class="s1">'addon.helloworld.notice.thank_you'</span><span class="p">,</span>
                        <span class="s1">'msgVars'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                            <span class="s1">'%name%'</span> <span class="o">=&gt;</span> <span class="nv">$form</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">()</span>
                        <span class="p">)</span>
                    <span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="nv">$cancelled</span> <span class="o">||</span> <span class="nv">$valid</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// Redirect to /hello/world
</span>
                <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">postActionRedirect</span><span class="p">(</span>
                    <span class="k">array</span><span class="p">(</span>
                        <span class="s1">'returnUrl'</span>       <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">generateUrl</span><span class="p">(</span><span class="s1">'addon_helloworld_world'</span><span class="p">),</span>
                        <span class="s1">'contentTemplate'</span> <span class="o">=&gt;</span> <span class="s1">'HelloWorldBundle:Default:world'</span><span class="p">,</span>
                        <span class="s1">'flashes'</span>         <span class="o">=&gt;</span> <span class="nv">$flashes</span>
                    <span class="p">)</span>
                <span class="p">);</span>
            <span class="p">}</span> <span class="c1">// Otherwise show the form again with validation error messages
</span>        <span class="p">}</span>

        <span class="c1">// Display the form
</span>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">delegateView</span><span class="p">(</span>
            <span class="k">array</span><span class="p">(</span>
                <span class="s1">'viewParameters'</span>  <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                    <span class="s1">'form'</span> <span class="o">=&gt;</span> <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">createView</span><span class="p">()</span>
                <span class="p">),</span>
                <span class="s1">'contentTemplate'</span> <span class="o">=&gt;</span> <span class="s1">'HelloWorldBundle:Contact:form.html.php'</span><span class="p">,</span>
                <span class="s1">'passthroughVars'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                    <span class="s1">'activeLink'</span> <span class="o">=&gt;</span> <span class="s1">'addon_helloworld_contact'</span><span class="p">,</span>
                    <span class="s1">'route'</span>      <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">generateUrl</span><span class="p">(</span><span class="s1">'addon_helloworld_contact'</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<h4 id="matching-routes-to-controller-methods">Matching Routes to Controller Methods</h4>

<p>The controller method called is determined by the <a href="#routes">route defined in the config</a>. Take this example,</p>

<pre class="inline">
addon_helloworld_admin' => array(
    'path'       => '/hello/admin',
    'controller' => 'HelloWorldBundle:Default:admin'
 ),
</pre>

<p>The controller is noted as <code class="prettyprint">HelloWorldBundle:Default:admin</code>. Broken down, that will translate to:</p>

<table>
<tr>
    <td>HelloWorldBundle</td>
    <td>\MauticAddons\HelloWorldBundle\Controller</td>
</tr>
<tr>
    <td>Default</td>
     <td>DefaultController</td>
<tr>
<tr>
    <td>admin</td>
    <td>adminAction()</td>
</tr>
</table>

<aside class="notice">
Controller notation is in the format of <code>BundleName:ControllerName:controllerMethod</code>. To use a controller within a subfolder of Controller, use <code>BundleName:Subdirectory\ControllerName:controllerMethod</code>.
</aside>

<p>Thus when a browser calls up <code class="prettyprint">/hello/admin</code>, <code class="prettyprint">\MauticAddons\HelloWorldBundle\Controller\DefaultController\adminAction()</code> will be called.</p>

<p>What about route placeholders? Symfony is super smart and will pass those into the controller&rsquo;s method as arguments (the method&rsquo;s arguments must be the same as the route&rsquo;s placeholders to be matched up).</p>

<pre class="inline">
'addon_helloworld_world' => array(
    'path'       => '/hello/{world}',
    'controller' => 'HelloWorldBundle:Default:world',
    'defaults'    => array(
        'world' => 'earth'
    ),
    'requirements' => array(
        'world' => 'earth|mars'
    )
),
</pre>

<p>The matching method for that route will look be <code class="prettyprint">public function worldAction($world = &#39;earth&#39;)</code>.</p>

<p>Notice that because the route defines a default for <code class="prettyprint">name</code>, the controller method must also set the same default. If the route looked like this instead:</p>

<pre class="inline">
'addon_helloworld_world' => array(
    'path'       => '/hello/{world}',
    'controller' => 'HelloWorldBundle:Default:world',
    'requirements' => array(
        'world' => 'earth|mars'
    )
),
</pre>

<p>Then the method would need to be <code class="prettyprint">public function worldAction($world)</code>.</p>

<h4 id="extending-mautic&#39;s-controllers">Extending Mautic&rsquo;s Controllers</h4>

<p>Mautic has several controllers that provide some helper functions.</p>

<h5 id="mautic\corebundle\controller\commoncontroller">Mautic\CoreBundle\Controller\CommonController</h5>

<p>Controllers extending this will make <a href="#factory-service">MauticFactory</a> available via <code class="prettyprint">$this-&gt;factory</code> and <a href="#request">Request</a> via <code class="prettyprint">$this-&gt;request</code>. </p>

<p>It also provides the following helper methods:</p>

<h6 id="delegateview($args)">delegateView($args)</h6>

<p>Mautic is ajax driven and thus must support both http requests and ajax requests for content. <code class="prettyprint">delegateView</code> is wrapper method that determines if the request is for ajax content or the full DOM then generates and returns the appropriate response. </p>

<p>The $args argument is an array with the required elements for generating the view, ajax or http. It will accept the following parameters:</p>

<table><thead>
<tr>
<th>Key</th>
<th>Required</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>contentTemplate</td>
<td>REQUIRED</td>
<td>string</td>
<td>Defines the view template to load. This should be in view notation of BundleName:ViewName:template.html.php. Refer to <a href="#views">views</a> for more information.</td>
</tr>
<tr>
<td>viewParameters</td>
<td>OPTIONAL</td>
<td>array</td>
<td>Array of variables with values made available to the template. Each key will be a variable available to the template.</td>
</tr>
<tr>
<td>passthroughVars</td>
<td>OPTIONAL</td>
<td>array</td>
<td>Array of variables returned as part of the ajax response used by Mautic and/or the addon&rsquo;s onLoad JS callback.</td>
</tr>
</tbody></table>

<p>Due to the use of ajax, there are some elements of the <code class="prettyprint">passthroughVars</code> array that Mautic will use internally to manipulate the user interface. For responses that include main content, i.e. routes a user would click to, should set at least <code class="prettyprint">activeLink</code> and <code class="prettyprint">route</code>.</p>

<table><thead>
<tr>
<th>Key</th>
<th>Required</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>activeLink</td>
<td>OPTIONAL</td>
<td>string</td>
<td>The <a href="#items">ID of the menu item</a> that should be activated dynamically to match the ajax response</td>
</tr>
<tr>
<td>route</td>
<td>OPTIONAL</td>
<td>string</td>
<td>The route that should be pushed to the browser&rsquo;s address bar to match the ajax response</td>
</tr>
<tr>
<td>mauticContent</td>
<td>OPTIONAL</td>
<td>string</td>
<td>Used to generate the Javascript method to call after the ajax content has been injected into the DOM. The same function will also be called on a page refresh/full page load if set via <code class="prettyprint">$view[&#39;slots&#39;]</code> in the template. For example, if this is set as <code class="prettyprint">helloWorldDetails</code>, Mautic will check for the existence of and executes <code class="prettyprint">Mautic.helloWorldDetailsOnLoad()</code>. Refer to <a href="#processing-ajax-content">Processing Ajax Content</a> for more information regarding this and <a href="#asset-helper">Asset Helper</a> for injecting assets into the head for ajax generated content.</td>
</tr>
<tr>
<td>callback</td>
<td>OPTIONAL</td>
<td>string</td>
<td>A Mautic namespaced JS function that will be executed before the response is injected into the DOM. If set, Mautic will pass the response to the function and not process the content. It will be up to the callback function to handle the rest of the process.</td>
</tr>
<tr>
<td>redirect</td>
<td>OPTIONAL</td>
<td>string</td>
<td>The URL to force a page redirect rather than inject ajax content.</td>
</tr>
<tr>
<td>target</td>
<td>OPTIONAL</td>
<td>string</td>
<td>jQuery selector to inject the content into. By default, the app&rsquo;s main content selector will be used.</td>
</tr>
<tr>
<td>replaceContent</td>
<td>OPTIONAL</td>
<td>string</td>
<td>Determines if Mautic should replace the target selector with the ajax content or set as its inner HTML. Return &lsquo;true&rsquo; as a string to replace the selector.</td>
</tr>
</tbody></table>

<h6 id="delegateredirect($url)">delegateRedirect($url)</h6>

<p>Delegates the appropriate response for redirects. </p>

<p>If an ajax request, a json response with <code class="prettyprint">{redirect: $url}</code> will be returned allowing the executing JS code to force the redirect.</p>

<p>If an http request, then a redirect response is returned (i.e redirect header).</p>

<h6 id="postactionredirect($args)">postActionRedirect($args)</h6>

<p>Similar to delegateView(), this method will delegate the appropriate response based on the request. This method can be used after performing some action, such as saving a form. It accepts the same elements in the $args array as delegateView() but also accepts the following:</p>

<table><thead>
<tr>
<th>Key</th>
<th>Required</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>returnUrl</td>
<td>OPTIONAL</td>
<td>string</td>
<td>The URL to redirect to. It will default to /s/dashboard if not set. This will also auto-populate passthroughVars[route] if not set.</td>
</tr>
<tr>
<td>flashes</td>
<td>OPTIONAL</td>
<td>array</td>
<td>Array of flash messages to display after redirecting. See <a href="#flash-messages">Flash Messages</a> for more information.</td>
</tr>
<tr>
<td>forwardController</td>
<td>OPTIONAL</td>
<td>bool</td>
<td>By default, the request is forwarded to a controller method rather than directly loading a view template. This means that contentTemplate should be in controller notation (BundleName:ControllerName:controllerMethod) rather than view notation (BundleName:ViewName:template.html.php). Set this to false to directly load a view template rather than forwarding to another controller.</td>
</tr>
</tbody></table>

<h5 id="mautic\corebundle\controller\formcontroller">Mautic\CoreBundle\Controller\FormController</h5>

<p>This controller extends CommonController and provides helper methods for managing forms. See <a href="#forms">Forms</a> for more information.</p>

<h5 id="mautic\corebundle\controller\ajaxcontroller">Mautic\CoreBundle\Controller\AjaxController</h5>

<p>This controller also extends CommonController and is a companion to some of the built-in Javascript helpers. See  <a href="#javascript-methods">Javascript methods</a> for more information.</p>

          <h3 id="models">Models</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="c1">// addons/HelloWorldBundle/Model/ContactModel.php
</span>
<span class="k">namespace</span> <span class="nx">MauticAddons\HelloWorldBundle\Model</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Mautic\CoreBundle\Model\CommonModel</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ContactModel</span> <span class="k">extends</span> <span class="nx">CommonModel</span>
<span class="p">{</span>

    <span class="sd">/**
     * Send contact email
     * 
     * @param array $data
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">sendContactEmail</span><span class="p">(</span><span class="nv">$data</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Get mailer helper
</span>        <span class="nv">$mailer</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">factory</span><span class="o">-&gt;</span><span class="na">getMailer</span><span class="p">();</span>

        <span class="nv">$mailer</span><span class="o">-&gt;</span><span class="na">message</span><span class="o">-&gt;</span><span class="na">addTo</span><span class="p">(</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">factory</span><span class="o">-&gt;</span><span class="na">getParameter</span><span class="p">(</span><span class="s1">'mailer_from_email'</span><span class="p">)</span>
        <span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">message</span><span class="o">-&gt;</span><span class="na">setFrom</span><span class="p">(</span>
            <span class="k">array</span><span class="p">(</span><span class="nv">$data</span><span class="p">[</span><span class="s1">'email'</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="nv">$data</span><span class="p">[</span><span class="s1">'name'</span><span class="p">])</span>
        <span class="p">);</span>

        <span class="nv">$mailer</span><span class="o">-&gt;</span><span class="na">message</span><span class="o">-&gt;</span><span class="na">setSubject</span><span class="p">(</span><span class="nv">$data</span><span class="p">[</span><span class="s1">'subject'</span><span class="p">]);</span>

        <span class="nv">$mailer</span><span class="o">-&gt;</span><span class="na">message</span><span class="o">-&gt;</span><span class="na">setBody</span><span class="p">(</span><span class="nv">$data</span><span class="p">[</span><span class="s1">'message'</span><span class="p">]);</span>

        <span class="nv">$mailer</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>Models are used to retrieve and process data between controllers and views. Models aren&rsquo;t required for addons but, if used, Mautic provides means to easily obtain the model objects and some commonly used methods.</p>

<h4 id="model-classes">Model Classes</h4>

<p>Custom models should extend one of two Mautic base models.</p>

<h5 id="\mautic\corebundle\model\commonmodel">\Mautic\CoreBundle\Model\CommonModel</h5>

<p>This is the basic model that mainly provides access to services frequently used with models.</p>

<table><thead>
<tr>
<th>Property</th>
<th>Service</th>
</tr>
</thead><tbody>
<tr>
<td>$this-&gt;factory</td>
<td><a href="#factory-service">Mautic&rsquo;s factory service</a></td>
</tr>
<tr>
<td>$this-&gt;em</td>
<td><a href="#database">Entity manager service</a></td>
</tr>
<tr>
<td>$this-&gt;security</td>
<td><a href="#security">Mautic&rsquo;s security service</a></td>
</tr>
<tr>
<td>$this-&gt;dispatcher</td>
<td><a href="#events">Event dispatcher service</a></td>
</tr>
<tr>
<td>$this-&gt;translator</td>
<td><a href="#translator">Translator service</a></td>
</tr>
</tbody></table>

<h5 id="\mautic\corebundle\model\formmodel">\Mautic\CoreBundle\Model\FormModel</h5>

<p>The FormModel extends CommonModel and provides a set of helper methods for interacting with entities and repositories. To read more about these methods, refer to the <a href="#database">Database</a> section. </p>

<h4 id="getting-model-objects">Getting Model Objects</h4>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>

<span class="sd">/** @var \Mautic\LeadBundle\Model\LeadModel $leadModel */</span>
<span class="nv">$leadModel</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">factory</span><span class="o">-&gt;</span><span class="na">getModel</span><span class="p">(</span><span class="s1">'lead'</span><span class="p">);</span>

<span class="sd">/** @var \Mautic\LeadBundle\Model\ListModel $leadListModel */</span>
<span class="nv">$leadListModel</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">factory</span><span class="o">-&gt;</span><span class="na">getModel</span><span class="p">(</span><span class="s1">'lead.list'</span><span class="p">);</span>

<span class="sd">/** @var \MauticAddons\HelloWorldBundle\Model\ContactModel $contactModel */</span>
<span class="nv">$contactModel</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">factory</span><span class="o">-&gt;</span><span class="na">getModel</span><span class="p">(</span><span class="s1">'addon.helloWorld.contact'</span><span class="p">);</span>
</code></pre>

<p>To get a model object, use the MauticFactory&rsquo;s <code class="prettyprint">getModel()</code> method. </p>

<p>The <code class="prettyprint">getModel()</code> method accepts the name of the model in a special notation of <code class="prettyprint">bundleName.modelName</code> for Mautic core bundles or <code class="prettyprint">addon.bundleName.modelName</code> for addons. If the <code class="prettyprint">bundleName</code> and <code class="prettyprint">modelName</code> happens to be the same, then <code class="prettyprint">bundleName</code> (core bundles) or <code class="prettyprint">addon.bundleName</code> (addons) are also accepted.</p>

          <h3 id="views">Views</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="c1">//addons/HelloWorldBundle/Views/World/details.html.php
</span>
<span class="c1">// Check if the request is Ajax
</span><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">getRequest</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">isXmlHttpRequest</span><span class="p">())</span> <span class="p">{</span>

    <span class="c1">// Set tmpl for parent template
</span>    <span class="nv">$view</span><span class="p">[</span><span class="s1">'slots'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">'tmpl'</span><span class="p">,</span> <span class="s1">'Details'</span><span class="p">);</span>

    <span class="c1">// Extend index.html.php as the parent
</span>    <span class="nv">$view</span><span class="o">-&gt;</span><span class="na">extend</span><span class="p">(</span><span class="s1">'HelloWorldBundle:World:index.html.php'</span><span class="p">);</span>
<span class="p">}</span>
<span class="cp">?&gt;</span>

<span class="nt">&lt;div&gt;</span>
    <span class="c">&lt;!-- Desired content/markup --&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="c1">// addons/HelloWorldBundle/Views/World/index.html.php
</span>
<span class="c1">// Extend the base content
</span><span class="nv">$view</span><span class="o">-&gt;</span><span class="na">extend</span><span class="p">(</span><span class="s1">'MauticCoreBundle:Default:content.html.php'</span><span class="p">);</span>

<span class="c1">// Get tmpl from sub-template
</span><span class="nv">$tmpl</span> <span class="o">=</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">'slots'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'tmpl'</span><span class="p">,</span> <span class="s1">'Details'</span><span class="p">);</span>

<span class="c1">// Tell Mautic to call JS onLoad method
</span><span class="nv">$view</span><span class="p">[</span><span class="s1">'slots'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">'mauticContent'</span><span class="p">,</span> <span class="s1">'helloWorld'</span><span class="o">.</span><span class="nv">$tmpl</span><span class="p">);</span>

<span class="c1">// Set the page and header title
</span><span class="nv">$header</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$tmpl</span> <span class="o">==</span> <span class="s1">'World'</span><span class="p">)</span>
    <span class="o">?</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">'translator'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">trans</span><span class="p">(</span>
        <span class="s1">'addon.helloworld.worlds'</span><span class="p">,</span>
        <span class="k">array</span><span class="p">(</span><span class="s1">'%world%'</span> <span class="o">=&gt;</span> <span class="nb">ucfirst</span><span class="p">(</span><span class="nv">$world</span><span class="p">))</span>
    <span class="p">)</span> <span class="o">:</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">'translator'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">trans</span><span class="p">(</span><span class="s1">'addon.helloworld.manage_worlds'</span><span class="p">);</span>
<span class="nv">$view</span><span class="p">[</span><span class="s1">'slots'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">'headerTitle'</span><span class="p">,</span> <span class="nv">$header</span><span class="p">);</span>
<span class="cp">?&gt;</span>

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"helloworld-content"</span><span class="nt">&gt;</span>
    <span class="cp">&lt;?php</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">'slots'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">output</span><span class="p">(</span><span class="s1">'_content'</span><span class="p">);</span> <span class="cp">?&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre>

<p>Views take data given it from the controller and displays the content to the user. Templates can be called from the controller or from within other templates.</p>

<p>It was discussed in the Controller&rsquo;s <a href="#delegateredirect($url)">delegateView() method</a> how to render a view from a controller. Remember that delegateView uses contentTemplate to determine what view to render.</p>

<p>Similar to controller notation, views are noted as <code class="prettyprint">HelloWorldBundle:Contact:form.html.php</code> which will point to the file <code class="prettyprint">/path/to/mautic/addons/HelloWorldBundle/Views/Contact/form.html.php</code>. </p>

<aside class="notice">
View notation is in the format of <code>BundleName:ViewName:template.html.php</code>. To use a view that has been nested in Views, use <code>BundleName:ViewName\Subfolder:template.html.php</code>.
</aside>

<h4 id="view-parameters">View Parameters</h4>

<p>Remember the array passed via viewParameters in the Controller&rsquo;s <a href="#delegateview($args)">delegateView() method</a>? Here is where the elements of that array will be made available as variables.  </p>

<p>For example, <code class="prettyprint">$world</code> will be available and assigned the value of <code class="prettyprint">mars</code> from the following example: </p>

<p><pre class="inline">
 &#39;viewParameters&#39;  =&gt; array(
     &#39;world&#39; =&gt; &#39;mars&#39;
 ),
 </pre></p>

<p>By default there are a couple variables available and should not be overridden by the controller</p>

<table><thead>
<tr>
<th>Variable</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>$view</strong></td>
<td>Contains all the helper objects available to templates along with providing methods for extending and/or rendering other templates.</td>
</tr>
<tr>
<td><strong>$app</strong></td>
<td>Gives access to request and session to views via <code class="prettyprint">$app-&gt;getRequest()</code> and <code class="prettyprint">$app-&gt;getSession()</code></td>
</tr>
</tbody></table>

<h4 id="extending-views">Extending Views</h4>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>

<span class="c1">// Extends the full document with menu, page header, etc
</span><span class="nv">$view</span><span class="o">-&gt;</span><span class="na">extend</span><span class="p">(</span><span class="s1">'MauticCoreBundle:Default:content.html.php'</span><span class="p">);</span>
</code></pre>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>

<span class="c1">// Extends the "slim" document which includes just the head and body with main content; does not include menu, page header, etc.
</span><span class="nv">$view</span><span class="o">-&gt;</span><span class="na">extend</span><span class="p">(</span><span class="s1">'MauticCoreBundle:Default:content.html.php'</span><span class="p">);</span>
</code></pre>

<p>Because of the use of Ajax, views must also be able to return main content vs the entire document. This is done by extending Mautic&rsquo;s base templates. Notice the notation is the same as what is used in controllers.</p>

<p>To determine if the request is Ajax or not, use <code class="prettyprint">$app-&gt;getRequest()-&gt;isXmlHttpRequest()</code>. Another option is to make the determination in the controller and pass it in the <code class="prettyprint">viewParameters</code> array.</p>

<p>Of course, this can also be used to extend custom templates as demonstrated in <a href="#views">this code example</a>.</p>

<aside>
The controller should call the sub-template.
</aside>

<aside class="notice">
It may help to note that extended templates are rendered inside out. So if <code>HelloWorldBundle:World:details.html.php</code> extends <code>HelloWorldBundle:World:index.html.php</code> which extends <code>MauticCoreBundle:Default:content.html.php</code>, the content of details.html.php will be rendered first and injected into index.html.php as it is rendered. <code>HelloWorldBundle:World:template1.html.php</code> will be rendered last.
</aside>

<p>To include the content from the sub-template in the parent template, use <code class="prettyprint">$view[&#39;slots&#39;]-&gt;output(&#39;_content&#39;);</code>. See the <a href="#slots-helper">Slots Helper</a> for more information.</p>

<h4 id="rendering-views-within-views">Rendering Views within Views</h4>

<p>To render the content of another template from within a template, simply use <code class="prettyprint">echo $view-&gt;render(&#39;BundleName:ViewName:template.html.php&#39;, array(&#39;parameter&#39; =&gt; &#39;value&#39;));</code></p>

<h4 id="template-helpers">Template Helpers</h4>

<p>There are a number of template helper objects and helper view templates that are built into Mautic.</p>

<h5 id="slots-helper">Slots Helper</h5>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>

<span class="c1">// Set a slot with content; will overwrite if slot already exists 
</span><span class="nv">$view</span><span class="p">[</span><span class="s1">'slots'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">'name'</span><span class="p">,</span> <span class="s1">'the content'</span><span class="p">);</span>

<span class="c1">// Append content to slot rather than overwrite
</span><span class="nv">$view</span><span class="p">[</span><span class="s1">'slots'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">append</span><span class="p">(</span><span class="s1">'name'</span><span class="p">,</span> <span class="s1">' and more content'</span><span class="p">);</span>
<span class="nv">$view</span><span class="p">[</span><span class="s1">'slots'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">append</span><span class="p">(</span><span class="s1">'existingArray'</span><span class="p">,</span> 
    <span class="k">array</span><span class="p">(</span>
        <span class="s1">'append'</span> <span class="o">=&gt;</span> <span class="s1">'me'</span>
    <span class="p">)</span>
<span class="p">);</span>

<span class="c1">// Get the slot content
</span><span class="nv">$content</span> <span class="o">=</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">'slots'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'name'</span><span class="p">,</span> <span class="s1">'default value'</span><span class="p">);</span>

<span class="c1">// Output the content; note that echo is not required
</span><span class="nv">$view</span><span class="p">[</span><span class="s1">'slots'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">output</span><span class="p">(</span><span class="s1">'name'</span><span class="p">);</span>

<span class="c1">// Check if a slot exists
</span><span class="k">if</span> <span class="p">(</span><span class="nv">$view</span><span class="p">[</span><span class="s1">'slots'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">has</span><span class="p">(</span><span class="s1">'name'</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// Do something
</span><span class="p">}</span>
</code></pre>

<p>As seen with extending views, the slots helper is used to pass content up through parent templates. Remember that extended templates are rendered inside out. So, content can be set in a sub template and accessed from the parent template but content set in a parent template, will not be available to the sub-template.</p>

<div class="clear-right"></div>

<h5 id="asset-helper">Asset Helper</h5>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>

<span class="c1">// Generate relative URL to image
</span><span class="k">echo</span> <span class="s1">'&lt;img src="'</span> <span class="o">.</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">'assets'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">getUrl</span><span class="p">(</span><span class="s1">'addons/HelloWorldBundle/assets/images/earth.png'</span><span class="p">)</span> <span class="o">.</span> <span class="s1">'" /&gt;'</span><span class="p">;</span>

<span class="c1">// Dynamically insert script into head
</span><span class="nv">$view</span><span class="p">[</span><span class="s1">'assets'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">includeScript</span><span class="p">(</span><span class="s1">'addons/HelloWorldBundle/assets/helloworld.js'</span><span class="p">);</span>

<span class="c1">// Dynamically insert stylesheet into head
</span><span class="nv">$view</span><span class="p">[</span><span class="s1">'assets'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">includeScript</span><span class="p">(</span><span class="s1">'addons/HelloWorldBundle/assets/helloworld.css'</span><span class="p">);</span>
</code></pre>

<p>The asset helper, accessed via <code class="prettyprint">$view[&#39;assets&#39;]</code>, is used to load assets into the DOM including images, script and stylesheets. </p>

<aside class="notice">
<code>$view['assets']</code> should always be used to ensure that assets work with Mautic installed in the web root, installed in a subdirectory, ran under the dev environment (index_dev.php), and/or ran under the prod environment.
</aside>

<p>The asset helper also provides a way to insert scripts and stylesheets into the head for ajax loaded content using <code class="prettyprint">$view[&#39;assets&#39;]-&gt;loadScript()</code> and <code class="prettyprint">$view[&#39;assets&#39;]-&gt;loadStylesheet()</code>.</p>

<div class="clear-right"></div>

<h5 id="router-helper">Router Helper</h5>
<pre><code class="highlight php"><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">'router'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">generate</span><span class="p">(</span><span class="s1">'addon_helloworld_world'</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'world'</span> <span class="o">=&gt;</span> <span class="s1">'mars'</span><span class="p">));</span> <span class="cp">?&gt;</span><span class="s">"</span> <span class="na">data-toggle=</span><span class="s">"ajax"</span> <span class="nt">/&gt;</span>Mars<span class="nt">&lt;/a&gt;</span>
</code></pre>

<p>The router helper, <code class="prettyprint">$view[&#39;router&#39;]</code>, works as explained in the <a href="#router">Router</a>.</p>

<div class="clear-right"></div>

<h5 id="translation-helper">Translation Helper</h5>
<pre><code class="highlight php"><span class="nt">&lt;h1&gt;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">'translator'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">trans</span><span class="p">(</span><span class="s1">'addon.helloworld.worlds'</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'%world%'</span><span class="p">,</span> <span class="s1">'Mars'</span><span class="p">);</span> <span class="cp">?&gt;</span><span class="nt">&lt;/h1&gt;</span>
</code></pre>

<p>The translation helper, <code class="prettyprint">$view[&#39;translator&#39;]</code>, works as explained in the <a href="#translator">Translator</a> section.</p>

<div class="clear-right"></div>

<h5 id="date-helper">Date Helper</h5>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>

<span class="c1">// Can be string or \DateTime object; if string, it's assumed local time unless noted otherwise via third argument to helper methods
</span><span class="nv">$datetime</span> <span class="o">=</span> <span class="s1">'2015-04-12 20:56:00'</span><span class="p">;</span>

<span class="c1">// Formats per full date system config setting 
</span><span class="nv">$fullDateTime</span> <span class="o">=</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">'date'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">toFull</span><span class="p">(</span><span class="nv">$datetime</span><span class="p">);</span>

<span class="c1">// Formats per short date system config setting
</span><span class="nv">$shortDateTime</span> <span class="o">=</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">'date'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">toShort</span><span class="p">(</span><span class="nv">$datetime</span><span class="p">);</span>

<span class="c1">// Formats per date only system config setting
</span><span class="nv">$date</span> <span class="o">=</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">'date'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">toDate</span><span class="p">(</span><span class="nv">$datetime</span><span class="p">);</span>

<span class="c1">// Formats per time only system config setting
</span><span class="nv">$time</span> <span class="o">=</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">'date'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">toTime</span><span class="p">(</span><span class="nv">$datetime</span><span class="p">);</span>

<span class="c1">// Formats as date only config setting + time only config setting
</span><span class="nv">$datetime</span> <span class="o">=</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">'date'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">toFullConcat</span><span class="p">(</span><span class="nv">$datetime</span><span class="p">);</span>

<span class="c1">// Formats date as Yesterday, 8:02 pm (Today or Tomorrow); otherwise 'x days ago'  
</span><span class="nv">$text</span> <span class="o">=</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">'date'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">toText</span><span class="p">(</span><span class="nv">$datetime</span><span class="p">);</span>

<span class="c1">// Format a string that is not already in local time
</span><span class="nv">$fullDateTime</span> <span class="o">=</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">'date'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">toFull</span><span class="p">(</span><span class="nv">$datetime</span><span class="p">,</span> <span class="s1">'Y-m-d H:i:s'</span><span class="p">,</span> <span class="s1">'UTC'</span><span class="p">);</span>
</code></pre>

<p>The date helper can be used to format dates based on system and/or user settings. </p>

<p>The first argument to the various methods can either be a date/time string or a \DateTime object. If a string, it is expected to be formatted as &lsquo;Y-m-d H:i:s&rsquo; and already in the user&rsquo;s and/or system&rsquo;s local time. If it is not, pass the format as the second argument and the timezone (string) as the third.</p>

<div class="clear-right"></div>

<h5 id="form-helper">Form Helper</h5>
<pre><code class="highlight php"><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">'form'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">form</span><span class="p">(</span><span class="nv">$form</span><span class="p">);</span> <span class="cp">?&gt;</span>
</code></pre>

<p>The form helper, <code class="prettyprint">$view[&#39;form&#39;]</code>, works as explained in the <a href="#form-template-helper">Form</a> section.</p>

<div class="clear-right"></div>

<h4 id="view-helper-templates">View Helper Templates</h4>

<p>@todo</p>

<div class="clear-right"></div>

<h4 id="processing-ajax-content">Processing Ajax Content</h4>

<p>Mautic provides built in ways to ajaxify links, modals, and forms.</p>

<h5 id="ajax-links">Ajax Links</h5>
<pre><code class="highlight php"><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">'router'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">generate</span><span class="p">(</span><span class="s1">'addon_helloworld_world'</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'world'</span> <span class="o">=&gt;</span> <span class="s1">'mars'</span><span class="p">));</span> <span class="cp">?&gt;</span><span class="s">"</span> <span class="na">data-toggle=</span><span class="s">"ajax"</span> <span class="nt">/&gt;</span>Mars<span class="nt">&lt;/a&gt;</span>
</code></pre>

<p>To ajaxify a link, set the attribute <code class="prettyprint">data-target=&quot;ajax&quot;</code></p>

<h5 id="ajax-modals">Ajax Modals</h5>
<pre><code class="highlight php"><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">'router'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">generate</span><span class="p">(</span><span class="s1">'addon_helloworld_world'</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'world'</span> <span class="o">=&gt;</span> <span class="s1">'mars'</span><span class="p">));</span> <span class="cp">?&gt;</span><span class="s">"</span> 
   <span class="na">data-toggle=</span><span class="s">"ajaxmodal"</span>
   <span class="na">data-target=</span><span class="s">"#MauticSharedModal"</span>
   <span class="na">data-header=</span><span class="s">"</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">'translator'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">trans</span><span class="p">(</span><span class="s1">'addon.helloworld.worlds'</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'%world%'</span><span class="p">,</span> <span class="s1">'Mars'</span><span class="p">));</span> <span class="cp">?&gt;</span><span class="s">"</span><span class="nt">&gt;</span>Mars<span class="nt">&lt;/a&gt;</span>
</code></pre>

<p>Mautic uses Bootstrap modals but Bootstrap lacks an easy way to dynamically retrieve content more than once. Thus, Mautic provides the attribute <code class="prettyprint">data-toggle=&quot;ajaxmodal&quot;</code> to help with this.</p>

<p><code class="prettyprint">data-target</code> should be the selector of the model to inject the content into. Mautic has a modal, <code class="prettyprint">#MauticSharedModal</code> on standby to be used for this very purpose.</p>

<p><code class="prettyprint">data-header</code> will set the modal&rsquo;s header.</p>

<h5 id="ajax-forms">Ajax Forms</h5>

<p>When using Symfony&rsquo;s <a href="#forms">form services</a>, the form will be auto-ajaxified.</p>

<h5 id="ajax-content-callbacks">Ajax Content Callbacks</h5>
<pre><code class="highlight plaintext">Mautic.helloWorldDetailsOnLoad = function(container, response) {
    // Manipulate content 
};

Mautic.helloWorldDetailsOnUnload = function(container, response) {
    // Manipulate content 
};
</code></pre>

<p>Mautic provides a way to execute a javascript function after it injects ajax content into the DOM. This can be useful to activate various JS driven features such as typeaheads, charts, bind events, etc.</p>

<p>To take advantage of this, utilize the mauticContent element in the passthroughVars array from the controller&rsquo;s <a href="#delegateView($args)">delegateView()</a>. The value of this variable will determine what function should be called after the content has been injected.</p>

<p>For example, the method <code class="prettyprint">Mautic.helloWorldDetailsOnLoad()</code> will be called for the following: </p>

<p><pre class='inline'>
 &#39;passthroughVars&#39; =&gt; array(
     &#39;activeLink&#39;    =&gt; &#39;addon_helloworld_world&#39;,
     &#39;route&#39;         =&gt; $this-&gt;generateUrl(&#39;addon_helloworld_world&#39;, array(&#39;world&#39; =&gt; $world)),
     &#39;mauticContent&#39; =&gt; &#39;helloWorldDetails&#39;
 )
 </pre></p>

<p>When the user browses away from the page, <code class="prettyprint">Mautic.helloWorldDetailsOnUnload()</code> will be called to give opportunity to destroy objects if necessary.</p>

<p>Both the OnLoad and OnUnload methods are passed two arguments.</p>

<table><thead>
<tr>
<th>Argument</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>container</td>
<td>The selector that was used as the target of the ajax content.</td>
</tr>
<tr>
<td>response</td>
<td>The object from the ajax response, i.e. set in the passthroughVars from the Controller</td>
</tr>
</tbody></table>

<p><code class="prettyprint">mauticContent</code> should also be set via <code class="prettyprint">$view[&#39;slots&#39;]</code> in the <a href="#slots-helper">view&rsquo;s</a> main page. </p>

<pre class="inline">
$view['slots']->set('mauticContent', 'helloBundleDetails');
</pre>

<p>Doing so will ensure <code class="prettyprint">Mautic.helloWorldDetailsOnLoad()</code> is also called when there is a page refresh.</p>

          <h2 id="factory-service">Factory Service</h2>

<p>Mautic&rsquo;s factory service gives quick access to the most commonly used services such as the router, request, translator, database, etc along with providing a few helper methods.</p>

<p>For <a href="#controllers">controllers</a>, extend either <code class="prettyprint">\Mautic\CoreBundle\Controller\CommonController</code> or <code class="prettyprint">\Mautic\CoreBundle\Controller\FormController</code> and it will be available via <code class="prettyprint">$this-&gt;factory</code> by default. Otherwise, obtain the factory from the service container via <code class="prettyprint">$factory = $this-&gt;container-&gt;get(&#39;mautic.factory&#39;);</code></p>

<p>For <a href="#models">models</a>, it will be available via <code class="prettyprint">$this-&gt;factory</code> by default.</p>

<p>For custom <a href="#services">services</a>, pass &lsquo;mautic.factory&rsquo; as an argument and MauticFactory will be passed into the __construct of the service.</p>

<h3 id="user">User</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="nv">$user</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">factory</span><span class="o">-&gt;</span><span class="na">getUser</span><span class="p">();</span>

<span class="nv">$firstName</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getFirstname</span><span class="p">();</span>
<span class="nv">$lastName</span>  <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getLastname</span><span class="p">();</span>
<span class="nv">$email</span>     <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getEmail</span><span class="p">();</span>
<span class="nv">$profile</span>   <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getProfile</span><span class="p">();</span>

<span class="nv">$role</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getRole</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getName</span><span class="p">();</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$role</span><span class="o">-&gt;</span><span class="na">isAdmin</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">// do something
</span><span class="p">}</span>
</code></pre>

<p><code class="prettyprint">getUser()</code> will return the <a href="#database">entity</a>, \Mautic\UserBundle\Entity\User that can then be used to get information about the currently logged in user.</p>

<h3 id="security">Security</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>

<span class="nv">$security</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">factory</span><span class="o">-&gt;</span><span class="na">getSecurity</span><span class="p">();</span>

<span class="c1">// Check if user is granted a single permission
</span><span class="k">if</span> <span class="p">(</span><span class="nv">$security</span><span class="o">-&gt;</span><span class="na">isGranted</span><span class="p">(</span><span class="s1">'addon:helloWorld:worlds:view'</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// do something
</span><span class="p">}</span>

<span class="c1">// Check if user is granted multiple permissions (must be granted to all to be true)
</span><span class="k">if</span> <span class="p">(</span><span class="nv">$security</span><span class="o">-&gt;</span><span class="na">isGranted</span><span class="p">(</span>
    <span class="k">array</span><span class="p">(</span>
        <span class="s1">'addon:helloWorld:worlds:view'</span><span class="p">,</span>
        <span class="s1">'addon:helloWorld:worlds:create'</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="p">)</span> <span class="p">{</span>
    <span class="c1">//do something
</span><span class="p">}</span>

<span class="c1">// Check if user is granted to at least one permission
</span><span class="k">if</span> <span class="p">(</span><span class="nv">$security</span><span class="o">-&gt;</span><span class="na">isGranted</span><span class="p">(</span>
    <span class="k">array</span><span class="p">(</span>
        <span class="s1">'addon:helloWorld:worlds:view'</span><span class="p">,</span>
        <span class="s1">'addon:helloWorld:worlds:edit'</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="s1">'MATCH_ONE'</span>
<span class="p">)</span>
<span class="p">)</span> <span class="p">{</span>
    <span class="c1">//do something
</span><span class="p">}</span>

<span class="c1">// Get an array of user permissions
</span><span class="nv">$permissions</span> <span class="o">=</span> <span class="nv">$security</span><span class="o">-&gt;</span><span class="na">isGranted</span><span class="p">(</span>
    <span class="k">array</span><span class="p">(</span>
        <span class="s1">'addon:helloWorld:worlds:view'</span><span class="p">,</span>
        <span class="s1">'addon:helloWorld:worlds:edit'</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="s1">'RETURN_ARRAY'</span>
<span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$permissions</span><span class="p">[</span><span class="s1">'addon:helloWorld:worlds:view'</span><span class="p">])</span> <span class="p">{</span>
    <span class="c1">// do something
</span><span class="p">}</span>

<span class="c1">// Check to see if a user is anonymous (not logged in)
</span><span class="k">if</span> <span class="p">(</span><span class="nv">$security</span><span class="o">-&gt;</span><span class="na">isAnonymous</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">// do something
</span><span class="p">}</span>

<span class="c1">// Get object of currently logged in user
</span><span class="nv">$user</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">factory</span><span class="o">-&gt;</span><span class="na">getUser</span><span class="p">();</span>
</code></pre>

<p>Obtain the security service from <a href="#factory-service">Mautic&rsquo;s factory service</a> via <code class="prettyprint">$this-&gt;factory-&gt;getSecurity()</code>.</p>

<p>Using the service to check permissions is explained more in <a href="#using-permissions">Using Permissions</a>.</p>

<h3 id="translator">Translator</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span> 
<span class="c1">// Simple string
</span><span class="k">echo</span> <span class="nv">$translator</span><span class="o">-&gt;</span><span class="na">trans</span><span class="p">(</span><span class="s1">'addon.helloworld.goodbye'</span><span class="p">);</span>

<span class="c1">// Simple string with placeholders
</span><span class="k">echo</span> <span class="nv">$translator</span><span class="o">-&gt;</span><span class="na">trans</span><span class="p">(</span><span class="s1">'addon.helloworld.greeting'</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'%name%'</span> <span class="o">=&gt;</span> <span class="nv">$name</span><span class="p">));</span>

<span class="c1">// String from a domain other than messages (will use planets.ini)
</span><span class="k">echo</span> <span class="nv">$translator</span><span class="o">-&gt;</span><span class="na">trans</span><span class="p">(</span><span class="s1">'addon.helloworld.worlds'</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'%world%'</span> <span class="o">=&gt;</span> <span class="nv">$world</span><span class="p">),</span> <span class="s1">'planets'</span><span class="p">);</span>

<span class="c1">// Plural translations
</span><span class="nv">$planetCount</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="k">echo</span> <span class="nv">$translator</span><span class="o">-&gt;</span><span class="na">transChoice</span><span class="p">(</span><span class="s1">'addon.helloworld.number_of_planets'</span><span class="p">,</span> <span class="nv">$planetCount</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'%planets%'</span> <span class="o">=&gt;</span> <span class="nv">$planetCount</span><span class="p">));</span>

<span class="c1">// Check to see if a translation key exists
</span><span class="k">if</span> <span class="p">(</span><span class="nv">$translator</span><span class="o">-&gt;</span><span class="na">hasId</span><span class="p">(</span><span class="s1">'addon.helloworld.goodbye'</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$translator</span><span class="o">-&gt;</span><span class="na">trans</span><span class="p">(</span><span class="s1">'addon.helloworld.goodbye'</span><span class="p">);</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// other logic
</span><span class="p">}</span>

<span class="c1">// Use the first key if it exists, otherwise use the second (helpful to prevent managing duplicate keys with the same string)
</span><span class="k">echo</span> <span class="nv">$translator</span><span class="o">-&gt;</span><span class="na">transConditional</span><span class="p">(</span><span class="s1">'addon.helloworld.planets.'</span> <span class="o">.</span> <span class="nv">$planet</span><span class="p">,</span> <span class="s1">'addon.helloworld.dwarf_planets. '</span> <span class="o">.</span> <span class="nv">$planet</span><span class="p">);</span>
</code></pre>

<p>Use the translator service to include translated strings in the code. Depending on where the translation is necessary will determine how to obtain the service.</p>

<p>From controllers, models, and any service that has access to <a href="#factory-service">Mautic&rsquo;s factory service</a> (mautic.factory), simply use <code class="prettyprint">$translator = $this-&gt;factory-&gt;getTranslator();</code>.</p>

<p>To use the template service in view templates, simply use the <a href="#translation-helper">template helper</a>, <code class="prettyprint">$view[&#39;translator&#39;]</code>.</p>

<p>The translator service has the following functions to help with translating strings:</p>

<p><strong>Simple translation</strong><br />
<code class="prettyprint">trans($id, array $parameters = array(), $domain = null, $locale = null)</code></p>

<p><strong><a href="http://symfony.com/doc/current/components/translation/usage.html#pluralization">Pluralization</a></strong><br /> 
<code class="prettyprint">transChoice($id, $number, array $parameters = array(), $domain = null, $locale = null)</code></p>

<p><strong>Check to see if a key exists</strong><br />
<code class="prettyprint">hasId($id, $domain = null, $locale = null)</code></p>

<p><strong>Use the $preferred key if it exists, if not, use $alternative</strong><br />
<code class="prettyprint">transConditional($preferred, $alternative, $parameters = array(), $domain = null, $locale = null)</code></p>

<h3 id="router">Router</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span> 

<span class="nv">$router</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">factory</span><span class="o">-&gt;</span><span class="na">getRouter</span><span class="p">();</span>

<span class="c1">// Relative URL
</span><span class="nv">$url</span> <span class="o">=</span> <span class="nv">$router</span><span class="o">-&gt;</span><span class="na">generateUrl</span><span class="p">(</span><span class="s1">'addon_helloworld_admin'</span><span class="p">);</span>

<span class="c1">// URL with placeholders
</span><span class="nv">$url</span> <span class="o">=</span> <span class="nv">$router</span><span class="o">-&gt;</span><span class="na">generateUrl</span><span class="p">(</span><span class="s1">'addon_helloworld_world'</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'%world%'</span><span class="p">,</span> <span class="s1">'mars'</span><span class="p">));</span>

<span class="c1">// Absolute URL
</span><span class="nv">$absoluteUrl</span> <span class="o">=</span> <span class="nv">$router</span><span class="o">-&gt;</span><span class="na">generateUrl</span><span class="p">(</span><span class="s1">'addon_helloworld_admin'</span><span class="p">,</span> <span class="k">array</span><span class="p">(),</span> <span class="kc">true</span><span class="p">);</span>
</code></pre>
<pre><code class="highlight php"><span class="cp">&lt;?php</span> 

<span class="c1">// Generate a URL in a view template
</span><span class="nv">$url</span> <span class="o">=</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">'router'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">generate</span><span class="p">(</span><span class="s1">'addon_helloworld_admin'</span><span class="p">);</span>

</code></pre>

<p>For controllers, models, and services with <a href="#factory-service">Mautic&rsquo;s factory service</a> set as an argument, the router service can be easily obtained from using <code class="prettyprint">$this-&gt;factory-&gt;getRouter()</code>.</p>

<p>For views, use the <code class="prettyprint">$view[&#39;router&#39;]</code> helper. The difference with the <a href="#router-helper">template helper</a> is that <code class="prettyprint">generate()</code> is used instead of <code class="prettyprint">generateUrl</code>.</p>

<h3 id="request">Request</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>

<span class="nv">$request</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">factory</span><span class="o">-&gt;</span><span class="na">getRequest</span><span class="p">();</span>

<span class="c1">// $_GET
</span><span class="nv">$get</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">();</span>

<span class="c1">// $_POST
</span><span class="nv">$post</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">();</span>

<span class="c1">// $_COOKIE
</span><span class="nv">$cookies</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">cookies</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">();</span>

<span class="c1">// $_SERVER
</span><span class="nv">$server</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">server</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">();</span>

<span class="c1">// Headers
</span><span class="nv">$headers</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">headers</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">();</span>

<span class="c1">// Attributes - custom parameters
</span><span class="nv">$headers</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">attributes</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">();</span>

<span class="c1">// Check if a parameter exists
</span><span class="k">if</span> <span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">has</span><span class="p">(</span><span class="s1">'hello'</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// do something
</span><span class="p">}</span>

<span class="c1">// Retrieve value of a specific parameter setting mars as default
</span><span class="nv">$world</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'world'</span><span class="p">,</span> <span class="s1">'mars'</span><span class="p">);</span>

<span class="c1">// Set custom request value
</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">attributes</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">'hello'</span><span class="p">,</span> <span class="s1">'world'</span><span class="p">);</span>

<span class="c1">// Get the value of a nested array
</span><span class="nv">$mars</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'world[mars]'</span><span class="p">,</span> <span class="k">array</span><span class="p">(),</span> <span class="kc">true</span><span class="p">);</span>
</code></pre>

<p>There are multiple ways to obtain the request service.</p>

<p>If the controller is extending one of <a href="#controllers">Mautic&rsquo;s controllers</a>, it is already available via <code class="prettyprint">$request</code>.</p>

<p>Otherwise, if from with a model or a service with access to <a href="#factory-service">Mautic&rsquo;s factory service</a>, use <code class="prettyprint">$this-&gt;factory-&gt;getRequest()</code>.</p>

<p>From within a view, use <code class="prettyprint">$app-&gt;getRequest()</code>.</p>

<h3 id="session">Session</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>

<span class="nv">$session</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">factory</span><span class="o">-&gt;</span><span class="na">getSession</span><span class="p">();</span>

<span class="c1">// Get all session parameters
</span><span class="nv">$all</span> <span class="o">=</span> <span class="nv">$session</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">();</span>

<span class="c1">// Get specific parameter setting mars as default
</span><span class="nv">$world</span> <span class="o">=</span> <span class="nv">$session</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'helloworld.world'</span><span class="p">,</span> <span class="s1">'mars'</span><span class="p">);</span>

<span class="c1">// Check if a parameter exists
</span><span class="k">if</span> <span class="p">(</span><span class="nv">$session</span><span class="o">-&gt;</span><span class="na">has</span><span class="p">(</span><span class="s1">'helloworld.world'</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// do something
</span><span class="p">}</span>

<span class="c1">// Set a session parameter
</span><span class="nv">$session</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">'helloworld.world'</span><span class="p">,</span> <span class="s1">'mars'</span><span class="p">);</span>

<span class="c1">// Remove a session parameter
</span><span class="nv">$session</span><span class="o">-&gt;</span><span class="na">remove</span><span class="p">(</span><span class="s1">'helloworld.world'</span><span class="p">);</span>

<span class="c1">// Clear the whole session
</span><span class="nv">$session</span><span class="o">-&gt;</span><span class="na">clear</span><span class="p">();</span>
</code></pre>

<p>To obtain the session service from a controller, model, or a service with access to <a href="#factory-service">Mautic&rsquo;s factory service</a>, use <code class="prettyprint">$this-&gt;factory-&gt;getSession()</code>.</p>

<p>From within a view, use <code class="prettyprint">$app-&gt;getSession()</code>.</p>

<h3 id="database/entity-manager">Database/Entity Manager</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="nv">$em</span>         <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">factory</span><span class="o">-&gt;</span><span class="na">getEntityManager</span><span class="p">();</span>
<span class="nv">$repository</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">getRepository</span><span class="p">(</span><span class="s1">'HelloWorldBundle:World'</span><span class="p">);</span>
<span class="nv">$worlds</span>     <span class="o">=</span> <span class="nv">$repository</span><span class="o">-&gt;</span><span class="na">getEntities</span><span class="p">();</span>

<span class="sd">/** @var \MauticAddon\HelloWorldBundle\Entity\World $world */</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$worlds</span> <span class="k">as</span> <span class="nv">$world</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$world</span><span class="o">-&gt;</span><span class="na">upVisitCount</span><span class="p">();</span>
<span class="p">}</span>

<span class="nv">$repository</span><span class="o">-&gt;</span><span class="na">saveEntities</span><span class="p">(</span><span class="nv">$worlds</span><span class="p">);</span>
</code></pre>

<p>The entity manager can be used to interact with the bundle&rsquo;s repositories and entities. See <a href="##database">Database</a> for more info. </p>

          <h2 id="database">Database</h2>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="c1">// addons/HelloWorldBundle/Entity/World.php
</span>
<span class="k">namespace</span> <span class="nx">MauticAddon\HelloWorldBundle\Entity</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Doctrine\ORM\Mapping</span> <span class="k">as</span> <span class="nx">ORM</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Mautic\CategoryBundle\Entity\Category</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Mautic\CoreBundle\Entity\CommonEntity</span><span class="p">;</span>

<span class="sd">/**
 * Class World
 * @ORM\Table(name="worlds")
 * @ORM\Entity(repositoryClass="MauticAddon\HelloWorldBundle\Entity\WorldRepository")
 */</span>
<span class="k">class</span> <span class="nc">World</span> <span class="k">extends</span> <span class="nx">CommonEntity</span>
<span class="p">{</span>

    <span class="sd">/**
     * @ORM\Column(type="integer")
     * @ORM\Id()
     * @ORM\GeneratedValue(strategy="AUTO")
     */</span>
    <span class="k">private</span> <span class="nv">$id</span><span class="p">;</span>

    <span class="sd">/**
     * @ORM\Column(type="string")
     */</span>
    <span class="k">private</span> <span class="nv">$name</span><span class="p">;</span>

    <span class="sd">/**
     * @ORM\Column(type="text", nullable=true)
     */</span>
    <span class="k">private</span> <span class="nv">$description</span><span class="p">;</span>

    <span class="sd">/**
     * @ORM\ManyToOne(targetEntity="Mautic\CategoryBundle\Entity\Category")
     * @ORM\JoinColumn(onDelete="SET NULL")
     */</span>
    <span class="k">private</span> <span class="nv">$category</span><span class="p">;</span>

    <span class="sd">/**
     * @ORM\Column(name="visit_count", type="integer", nullable=true)
     */</span>
    <span class="k">private</span> <span class="nv">$visitCount</span><span class="p">;</span>

    <span class="sd">/**
     * @return mixed
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getId</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**
     * @return mixed
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getName</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**
     * @param mixed $name
     *
     * @return World
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setName</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">=</span> <span class="nv">$name</span><span class="p">;</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**
     * @return mixed
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getDescription</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">description</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**
     * @param mixed $description
     *
     * @return World
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setDescription</span><span class="p">(</span><span class="nv">$description</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">description</span> <span class="o">=</span> <span class="nv">$description</span><span class="p">;</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**
     * @return Category
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getCategory</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">category</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**
     * @param mixed $category
     *
     * @return World
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setCategory</span><span class="p">(</span><span class="nx">Category</span> <span class="nv">$category</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">category</span> <span class="o">=</span> <span class="nv">$category</span><span class="p">;</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**
     * @return mixed
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getVisitCount</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">visitCount</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**
     * @param mixed $visitCount
     *
     * @return World
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setVisitCount</span><span class="p">(</span><span class="nv">$visitCount</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">visitCount</span> <span class="o">=</span> <span class="nv">$visitCount</span><span class="p">;</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**
     * Increase the visit count by one
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">upVisitCount</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">visitCount</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="c1">// addons/HelloWorldBundle/Entity/WorldRepository.php
</span>
<span class="k">namespace</span> <span class="nx">MauticAddon\HelloWorldBundle\Entity</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Mautic\CoreBundle\Entity\CommonRepository</span><span class="p">;</span>

<span class="sd">/**
 * WorldRepository
 */</span>
<span class="k">class</span> <span class="nc">WorldRepository</span> <span class="k">extends</span> <span class="nx">CommonRepository</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getEntities</span><span class="p">(</span><span class="nv">$args</span> <span class="o">=</span> <span class="k">array</span><span class="p">())</span>
    <span class="p">{</span>
        <span class="nv">$q</span> <span class="o">=</span> <span class="nv">$this</span>
            <span class="o">-&gt;</span><span class="na">createQueryBuilder</span><span class="p">(</span><span class="s1">'w'</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">leftJoin</span><span class="p">(</span><span class="s1">'a.category'</span><span class="p">,</span> <span class="s1">'c'</span><span class="p">);</span>

        <span class="nv">$args</span><span class="p">[</span><span class="s1">'qb'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$q</span><span class="p">;</span>

        <span class="k">return</span> <span class="k">parent</span><span class="o">::</span><span class="na">getEntities</span><span class="p">(</span><span class="nv">$args</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>Mautic uses <a href="#http://doctrine-orm.readthedocs.org/en/latest/">Doctrine</a>, a database object relational mapper (ORM) and database abstraction layer (DBAL) library.</p>

<p>Most of Mautic use <a href="http://symfony.com/doc/current/book/doctrine.html#creating-an-entity-class">entity and repository classes</a> to define the schema and interact with the database.</p>

<h4 id="usage">Usage</h4>

<p>Refer to <a href="http://symfony.com/doc/current/book/doctrine.html">Symfony&rsquo;s</a> and <a href="http://doctrine-orm.readthedocs.org/en/latest">Doctrine&rsquo;s</a> documentation on the specifics of how to interact with the Database.</p>

<h4 id="metadata/schema">Metadata/Schema</h4>

<p>In 1.0.x-1.1.x, Mautic uses <a href="#http://doctrine-orm.readthedocs.org/en/latest/reference/basic-mapping.html">Doctrine annotations driver </a> to map entity metadata which in turn defines the schema structure.</p>

<aside class="warning">
A problem with this method for many shared hosts is the number of cache files it generates (can be 800+ files). Thus, planned for 1.2, metadata mapping will be switched to using the Doctrine&rsquo;s <a href="http://doctrine-orm.readthedocs.org/en/latest/reference/php-mapping.html#static-function" target="_new">PHP driver</a> by leveraging the entity&rsquo;s static <code>loadMetadata()</code> function.
</aside>

<h4 id="installing/updating-schema">Installing/Updating Schema</h4>

<p>When an addon is installed or updated, the bundle&rsquo;s onInstall or onUpgrade functions are called.  These functions can be used to manipulate the database schema. See <a href="#install/upgrade">Install/Upgrade</a>.</p>

<h4 id="table-prefix">Table Prefix</h4>

<p>Mautic allows custom table prefixes.  If using ORM, there is no need to include the prefix as Mautic will automatically handle it.  However, if there is a need to use Doctrine&rsquo;s DBAL layer directly, the contstant <code class="prettyprint">MAUTIC_TABLE_PREFIX</code> can be used in conjuction with the table name.</p>

<h4 id="query-builder-best-practices">Query Builder Best Practices</h4>

<p>Due to Mautic supporting both MySQL and Postgres, it is best to use Doctrine&rsquo;s query builders when possible. Here are some notes when using the query builders:</p>

<p><code class="prettyprint">-&gt;groupBy()</code> must include the same columns included in <code class="prettyprint">-&gt;select()</code></p>

<p><code class="prettyprint">-&gt;where()</code> statements that include something like <code class="prettyprint">&#39;my_boolean_column = 1&#39;</code> must be
<code class="prettyprint">-&gt;where(&#39;my_boolean_column = :true&#39;)-&gt;setParameter(&#39;true&#39;, true, &#39;boolean&#39;)</code></p>

<p>The same applies for <code class="prettyprint">-&gt;expr()-&gt;eq(&#39;l.isPublished&#39;, true)</code></p>

<p>Instead use</p>

<p><code class="prettyprint">-&gt;where($qb-&gt;expr()-&gt;eq(&#39;l.isPublished&#39;, &#39;:true&#39;))-&gt;setParameter(&#39;true&#39;, true, &#39;boolean&#39;)</code></p>

<p>Of course the same principle applies to = 0 or false.</p>

<p><code class="prettyprint">-&gt;select(sum(my_boolean_column) as total)</code> works in MySql but will fail in others.  Either type case the entity property as an integer or use</p>

<p><code class="prettyprint">count(CASE WHEN my_boolean_column THEN 1 ELSE null END)</code></p>

<p>Mysql does not like the above in a <code class="prettyprint">where()</code> statement.  Use <code class="prettyprint">having()</code> instead.</p>

<p>Aliases should be lower case or in quotations as Postgres will return the result lower case if not quoted which will lead to PHP errors when used as array keys.</p>

<p><code class="prettyprint">-&gt;select(&#39;f.field as myField&#39;)</code> will return as <code class="prettyprint">myfield</code></p>

<p><code class="prettyprint">-&gt;select(&#39;f.field as &quot;myField&quot;&#39;)</code> will return as <code class="prettyprint">myField</code></p>

<p><strong>Quoting aliases will not work for ORM.  If using ORM, use lower case.</strong></p>

<p>When using ORM, Mautic will automatically convert DateTime properties to UTC and to the system/user&rsquo;s profile timezone on retrieval.  However, if using DBAL, DateTime strings must be converted to UTC before persisting and to the local timezone on retrieval.  See <a href="#date/time-helper">Date/Time Helper</a> to assist with conversions.</p>

          <h2 id="roles-and-permissions">Roles and Permissions</h2>

<p>Mautic provides a means of defining custom permissions for roles through Permission objects.</p>

<h3 id="how-permissions-work">How Permissions Work</h3>

<p>Permissions are calculated based on bits assigned to an addon&rsquo;s level and permission. Bits are integers that increase by doubling the value. 1, 2, 4, 8, 16, 32, 64, 128, 512, 1024, and so forth. The bits should never be assigned numbers in between such as 3 or 5 as the permission will not be correctly calculated in such cases.</p>

<p>For example, let&rsquo;s say HelloWorldBundle needs to manage access to user&rsquo;s Worlds entity. A permission set for <code class="prettyprint">addon:helloWorld:worlds</code> might look like</p>

<table><thead>
<tr>
<th>Permission</th>
<th>Bit</th>
</tr>
</thead><tbody>
<tr>
<td>view</td>
<td>1</td>
</tr>
<tr>
<td>edit</td>
<td>2</td>
</tr>
<tr>
<td>create</td>
<td>4</td>
</tr>
<tr>
<td>delete</td>
<td>8</td>
</tr>
<tr>
<td>full</td>
<td>16</td>
</tr>
</tbody></table>

<aside class="notice">
<code>addon:helloWorld:worlds:view</code> is a typically notation for requesting permission in Mautic. The notation tells Mautic to check for the `view` permission for the addon, HelloWorldBundle, within the `worlds` level. Levels allow addon&rsquo;s to set permissions for multiple areas.
</aside>

<p>Mautic will take the summation of the bits for the permissions given to a role and store it in the database. For example, if a role is given view and edit access, the stored bit is 3. If given view and create access, the stored bit is 5.</p>

<p>When a permission check is required, e.g. <code class="prettyprint">addon:helloWorld:worlds:create</code>, Mautic will check if bit of 4 is set in the role&rsquo;s generated bit for <code class="prettyprint">addon:helloWorld:worlds</code>. If so, permission is granted.</p>

<aside class="notice">
The permission <code>full</code> is reserved to grant access to all previous permissions within the level and thus should always be the highest bit.
</aside>

<h3 id="using-permissions">Using Permissions</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>

<span class="nv">$security</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">factory</span><span class="o">-&gt;</span><span class="na">getSecurity</span><span class="p">();</span>

<span class="c1">// Check if user is granted a single permission
</span><span class="k">if</span> <span class="p">(</span><span class="nv">$security</span><span class="o">-&gt;</span><span class="na">isGranted</span><span class="p">(</span><span class="s1">'addon:helloWorld:worlds:view'</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// do something
</span><span class="p">}</span>

<span class="c1">// Check if user is granted multiple permissions (must be granted to all to be true)
</span><span class="k">if</span> <span class="p">(</span><span class="nv">$security</span><span class="o">-&gt;</span><span class="na">isGranted</span><span class="p">(</span>
    <span class="k">array</span><span class="p">(</span>
        <span class="s1">'addon:helloWorld:worlds:view'</span><span class="p">,</span>
        <span class="s1">'addon:helloWorld:worlds:create'</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="p">)</span> <span class="p">{</span>
    <span class="c1">//do something
</span><span class="p">}</span>

<span class="c1">// Check if user is granted to at least one permission
</span><span class="k">if</span> <span class="p">(</span><span class="nv">$security</span><span class="o">-&gt;</span><span class="na">isGranted</span><span class="p">(</span>
    <span class="k">array</span><span class="p">(</span>
        <span class="s1">'addon:helloWorld:worlds:view'</span><span class="p">,</span>
        <span class="s1">'addon:helloWorld:worlds:edit'</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="s1">'MATCH_ONE'</span>
<span class="p">)</span>
<span class="p">)</span> <span class="p">{</span>
    <span class="c1">//do something
</span><span class="p">}</span>

<span class="c1">// Get an array of user permissions
</span><span class="nv">$permissions</span> <span class="o">=</span> <span class="nv">$security</span><span class="o">-&gt;</span><span class="na">isGranted</span><span class="p">(</span>
    <span class="k">array</span><span class="p">(</span>
        <span class="s1">'addon:helloWorld:worlds:view'</span><span class="p">,</span>
        <span class="s1">'addon:helloWorld:worlds:edit'</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="s1">'RETURN_ARRAY'</span>
<span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$permissions</span><span class="p">[</span><span class="s1">'addon:helloWorld:worlds:view'</span><span class="p">])</span> <span class="p">{</span>
    <span class="c1">// do something
</span><span class="p">}</span>

<span class="c1">// Check if user has access to view leads
</span><span class="k">if</span> <span class="p">(</span><span class="nv">$security</span><span class="o">-&gt;</span><span class="na">isGranted</span><span class="p">(</span><span class="s1">'lead:leads:viewother'</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// do something
</span><span class="p">}</span>
</code></pre>

<p>To determine if a user has a specific permission, use Mautic&rsquo;s security service which can be obtained from the <a href="#factory-service">factory service</a> via <code class="prettyprint">$this-&gt;factory-&gt;getSecurity()</code>.</p>

<p>As suggested above, Mautic uses a special permission notation to refer to a specific permission. For core bundles, <code class="prettyprint">bundleName:permissionLevel:permission</code> is used.  For addons, append <code class="prettyprint">addon:</code>, i.e. <code class="prettyprint">addon:bundleName:permissionLevel:permission</code>. <code class="prettyprint">addon:</code> tells Mautic to look for the permission class in the addons/ directory and <code class="prettyprint">MauticAddons</code> namespace. </p>

<p>The permission level and permissions are set by the core bundle or addon. For example, Mautic&rsquo;s core UserBundle has <code class="prettyprint">users</code> and <code class="prettyprint">roles</code> levels with <code class="prettyprint">view</code>, <code class="prettyprint">edit</code>, <code class="prettyprint">create</code>, <code class="prettyprint">delete</code> and <code class="prettyprint">full</code> permissions for each. </p>

<p>To check if a user has permission to edit roles, use <code class="prettyprint">$this-&gt;factory-&gt;getSecurity()-&gt;isGranted(&#39;user:roles:edit&#39;);</code></p>

<h3 id="creating-custom-permissions">Creating Custom Permissions</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="c1">// addons/HelloWorldBundle/Security/Permissions/HelloWorldPermissions.php
</span>
<span class="k">namespace</span> <span class="nx">MauticAddons\HelloWorldBundle\Security\Permissions</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Component\Form\FormBuilderInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Mautic\CoreBundle\Security\Permissions\AbstractPermissions</span><span class="p">;</span>

<span class="sd">/**
 * Class HelloWorldPermissions
 */</span>
<span class="k">class</span> <span class="nc">HelloWorldPermissions</span> <span class="k">extends</span> <span class="nx">AbstractPermissions</span>
<span class="p">{</span>

    <span class="sd">/**
     * Define available permissions
     *
     * @param $params
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nv">$params</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">__construct</span><span class="p">(</span><span class="nv">$params</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">permissions</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>

            <span class="c1">// Custom level
</span>            <span class="s1">'worlds'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>

                <span class="c1">// Custom permissions
</span>                <span class="s1">'use_telescope'</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s1">'send_probe'</span>    <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span>
                <span class="s1">'visit'</span>         <span class="o">=&gt;</span> <span class="mi">4</span><span class="p">,</span>
                <span class="c1">// Full will almost always be included and should be significantly higher than the
</span>                <span class="c1">// others in case new permissions need to be added later 
</span>                <span class="s1">'full'</span>          <span class="o">=&gt;</span> <span class="mi">1024</span>
            <span class="p">)</span>
        <span class="p">);</span>

        <span class="c1">// Add standard category permissions
</span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">addStandardPermissions</span><span class="p">(</span><span class="s1">'categories'</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**
     * Append the permission form fields to the Role form
     *
     * @param FormBuilderInterface $builder
     * @param array                $options
     * @param array                $data
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">buildForm</span><span class="p">(</span><span class="nx">FormBuilderInterface</span> <span class="o">&amp;</span><span class="nv">$builder</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$options</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$data</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Add standard category form fields
</span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">addStandardFormFields</span><span class="p">(</span><span class="s1">'helloWorld'</span><span class="p">,</span> <span class="s1">'categories'</span><span class="p">,</span> <span class="nv">$builder</span><span class="p">,</span> <span class="nv">$data</span><span class="p">);</span>

        <span class="c1">// Add custom 'worlds' level form fields
</span>        <span class="nv">$builder</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span>

            <span class="c1">// Form element name should be bundleName:permissionLevel
</span>            <span class="s1">'helloWorld:worlds'</span><span class="p">,</span>

            <span class="c1">// Should always be permissionlist type
</span>            <span class="s1">'permissionlist'</span><span class="p">,</span>
            <span class="k">array</span><span class="p">(</span>
                <span class="s1">'choices'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                    <span class="s1">'use_telescope'</span> <span class="o">=&gt;</span> <span class="s1">'addon.helloworld.permissions.use_telescope'</span><span class="p">,</span>
                    <span class="s1">'send_probe'</span>    <span class="o">=&gt;</span> <span class="s1">'addon.helloworld.permissions.send_probe'</span><span class="p">,</span>
                    <span class="s1">'visit'</span>         <span class="o">=&gt;</span> <span class="s1">'addon.helloworld.permissions.visit'</span><span class="p">,</span>
                    <span class="s1">'full'</span>          <span class="o">=&gt;</span> <span class="s1">'mautic.core.permissions.full'</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="s1">'label'</span>   <span class="o">=&gt;</span> <span class="s1">'addon.helloworld.permissions'</span><span class="p">,</span>

                <span class="c1">// Set existing data
</span>                <span class="s1">'data'</span>    <span class="o">=&gt;</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$data</span><span class="p">[</span><span class="s1">'worlds'</span><span class="p">])</span> <span class="o">?</span> <span class="nv">$data</span><span class="p">[</span><span class="s1">'worlds'</span><span class="p">]</span> <span class="o">:</span> <span class="k">array</span><span class="p">()),</span>

                <span class="c1">// Bundle name (used to build frontend form)
</span>                <span class="s1">'bundle'</span>  <span class="o">=&gt;</span> <span class="s1">'helloWorld'</span><span class="p">,</span>

                <span class="c1">// Permission level (used to build frontend form)
</span>                <span class="s1">'level'</span>   <span class="o">=&gt;</span> <span class="s1">'worlds'</span>
            <span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**
     * Permission set identifier; should be bundleName
     * 
     * @return string
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getName</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s1">'helloWorld'</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>An addon can create it&rsquo;s own set of permissions by creating a Permission class. See the code example for a skeleton outline of what the class will look like.</p>

<p>Each permission class should extend <code class="prettyprint">Mautic\CoreBundle\Security\Permissions\AbstractPermissions</code>.</p>

<p>Then, for most permission classes, three methods are needed: <code class="prettyprint">__construct()</code>, <code class="prettyprint">buildForm()</code> and <code class="prettyprint">getName()</code>.</p>

<p><strong>__construct()</strong></p>

<p>The construct method should do two things. It should call <code class="prettyprint">parent::__construct($params)</code> or it should set <code class="prettyprint">$this-&gt;params = $params;</code>. </p>

<p>Then it should define <code class="prettyprint">$this-&gt;permissions</code>. <code class="prettyprint">$this-&gt;permissions</code> is an array of permission levels that are each arrays with permissions assigned to bits.  For example, in the code block, a custom permission level of <code class="prettyprint">worlds</code> is defined with the permissions of <code class="prettyprint">use_telescope</code>, <code class="prettyprint">send_probe</code>, <code class="prettyprint">visit</code> and <code class="prettyprint">full</code>. To check to see if a user has permission to the level <code class="prettyprint">worlds</code> and permission <code class="prettyprint">send_probe</code>, <code class="prettyprint">$this-&gt;factory-&gt;getSecurity()-&gt;isGranted(&#39;addon:helloWorld:worlds:send_probe&#39;)</code> would be used.</p>

<p>Mautic provides a few helper methods for common permission sets:</p>

<table><thead>
<tr>
<th>Method</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>addStandardPermissions()</td>
<td>Set view, edit, create, delete, publish (with option to exclude), and full permissions.</td>
</tr>
<tr>
<td>addExtendedPermissions()</td>
<td>Set creator level restrictions: viewown, viewother, editown, editother, create, deleteown, deleteother, publishown (with option to exclude), publishother (with option to exclude), and full</td>
</tr>
<tr>
<td>addManagePermission</td>
<td>Set single manage permission</td>
</tr>
</tbody></table>

<p><strong>buildForm()</strong></p>

<p>The buildForm method will append the permission toggles to the Role&rsquo;s form (see <a href="#forms">Forms</a> for details on form builders). Review the comments in the code sample.</p>

<p>There are complimentary helper methods for the common permission sets:</p>

<table><thead>
<tr>
<th>Method</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>addStandardFormFields()</td>
<td>Appends the standard permission sets to the form</td>
</tr>
<tr>
<td>addExtendedFormFields()</td>
<td>Appends the extended, aka creator restricted, permissions to the form</td>
</tr>
<tr>
<td>addManageFormFields()</td>
<td>Appends the single manager element to the form</td>
</tr>
</tbody></table>

<p><strong>getName()</strong>
This method is absolutely required and should match both the bundleName and the name of the file. For example, if <code class="prettyprint">HelloWorldBundle</code> is the bundle&rsquo;s name, then this would be <code class="prettyprint">helloWorld</code> with a filename of <code class="prettyprint">HelloWorldPermissions.php</code>.</p>

<div class="clear-right"></div> 

<h4 id="permission-aliases">Permission Aliases</h4>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>

    <span class="k">protected</span> <span class="k">function</span> <span class="nf">getSynonym</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$level</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$name</span> <span class="o">==</span> <span class="s1">'send_satellite'</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Set real permission name
</span>            <span class="nv">$name</span> <span class="o">=</span> <span class="s1">'send_probe'</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="k">array</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$level</span><span class="p">);</span>
    <span class="p">}</span>
</code></pre>

<p>To add a permission alias, use the <code class="prettyprint">getSynonym()</code> method. Basically this method is called before each requested permission is determined giving opportunity to change the permission level or name as needed.</p>

<p>For example, <code class="prettyprint">parent::getSynonym()</code> will recognize <code class="prettyprint">editown</code> as <code class="prettyprint">edit</code> if <code class="prettyprint">editown</code> isn&rsquo;t defined in the permission class&rsquo; <code class="prettyprint">$this-&gt;permissions</code> property for the requested level.</p>

<div class="clear-right"></div>

<h4 id="manipulating-permissions-before-saving">Manipulating Permissions before Saving</h4>
<pre><code class="highlight php"> <span class="cp">&lt;?php</span>

     <span class="sd">/**
      * @param array $permissions     Addon specific permissions
      * @param       $allPermissions  All role permissions
      * @param bool  $isSecondRound   Is round two after permissions have been updated by all permission classes 
      *
      * @return bool Return true if a second round is required; default false
      */</span>
     <span class="k">public</span> <span class="k">function</span> <span class="nf">analyzePermissions</span><span class="p">(</span><span class="k">array</span> <span class="o">&amp;</span><span class="nv">$permissions</span><span class="p">,</span> <span class="nv">$allPermissions</span><span class="p">,</span> <span class="nv">$isSecondRound</span> <span class="o">=</span> <span class="kc">false</span><span class="p">)</span>
     <span class="p">{</span>
         <span class="k">foreach</span> <span class="p">(</span><span class="nv">$permissions</span> <span class="k">as</span> <span class="nv">$level</span> <span class="o">=&gt;</span> <span class="o">&amp;</span><span class="nv">$perms</span><span class="p">)</span> <span class="p">{</span>
             <span class="k">foreach</span> <span class="p">(</span><span class="nv">$perms</span> <span class="k">as</span> <span class="nv">$perm</span><span class="p">)</span> <span class="p">{</span>
                 <span class="nv">$include</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
                 <span class="k">switch</span> <span class="p">(</span><span class="nv">$perm</span><span class="p">)</span> <span class="p">{</span>
                     <span class="k">case</span> <span class="s1">'send_probe'</span><span class="o">:</span>
                         <span class="nv">$include</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">'use_telescope'</span><span class="p">);</span>
                         <span class="k">break</span><span class="p">;</span>
                     <span class="k">case</span> <span class="s1">'visit'</span><span class="o">:</span>
                         <span class="nv">$include</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">'use_telescope'</span><span class="p">,</span> <span class="s1">'send_probe'</span><span class="p">);</span>
                         <span class="k">break</span><span class="p">;</span>
                 <span class="p">}</span>
                 <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$include</span><span class="p">))</span> <span class="p">{</span>
                     <span class="k">foreach</span> <span class="p">(</span><span class="nv">$include</span> <span class="k">as</span> <span class="nv">$r</span><span class="p">)</span> <span class="p">{</span>
                         <span class="k">list</span><span class="p">(</span><span class="nv">$ignore</span><span class="p">,</span> <span class="nv">$r</span><span class="p">)</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getSynonym</span><span class="p">(</span><span class="nv">$level</span><span class="p">,</span> <span class="nv">$r</span><span class="p">);</span>
                         <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">isSupported</span><span class="p">(</span><span class="nv">$level</span><span class="p">,</span> <span class="nv">$r</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$r</span><span class="p">,</span> <span class="nv">$perms</span><span class="p">))</span> <span class="p">{</span>
                             <span class="nv">$perms</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$r</span><span class="p">;</span>
                         <span class="p">}</span>
                     <span class="p">}</span>
                 <span class="p">}</span>
             <span class="p">}</span>
         <span class="p">}</span>

         <span class="c1">// Return true if this method needs a second round after all the other bundles have adjusted permissions
</span>         <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
     <span class="p">}</span>
</code></pre>

<p>Addon&rsquo;s can adjust permissions based on other selected permissions in order to prevent &lsquo;user error.&rsquo; For example, if a user has permission to <code class="prettyprint">edit</code>, then the user also needs permission to <code class="prettyprint">view</code> whether that was selected in the Role form or not. The method <code class="prettyprint">analyzePermissions()</code>  can be be used for this which gives opportunity to the addon to modify permissions based on other selections before persisting to the database. </p>

<p>Sometimes, it may be necessary to re-adjust based on a permission that is outside the addon&rsquo;s control. In this case, <code class="prettyprint">analyzePermissions()</code> can return true and it will be called again after all the permissions have been analyzed by the other bundles and addons. In this case, the argument <code class="prettyprint">$isSecondRound</code> will be true.</p>

<h4 id="advanced-isgranted-logic">Advanced isGranted Logic</h4>

<p>If it is necessary to perform some logic other than simply comparing bits, the permission class can override the parent&rsquo;s <code class="prettyprint">public function isGranted($userPermissions, $name, $level)</code> and do whatever is necessary for it&rsquo;s own permission levels and individual permissions.</p>

<h4 id="advanced-issupported-logic">Advanced isSupported Logic</h4>

<p>The same can be applied for the method <code class="prettyprint">isSupported()</code> which is used to determine if a bundle or addon includes the requested permission and permission level. This can also be used to provide BC support.</p>

          <h2 id="custom-config-params">Custom Config Params</h2>

<p>Mautic&rsquo;s configuration is stored in app/config/local.php. Addon&rsquo;s can leverage custom config parameters to use within it&rsquo;s code.</p>

<p>Each configuration option desired should be defined and have a default set in the <a href="#parameters">addon&rsquo;s config file</a>. This prevents Symfony from throwing errors if the parameter is used during cache compilation or if accessed directly from the container without checking if it exists first. Defining the parameters in the addon&rsquo;s config file will ensure that it always exists.</p>

<p>To add config options to the Configuration page, an <a href="#subscribers">event subscriber</a>, a config <a href="#forms">form type</a>, and a <a href="#views">specific view</a> are required.</p>

<aside class="notice">
To translate the addon&rsquo;s tab in the configuration form, be sure to include <code>mautic.config.tab.helloworld_config</code> in the addon&rsquo;s messages.ini file. Of course replace helloworld_config with whatever is used as the formAlias when registering the form in the event subscriber (explained below).
</aside>

<h3 id="config-event-subscriber">Config Event Subscriber</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="c1">// addons/HelloWorldBundle/EventListener/ConfigSubscriber.php
</span>
<span class="k">namespace</span> <span class="nx">MauticAddons\HelloWorldBundle\EventListener</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Mautic\ConfigBundle\Event\ConfigEvent</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Mautic\CoreBundle\EventListener\CommonSubscriber</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Mautic\ConfigBundle\ConfigEvents</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Mautic\ConfigBundle\Event\ConfigBuilderEvent</span><span class="p">;</span>

<span class="sd">/**
 * Class ConfigSubscriber
 */</span>
<span class="k">class</span> <span class="nc">ConfigSubscriber</span> <span class="k">extends</span> <span class="nx">CommonSubscriber</span>
<span class="p">{</span>

    <span class="sd">/**
     * @return array
     */</span>
    <span class="k">static</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">getSubscribedEvents</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">array</span><span class="p">(</span>
            <span class="nx">ConfigEvents</span><span class="o">::</span><span class="na">CONFIG_ON_GENERATE</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'onConfigGenerate'</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="nx">ConfigEvents</span><span class="o">::</span><span class="na">CONFIG_PRE_SAVE</span>    <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'onConfigSave'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**
     * @param ConfigBuilderEvent $event
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">onConfigGenerate</span><span class="p">(</span><span class="nx">ConfigBuilderEvent</span> <span class="nv">$event</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">addForm</span><span class="p">(</span>
            <span class="k">array</span><span class="p">(</span>
                <span class="s1">'formAlias'</span>  <span class="o">=&gt;</span> <span class="s1">'helloworld_config'</span><span class="p">,</span>
                <span class="s1">'formTheme'</span>  <span class="o">=&gt;</span> <span class="s1">'HelloWorldBundle:FormTheme\Config'</span><span class="p">,</span>
                <span class="s1">'parameters'</span> <span class="o">=&gt;</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getParametersFromConfig</span><span class="p">(</span><span class="s1">'HelloWorldBundle'</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**
     * @param ConfigEvent $event
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">onConfigSave</span><span class="p">(</span><span class="nx">ConfigEvent</span> <span class="nv">$event</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="sd">/** @var array $values */</span>
        <span class="nv">$values</span> <span class="o">=</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getConfig</span><span class="p">();</span>

        <span class="c1">// Manipulate the values
</span>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$values</span><span class="p">[</span><span class="s1">'helloworld_config'</span><span class="p">][</span><span class="s1">'custom_config_option'</span><span class="p">]))</span> <span class="p">{</span>
            <span class="nv">$values</span><span class="p">[</span><span class="s1">'helloworld_config'</span><span class="p">][</span><span class="s1">'custom_config_option'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="nv">$values</span><span class="p">[</span><span class="s1">'helloworld_config'</span><span class="p">][</span><span class="s1">'custom_config_option'</span><span class="p">]);</span>
        <span class="p">}</span>

        <span class="c1">// Set updated values 
</span>        <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">setConfig</span><span class="p">(</span><span class="nv">$values</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>The event subscriber will listen to the <code class="prettyprint">ConfigEvents::CONFIG_ON_GENERATE</code> and <code class="prettyprint">ConfigEvents::CONFIG_PRE_SAVE</code> events.  </p>

<p>The <code class="prettyprint">ConfigEvents::CONFIG_ON_GENERATE</code> is dispatched when the configuration form is built giving the addon an opportunity to inject it&rsquo;s own tab and config options.</p>

<p>To do this, the addon must register it&rsquo;s configuration details through the method assigned to the <code class="prettyprint">ConfigEvents::CONFIG_ON_GENERATE</code> event. The \Mautic\ConfigBundle\Event\ConfigBuilderEvent object is passed into the method and expects the method to call <code class="prettyprint">addForm()</code>. <code class="prettyprint">addForm()</code> expects an array with the following elements:</p>

<table><thead>
<tr>
<th>Key</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>formAlias</strong></td>
<td>Alias of the form type class that sets the expected form elements</td>
</tr>
<tr>
<td><strong>formTheme</strong></td>
<td>View to format the configuration form elements, i.e, <code class="prettyprint">HelloWorldBundle:FormTheme\Config</code></td>
</tr>
<tr>
<td><strong>parameters</strong></td>
<td>Array of custom config elements. <code class="prettyprint">$event-&gt;getParametersFromConfig(&#39;HelloWorldBundle&#39;)))</code> can be used to glean them from the addon&rsquo;s config file.</td>
</tr>
</tbody></table>

<p>The <code class="prettyprint">ConfigEvents::CONFIG_PRE_SAVE</code> is called before the values from the form are rendered and saved to the local.php file. This gives the addon an opportunity to clean up or manipulate the data before it is written.</p>

<p>Remember that the subscriber must be registered through the addon&rsquo;s config in the <code class="prettyprint">services[events]</code> <a href="#services">section</a>.</p>

<h3 id="config-form">Config Form</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="c1">// addons/HelloWorldBundle/Form/Type/ConfigType.php
</span>
<span class="k">namespace</span> <span class="nx">MauticAddons\HelloWorldBundle\Form\Type</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Component\Form\AbstractType</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Form\FormBuilderInterface</span><span class="p">;</span>

<span class="sd">/**
 * Class ConfigType
 */</span>
<span class="k">class</span> <span class="nc">ConfigType</span> <span class="k">extends</span> <span class="nx">AbstractType</span>
<span class="p">{</span>
    <span class="sd">/**
     * @param FormBuilderInterface $builder
     * @param array                $options
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">buildForm</span><span class="p">(</span><span class="nx">FormBuilderInterface</span> <span class="nv">$builder</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$options</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$builder</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span>
            <span class="s1">'custom_config_option'</span><span class="p">,</span>
            <span class="s1">'text'</span><span class="p">,</span>
            <span class="k">array</span><span class="p">(</span>
                <span class="s1">'label'</span> <span class="o">=&gt;</span> <span class="s1">'addon.helloworld.config.custom_config_option'</span><span class="p">,</span>
                <span class="s1">'data'</span>  <span class="o">=&gt;</span> <span class="nv">$options</span><span class="p">[</span><span class="s1">'data'</span><span class="p">][</span><span class="s1">'custom_config_option'</span><span class="p">],</span>
                <span class="s1">'attr'</span>  <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                    <span class="s1">'tooltip'</span> <span class="o">=&gt;</span> <span class="s1">'addon.helloworld.config.custom_config_option_tooltip'</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**
     * {@inheritdoc}
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getName</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s1">'helloworld_config'</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>The form type is used to generate the form fields in the main configuration form. Refer to <a href="#forms">Forms</a> for more information on using form types.</p>

<p>Remember that the form type must be registered through the addon&rsquo;s config in the <code class="prettyprint">services[forms]</code> <a href="#services">section</a>.</p>

<h3 id="config-template">Config Template</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="c1">// addons/HelloWorldBundle/Views/FormTheme/Config/_config_helloworld_config_widget.html.php
</span>
<span class="cp">?&gt;</span>

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"panel panel-primary"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"panel-heading"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;h3</span> <span class="na">class=</span><span class="s">"panel-title"</span><span class="nt">&gt;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">'translator'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">trans</span><span class="p">(</span><span class="s1">'mautic.config.tab.helloworld_config'</span><span class="p">);</span> <span class="cp">?&gt;</span><span class="nt">&lt;/h3&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"panel-body"</span><span class="nt">&gt;</span>
        <span class="cp">&lt;?php</span> <span class="k">foreach</span> <span class="p">(</span><span class="nv">$form</span><span class="o">-&gt;</span><span class="na">children</span> <span class="k">as</span> <span class="nv">$f</span><span class="p">)</span><span class="o">:</span> <span class="cp">?&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-md-6"</span><span class="nt">&gt;</span>
                    <span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">'form'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">row</span><span class="p">(</span><span class="nv">$f</span><span class="p">);</span> <span class="cp">?&gt;</span>
                <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="cp">&lt;?php</span> <span class="k">endforeach</span><span class="p">;</span> <span class="cp">?&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre>

<p>Registering a formTheme as <code class="prettyprint">HelloWorldBundle:FormTheme\Config</code> in the event listener told the ConfigBundle to look in the HelloWorldBundle&rsquo;s Views/FormTheme/Config folder for templates. Specifically, it will look for a template named <code class="prettyprint">_config_{formAlias}_widget.html.php</code> where <code class="prettyprint">{formAlias}</code> is the same as <code class="prettyprint">formAlias</code> set in the addon&rsquo;s <code class="prettyprint">ConfigEvents::CONFIG_ON_GENERATE</code> event listener.</p>

<p>The template should be in a panel format to match the rest of the config UI.</p>

          <h2 id="miscellaneous">Miscellaneous</h2>

          <h3 id="flash-messages">Flash Messages</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>

<span class="c1">// From within a controller
</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">addFlash</span><span class="p">(</span>
    <span class="s1">'mautic.translation.key'</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">'%placeholder%'</span> <span class="o">=&gt;</span> <span class="s1">'some text'</span><span class="p">),</span>
    <span class="s1">'notice'</span><span class="p">,</span> <span class="c1">// Notification type
</span>    <span class="s1">'flashes'</span><span class="p">,</span> <span class="c1">// Translation domain
</span>    <span class="nv">$addNotification</span> <span class="c1">// Add a notification entry
</span><span class="p">);</span>
</code></pre>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>

<span class="c1">// From within a model or other service with MauticFactory access
</span>
<span class="nv">$session</span>          <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">factory</span><span class="o">-&gt;</span><span class="na">getSession</span><span class="p">();</span>
<span class="nv">$translatedString</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">factory</span><span class="o">-&gt;</span><span class="na">getTranslator</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">trans</span><span class="p">(,</span> 
    <span class="k">array</span><span class="p">(</span>
        <span class="s1">'%placeholder%'</span> <span class="o">=&gt;</span> <span class="s1">'some text'</span>
    <span class="p">),</span>
    <span class="s1">'flashes'</span>
<span class="p">);</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">factory</span><span class="o">-&gt;</span><span class="na">getSession</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getFlashBag</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">'notice'</span><span class="p">,</span> <span class="nv">$translatedString</span><span class="p">);</span>
</code></pre>

<p>To create an alert, aka flash message, you can use the flash bag in the session.</p>

<p>If your controller extends one of <a href="#controllers">Mautic&rsquo;s common controllers</a>, you can simply use the helper function <code class="prettyprint">addFlash()</code>.</p>

<p>From a model, or any service, you can use the session to obtain the flash bag.</p>

<p><code class="prettyprint">$flashBag = $this-&gt;factory-&gt;getSession()-&gt;getFlashBag();</code></p>

<h3 id="notifications">Notifications</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="c1">// From within a controller
</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">addNotification</span><span class="p">(</span><span class="nv">$message</span><span class="p">,</span> <span class="nv">$type</span><span class="p">,</span> <span class="nv">$isRead</span><span class="p">,</span> <span class="nv">$header</span><span class="p">,</span> <span class="nv">$iconClass</span><span class="p">,</span> <span class="k">new</span> <span class="nx">\DateTime</span><span class="p">());</span>
</code></pre>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>

<span class="c1">// From within a model or other service with MauticFactory access
</span>
<span class="sd">/** @var \Mautic\CoreBundle\Model\NotificationModel $notificationModel */</span>
<span class="nv">$notificationModel</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">factory</span><span class="o">-&gt;</span><span class="na">getModel</span><span class="p">(</span><span class="s1">'core.notification'</span><span class="p">);</span>
<span class="nv">$notificationModel</span><span class="o">-&gt;</span><span class="na">addNotification</span><span class="p">(</span><span class="nv">$message</span><span class="p">,</span> <span class="nv">$type</span><span class="p">,</span> <span class="nv">$isRead</span><span class="p">,</span> <span class="nv">$header</span><span class="p">,</span> <span class="nv">$iconClass</span><span class="p">,</span> <span class="nv">$datetime</span> <span class="p">);</span>

</code></pre>

<p>Mautic also has a notification center.  By default, addFlash() will also add a notification to the center. But, a message can be manually added as well.  </p>

<p>Controllers can use the helper function while models and other services can obtain the NotificationModel.</p>

          <h3 id="helpers">Helpers</h3>

<p>Mautic has many helper classes available. A few of the most commonly used ones are highlighted below.</p>

<h4 id="input-helper">Input Helper</h4>

<p>The input helper can be used to ensure clean strings from user input.</p>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Mautic\CoreBundle\Helper\InputHelper</span>

<span class="c1">// ...
</span>
<span class="nv">$clean</span> <span class="o">=</span> <span class="nx">InputHelper</span><span class="o">::</span><span class="na">clean</span><span class="p">(</span><span class="nv">$input</span><span class="p">);</span>
<span class="nv">$clean</span> <span class="o">=</span> <span class="nx">InputHelper</span><span class="o">::</span><span class="na">int</span><span class="p">(</span><span class="nv">$input</span><span class="p">);</span>
<span class="nv">$clean</span> <span class="o">=</span> <span class="nx">InputHelper</span><span class="o">::</span><span class="na">alphanum</span><span class="p">(</span><span class="nv">$input</span><span class="p">);</span>
<span class="nv">$clean</span> <span class="o">=</span> <span class="nx">InputHelper</span><span class="o">::</span><span class="na">html</span><span class="p">(</span><span class="nv">$input</span><span class="p">);</span>

<span class="c1">// and others; refer to the class for more options
</span></code></pre>

<div class="clear-right"></div>

<h4 id="cookie-helper">Cookie Helper</h4>

<p>The cookie helper can be used to set cookies based on system settings.</p>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>

<span class="nv">$cookieHelper</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">factory</span><span class="o">-&gt;</span><span class="na">getHelper</span><span class="p">(</span><span class="s1">'cookie'</span><span class="p">);</span>
<span class="nv">$cookieHelper</span><span class="o">-&gt;</span><span class="na">setCookie</span><span class="p">(</span><span class="s1">'name'</span><span class="p">,</span> <span class="s1">'value'</span><span class="p">,</span> <span class="mi">3600</span><span class="p">);</span>

<span class="nv">$cookieHelper</span><span class="o">-&gt;</span><span class="na">deleteCookie</span><span class="p">(</span><span class="s1">'name'</span><span class="p">);</span>
</code></pre>

<div class="clear-right"></div>

<h4 id="date/time-helper">Date/Time Helper</h4>

<p>The date/time helper can be used to convert between UTC and the local timezone. </p>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>

<span class="nv">$dtHelper</span>  <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">factory</span><span class="o">-&gt;</span><span class="na">getDate</span><span class="p">(</span><span class="s1">'2015-07-20 21:39:00'</span><span class="p">,</span> <span class="s1">'Y-m-d H:i:m'</span><span class="p">,</span> <span class="s1">'local'</span><span class="p">);</span>
<span class="nv">$utcString</span> <span class="o">=</span> <span class="nv">$dtHelper</span><span class="o">-&gt;</span><span class="na">toUtcString</span><span class="p">();</span>

<span class="c1">// refer to the class for other functions
</span></code></pre>

<div class="clear-right"></div>

<h4 id="mail-helper">Mail Helper</h4>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="nv">$mailer</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">factory</span><span class="o">-&gt;</span><span class="na">getMailer</span><span class="p">();</span>

<span class="c1">// To address; can use setTo(), addCc(), setCc(), addBcc(), or setBcc() as well
</span><span class="nv">$mailer</span><span class="o">-&gt;</span><span class="na">addTo</span><span class="p">(</span><span class="nv">$toAddress</span><span class="p">,</span> <span class="nv">$toName</span><span class="p">);</span>

<span class="c1">// Set a custom from; will use system settings by default
</span><span class="nv">$user</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">factory</span><span class="o">-&gt;</span><span class="na">getUser</span><span class="p">();</span>
<span class="nv">$mailer</span><span class="o">-&gt;</span><span class="na">setFrom</span><span class="p">(</span>
    <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getEmail</span><span class="p">(),</span>
    <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getFirstName</span><span class="p">()</span><span class="o">.</span><span class="s1">' '</span><span class="o">.</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getLastName</span><span class="p">()</span>
<span class="p">);</span>

<span class="c1">// Set subject
</span><span class="nv">$mailer</span><span class="o">-&gt;</span><span class="na">setSubject</span><span class="p">(</span><span class="nv">$email</span><span class="p">[</span><span class="s1">'subject'</span><span class="p">]);</span>

<span class="c1">// Set content
</span><span class="nv">$mailer</span><span class="o">-&gt;</span><span class="na">setBody</span><span class="p">(</span><span class="nv">$content</span><span class="p">);</span>
<span class="nv">$mailer</span><span class="o">-&gt;</span><span class="na">parsePlainText</span><span class="p">(</span><span class="nv">$content</span><span class="p">);</span>

<span class="c1">// Optional lead tracking (array)
</span><span class="nv">$mailer</span><span class="o">-&gt;</span><span class="na">setLead</span><span class="p">(</span><span class="nv">$lead</span><span class="p">);</span>
<span class="nv">$mailer</span><span class="o">-&gt;</span><span class="na">setIdHash</span><span class="p">();</span>

<span class="c1">// Send the mail, pass true to dispatch through event listeners (for replacing tokens, etc)
</span><span class="k">if</span> <span class="p">(</span><span class="nv">$mailer</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span><span class="kc">true</span><span class="p">))</span> <span class="p">{</span>

    <span class="c1">// Optional to create a stat to allow a web view, tracking, etc
</span>    <span class="nv">$mailer</span><span class="o">-&gt;</span><span class="na">createLeadEmailStat</span><span class="p">();</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nv">$errors</span> <span class="o">=</span> <span class="nv">$mailer</span><span class="o">-&gt;</span><span class="na">getErrors</span><span class="p">();</span>
    <span class="nv">$failedRecipients</span> <span class="o">=</span> <span class="nv">$errors</span><span class="p">[</span><span class="s1">'failures'</span><span class="p">];</span>
<span class="p">}</span>
</code></pre>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="c1">// Using queue() for tokenization support
</span>
<span class="k">use</span> <span class="nx">Mautic\CoreBundle\Swiftmailer\Exception\BatchQueueMaxException</span><span class="p">;</span>

<span class="nv">$mailer</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">factory</span><span class="o">-&gt;</span><span class="na">getMailer</span><span class="p">();</span>
<span class="nv">$failed</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$emailList</span> <span class="k">as</span> <span class="nv">$email</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$mailer</span><span class="o">-&gt;</span><span class="na">addTo</span><span class="p">(</span><span class="nv">$email</span><span class="p">[</span><span class="s1">'email'</span><span class="p">],</span> <span class="nv">$email</span><span class="p">[</span><span class="s1">'name'</span><span class="p">])</span> <span class="p">{</span>
            <span class="c1">// Clear the errors so it doesn't stop the next send
</span>            <span class="nv">$mailer</span><span class="o">-&gt;</span><span class="na">clearErrors</span><span class="p">();</span>

            <span class="nv">$failed</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$email</span><span class="p">;</span>

            <span class="k">continue</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">BatchQueueMaxException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Queue full so flush (send) then try again
</span>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$mailer</span><span class="o">-&gt;</span><span class="na">flushQueue</span><span class="p">())</span> <span class="p">{</span>
            <span class="nv">$errors</span> <span class="o">=</span> <span class="nv">$mailer</span><span class="o">-&gt;</span><span class="na">getErrors</span><span class="p">();</span>
            <span class="nv">$failed</span> <span class="o">=</span> <span class="nb">array_merge</span><span class="p">(</span><span class="nv">$failed</span><span class="p">,</span> <span class="nv">$errors</span><span class="p">[</span><span class="s1">'failures'</span><span class="p">]);</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$mailer</span><span class="o">-&gt;</span><span class="na">addTo</span><span class="p">(</span><span class="nv">$email</span><span class="p">[</span><span class="s1">'email'</span><span class="p">],</span> <span class="nv">$email</span><span class="p">[</span><span class="s1">'email'</span><span class="p">],</span> <span class="nv">$email</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]))</span> <span class="p">{</span>
            <span class="c1">// ...
</span>        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Flush pending
</span><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$mailer</span><span class="o">-&gt;</span><span class="na">flushQueue</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">// ...
</span><span class="p">}</span>
</code></pre>

<p>The mail helper can be used to send email, running the content through the event listeners to search/replace tokens, manipulate the content, etc. </p>

<p>Some transports, such as Mandrill, support tokenized emails for multiple recipients. The mail helper makes it easy to leverage this feature by using it&rsquo;s <code class="prettyprint">queue()</code> and <code class="prettyprint">flushQueue()</code> functions in place of <code class="prettyprint">send()</code>. If sending a batch of emails, it is recommended to use the <code class="prettyprint">queue()</code> function.</p>

<p>If using an Email entity (<code class="prettyprint">\Mautic\EmailBundle\Entity\Email</code>), just pass the Email entity to <code class="prettyprint">$mailer-&gt;setEmail($email)</code> and the subject, body, assets, etc will be extracted and automatically set.</p>

<h4 id="attachments">Attachments</h4>

<p>Attachments can be attached to emails by using the <code class="prettyprint">attachFile()</code> function. You can also attach Mautic assets (<code class="prettyprint">\Mautic\AssetBundle\Entity\Asset</code>) via <code class="prettyprint">attachAsset()</code>.</p>

<p>Refer to the class for more details on available functions.</p>

          <h3 id="forms">Forms</h3>

<p>Mautic leverages Symfony&rsquo;s Form component and form classes. Refer to <a href="http://symfony.com/doc/current/book/forms.html#creating-form-classes">Symfony&rsquo;s documentation</a> for more information.</p>

<h5 id="form-type-configuration">Form Type Configuration</h5>

<p>As stated in Symfony&rsquo;s documentation referenced above, form type classes are the best way to go.  Mautic makes it easy to register form types services through the bundle&rsquo;s config file. Refer to the <a href="#services">Services</a> section. </p>

          <h3 id="events">Events</h3>

<p>Mautic leverages Symfony&rsquo;s EventDispatcher to execute and communicate various actions through Mautic. Addon&rsquo;s can hook into these to extend the functionality of Mautic. Refer to <a href="#extending-mautic">Extending Mautic</a> for some of the ways to do this.</p>

<h4 id="subscribers">Subscribers</h4>

<p>The easiest way to listen to various events is to use an event subscriber. Read more about subscribers in <a href="http://symfony.com/doc/current/components/event_dispatcher/introduction.html#using-event-subscribers">Symfony&rsquo;s documentation</a>. </p>

<p>Addon event subscribers should extend <code class="prettyprint">\Mautic\CoreBundle\EventListener\CommonSubscriber</code> which gives access to MauticFactory and also allows registering the subscriber service through the bundles&rsquo;s config file.  See <a href="#services">Services</a> for more information on registering event services. </p>

<h4 id="custom-events">Custom Events</h4>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="nx">\\</span> <span class="nx">addons\HelloWorldBundle\EventListener\LeadSubscriber</span>

<span class="k">namespace</span> <span class="nx">MauticAddon\HelloWorldBundle\EventListener</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Mautic\LeadBundle\Event</span> <span class="k">as</span> <span class="nx">Events</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Mautic\LeadBundle\LeadEvents</span><span class="p">;</span>

<span class="sd">/**
 * Class LeadSubscriber
 *
 * @package Mautic\LeadBundle\EventListener
 */</span>
<span class="k">class</span> <span class="nc">LeadSubscriber</span> <span class="k">extends</span> <span class="nx">CommonSubscriber</span>
<span class="p">{</span>

    <span class="sd">/**
     * @return array
     */</span>
    <span class="k">static</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">getSubscribedEvents</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">array</span><span class="p">(</span>
            <span class="nx">LeadEvents</span><span class="o">::</span><span class="na">LEAD_POST_SAVE</span>     <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'onLeadPostSave'</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="nx">LeadEvents</span><span class="o">::</span><span class="na">LEAD_POST_DELETE</span>   <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'onLeadDelete'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">onLeadPostSave</span><span class="p">(</span><span class="nx">LeadEvent</span> <span class="nv">$event</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$lead</span> <span class="o">=</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getLead</span><span class="p">();</span>

        <span class="c1">// do something
</span>    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">onLeadDelete</span><span class="p">(</span><span class="nx">LeadEvent</span> <span class="nv">$event</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$lead</span> <span class="o">=</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getLead</span><span class="p">();</span>

        <span class="nv">$deletedId</span> <span class="o">=</span> <span class="nv">$lead</span><span class="o">-&gt;</span><span class="na">deletedId</span><span class="p">;</span>

        <span class="c1">// do something
</span>    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>There are many events available throughout Mautic. Depending on the desired functionality, look at the core bundle&rsquo;s *Event.php file in the root of the bundle.  For example, Lead related events are defined and described in &lsquo;app\bundles\LeadBundle\LeadEvents.php&rsquo;. These final classes provide the names of the events to listen to.  Always use the event constants to ensure future changes to event names will not break the addon.</p>

          <h2 id="extending-mautic">Extending Mautic</h2>

          <h3 id="extending-api">Extending API</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="c1">// addons/HelloWorldBundle/Config/config.php
</span>
<span class="k">return</span> <span class="k">array</span><span class="p">(</span>
    <span class="c1">// ...
</span>
    <span class="s1">'routes'</span>   <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>

        <span class="c1">// ...
</span>
        <span class="s1">'api'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">'addon_helloworld_api'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">'path'</span>       <span class="o">=&gt;</span> <span class="s1">'/hello/worlds'</span><span class="p">,</span>
                <span class="s1">'controller'</span> <span class="o">=&gt;</span> <span class="s1">'HelloWorldBundle:Api:worlds'</span><span class="p">,</span>
                <span class="s1">'method'</span>     <span class="o">=&gt;</span> <span class="s1">'GET'</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="p">),</span>

    <span class="c1">// ...
</span><span class="p">);</span>
</code></pre>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="c1">// addons/HelloWorldBundle/Controller/ApiController.php
</span>
<span class="k">namespace</span> <span class="nx">Mautic\LeadBundle\Controller\Api</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">FOS\RestBundle\Util\Codes</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Mautic\ApiBundle\Controller\CommonApiController</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ApiController</span> <span class="k">extends</span> <span class="nx">CommonApiController</span>
<span class="p">{</span>

    <span class="sd">/**
     * Get a list of worlds
     * 
     * @return \Symfony\Component\HttpFoundation\Response
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getWorldsAction</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">factory</span><span class="o">-&gt;</span><span class="na">getSecurity</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">isGranted</span><span class="p">(</span><span class="s1">'addon:helloWorld:worlds:view'</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">accessDenied</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="nv">$filter</span>  <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'filter'</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
        <span class="nv">$limit</span>   <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'limit'</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
        <span class="nv">$start</span>   <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'start'</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>

        <span class="sd">/** @var \MauticAddons\HelloWorldBundle\Model\WorldsModel $model */</span>
        <span class="nv">$model</span>   <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">factory</span><span class="o">-&gt;</span><span class="na">getModel</span><span class="p">(</span><span class="s1">'addon.helloWorld.worlds'</span><span class="p">);</span>

        <span class="nv">$worlds</span>  <span class="o">=</span> <span class="nv">$model</span><span class="o">-&gt;</span><span class="na">getWorlds</span><span class="p">(</span><span class="nv">$filter</span><span class="p">,</span> <span class="nv">$limit</span><span class="p">,</span> <span class="nv">$start</span><span class="p">);</span>
        <span class="nv">$worlds</span>  <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">view</span><span class="p">(</span><span class="nv">$worlds</span><span class="p">,</span> <span class="nx">Codes</span><span class="o">::</span><span class="na">HTTP_OK</span><span class="p">);</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">handleView</span><span class="p">(</span><span class="nv">$worlds</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>To add custom API endpoints, simply define the routes under the API firewall in the <a href="#routes">addon&rsquo;s config file</a>. This will place the route behind /api which will only be accessible if the requester has been authorized via OAuth.</p>

<p>The api controller(s), should extend <code class="prettyprint">Mautic\ApiBundle\Controller\CommonApiController</code> to leverage the helper methods provided and to utilize the REST views.</p>

          <h3 id="extending-campaigns">Extending Campaigns</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="c1">// addons/HelloWorldBundle/EventListener/CampaignSubscriber.php
</span>
<span class="k">namespace</span> <span class="nx">MauticAddons\HelloWorldBundle\Events</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Mautic\CoreBundle\EventListener\CommonSubscriber</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Mautic\CampaignBundle\Event</span> <span class="k">as</span> <span class="nx">Events</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Mautic\CampaignBundle\CampaignEvents</span><span class="p">;</span>

<span class="sd">/**
* Class CampaignSubscriber
*/</span>
<span class="k">class</span> <span class="nc">CampaignSubscriber</span> <span class="k">extends</span> <span class="nx">CommonSubscriber</span>
<span class="p">{</span>

    <span class="sd">/**
     * @return array
     */</span>
    <span class="k">static</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">getSubscribedEvents</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">array</span><span class="p">(</span>
            <span class="nx">CampaignEvents</span><span class="o">::</span><span class="na">CAMPAIGN_ON_BUILD</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'onCampaignBuild'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**
     * Add campaign decision and actions
     *
     * @param Events\CampaignBuilderEvent $event
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">onCampaignBuild</span><span class="p">(</span><span class="nx">Events\CampaignBuilderEvent</span> <span class="nv">$event</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Register custom action
</span>        <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">addAction</span><span class="p">(</span>
            <span class="s1">'helloworld.send_offworld'</span><span class="p">,</span>
            <span class="k">array</span><span class="p">(</span>
                <span class="s1">'label'</span>           <span class="o">=&gt;</span> <span class="s1">'addon.helloworld.campaign.send_offworld'</span><span class="p">,</span>
                <span class="s1">'description'</span>     <span class="o">=&gt;</span> <span class="s1">'addon.helloworld.campaign.send_offworld_descr'</span><span class="p">,</span>
                <span class="c1">// Set custom parameters to configure the decision
</span>                <span class="s1">'formType'</span>        <span class="o">=&gt;</span> <span class="s1">'helloworld_worlds'</span><span class="p">,</span>
                <span class="c1">// Set a custom formTheme to customize the layout of elements in formType
</span>                <span class="s1">'formTheme'</span>       <span class="o">=&gt;</span> <span class="s1">'HelloWorldBundle:FormTheme\SubmitAction'</span>
                <span class="c1">// Set custom options to pass to the form type, if applicable 
</span>                <span class="s1">'formTypeOptions'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                    <span class="s1">'world'</span> <span class="o">=&gt;</span> <span class="s1">'mars'</span>
                <span class="p">),</span>
                <span class="c1">// Static callback function to execute this action
</span>                <span class="s1">'callback'</span>        <span class="o">=&gt;</span> <span class="s1">'\MauticAddons\HelloWorldBundle\Helper\CampaignEventHelper::sendLeadOffworld'</span>
            <span class="p">)</span>
        <span class="p">);</span>

        <span class="c1">// Register custom decision (executes when a lead "makes a decision" i.e. executes some direct action 
</span>        <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">addLeadDecision</span><span class="p">(</span>
            <span class="s1">'helloworld.visits_mars'</span><span class="p">,</span>
            <span class="k">array</span><span class="p">(</span>
                <span class="s1">'label'</span>           <span class="o">=&gt;</span> <span class="s1">'addon.helloworld.campaign.visits_mars'</span><span class="p">,</span>
                <span class="s1">'description'</span>     <span class="o">=&gt;</span> <span class="s1">'addon.helloworld.campaign.visits_mars_descr'</span><span class="p">,</span>
                <span class="c1">// Same as registering an action
</span>                <span class="s1">'formType'</span>        <span class="o">=&gt;</span> <span class="kc">false</span><span class="p">,</span>
                <span class="s1">'formTypeOptions'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(),</span>
                <span class="c1">// Optional static callback function to validate whether the decision should be executed or not 
</span>                <span class="s1">'callback'</span>        <span class="o">=&gt;</span> <span class="s1">'\MauticAddons\HelloWorldBundle\Helper\CampaignEventHelper::validateVisitation'</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>Addons can add their own campaign actions and decisions by listening to the <code class="prettyprint">\Mautic\CampaignBundle\CampaignEvents::CAMPAIGN_ON_BUILD</code> event.  Read more about <a href="#events">listeners and subscribers</a>. </p>

<h4 id="campaign-actions">Campaign Actions</h4>

<p>To add an action, use the <code class="prettyprint">$event-&gt;addAction($identifier, $parameters)</code> method. <code class="prettyprint">$identifier</code> must be something unique. The <code class="prettyprint">$parameters</code> array can contain the following elements:</p>

<table><thead>
<tr>
<th>Key</th>
<th>Required</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>label</strong></td>
<td>REQUIRED</td>
<td>string</td>
<td>The language string to use for the draggable&rsquo;s label</td>
</tr>
<tr>
<td><strong>description</strong></td>
<td>OPTIONAL</td>
<td>string</td>
<td>The language string to use for the draggable&rsquo;s tooltip</td>
</tr>
<tr>
<td><strong>callback</strong></td>
<td>REQUIRED</td>
<td>mixed</td>
<td>Static callback function that will be called for the action and should contain the logic to execute the custom action</td>
</tr>
<tr>
<td><strong>formType</strong></td>
<td>OPTIONAL</td>
<td>string</td>
<td>The alias of a custom form type used to set config options for the decision</td>
</tr>
<tr>
<td><strong>formTypeOptions</strong></td>
<td>OPTIONAL</td>
<td>array</td>
<td>Array of options to include into the formType&rsquo;s $options argument</td>
</tr>
<tr>
<td><strong>formTypeCleanMasks</strong></td>
<td>OPTIONAL</td>
<td>array</td>
<td>Array of input masks to clean a values from formType</td>
</tr>
<tr>
<td><strong>formTypeTheme</strong></td>
<td>OPTIONAL</td>
<td>string</td>
<td>Theme to customize elements for formType</td>
</tr>
</tbody></table>

<p>The action&rsquo;s callback can accept the following variables (determined via ReflectionMethod::invokeArgs()):</p>

<table><thead>
<tr>
<th>Variable</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>config</strong></td>
<td>array</td>
<td>Options configured by user for the custom formType</td>
</tr>
<tr>
<td><strong>event</strong></td>
<td>array</td>
<td>Details of the current event executed</td>
</tr>
<tr>
<td><strong>lead</strong></td>
<td>\Mautic\LeadBundle\Entity\Lead</td>
<td>The lead executing the event</td>
</tr>
<tr>
<td><strong>factory</strong></td>
<td>\Mautic\CoreBundle\Factory\MauticFactory</td>
<td><a href="#factory-service">Mautic&rsquo;s factory service</a></td>
</tr>
<tr>
<td><strong>eventDetails</strong></td>
<td>mixed</td>
<td>Whatever the triggering decision passes into the triggerEvent method. It could be the Email entity that was opened, an array, null, etc.</td>
</tr>
<tr>
<td><strong>systemTriggered</strong></td>
<td>boolean</td>
<td>Notes if the action was executed directly by the lead (false) or by the system (true)</td>
</tr>
</tbody></table>

<h4 id="campaign-decisions">Campaign Decisions</h4>
<pre><code class="highlight php"> <span class="cp">&lt;?php</span>
 <span class="c1">// Trigger configured 'helloworld.visits_mars' decisions
</span>
 <span class="sd">/** @var \Mautic\CampaignBundle\Model\CampaignModel $campaignModel */</span>
 <span class="nv">$campaignModel</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">factory</span><span class="o">-&gt;</span><span class="na">getModel</span><span class="p">(</span><span class="s1">'campaign.event'</span><span class="p">);</span>

 <span class="c1">// Can be anything and passed into action callbacks as $eventDetails
</span> <span class="nv">$customPassthrough</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>

 <span class="c1">// Some optional unique identifier for this specific trigger that is used mainly for debug logging; for example, can be a concatenation of the decision name + lead ID
</span> <span class="nv">$uniqueTriggerId</span>   <span class="o">=</span> <span class="s1">'something_something'</span><span class="p">;</span>

 <span class="nv">$campaignModel</span><span class="o">-&gt;</span><span class="na">triggerEvent</span><span class="p">(</span><span class="s1">'helloworld.visits_mars'</span><span class="p">,</span> <span class="nv">$customPassthroughToActions</span><span class="p">,</span> <span class="nv">$uniqueTriggerId</span><span class="p">);</span>
</code></pre>

<p>Campaign decisions are registered exactly as a campaign action except it uses the <code class="prettyprint">$event-&gt;addLeadDecision($identifier, $parameters)</code> method. The only difference in the <code class="prettyprint">$parameters</code> arguments is that the function defined in the <code class="prettyprint">callback</code> element is used to validate the decision rather than execute some action. For example, if the decision is configured to only apply to a specific ID chosen by the user (defined in the <code class="prettyprint">formType</code>), the callback function may could compare the decision&rsquo;s <code class="prettyprint">$eventDetails[&#39;id&#39;]</code> (see below) with the event&rsquo;s<code class="prettyprint">$config[&#39;id&#39;]</code>. If the decision should execue the actions associated with it, return <code class="prettyprint">true</code>.  Otherwise return <code class="prettyprint">false</code> and nothing will be executed or logged.</p>

<p>For custom decisions to work, there must be a trigger executed when the lead makes the decision. Thus, where ever is appropriate in the addon&rsquo;s code logic, add something similar to what&rsquo;s in the example code block. </p>

<p>The <code class="prettyprint">triggerEvent()</code> method will pull all the triggered decisions (<code class="prettyprint">helloworld.visits_mars</code> in the code example) for published campaigns the lead is in, execute the decisions callback (if configured) for validation, then execute the associated actions if appropriate.</p>

          <h3 id="extending-categories">Extending Categories</h3>

<p>Mautic has a CategoryBundle that can be leveraged to incorporate categories into an addon.</p>

<h4 id="configuring-categories-for-menu">Configuring Categories for Menu</h4>

<p>To add a category menu item for the addon, simply add the following to <code class="prettyprint">menu</code> <a href="#menu">config</a> for whichever menu the item should appear (<code class="prettyprint">main</code> or <code class="prettyprint">admin</code>):</p>

<pre class="inline">
    'mautic.category.menu.index' => array(
        'bundle' => 'addon:helloWorld'
    )
</pre>

<p>The <code class="prettyprint">bundle</code> value needs be prefixed with <code class="prettyprint">addon:</code> as it is used in determining permissions to manage categories. The <code class="prettyprint">helloWorld</code> should be the bundle name of the addon.</p>

<h4 id="configuring-categories-for-routes">Configuring Categories for Routes</h4>

<p>There is no need to add custom routes for categories. However, when <a href="#router">generating a URL</a> to the addon&rsquo;s category list, use</p>

<pre class="inline">
$categoryUrl = $router->generateUrl('mautic_category_index', array('bundle' => 'addon:helloWorld'));
</pre>

<h4 id="including-category-in-forms">Including Category in Forms</h4>

<p>To add a category select list to a <a href="#forms">form</a>, use <code class="prettyprint">category</code> as the form type and pass <code class="prettyprint">bundle</code> as an option:</p>

<pre class="inline">
    //add category
    $builder->add('category', 'category', array(
        'bundle' => 'addon:helloWorld'
    ));
</pre>

<h4 id="restricting-category-management">Restricting Category Management</h4>

<p>To restrict access to catgories, use the following in the addon&rsquo;s <a href="#roles-and-permissions">Permission class</a>.</p>

<p>In <code class="prettyprint">__construct()</code> add <code class="prettyprint">$this-&gt;addStandardPermissions(&#39;categories&#39;);</code> then in <code class="prettyprint">buildForm()</code>, add <code class="prettyprint">$this-&gt;addStandardFormFields(&#39;helloWorld&#39;, &#39;categories&#39;, $builder, $data);</code>.</p>

<p>See a code example in <a href="#roles-and-permissions">Roles and Permissions</a>.</p>

<p>The two standard helper methods will add the permissions of <code class="prettyprint">view</code>, <code class="prettyprint">edit</code>, <code class="prettyprint">create</code>, <code class="prettyprint">delete</code>, <code class="prettyprint">publish</code>, and <code class="prettyprint">full</code> for categories.</p>

          <h3 id="extending-emails">Extending Emails</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="c1">// addons/HelloWorldBundle/EventListener/EmailSubscriber.php
</span>
<span class="k">namespace</span> <span class="nx">MauticAddons\HelloWorldBundle\EventListener</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Mautic\CoreBundle\EventListener\CommonSubscriber</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Mautic\EmailBundle\EmailEvents</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Mautic\EmailBundle\Event\EmailBuilderEvent</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Mautic\EmailBundle\Event\EmailSendEvent</span><span class="p">;</span>

<span class="sd">/**
 * Class EmailSubscriber
 */</span>
<span class="k">class</span> <span class="nc">EmailSubscriber</span> <span class="k">extends</span> <span class="nx">CommonSubscriber</span>
<span class="p">{</span>

    <span class="sd">/**
     * @return array
     */</span>
    <span class="k">static</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">getSubscribedEvents</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">array</span><span class="p">(</span>
            <span class="nx">EmailEvents</span><span class="o">::</span><span class="na">EMAIL_ON_BUILD</span>   <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'onEmailBuild'</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="nx">EmailEvents</span><span class="o">::</span><span class="na">EMAIL_ON_SEND</span>    <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'onEmailGenerate'</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="nx">EmailEvents</span><span class="o">::</span><span class="na">EMAIL_ON_DISPLAY</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'onEmailGenerate'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**
     * Register the tokens and a custom A/B test winner
     *
     * @param EmailBuilderEvent $event
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">onEmailBuild</span><span class="p">(</span><span class="nx">EmailBuilderEvent</span> <span class="nv">$event</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Add email tokens
</span>        <span class="nv">$content</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">templating</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">'HelloWorldBundle:SubscribedEvents\EmailToken:token.html.php'</span><span class="p">);</span>
        <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">addTokenSection</span><span class="p">(</span><span class="s1">'helloworld.token'</span><span class="p">,</span> <span class="s1">'addon.helloworld.header'</span><span class="p">,</span> <span class="nv">$content</span><span class="p">);</span>

        <span class="c1">// Add AB Test Winner Criteria
</span>        <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">addAbTestWinnerCriteria</span><span class="p">(</span>
            <span class="s1">'helloworld.planetvisits'</span><span class="p">,</span>
            <span class="k">array</span><span class="p">(</span>
                <span class="c1">// Label to group by
</span>                <span class="s1">'group'</span>    <span class="o">=&gt;</span> <span class="s1">'addon.helloworld.header'</span><span class="p">,</span>

                <span class="c1">// Label for this specific a/b test winning criteria
</span>                <span class="s1">'label'</span>    <span class="o">=&gt;</span> <span class="s1">'addon.helloworld.emailtokens.'</span><span class="p">,</span>

                <span class="c1">// Static callback function that will be used to determine the winner
</span>                <span class="s1">'callback'</span> <span class="o">=&gt;</span> <span class="s1">'\MauticAddons\HelloWorldBundle\Helper\AbTestHelper::determinePlanetVisitWinner'</span>
            <span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**
     * Search and replace tokens with content
     *
     * @param EmailSendEvent $event
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">onEmailGenerate</span><span class="p">(</span><span class="nx">EmailSendEvent</span> <span class="nv">$event</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Get content
</span>        <span class="nv">$content</span> <span class="o">=</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getContent</span><span class="p">();</span>

        <span class="c1">// Search and replace tokens
</span>        <span class="nv">$content</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s1">'{hello}'</span><span class="p">,</span> <span class="s1">'world!'</span><span class="p">,</span> <span class="nv">$content</span><span class="p">);</span>

        <span class="c1">// Set updated content
</span>        <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">setContent</span><span class="p">(</span><span class="nv">$content</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>There are two way to extend emails: email tokens used to insert dynamic content into an email and a/b test winning criteria . Both leverage the <code class="prettyprint">\Mautic\EmailBundle\EmailEvents::EMAIL_ON_BUILD</code> event. Read more about <a href="#events">listeners and subscribers</a>.</p>

<h4 id="email-tokens">Email Tokens</h4>

<p>Email tokens are placeholders that are inserted into an email that can be replaced by dynamic content when the email is sent or viewed in the browser.</p>

<p><code class="prettyprint">$event-&gt;addTokenSection($uniqueId, $headerTranslationKey, $htmlContent)</code> is used to generate the section for drag and drop tokens in the email builder.  </p>

<p><code class="prettyprint">$uniqueId</code> must be unique. </p>

<p><code class="prettyprint">$headerTranslationKey</code> is the translation key that will be used to create the section&rsquo;s header.</p>

<p><code class="prettyprint">$htmlContent</code> is the HTML that will be inserted into the builder&rsquo;s token list for this token&rsquo;s section. <code class="prettyprint">$this-&gt;templating-&gt;render()</code> can be used to render a specific view&rsquo;s content (using <a href="#views">view notation</a>. There is free reign as to what the HTML will look like but the important part is that the elements representing the tokens must have the attribute <code class="prettyprint">data-token=&quot;{token_text}&quot;</code> in order for the builder to recognize them.</p>

<p>For example, <code class="prettyprint">&lt;a href=&quot;#&quot; data-token=&quot;{hello}&quot; class=&quot;btn btn-default btn-block&quot;&gt;Translated Token Text&lt;/a&gt;</code></p>

<h5 id="custom-token-handling">Custom Token Handling</h5>

<p>To convert the token into a link while requesting what the links text should be, use the attributes <code class="prettyprint">data-token=&#39;&lt;a href=&quot;%url={hello}%&quot;&gt;%text%&lt;/a&gt;&#39; data-drop=&quot;showBuilderLinkModal&quot;</code> (replacing <code class="prettyprint">hello</code> with the addon&rsquo;s custom token).</p>

<p>To request simple feedback from the user and inject it into the token, use the attributes <code class="prettyprint">data-token=&#39;{hello=%world%}&#39; data-drop=&quot;showBuilderFeedbackModal&quot;</code>. A modal will appear with a simple input box. Whatever the user inputs will replace <code class="prettyprint">%world%</code>.</p>

<p>If you need more control or more customization, create and define a custom JS function within the Mautic namespace (i.e. <code class="prettyprint">Mautic.customFunction</code> and use the attribute <code class="prettyprint">data-drop=&quot;customFunction&quot;</code>. When a user drops the token, <code class="prettyprint">Mautic.customFunction()</code> passing the arguments event (jQuery Event), ui (jQuery UI object with draggable, helper, etc), editorId (ID of the inline CkEditor).</p>

<pre class="inline">
Mautic.customFunction = function (event, ui, editorId) {
    var token  = mQuery(ui.draggable).data('token');
    
    // Do something fancy then insert token
        
    Mautic.insertBuilderEditorToken(editorId, token);
};
</pre>

<h4 id="email-a/b-test-winner-criteria">Email A/B Test Winner Criteria</h4>

<p>To add a custom an a/b test winner criteria, i.e. a test to compare specific aspects of an email to determine what made it more successful over it&rsquo;s variants, use <code class="prettyprint">$event-&gt;addAbTestWinnerCriteria($uniqueId, $parameters)</code>.</p>

<p><code class="prettyprint">$parameters</code> can have the following elements:</p>

<table><thead>
<tr>
<th>Key</th>
<th>Required</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>group</strong></td>
<td>REQUIRED</td>
<td>string</td>
<td>Translation string to group criteria by in the dropdown select list</td>
</tr>
<tr>
<td><strong>label</strong></td>
<td>OPTIONAL</td>
<td>string</td>
<td>Label for this option in the drop down list</td>
</tr>
<tr>
<td><strong>callback</strong></td>
<td>REQUIRED</td>
<td>mixed</td>
<td>Static callback function that will be called to determine the winner when the email detail page is viewed</td>
</tr>
<tr>
<td><strong>formType</strong></td>
<td>OPTIONAL</td>
<td>string</td>
<td>The alias of a custom form type used to set config options for the decision</td>
</tr>
<tr>
<td><strong>formTypeOptions</strong></td>
<td>OPTIONAL</td>
<td>array</td>
<td>Array of options to include into the formType&rsquo;s $options argument</td>
</tr>
<tr>
<td><strong>formTypeCleanMasks</strong></td>
<td>OPTIONAL</td>
<td>array</td>
<td>Array of input masks to clean a values from formType</td>
</tr>
<tr>
<td><strong>formTypeTheme</strong></td>
<td>OPTIONAL</td>
<td>string</td>
<td>Theme to customize elements for formType</td>
</tr>
</tbody></table>

<p>The callback can accept the following variables (determined via ReflectionMethod::invokeArgs()):</p>

<table><thead>
<tr>
<th>Variable</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>$properties</strong></td>
<td>array</td>
<td>Array of elements saved from the configured formType; keyed by email ID in the case of multiple variants</td>
</tr>
<tr>
<td><strong>$factory</strong></td>
<td>Mautic\CoreBundle\Factory\MauticFactory</td>
<td><a href="#factory-service">Mautic&rsquo;s factory service</a></td>
</tr>
<tr>
<td><strong>$email</strong></td>
<td>Mautic\EmailBundle\Entity\Email</td>
<td>Email entity for the displayed email</td>
</tr>
<tr>
<td><strong>$parent</strong></td>
<td>Mautic\EmailBundle\Entity\Email</td>
<td>Email entity for the parent of the email entity</td>
</tr>
<tr>
<td><strong>$children</strong></td>
<td>Doctrine\Common\Collections\ArrayCollection</td>
<td>All variants of the parent email</td>
</tr>
</tbody></table>

<p>The callback function should return an array keyed with the following elements:</p>

<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>winners</strong></td>
<td>array</td>
<td>Array of IDs of the winners (array in case of a tie)</td>
</tr>
<tr>
<td><strong>support</strong></td>
<td>mixed</td>
<td>Passed to the view defined by supportTemplate below in order to render visual support for the winners (such as a graph, etc)</td>
</tr>
<tr>
<td><strong>supportTemplate</strong></td>
<td>string</td>
<td>View notation to render content for the A/B stats modal. For example, <code class="prettyprint">HelloWorldBundle:SubscribedEvents\AbTest:graph.html.php</code></td>
</tr>
</tbody></table>

<pre class="inline">
return array(
   'winners'         => $winners,
   'support'         => $support,
   'supportTemplate' => 'HelloWorldBundle:SubscribedEvents\AbTest:graph.html.php'
);
</pre>

          <h3 id="extending-forms">Extending Forms</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="c1">// addons/HelloWorldBundle/EventListener/FormSubscriber.php
</span>
<span class="k">namespace</span> <span class="nx">MauticAddon\HelloWorldBundle\EventListener</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Mautic\CoreBundle\EventListener\CommonSubscriber</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Mautic\FormBundle\Event</span> <span class="k">as</span> <span class="nx">Events</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Mautic\FormBundle\FormEvents</span><span class="p">;</span>

<span class="sd">/**
 * Class FormSubscriber
 */</span>
<span class="k">class</span> <span class="nc">FormSubscriber</span> <span class="k">extends</span> <span class="nx">CommonSubscriber</span>
<span class="p">{</span>

    <span class="sd">/**
     * {@inheritdoc}
     */</span>
    <span class="k">static</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">getSubscribedEvents</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">array</span><span class="p">(</span>
            <span class="nx">FormEvents</span><span class="o">::</span><span class="na">FORM_ON_BUILD</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'onFormBuilder'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**
     * Add a simple email form
     *
     * @param FormBuilderEvent $event
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">onFormBuilder</span><span class="p">(</span><span class="nx">Events\FormBuilderEvent</span> <span class="nv">$event</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Register a form submit actions
</span>        <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">addSubmitAction</span><span class="p">(</span>
            <span class="s1">'helloworld.sendemail'</span><span class="p">,</span>
            <span class="k">array</span><span class="p">(</span>
                <span class="c1">// Label to group by in the dropdown
</span>                <span class="s1">'group'</span>       <span class="o">=&gt;</span> <span class="s1">'addon.helloworld.header'</span><span class="p">,</span>

                <span class="c1">// Label to list by in the dropdown
</span>                <span class="s1">'label'</span>       <span class="o">=&gt;</span> <span class="s1">'addon.helloworld.formaction.send_email'</span><span class="p">,</span>
                <span class="s1">'description'</span> <span class="o">=&gt;</span> <span class="s1">'addon.helloworld.formaction.send_email_descr'</span><span class="p">,</span>

                <span class="c1">// Form service for custom config options
</span>                <span class="s1">'formType'</span>    <span class="o">=&gt;</span> <span class="s1">'helloworld_worlds'</span><span class="p">,</span>
                <span class="s1">'formTheme'</span>   <span class="o">=&gt;</span> <span class="s1">'HelloWorldBundle:FormTheme\SubmitAction'</span><span class="p">,</span>

                <span class="c1">// Custom validation callback
</span>                <span class="s1">'validator'</span>   <span class="o">=&gt;</span> <span class="s1">'\MauticAddons\HelloWorldBundle\Helper\FormSubmitHelper::validateForm'</span><span class="p">,</span>

                <span class="c1">// Callback method to be executed after the submission 
</span>                <span class="s1">'callback'</span>    <span class="o">=&gt;</span> <span class="s1">'\MauticAddons\HelloWorldBundle\Helper\FormSubmitHelper::sendEmail'</span>
            <span class="p">)</span>
        <span class="p">);</span>

        <span class="c1">// Register a custom form field
</span>        <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">addFormField</span><span class="p">(</span>
            <span class="s1">'helloworld.customfield'</span><span class="p">,</span>
            <span class="k">array</span><span class="p">(</span>
                <span class="c1">// Field label
</span>                <span class="s1">'label'</span>    <span class="o">=&gt;</span> <span class="s1">'addon.helloworld.formfield.customfield'</span><span class="p">,</span>

                <span class="c1">// Form service for the field's configuration
</span>                <span class="s1">'formType'</span> <span class="o">=&gt;</span> <span class="s1">'helloworld_worlds'</span><span class="p">,</span>

                <span class="c1">// Template to use to render the formType
</span>                <span class="s1">'template'</span> <span class="o">=&gt;</span> <span class="s1">'HelloWorldBundle:SubscribedEvents\FormField:customfield.html.php'</span>
            <span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>Forms can be extended by listening to the <code class="prettyprint">\Mautic\FormBundle\FormEvents::FORM_ON_BUILD</code> event.  Read more about <a href="#events">listeners and subscribers</a>. </p>

<h4 id="form-fields">Form Fields</h4>

<p>To add a custom form field, use the <code class="prettyprint">$event-&gt;addFormField($identifier, $parameters)</code> method. <code class="prettyprint">$identifier</code> must be something unique. The <code class="prettyprint">$parameters</code> array can contain the following elements:</p>

<table><thead>
<tr>
<th>Key</th>
<th>Required</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>label</strong></td>
<td>REQUIRED</td>
<td>string</td>
<td>The language string for the option in the dropdown</td>
</tr>
<tr>
<td><strong>formType</strong></td>
<td>REQUIRED</td>
<td>string</td>
<td>The alias of a custom form type used to set config options</td>
</tr>
<tr>
<td><strong>formTypeOptions</strong></td>
<td>OPTIONAL</td>
<td>array</td>
<td>Array of options to include into the formType&rsquo;s $options argument</td>
</tr>
<tr>
<td><strong>formTypeCleanMasks</strong></td>
<td>OPTIONAL</td>
<td>array</td>
<td>Array of input masks to clean a values from formType</td>
</tr>
<tr>
<td><strong>formTypeTheme</strong></td>
<td>OPTIONAL</td>
<td>string</td>
<td>Theme to customize elements for formType</td>
</tr>
<tr>
<td><strong>template</strong></td>
<td>REQUIRED</td>
<td>string</td>
<td>View template used to render the formType</td>
</tr>
<tr>
<td><strong>valueFilter</strong></td>
<td>OPTIONAL</td>
<td>mixed</td>
<td>Filter to use to clean the submitted value as supported by InputHelper or a callback function that accepts the arguments <code class="prettyprint">\Mautic\FormBundle\Entity\Field $field</code> and <code class="prettyprint">$value</code>.</td>
</tr>
<tr>
<td><strong>valueConstraints</strong></td>
<td>OPTIONAL</td>
<td>mixed</td>
<td>Callback function to use to validate the value; the function should accept the arguments <code class="prettyprint">\Mautic\FormBundle\Entity\Field $field</code> and <code class="prettyprint">$filteredValue</code>.</td>
</tr>
<tr>
<td><strong>builderOptions</strong></td>
<td>OPTIONAL</td>
<td>array</td>
<td>Array of boolean options for the form builder: <br />addHelpMessage = true/false<br />addShowLabel = true/false<br />addDefaultValue = true/false<br />addLabelAttributes = true/false<br />addInputAttributes = true/false<br />addIsRequired = true/false</td>
</tr>
</tbody></table>

<h4 id="form-submit-actions">Form Submit Actions</h4>

<p>To add an action, use the <code class="prettyprint">$event-&gt;addSubmitAction($identifier, $parameters)</code> method. <code class="prettyprint">$identifier</code> must be something unique. The <code class="prettyprint">$parameters</code> array can contain the following elements:</p>

<table><thead>
<tr>
<th>Key</th>
<th>Required</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>label</strong></td>
<td>REQUIRED</td>
<td>string</td>
<td>The language string for the option in the dropdown</td>
</tr>
<tr>
<td><strong>description</strong></td>
<td>OPTIONAL</td>
<td>string</td>
<td>The language string to use for the option&rsquo;s tooltip</td>
</tr>
<tr>
<td><strong>validator</strong></td>
<td>OPTIONAL</td>
<td>mixed</td>
<td>Static callback function called to validate the form submission</td>
</tr>
<tr>
<td><strong>callback</strong></td>
<td>REQUIRED</td>
<td>mixed</td>
<td>Static callback function called after a submission (submit action logic goes here)</td>
</tr>
<tr>
<td><strong>formType</strong></td>
<td>OPTIONAL</td>
<td>string</td>
<td>The alias of a custom form type used to set config options</td>
</tr>
<tr>
<td><strong>formTypeOptions</strong></td>
<td>OPTIONAL</td>
<td>array</td>
<td>Array of options to include into the formType&rsquo;s $options argument</td>
</tr>
<tr>
<td><strong>formTypeCleanMasks</strong></td>
<td>OPTIONAL</td>
<td>array</td>
<td>Array of input masks to clean a values from formType</td>
</tr>
<tr>
<td><strong>formTypeTheme</strong></td>
<td>OPTIONAL</td>
<td>string</td>
<td>Theme to customize elements for formType</td>
</tr>
<tr>
<td><strong>template</strong></td>
<td>OPTIONAL</td>
<td>string</td>
<td>View template used to render the formType</td>
</tr>
</tbody></table>

<p>The <code class="prettyprint">callback</code> and <code class="prettyprint">validator</code> functions can accept the following variables (determined via ReflectionMethod::invokeArgs()):</p>

<table><thead>
<tr>
<th>Variable</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>config</strong></td>
<td>array</td>
<td>Values saved from the custom config options in <code class="prettyprint">formType</code></td>
</tr>
<tr>
<td><strong>post</strong></td>
<td>array</td>
<td>$_POST</td>
</tr>
<tr>
<td><strong>server</strong></td>
<td>array</td>
<td>$_SERVER</td>
</tr>
<tr>
<td><strong>factory</strong></td>
<td>Mautic\CoreBundle\Factory\MauticFactory</td>
<td><a href="#factory-service">Mautic&rsquo;s factory service</a></td>
</tr>
<tr>
<td><strong>fields</strong></td>
<td>array</td>
<td>Array of the form&rsquo;s fields</td>
</tr>
<tr>
<td><strong>form</strong></td>
<td>Mautic\FormBundle\Entity\Form</td>
<td>Form entity</td>
</tr>
<tr>
<td><strong>action</strong></td>
<td>Mautic\FormBundle\Entity\Action</td>
<td>Action entity</td>
</tr>
<tr>
<td><strong>submission</strong></td>
<td>Mautic\FormBundle\Entity\Submission</td>
<td>Submission entity for this submission</td>
</tr>
</tbody></table>

          <h3 id="extending-integrations">Extending Integrations</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="o">&lt;?</span><span class="nx">php</span>
<span class="c1">// addons\HelloWorldBundle\Integration\MarsIntegration
</span>
<span class="k">namespace</span> <span class="nx">MauticAddon\HelloWorldBundle\Integration</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Mautic\AddonBundle\Entity\Integration</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Mautic\AddonBundle\Integration\AbstractIntegration</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Mautic\AddonBundle\Helper\oAuthHelper</span><span class="p">;</span>

<span class="sd">/**
 * Class MarsIntegration
 */</span>
<span class="k">class</span> <span class="nc">MarsIntegration</span> <span class="k">extends</span> <span class="nx">AbstractIntegration</span>
<span class="p">{</span>
    <span class="sd">/**
     * Returns the name of the social integration that must match the name of the file
     * For example, IcontactIntegration would need Icontact here
     *
     * @return string
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getName</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s1">'Mars'</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**
     * Display name for the integration which defaults to getName() unless defined here
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getDisplayName</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s1">'Red Mars'</span>
    <span class="p">}</span>

    <span class="sd">/**
     * Get the type of authentication required for this API.  Values can be none, key, oauth2 or callback
     * (will call $this-&gt;authenticationTypeCallback)
     *
     * @return string
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getAuthenticationType</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s1">'oauth2'</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**
     * OAuth2 authentication URL
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getAuthenticationUrl</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s1">'https://somesite.com/oauth/authorize'</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**
     * OAuth2 access token URL
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getAccessTokenUrl</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s1">'https://somesite.com/oauth/access_token'</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**
     * Get a list of supported features for this integration
     *
     * @return array
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getSupportedFeatures</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">'public_profile'</span><span class="p">,</span>
            <span class="s1">'public_activity'</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>Integrating 3rd party services in Mautic can be done by defining an Integration class for the service. For example, the MauticSocialBundle has several social media service classes defined in \Addons\MauticSocialBundle\Integration.  Each integration class handles the authorization process, integration configuration, etc.</p>

<h4 id="integration-class">Integration Class</h4>

<p>Each addon can have multiple integrations by defining each as it&rsquo;s own Integration class in the bundle&rsquo;s Integration folder. The class should extend <code class="prettyprint">\Mautic\AddonBundle\Integration\AbstractIntegration</code>. It defines the integration and provides a number of helper functions including OAuth authorization/request signing functions.</p>

<h4 id="integration-image">Integration Image</h4>

<p>Each integration is displayed on a &ldquo;card&rdquo; in the Manage Addons area. To set an image for the integration, include an image in the bundle&rsquo;s Assets\img.  It should be 128x128px, be in a png, and have the same name as returned by <code class="prettyprint">getName()</code> as lower case. For example, <code class="prettyprint">\MauticAddon\HelloWorldBundle\Integration\MarsIntegration</code> should have an image <code class="prettyprint">addons\HelloWorldBundle\Assets\img\mars.png</code>.  </p>

<h4 id="authorization">Authorization</h4>

<p>Out of the box, the AbstractIntegration class can handle standard key, OAuth1a, and OAuth2 specifications. The authorization type is defined by the <code class="prettyprint">getAuthenticationType()</code> function. Each input required by the user (i.e username, password, etc) are defined by an array of keyName =&gt; label elements returned by <code class="prettyprint">getRequiredKeyFields()</code>. This function is not required if using standard specs of key, OAuth1a, or OAuth2.</p>

<h4 id="functions">Functions</h4>

<p>Some of the main functions used are described below. Review the AbstractIntegration class and the functions docblocks for more details.</p>

<p>Keys saved by the integration are encrypted. To access the unencrypted versions in the Integration class, use the array <code class="prettyprint">$this-&gt;keys</code>. </p>

<p>Any of the functions defined in AbstractIntegration can be overridden per special needs of the specific Integration being implemented.</p>

<table><thead>
<tr>
<th>Area</th>
<th>Function</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>Auth</td>
<td>getRequiredKeyFields</td>
<td>Returns an array of keyName =&gt; label elements for settings required from the user, i.e. username, password, client id, client secret, key, etc. Each element will be displayed as an input in the integration&rsquo;s settings.</td>
</tr>
<tr>
<td>Auth</td>
<td>getSecretKeys</td>
<td>Any keyName returned by getRequiredKeyFields that is considered secret or a password should be returned in an array by this function so that it&rsquo;s properly masked in the form.</td>
</tr>
<tr>
<td>Auth &amp; Request</td>
<td>getClientIdKey</td>
<td>Used to define the &ldquo;username&rdquo; for the integration. It defaults to &lsquo;client_id&rsquo; for authentication type oauth2 and &#39;keyName&rsquo; for the keyName authentication type.</td>
</tr>
<tr>
<td>Auth &amp; Request</td>
<td>getClientSecretKey</td>
<td>Used to define the &ldquo;password&rdquo; for the integration. By default, only oauth2 uses this and returns &#39;client_secret&rsquo;.</td>
</tr>
<tr>
<td>Auth</td>
<td>getAuthLoginUrl</td>
<td>Defines the login URL for the oauth1a spec</td>
</tr>
<tr>
<td>Auth</td>
<td>getRequestToken</td>
<td>Used by the oauth1a spec to retrieve a request token during authorization</td>
</tr>
<tr>
<td>Auth</td>
<td>getRequestTokenUrl</td>
<td>Used by the oauth1a spec to define the request token URL</td>
</tr>
<tr>
<td>Auth</td>
<td>getAuthenticationUrl</td>
<td>Defines the login URL for the oauth2 spec</td>
</tr>
<tr>
<td>Auth</td>
<td>getAccessTokenUrl</td>
<td>Defines the access token URL for the oauth2 spec</td>
</tr>
<tr>
<td>Auth</td>
<td>getAuthScope</td>
<td>Defines the scope for the oauth2 spec</td>
</tr>
<tr>
<td>Auth</td>
<td>getAuthCallbackUrl</td>
<td>Used to define the callback URL for oauth1a or oauth2 specs. This defaults to the mautic_integration_auth_callback route.</td>
</tr>
<tr>
<td>Auth</td>
<td>prepareResponseForExtraction</td>
<td>Called by extractAuthKeys() to manipulate the data prior to checking validating the response by checking that the keyName returned by getAuthTokenKey() is part of the response. If not, it calls getErrorsFromResponse().</td>
</tr>
<tr>
<td>Auth</td>
<td>getErrorsFromResponse</td>
<td>Called by extractAuthKeys() to extract errors from the response into a string.</td>
</tr>
<tr>
<td>Auth &amp; Request</td>
<td>prepareRequest</td>
<td>Called by makeRequest() to manipulate or prepare parameters, settings, headers, etc before sending to the URL</td>
</tr>
<tr>
<td>Auth &amp; Request</td>
<td>parseCallbackResponse</td>
<td>Called by makeRequest() to parse the response for the request into an array.</td>
</tr>
<tr>
<td>Auth &amp; Request</td>
<td>getAuthTokenKey</td>
<td>Returns the keyName that&rsquo;s used to sign a request. Used by oauth1a (oauth_token) and oauth2 (access_token) specs.</td>
</tr>
<tr>
<td>Request</td>
<td>getBearerToken</td>
<td>Generate a bearer token if required by the oauth2 spec</td>
</tr>
<tr>
<td>General</td>
<td>isConfigured</td>
<td>Called to determine if the integration has been correctly configured.</td>
</tr>
<tr>
<td>General</td>
<td>isAuthorized</td>
<td>Called to determine if the integration is authorized (or peforms a reauth if an oauth2 spec has refresh tokens stored)</td>
</tr>
<tr>
<td>Request</td>
<td>makeRequest</td>
<td>Can be used to make API requests. It automatically handles standard key, oauth1a and oauth2 specs.</td>
</tr>
<tr>
<td>Form</td>
<td>getFormSettings</td>
<td>Returns an array of options of what to display in integration&rsquo;s configuration form. The two options used at this time is <code class="prettyprint">requires_callback</code> (true to show a readonly input with the callback returned by getAuthCallbackUrl()) and <code class="prettyprint">requires_authorization</code> (true to display the authorization button).</td>
</tr>
<tr>
<td>Form</td>
<td>getFormNotes</td>
<td>Returns an array of &ldquo;helper notes&rdquo; to display in the various areas of the form.</td>
</tr>
</tbody></table>

<h4 id="makerequest()">makeRequest()</h4>

<p>makeRequest() can be used to automatically sign outgoing requests and/or authentication processes. Of course, any integration can inherit and override this class to suit the integrations needs. It accepts the following parameters:</p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>$url</td>
<td>string</td>
<td>The url to make the request to</td>
</tr>
<tr>
<td>$parameters</td>
<td>array</td>
<td>An array of parameters to submit with the request.  If $method is GET, these will be appended to the query string. Otherwise, they will be part of the POST body.</td>
</tr>
<tr>
<td>$method</td>
<td>string</td>
<td>The request method i.e. get, post, put, patch, delete</td>
</tr>
<tr>
<td>$settings</td>
<td>array</td>
<td>Configures the behavior of the makeRequest function. Built in optional settings are below.</td>
</tr>
</tbody></table>

<h5 id="settings">Settings</h5>

<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>auth_type</td>
<td>string</td>
<td>Overrides the authentication type for the request. If not set, getAuthenticationType() is used.</td>
</tr>
<tr>
<td>query</td>
<td>array</td>
<td>Append parameters to the query of the request URL.</td>
</tr>
<tr>
<td>content_type</td>
<td>string</td>
<td>Sets the content type header for the request.</td>
</tr>
<tr>
<td>encode_parameters</td>
<td>string</td>
<td>If set to json, parameters in the POST will be json encoded prior to making the request.</td>
</tr>
<tr>
<td>headers</td>
<td>array</td>
<td>Array of custom headers to append to the request.</td>
</tr>
<tr>
<td>ssl_verifypeer</td>
<td>bool</td>
<td>Set the CURLOPT_SSL_VERIFYPEER to true.</td>
</tr>
<tr>
<td>curl_options</td>
<td>array</td>
<td>Custom set of curl options to apply to the request.</td>
</tr>
<tr>
<td>return_raw</td>
<td>bool</td>
<td>If true, return the response rather than running it through parseCallbackResponse first.</td>
</tr>
<tr>
<td>authorize_session</td>
<td>bool</td>
<td>Used by prepareRequest() and parseCallbackResponse() to change the behavior based on whether the if the request is obtaining authorization or just making an API call.</td>
</tr>
</tbody></table>

          <h3 id="extending-landing-pages">Extending Landing Pages</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="c1">// addons/HelloWorldBundle/EventListener/PageSubscriber.php
</span>
<span class="k">namespace</span> <span class="nx">MauticAddons\HelloWorldBundle\EventListener</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Mautic\CoreBundle\EventListener\CommonSubscriber</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Mautic\PageBundle\PageEvents</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Mautic\PageBundle\Event\PageBuilderEvent</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Mautic\PageBundle\Event\PageSendEvent</span><span class="p">;</span>

<span class="sd">/**
 * Class PageSubscriber
 */</span>
<span class="k">class</span> <span class="nc">PageSubscriber</span> <span class="k">extends</span> <span class="nx">CommonSubscriber</span>
<span class="p">{</span>

    <span class="sd">/**
     * @return array
     */</span>
    <span class="k">static</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">getSubscribedEvents</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">array</span><span class="p">(</span>
            <span class="nx">PageEvents</span><span class="o">::</span><span class="na">PAGE_ON_BUILD</span>   <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'onPageBuild'</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="nx">PageEvents</span><span class="o">::</span><span class="na">PAGE_ON_DISPLAY</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'onPageDisplay'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**
     * Register the tokens and a custom A/B test winner
     *
     * @param PageBuilderEvent $event
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">onPageBuild</span><span class="p">(</span><span class="nx">PageBuilderEvent</span> <span class="nv">$event</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Add page tokens
</span>        <span class="nv">$content</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">templating</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">'HelloWorldBundle:SubscribedEvents\PageToken:token.html.php'</span><span class="p">);</span>
        <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">addTokenSection</span><span class="p">(</span><span class="s1">'helloworld.token'</span><span class="p">,</span> <span class="s1">'addon.helloworld.header'</span><span class="p">,</span> <span class="nv">$content</span><span class="p">);</span>

        <span class="c1">// Add AB Test Winner Criteria
</span>        <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">addAbTestWinnerCriteria</span><span class="p">(</span>
            <span class="s1">'helloworld.planetvisits'</span><span class="p">,</span>
            <span class="k">array</span><span class="p">(</span>
                <span class="c1">// Label to group by
</span>                <span class="s1">'group'</span>    <span class="o">=&gt;</span> <span class="s1">'addon.helloworld.header'</span><span class="p">,</span>

                <span class="c1">// Label for this specific a/b test winning criteria
</span>                <span class="s1">'label'</span>    <span class="o">=&gt;</span> <span class="s1">'addon.helloworld.pagetokens.'</span><span class="p">,</span>

                <span class="c1">// Static callback function that will be used to determine the winner
</span>                <span class="s1">'callback'</span> <span class="o">=&gt;</span> <span class="s1">'\MauticAddons\HelloWorldBundle\Helper\AbTestHelper::determinePlanetVisitWinner'</span>
            <span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**
     * Search and replace tokens with content
     *
     * @param PageSendEvent $event
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">onPageDisplay</span><span class="p">(</span><span class="nx">PageSendEvent</span> <span class="nv">$event</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Get content
</span>        <span class="nv">$content</span> <span class="o">=</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getContent</span><span class="p">();</span>

        <span class="c1">// Search and replace tokens
</span>        <span class="nv">$content</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s1">'{hello}'</span><span class="p">,</span> <span class="s1">'world!'</span><span class="p">,</span> <span class="nv">$content</span><span class="p">);</span>

        <span class="c1">// Set updated content
</span>        <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">setContent</span><span class="p">(</span><span class="nv">$content</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>There are two way to extend pages: page tokens used to insert dynamic content into a page and a/b test winning criteria . Both leverage the <code class="prettyprint">\Mautic\PageBundle\PageEvents::PAGE_ON_BUILD</code> event. Read more about <a href="#events">listeners and subscribers</a>.</p>

<h4 id="page-tokens">Page Tokens</h4>

<p>Page tokens are handled exactly the same as <a href="#page-tokens">Email Tokens</a>.</p>

<h4 id="page-a/b-test-winner-criteria">Page A/B Test Winner Criteria</h4>

<p>Custom landing page A/B test winner criteria is handled exactly the same as <a href="#page-a/b-test-winner-criteria">page A/B test winner criteria</a> with the only differences being that the <code class="prettyprint">callback</code> function is passed <code class="prettyprint">Mautic\PageBundle\Entity\Page $page</code> and <code class="prettyprint">Mautic\PageBundle\Entity\Page $parent</code> instead. Of course <code class="prettyprint">$children</code> is an ArrayCollection of Page entities as well.</p>

          <h3 id="extending-points">Extending Points</h3>

<p>Custom point actions and triggers can be added by listening to their respective on build events. Read more about <a href="#events">listeners and subscribers</a>.</p>

<h4 id="point-actions">Point Actions</h4>

<p>To add a custom point action used to give a lead x points for doing a certain action, add a listener to the <code class="prettyprint">\Mautic\PointBundle\PointEvents::POINT_ON_BUILD</code> event then configure the custom point action with <code class="prettyprint">$event-&gt;addAction($identifier, $parameters)</code> method. <code class="prettyprint">$identifier</code> must be something unique. The <code class="prettyprint">$parameters</code> array can contain the following elements:</p>

<table><thead>
<tr>
<th>Key</th>
<th>Required</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>label</strong></td>
<td>REQUIRED</td>
<td>string</td>
<td>The language string for the option in the dropdown</td>
</tr>
<tr>
<td><strong>formType</strong></td>
<td>OPTIONAL</td>
<td>string</td>
<td>The alias of a custom form type used to set config options.</td>
</tr>
<tr>
<td><strong>formTypeOptions</strong></td>
<td>OPTIONAL</td>
<td>array</td>
<td>Array of options to include into the formType&rsquo;s $options argument</td>
</tr>
<tr>
<td><strong>formTypeCleanMasks</strong></td>
<td>OPTIONAL</td>
<td>array</td>
<td>Array of input masks to clean a values from formType</td>
</tr>
<tr>
<td><strong>formTypeTheme</strong></td>
<td>OPTIONAL</td>
<td>string</td>
<td>Theme to customize elements for formType</td>
</tr>
<tr>
<td><strong>template</strong></td>
<td>OPTIONAL</td>
<td>string</td>
<td>View template used to render the formType</td>
</tr>
<tr>
<td><strong>callback</strong></td>
<td>OPTIONAL</td>
<td>mixed</td>
<td>Static callback function used to validate the action. Return true to add the points to the lead.</td>
</tr>
</tbody></table>

<p>In order for the custom point action to work, add something like the following in the code logic when the lead executes the custom action:</p>

<p><code class="prettyprint">$this-&gt;factory-&gt;getModel(&#39;point&#39;)-&gt;triggerAction(&#39;page.hit&#39;, $event-&gt;getHit());</code></p>

<h4 id="point-triggers">Point Triggers</h4>

<p>To add a custom point trigger used to execute a specific action once a lead hits X number of points, add a listener to the <code class="prettyprint">\Mautic\PointBundle\PointEvents::TRIGGER_ON_BUILD</code> event then configure the custom point trigger with <code class="prettyprint">$event-&gt;addEvent($identifier, $parameters)</code> method. <code class="prettyprint">$identifier</code> must be something unique. The <code class="prettyprint">$parameters</code> array can contain the following elements:</p>

<table><thead>
<tr>
<th>Key</th>
<th>Required</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>label</strong></td>
<td>REQUIRED</td>
<td>string</td>
<td>The language string for the option in the dropdown</td>
</tr>
<tr>
<td><strong>formType</strong></td>
<td>OPTIONAL</td>
<td>string</td>
<td>The alias of a custom form type used to set config options.</td>
</tr>
<tr>
<td><strong>formTypeOptions</strong></td>
<td>OPTIONAL</td>
<td>array</td>
<td>Array of options to include into the formType&rsquo;s $options argument</td>
</tr>
<tr>
<td><strong>formTypeCleanMasks</strong></td>
<td>OPTIONAL</td>
<td>array</td>
<td>Array of input masks to clean a values from formType</td>
</tr>
<tr>
<td><strong>formTypeTheme</strong></td>
<td>OPTIONAL</td>
<td>string</td>
<td>Theme to customize elements for formType</td>
</tr>
<tr>
<td><strong>template</strong></td>
<td>OPTIONAL</td>
<td>string</td>
<td>View template used to render the formType</td>
</tr>
<tr>
<td><strong>callback</strong></td>
<td>OPTIONAL</td>
<td>mixed</td>
<td>Static callback function used to execute the custom action.</td>
</tr>
</tbody></table>

          <h3 id="extending-reports">Extending Reports</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="c1">// addons\HelloWorldBundle\EventListener\ReportSubscriber
</span>
<span class="k">namespace</span> <span class="nx">MauticAddon\HelloWorldBundle\EventListener</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Mautic\CoreBundle\EventListener\CommonSubscriber</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Mautic\CoreBundle\Helper\GraphHelper</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Mautic\ReportBundle\Event\ReportBuilderEvent</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Mautic\ReportBundle\Event\ReportGeneratorEvent</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Mautic\ReportBundle\Event\ReportGraphEvent</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Mautic\ReportBundle\ReportEvents</span><span class="p">;</span>

<span class="sd">/**
 * Class ReportSubscriber
 */</span>
<span class="k">class</span> <span class="nc">ReportSubscriber</span> <span class="k">extends</span> <span class="nx">CommonSubscriber</span>
<span class="p">{</span>

    <span class="sd">/**
     * @return array
     */</span>
    <span class="k">static</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">getSubscribedEvents</span> <span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">array</span><span class="p">(</span>
            <span class="nx">ReportEvents</span><span class="o">::</span><span class="na">REPORT_ON_BUILD</span>          <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'onReportBuilder'</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="nx">ReportEvents</span><span class="o">::</span><span class="na">REPORT_ON_GENERATE</span>       <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'onReportGenerate'</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="nx">ReportEvents</span><span class="o">::</span><span class="na">REPORT_ON_GRAPH_GENERATE</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'onReportGraphGenerate'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**
     * Add available tables, columns, and graphs to the report builder lookup
     *
     * @param ReportBuilderEvent $event
     *
     * @return void
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">onReportBuilder</span> <span class="p">(</span><span class="nx">ReportBuilderEvent</span> <span class="nv">$event</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Use checkContext() to determine if the report being requested is this report
</span>        <span class="k">if</span> <span class="p">(</span><span class="nv">$event</span><span class="o">-&gt;</span><span class="na">checkContext</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">'worlds'</span><span class="p">)))</span> <span class="p">{</span>
            <span class="c1">// Define the columns that are available to the report.
</span>            <span class="nv">$prefix</span>        <span class="o">=</span> <span class="s1">'w.'</span><span class="p">;</span>
            <span class="nv">$columns</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
                <span class="nv">$prefix</span> <span class="o">.</span> <span class="s1">'visit_count'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                    <span class="s1">'label'</span> <span class="o">=&gt;</span> <span class="s1">'mautic.hellobundle.report.visit_count'</span><span class="p">,</span>
                    <span class="s1">'type'</span>  <span class="o">=&gt;</span> <span class="s1">'int'</span>
                <span class="p">)</span>
            <span class="p">);</span>

             <span class="c1">// Several helper functions are available to append common columns such as categories, publish state fields, lead, etc.  Refer to the ReportBuilderEvent class for more details.
</span>            <span class="nv">$columns</span>       <span class="o">=</span> <span class="nb">array_merge</span><span class="p">(</span><span class="nv">$columns</span><span class="p">,</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getStandardColumns</span><span class="p">(</span><span class="nv">$prefix</span><span class="p">),</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getCategoryColumns</span><span class="p">());</span>

            <span class="c1">// Add the table to the list
</span>            <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">addTable</span><span class="p">(</span><span class="s1">'worlds'</span><span class="p">,</span>
                <span class="k">array</span><span class="p">(</span>
                    <span class="s1">'display_name'</span> <span class="o">=&gt;</span> <span class="s1">'mautic.helloworld.worlds'</span><span class="p">,</span>
                    <span class="s1">'columns'</span>      <span class="o">=&gt;</span> <span class="nv">$columns</span>
                <span class="p">)</span>
            <span class="p">);</span>

            <span class="c1">// Register available graphs; can use line, pie, or table
</span>            <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">addGraph</span><span class="p">(</span><span class="s1">'worlds'</span><span class="p">,</span> <span class="s1">'line'</span><span class="p">,</span> <span class="s1">'mautic.hellobundle.graph.line.visits'</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="sd">/**
     * Initialize the QueryBuilder object used to generate the report's data. 
     * This should use Doctrine's DBAL layer, not the ORM so be sure to use 
     * the real schema column names (not the ORM property names) and the
     * MAUTIC_TABLE_PREFIX constant.
     *
     * @param ReportGeneratorEvent $event
     *
     * @return void
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">onReportGenerate</span> <span class="p">(</span><span class="nx">ReportGeneratorEvent</span> <span class="nv">$event</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$context</span> <span class="o">=</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getContext</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$context</span> <span class="o">==</span> <span class="s1">'worlds'</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$qb</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">factory</span><span class="o">-&gt;</span><span class="na">getEntityManager</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getConnection</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">createQueryBuilder</span><span class="p">();</span>

            <span class="nv">$qb</span><span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="nx">MAUTIC_TABLE_PREFIX</span> <span class="o">.</span> <span class="s1">'worlds'</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">);</span>
            <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">addCategoryLeftJoin</span><span class="p">(</span><span class="nv">$qb</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">);</span>

            <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">setQueryBuilder</span><span class="p">(</span><span class="nv">$qb</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="sd">/**
     * Generate the graphs
     *
     * @param ReportGraphEvent $event
     *
     * @return void
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">onReportGraphGenerate</span> <span class="p">(</span><span class="nx">ReportGraphEvent</span> <span class="nv">$event</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$event</span><span class="o">-&gt;</span><span class="na">checkContext</span><span class="p">(</span><span class="s1">'worlds'</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nv">$graphs</span>   <span class="o">=</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getRequestedGraphs</span><span class="p">();</span>
        <span class="nv">$qb</span>       <span class="o">=</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getQueryBuilder</span><span class="p">();</span>
        <span class="nv">$repo</span>     <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">factory</span><span class="o">-&gt;</span><span class="na">getEntityManager</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getRepository</span><span class="p">(</span><span class="s1">'HelloWorldBundle:World'</span><span class="p">);</span>

        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$graphs</span> <span class="k">as</span> <span class="nv">$graph</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$options</span>      <span class="o">=</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getOptions</span><span class="p">(</span><span class="nv">$graph</span><span class="p">);</span>
            <span class="nv">$queryBuilder</span> <span class="o">=</span> <span class="k">clone</span> <span class="nv">$qb</span><span class="p">;</span>

            <span class="k">switch</span> <span class="p">(</span><span class="nv">$graph</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">case</span> <span class="s1">'mautic.hellobundle.graph.line.visits'</span><span class="o">:</span>
                    <span class="c1">// Generate data for Stats line graph
</span>                    <span class="nv">$unit</span>   <span class="o">=</span> <span class="s1">'D'</span><span class="p">;</span>
                    <span class="nv">$amount</span> <span class="o">=</span> <span class="mi">30</span><span class="p">;</span>

                    <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$options</span><span class="p">[</span><span class="s1">'amount'</span><span class="p">]))</span> <span class="p">{</span>
                        <span class="nv">$amount</span> <span class="o">=</span> <span class="nv">$options</span><span class="p">[</span><span class="s1">'amount'</span><span class="p">];</span>
                    <span class="p">}</span>

                    <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$options</span><span class="p">[</span><span class="s1">'unit'</span><span class="p">]))</span> <span class="p">{</span>
                        <span class="nv">$unit</span> <span class="o">=</span> <span class="nv">$options</span><span class="p">[</span><span class="s1">'unit'</span><span class="p">];</span>
                    <span class="p">}</span>

                    <span class="c1">// Prepare the line graph
</span>                    <span class="nv">$graphStats</span> <span class="o">=</span> <span class="nx">GraphHelper</span><span class="o">::</span><span class="na">prepareDatetimeLineGraphData</span><span class="p">(</span><span class="nv">$amount</span><span class="p">,</span> <span class="nv">$unit</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'visits'</span><span class="p">));</span>

                    <span class="c1">// Get counts from repo
</span>                    <span class="nv">$visitStats</span> <span class="o">=</span> <span class="nv">$repo</span><span class="o">-&gt;</span><span class="na">getVisitStats</span><span class="p">(</span><span class="nv">$graphStats</span><span class="p">[</span><span class="s1">'fromDate'</span><span class="p">]);</span>

                    <span class="nv">$graphStats</span>  <span class="o">=</span> <span class="nx">GraphHelper</span><span class="o">::</span><span class="na">mergeLineGraphData</span><span class="p">(</span><span class="nv">$graphStats</span><span class="p">,</span> <span class="nv">$visitStats</span><span class="p">,</span> <span class="nv">$unit</span><span class="p">,</span>

                    <span class="nv">$graphData</span><span class="p">[</span><span class="s1">'data'</span><span class="p">]</span>      <span class="o">=</span> <span class="nv">$graphStats</span><span class="p">;</span>
                    <span class="nv">$graphData</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]</span>      <span class="o">=</span> <span class="nv">$graph</span><span class="p">;</span>
                    <span class="nv">$graphData</span><span class="p">[</span><span class="s1">'iconClass'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'fa-tachometer'</span><span class="p">;</span>
                    <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">setGraph</span><span class="p">(</span><span class="nv">$graph</span><span class="p">,</span> <span class="nv">$graphStats</span><span class="p">);</span>
                    <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>Adding and rendering custom reports are done by listening to the <code class="prettyprint">\Mautic\ReportBundle\ReportEvents::REPORT_ON_BUILD</code>, <code class="prettyprint">ReportEvents::REPORT_ON_GENERATE</code> and <code class="prettyprint">ReportEvents::REPORT_ON_GRAPH_GENERATE</code> events.</p>

<h4 id="defining-the-report">Defining the Report</h4>

<p>Defining the report is done through the <code class="prettyprint">ReportEvents::REPORT_ON_BUILD</code> event. This is where the addon will define the context of the report, available columns for table data, and available graphs. See the code example&rsquo;s <code class="prettyprint">onReportBuilder</code> for details.</p>

<h4 id="generate-the-querybuilder">Generate the QueryBuilder</h4>

<p>The <code class="prettyprint">ReportEvents::REPORT_ON_GENERATE</code> event is dispatched when a report is to be generated and displayed. In this function, the addon should define the QueryBuilder object used to generate the table data. </p>

<p>Use <code class="prettyprint">$event-&gt;checkContext()</code> to determine if the report requested is the subscribers report.</p>

<aside class="notice">
Note that the <code>ReportEvents::REPORT_ON_GENERATE</code> event should use Doctrine&rsquo;s DBAL layer QueryBuilder obtained via <code>$qb = $this->factory->getEntityManager()->getConnection()->createQueryBuilder();</code>.
</aside>

<p>There are a number of helper functions to append joins for commonly used relationships such as category, leads, ip address, etc.  Refer to the ReportGeneratorEvent class for more details.</p>

<h4 id="graphs">Graphs</h4>

<p>Graphs are generated using <code class="prettyprint">ReportEvents::REPORT_ON_GRAPH_GENERATE</code> event. The listener should check the context then generate and set the graph data.  The <code class="prettyprint">Mautic\CoreBundle\Helper\GraphHelper()</code> class can be used to assist in formatting the data for the graph.</p>

          <h3 id="manipulating-leads">Manipulating Leads</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>

<span class="sd">/** @var \Mautic\LeadBundle\Model\LeadModel $leadModel */</span>
<span class="nv">$leadModel</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">factory</span><span class="o">-&gt;</span><span class="na">getModel</span><span class="p">(</span><span class="s1">'lead'</span><span class="p">);</span>

<span class="o">/**</span> <span class="o">@</span><span class="k">var</span> <span class="nx">\Mautic\LeadBundle\Entity\Lead</span> <span class="nv">$currentLead</span>
<span class="nv">$currentLead</span> <span class="o">=</span> <span class="nv">$leadModel</span><span class="o">-&gt;</span><span class="na">getCurrentLead</span><span class="p">();</span>

<span class="c1">// To obtain the tracking ID as well, pass true
</span><span class="k">list</span><span class="p">(</span><span class="nv">$currentLead</span><span class="p">,</span> <span class="nv">$trackingId</span><span class="p">,</span> <span class="nv">$trackingIdIsNewlyGenerated</span><span class="p">)</span> <span class="o">=</span> <span class="nv">$leadModel</span><span class="o">-&gt;</span><span class="na">getCurrentLead</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>

<span class="c1">// To obtain just the tracking ID; pass true as an argument to force regeneration of the tracking ID and cookies
</span><span class="k">list</span><span class="p">(</span><span class="nv">$trackingId</span><span class="p">,</span> <span class="nv">$trackingIdIsNewlyGenerated</span><span class="p">)</span> <span class="o">=</span> <span class="nv">$leadModel</span><span class="o">-&gt;</span><span class="na">getTrackingCookie</span><span class="p">();</span>

<span class="c1">// Set the currently tracked lead and generate tracking cookies
</span><span class="nv">$lead</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Lead</span><span class="p">();</span>
<span class="c1">// ...
</span><span class="nv">$leadModel</span><span class="o">-&gt;</span><span class="na">setCurrentLead</span><span class="p">(</span><span class="nv">$lead</span><span class="p">);</span>

<span class="c1">// Set a lead for system use purposes (i.e. events that use getCurrentLead()) but without generating tracking cookies
</span><span class="nv">$leadModel</span><span class="o">-&gt;</span><span class="na">setSystemCurrentLead</span><span class="p">(</span><span class="nv">$lead</span><span class="p">);</span>

</code></pre>

<p>Many addons extending Mautic will be manipulating leads in one way or another. Here is a quick summary of how to obtain the current lead and/or manipulate the leads data.</p>

<h4 id="lead-tracking">Lead Tracking</h4>

<p>Leads are tracked by two cookies. The first cookie notes which ID the lead is tracked under Mautic as. The second is to track the lead&rsquo;s activity for the current session (defaults to 30 minutes and resets during each lead interaction).</p>

<p><code class="prettyprint">mautic_session_id</code> holds the value of the lead&rsquo;s current session ID.  That value is then name of the cookie that holds the lead&rsquo;s ID. </p>

<p>Review the sample code on how to obtain the currently tracked lead.</p>

<div class="clear-right"></div>

<h4 id="creating-new-leads">Creating New Leads</h4>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="c1">// Currently tracked lead based on cookies
</span><span class="nv">$lead</span> <span class="o">=</span> <span class="nv">$leadModel</span><span class="o">-&gt;</span><span class="na">getCurrentLead</span><span class="p">();</span>
<span class="nv">$leadId</span> <span class="o">=</span> <span class="nv">$lead</span><span class="o">-&gt;</span><span class="na">getId</span><span class="p">();</span>

<span class="c1">// OR generate a completely new lead with
</span><span class="nv">$lead</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Lead</span><span class="p">();</span>
<span class="nv">$lead</span><span class="o">-&gt;</span><span class="na">setNewlyCreated</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="nv">$leadId</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

<span class="c1">// IP address of the request
</span><span class="nv">$ipAdddress</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">factory</span><span class="o">-&gt;</span><span class="na">getIpAddress</span><span class="p">();</span>

<span class="c1">// Updated/new fields
</span><span class="nv">$leadFields</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">'firstname'</span> <span class="o">=&gt;</span> <span class="s1">'Bob'</span><span class="p">,</span>
    <span class="c1">//...
</span><span class="p">);</span>

<span class="c1">// Optionally check for identifier fields to determine if the lead is unique
</span><span class="nv">$uniqueLeadFields</span>    <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">factory</span><span class="o">-&gt;</span><span class="na">getModel</span><span class="p">(</span><span class="s1">'lead.field'</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getUniqueIdentiferFields</span><span class="p">();</span>
<span class="nv">$uniqueLeadFieldData</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>

<span class="c1">// Check if unique identifier fields are included
</span><span class="nv">$inList</span> <span class="o">=</span> <span class="nb">array_intersect_key</span><span class="p">(</span><span class="nv">$leadFields</span><span class="p">,</span> <span class="nv">$availableLeadFields</span><span class="p">);</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$inList</span> <span class="k">as</span> <span class="nv">$k</span> <span class="o">=&gt;</span> <span class="nv">$v</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$query</span><span class="p">[</span><span class="nv">$k</span><span class="p">]))</span> <span class="p">{</span>
        <span class="nb">unset</span><span class="p">(</span><span class="nv">$inList</span><span class="p">[</span><span class="nv">$k</span><span class="p">]);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">array_key_exists</span><span class="p">(</span><span class="nv">$k</span><span class="p">,</span> <span class="nv">$uniqueLeadFields</span><span class="p">))</span> <span class="p">{</span>
        <span class="nv">$uniqueLeadFieldData</span><span class="p">[</span><span class="nv">$k</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$v</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// If there are unique identifier fields, check for existing leads based on lead data
</span><span class="k">if</span> <span class="p">(</span><span class="nb">count</span><span class="p">(</span><span class="nv">$inList</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$uniqueLeadFieldData</span><span class="p">))</span> <span class="p">{</span>
    <span class="nv">$existingLeads</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">em</span><span class="o">-&gt;</span><span class="na">getRepository</span><span class="p">(</span><span class="s1">'MauticLeadBundle:Lead'</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getLeadsByUniqueFields</span><span class="p">(</span>
        <span class="nv">$uniqueLeadFieldData</span><span class="p">,</span>
        <span class="nv">$leadId</span> <span class="c1">// If a currently tracked lead, ignore this ID when searching for duplicates
</span>    <span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$existingLeads</span><span class="p">))</span> <span class="p">{</span>
        <span class="c1">// Existing found so merge the two leads
</span>        <span class="nv">$lead</span> <span class="o">=</span> <span class="nv">$leadModel</span><span class="o">-&gt;</span><span class="na">mergeLeads</span><span class="p">(</span><span class="nv">$lead</span><span class="p">,</span> <span class="nv">$existingLeads</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
    <span class="p">}</span>

    <span class="c1">// Get the lead's currently associated IPs
</span>    <span class="nv">$leadIpAddresses</span> <span class="o">=</span> <span class="nv">$lead</span><span class="o">-&gt;</span><span class="na">getIpAddresses</span><span class="p">();</span>

    <span class="c1">// If the IP is not already associated, do so (the addIpAddress will automatically handle ignoring
</span>    <span class="c1">// the IP if it is set to be ignored in the Configuration)
</span>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$leadIpAddresses</span><span class="o">-&gt;</span><span class="na">contains</span><span class="p">(</span><span class="nv">$ipAddress</span><span class="p">))</span> <span class="p">{</span>
        <span class="nv">$lead</span><span class="o">-&gt;</span><span class="na">addIpAddress</span><span class="p">(</span><span class="nv">$ipAddress</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Set the lead's data
</span><span class="nv">$leadModel</span><span class="o">-&gt;</span><span class="na">setFieldValues</span><span class="p">(</span><span class="nv">$lead</span><span class="p">,</span> <span class="nv">$leadFields</span><span class="p">);</span>

<span class="c1">// Save the entity
</span><span class="nv">$leadModel</span><span class="o">-&gt;</span><span class="na">saveEntity</span><span class="p">(</span><span class="nv">$lead</span><span class="p">);</span>

<span class="c1">// Set the updated lead
</span><span class="nv">$leadModel</span><span class="o">-&gt;</span><span class="na">setCurrentLead</span><span class="p">(</span><span class="nv">$lead</span><span class="p">);</span>
</code></pre>

<p>To create a new lead, use the <code class="prettyprint">\Mautic\LeadBundle\Entity\Lead</code> entity. Review the code sample.</p>

          <h1 id="themes">Themes</h1>

<p>Custom themes for public facing areas of Mautic can be generated but require a bit of PHP experience (for now).</p>

<p>The themes use the same templating formats as Symfony&rsquo;s templates and Mautic&rsquo;s view templates. Review the <a href="#views">Views</a> section for more on using Symfony&rsquo;s PHP templating engine and the <code class="prettyprint">$view</code> helpers.</p>

<h2 id="theme-directory-structure">Theme Directory Structure</h2>

<p>Each theme directory must have at least a config.php file and a html directory with the public facing template&rsquo;s for the feature&rsquo;s it supports. All themes should have a <code class="prettyprint">html/message.html.php</code> file.  See below for a typical directory structure:</p>

<p>themes/HelloWorld/<br />
  - - - <a href="#theme-config-file">config.php</a><br />
  - - - html/ <br />
  - - - - - - <a href="#theme-html-files">base.html.php</a><br />
  - - - - - - <a href="#theme-html-files">email.html.phpp</a><br />
  - - - - - - <a href="#theme-html-files">form.html.phpp</a><br />
  - - - - - - <a href="#theme-html-files">message.html.phpp</a><br />
  - - - - - - <a href="#theme-html-files">page.html.phpp</a><br /></p>

<h2 id="theme-config-file">Theme Config File</h2>
<pre><code class="highlight php"> <span class="cp">&lt;?php</span>
<span class="c1">// themes/HelloWorld/config.php
</span>
<span class="nv">$config</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">'name'</span>     <span class="o">=&gt;</span> <span class="s1">'Hello World'</span><span class="p">,</span>
    <span class="s1">'features'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">'page'</span><span class="p">,</span>
        <span class="s1">'email'</span><span class="p">,</span>
        <span class="s1">'form'</span>
    <span class="p">),</span>
    <span class="s1">'slots'</span>    <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">'page'</span>  <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">'page_title'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="s1">'text'</span><span class="p">,</span> <span class="s1">'placeholder'</span> <span class="o">=&gt;</span> <span class="s1">'mautic.page.builder.addcontent'</span><span class="p">),</span>
            <span class="s1">'top_title'</span>  <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="s1">'text'</span><span class="p">,</span> <span class="s1">'placeholder'</span> <span class="o">=&gt;</span> <span class="s1">'mautic.page.builder.addcontent'</span><span class="p">),</span>
            <span class="s1">'top'</span>        <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="s1">'html'</span><span class="p">,</span> <span class="s1">'placeholder'</span> <span class="o">=&gt;</span> <span class="s1">'mautic.page.builder.addcontent'</span><span class="p">),</span>
            <span class="s1">'main'</span>       <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="s1">'html'</span><span class="p">,</span> <span class="s1">'placeholder'</span> <span class="o">=&gt;</span> <span class="s1">'mautic.page.builder.addcontent'</span><span class="p">),</span>
            <span class="s1">'footer'</span>     <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="s1">'html'</span><span class="p">,</span> <span class="s1">'placeholder'</span> <span class="o">=&gt;</span> <span class="s1">'mautic.page.builder.addcontent'</span><span class="p">)</span>
        <span class="p">),</span>
        <span class="s1">'email'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">'header'</span><span class="p">,</span>
            <span class="s1">'body'</span><span class="p">,</span>
            <span class="s1">'footer'</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">);</span>

<span class="k">return</span> <span class="nv">$config</span><span class="p">;</span>
</code></pre>

<p>The config file defines the name of the theme, the features it supports, and the slots available for page/email builders.</p>

<p>The config file should return an array with the following keys:</p>

<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>name</td>
<td>string</td>
<td>Name displayed in the theme dropdowns</td>
</tr>
<tr>
<td>features</td>
<td>array</td>
<td>Array of features the theme supports. Options currently are email, form, and/or page</td>
</tr>
<tr>
<td>slots</td>
<td>array</td>
<td>Array defining slots available for the email and page builders.  Not required for just form themes.</td>
</tr>
</tbody></table>

<h2 id="theme-html-files">Theme HTML Files</h2>

<p>Notice that in the directory structure above, there is a base.html.php file.  This is not necessary but used in the example to define the base HTML document which each some of the following files extend.  Review <a href="#extending-views">Extending Views</a> for more information.</p>

<h3 id="email.html.php">email.html.php</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span> 
<span class="c1">// themes/HelloBundle/html/email.html.php 
</span><span class="cp">?&gt;</span> 

<span class="c">&lt;!-- Very simple document --&gt;</span> 
<span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="cp">&lt;?php</span> 
        <span class="c1">// required for the email builder
</span>        <span class="nv">$view</span><span class="p">[</span><span class="s1">'assets'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">outputHeadDeclarations</span><span class="p">();</span> 
        <span class="cp">?&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body</span> <span class="na">style=</span><span class="s">"background: #f7f7f7; margin:0"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div&gt;</span>
            <span class="cp">&lt;?php</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">'slots'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">output</span><span class="p">(</span><span class="s1">'header'</span><span class="p">);</span> <span class="cp">?&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;div&gt;</span>
            <span class="cp">&lt;?php</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">'slots'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">output</span><span class="p">(</span><span class="s1">'body'</span><span class="p">);</span> <span class="cp">?&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;div&gt;</span>
            <span class="cp">&lt;?php</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">'slots'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">output</span><span class="p">(</span><span class="s1">'footer'</span><span class="p">);</span> <span class="cp">?&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="cp">&lt;?php</span> 
        <span class="c1">// required for the email builder
</span>        <span class="nv">$view</span><span class="p">[</span><span class="s1">'slots'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">output</span><span class="p">(</span><span class="s1">'builder'</span><span class="p">);</span> 
        <span class="cp">?&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre>

<p>This file defines the document for building an email template. Of course this file should follow html based email etiquette. Throughout the document should be output for the slots defined in the config file. For example, the config above defines header, body, and footer slots.  Thus in the appropriate places within email.html.php, should be <code class="prettyprint">&lt;?php $view[&#39;slots&#39;]-&gt;output(&#39;header&#39;); ?&gt;</code>, <code class="prettyprint">&lt;?php $view[&#39;slots&#39;]-&gt;output(&#39;body&#39;); ?&gt;</code>,  and <code class="prettyprint">&lt;?php $view[&#39;slots&#39;]-&gt;output(&#39;footer&#39;); ?&gt;</code>,  </p>

<aside class="notice">
Every email.html.php file should have <code>&lt;?php $view['assets']->outputHeadDeclarations();?&gt;</code> in the &lt;head /&gt; tag and <code>&lt;?php $view['slots']->output('builder'); ?&gt;</code> before the closing &lt;/body&gt; tag.  These are used by the email builder and are required.
</aside>

<h3 id="form.html.php">form.html.php</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="c1">// theme/HelloWorld/html/form.html.php
</span>
<span class="nv">$view</span><span class="o">-&gt;</span><span class="na">extend</span><span class="p">(</span><span class="s2">":</span><span class="nv">$template</span><span class="s2">:base.html.php"</span><span class="p">);</span>
<span class="cp">?&gt;</span>
<span class="cp">&lt;?php</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$message</span><span class="p">))</span><span class="o">:</span> <span class="cp">?&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"well text-center"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;h2&gt;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$message</span><span class="p">;</span> <span class="cp">?&gt;</span><span class="nt">&lt;/h2&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="cp">&lt;?php</span> <span class="k">endif</span><span class="p">;</span> <span class="cp">?&gt;</span>

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-container"</span><span class="nt">&gt;</span>
    <span class="cp">&lt;?php</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$header</span><span class="p">))</span><span class="o">:</span> <span class="cp">?&gt;</span>
        <span class="nt">&lt;h4&gt;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="p">(</span><span class="nv">$header</span><span class="p">);</span> <span class="cp">?&gt;</span><span class="nt">&lt;/h4&gt;</span>
    <span class="cp">&lt;?php</span> <span class="k">endif</span><span class="p">;</span> <span class="cp">?&gt;</span>
    <span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$content</span><span class="p">;</span> <span class="cp">?&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre>

<p>This file generates the html document for a form when viewed via it&rsquo;s public URL. This does not style the fields of a form. That will be described below.  </p>

<p>Each form.html.php file should echo a <code class="prettyprint">$message</code>, <code class="prettyprint">$header</code>, and <code class="prettyprint">$content</code> variables. <code class="prettyprint">$template</code> is defined with the name of the current theme used and can be used to extend form.html.php. </p>

<h4 id="customizing-the-form">Customizing the Form</h4>

<p>To provide custom form field templates or to manipulate the form body, create the following directory structure:</p>

<p>themes/HelloWorld/<br />
  - - - html/ <br />
  - - - - - - MauticFormBundle<br />
  - - - - - - - - - Builder &lt;&ndash; for customizing the form structure itself<br />
  - - - - - - - - - Field &lt;&ndash; for customizing form field types<br /></p>

<p>Copy from <code class="prettyprint">app/bundles/FormBundle/Views/Builder/form.html.php</code> in the theme&rsquo;s Builder directory or one or more of the fields templates in <code class="prettyprint">app/bundles/FormBundle/Views/Field/*.html.php</code> into the theme&rsquo;s Field directory. Then customize to the desired layout.  </p>

<h3 id="message.html.php">message.html.php</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="c1">// themes/HelloWorld/html/message.html.php
</span>
<span class="c1">// extend base.html.php which contains the outer HTML document (html, head, and body)
</span><span class="nv">$view</span><span class="o">-&gt;</span><span class="na">extend</span><span class="p">(</span><span class="s2">":</span><span class="nv">$template</span><span class="s2">:base.html.php"</span><span class="p">);</span>
<span class="cp">?&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"well text-center"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h2&gt;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$message</span><span class="p">;</span> <span class="cp">?&gt;</span><span class="nt">&lt;/h2&gt;</span>
    <span class="cp">&lt;?php</span> <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$content</span><span class="p">))</span><span class="o">:</span> <span class="cp">?&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"text-left"</span><span class="nt">&gt;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$content</span><span class="p">;</span> <span class="cp">?&gt;</span><span class="nt">&lt;/div&gt;</span>
    <span class="cp">&lt;?php</span> <span class="k">endif</span><span class="p">;</span> <span class="cp">?&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre>

<p>This file is a simple message file mainly used as the landing page for when a lead unsubscribes or resubscribes to the system&rsquo;s emails. But may be used by other areas so should be included in all themes.</p>

<p>It requires echo&#39;ing two variables: <code class="prettyprint">$message</code> and <code class="prettyprint">$content</code>. <code class="prettyprint">$message</code> houses the string message such as &ldquo;You have been unsubscribed&hellip;&rdquo; <code class="prettyprint">$content</code> will either be empty or house the HTML of a form that&rsquo;s been associated with the email as an &ldquo;unsubscribe form.&rdquo; </p>

<h3 id="page.html.php">page.html.php</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="c1">// themes/HelloBundle/html/page.html.php
</span>
<span class="c1">// extend base.html.php which contains the outer HTML document (html, head, and body)
</span><span class="nv">$view</span><span class="o">-&gt;</span><span class="na">extend</span><span class="p">(</span><span class="s2">":</span><span class="nv">$template</span><span class="s2">:base.html.php"</span><span class="p">);</span>

<span class="nv">$parentVariant</span> <span class="o">=</span> <span class="nv">$page</span><span class="o">-&gt;</span><span class="na">getVariantParent</span><span class="p">();</span>
<span class="nv">$title</span>         <span class="o">=</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$parentVariant</span><span class="p">))</span> <span class="o">?</span> <span class="nv">$parentVariant</span><span class="o">-&gt;</span><span class="na">getTitle</span><span class="p">()</span> <span class="o">:</span> <span class="nv">$page</span><span class="o">-&gt;</span><span class="na">getTitle</span><span class="p">();</span>
<span class="nv">$view</span><span class="p">[</span><span class="s1">'slots'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">'pageTitle'</span><span class="p">,</span> <span class="nv">$title</span><span class="p">);</span>
<span class="cp">?&gt;</span>

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>

    <span class="cp">&lt;?php</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$view</span><span class="p">[</span><span class="s1">'slots'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">hasContent</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">'page_title'</span><span class="p">,</span> <span class="s1">'top_title'</span><span class="p">,</span> <span class="s1">'top'</span><span class="p">)))</span><span class="o">:</span> <span class="cp">?&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
        <span class="cp">&lt;?php</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$view</span><span class="p">[</span><span class="s1">'slots'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">hasContent</span><span class="p">(</span><span class="s1">'page_title'</span><span class="p">))</span><span class="o">:</span> <span class="cp">?&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-lg-12"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;h1</span> <span class="na">class=</span><span class="s">"page-header"</span><span class="nt">&gt;</span>
                <span class="cp">&lt;?php</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">'slots'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">output</span><span class="p">(</span><span class="s1">'page_title'</span><span class="p">);</span> <span class="cp">?&gt;</span>
            <span class="nt">&lt;/h1&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="cp">&lt;?php</span> <span class="k">endif</span><span class="p">;</span> <span class="cp">?&gt;</span>
        <span class="cp">&lt;?php</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$view</span><span class="p">[</span><span class="s1">'slots'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">hasContent</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">'top_title'</span><span class="p">,</span> <span class="s1">'top'</span><span class="p">)))</span><span class="o">:</span> <span class="cp">?&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-md-12"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"panel panel-default"</span><span class="nt">&gt;</span>
                <span class="cp">&lt;?php</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$view</span><span class="p">[</span><span class="s1">'slots'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">hasContent</span><span class="p">(</span><span class="s1">'top_title'</span><span class="p">))</span><span class="o">:</span> <span class="cp">?&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"panel-heading"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;h4&gt;</span><span class="cp">&lt;?php</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">'slots'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">output</span><span class="p">(</span><span class="s1">'top_title'</span><span class="p">);</span> <span class="cp">?&gt;</span><span class="nt">&lt;/h4&gt;</span>
                <span class="nt">&lt;/div&gt;</span>
                <span class="cp">&lt;?php</span> <span class="k">endif</span><span class="p">;</span> <span class="cp">?&gt;</span>
                <span class="cp">&lt;?php</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$view</span><span class="p">[</span><span class="s1">'slots'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">hasContent</span><span class="p">(</span><span class="s1">'top'</span><span class="p">))</span><span class="o">:</span> <span class="cp">?&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"panel-body"</span><span class="nt">&gt;</span>
                    <span class="cp">&lt;?php</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">'slots'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">output</span><span class="p">(</span><span class="s1">'top'</span><span class="p">);</span> <span class="cp">?&gt;</span>
                <span class="nt">&lt;/div&gt;</span>
                <span class="cp">&lt;?php</span> <span class="k">endif</span><span class="p">;</span> <span class="cp">?&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="cp">&lt;?php</span> <span class="k">endif</span><span class="p">;</span> <span class="cp">?&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="cp">&lt;?php</span> <span class="k">endif</span><span class="p">;</span> <span class="cp">?&gt;</span>

    <span class="cp">&lt;?php</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$view</span><span class="p">[</span><span class="s1">'slots'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">hasContent</span><span class="p">(</span><span class="s1">'main'</span><span class="p">))</span><span class="o">:</span> <span class="cp">?&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
       <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-sm-12"</span><span class="nt">&gt;</span>
           <span class="cp">&lt;?php</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">'slots'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">output</span><span class="p">(</span><span class="s1">'main'</span><span class="p">);</span> <span class="cp">?&gt;</span>
       <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="cp">&lt;?php</span> <span class="k">endif</span><span class="p">;</span> <span class="cp">?&gt;</span>

    <span class="cp">&lt;?php</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$view</span><span class="p">[</span><span class="s1">'slots'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">hasContent</span><span class="p">(</span><span class="s1">'footer'</span><span class="p">))</span><span class="o">:</span> <span class="cp">?&gt;</span>
    <span class="nt">&lt;footer&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-lg-12"</span><span class="nt">&gt;</span>
                <span class="cp">&lt;?php</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">'slots'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">output</span><span class="p">(</span><span class="s1">'footer'</span><span class="p">);</span> <span class="cp">?&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/footer&gt;</span>
    <span class="cp">&lt;?php</span> <span class="k">endif</span><span class="p">;</span> <span class="cp">?&gt;</span>

<span class="nt">&lt;/div&gt;</span>
<span class="cp">&lt;?php</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">'slots'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">output</span><span class="p">(</span><span class="s1">'builder'</span><span class="p">);</span> <span class="cp">?&gt;</span>
</code></pre>

<p>page.html.php is exactly the same as email.html.php except that it&rsquo;ll be used for landing pages instead. Thus, it can be more robust with the HTML document.</p>

<p>The defined slots in the config file can contain properties to tell the builder how to treat the slot.  </p>

<pre class="inline">
    'slots'    => array(
        'page'  => array(
            'page_title' => array('type' => 'text', 'placeholder' => 'mautic.page.builder.addcontent'),
            'top_title'  => array('type' => 'text', 'placeholder' => 'mautic.page.builder.addcontent'),
            'top'        => array('type' => 'html', 'placeholder' => 'mautic.page.builder.addcontent'),
            'main'       => array('type' => 'html', 'placeholder' => 'mautic.page.builder.addcontent'),
            'footer'     => array('type' => 'html', 'placeholder' => 'mautic.page.builder.addcontent')
        ),
</pre>

<p>In the above example, the <code class="prettyprint">page_title</code> slot only allows text and has a builder placeholder (the text displayed to indicate that it is editable) should be translated using the <code class="prettyprint">mautic.page.builder.addcontent</code> key (this can be pre-translated text but it&rsquo;s best to use a translatable string for locale support). </p>

<p>The type option defines how the user can interact with that slot and can be set as text, html, image, or slideshow. </p>

          <h1 id="rest-api">REST API</h1>

<p>Mautic provides a REST API to manipulate leads and/or obtain information for various entities of Mautic. </p>

<aside class="notice">
Currently, the only _editable_ entity is leads and is the main purpose for the Mautic API. All other entities are read-only.
</aside>

<aside class="warning">
All Mautic API endpoints require an OAuth1a signtature or OAuth2 access token.
</aside>

<h2 id="error-handling">Error Handling</h2>

<p>If an OAuth error is encountered, it&rsquo;ll be a JSON encoded array similar to:</p>

<pre class="inline">
{
  "error": "invalid_grant",
  "error_description": "The access token provided has expired."
}
</pre>

<p>If a system error encountered, it&rsquo;ll be a JSON encoded array similar to:</p>

<pre class="inline">
{
    "error": {
        "message": "You do not have access to the requested area/action.",
        "code": 403
    }
}
</pre>

          <h2 id="authorization">Authorization</h2>

<p>Mautic uses OAuth for API authorization. It supports both <a href="http://tools.ietf.org/html/rfc5849">OAuth 1a</a> and <a href="https://tools.ietf.org/html/rfc6749">OAuth 2</a>; however, as of 1.1.2, the administrator of the Mautic instance must choose one or the other.  Of course OAuth 2 is only recommended for servers secured behind SSL.</p>

<p>The Mautic administrator should enable the API in the Configuration -&gt; API Settings and choose the desired mode for API authentication (OAuth 1a or OAuth 2). This will add the &ldquo;API Credentials&rdquo; to the admin menu. A client/consumer ID and secret should then be generated which will be used in the following processes. </p>

<p>All authorization requests should be made to the specific Mautic instances URL, i.e. <code class="prettyprint">https://your-mautic.com</code>.</p>

<aside class="notice">
The OAuth processes can be a pain. If possible, it&rsquo;s best to use an OAuth library for the language being used. If PHP, it is recommended that Mautic&rsquo;s <a href="#php-library">PHP library</a> be used.
</aside>

          <h3 id="oauth-1a">OAuth 1a</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">Mautic\Auth\ApiAuth</span>

<span class="c1">// ApiAuth::initiate will accept an array of OAuth settings
</span><span class="nv">$settings</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">'baseUrl'</span>      <span class="o">=&gt;</span> <span class="s1">'https://your-mautic.com'</span><span class="p">,</span>
    <span class="s1">'version'</span>      <span class="o">=&gt;</span> <span class="s1">'OAuth1a'</span>
    <span class="s1">'clientKey'</span>    <span class="o">=&gt;</span> <span class="s1">'5ad6fa7asfs8fa7sdfa6sfas5fas6asdf8'</span><span class="p">,</span>
    <span class="s1">'clientSecret'</span> <span class="o">=&gt;</span> <span class="s1">'adf8asf7sf54asf3as4f5sf6asfasf97dd'</span><span class="p">,</span> 
    <span class="s1">'callback'</span>     <span class="o">=&gt;</span> <span class="s1">'https://your-callback.com'</span>
<span class="p">);</span>

<span class="c1">// Initiate the auth object
</span><span class="nv">$auth</span> <span class="o">=</span> <span class="nx">ApiAuth</span><span class="o">::</span><span class="na">initiate</span><span class="p">(</span><span class="nv">$settings</span><span class="p">);</span>

<span class="c1">// Initiate process for obtaining an access token; this will redirect the user to the authorize endpoint and/or set the tokens when the user is redirected back after granting authorization
</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$auth</span><span class="o">-&gt;</span><span class="na">validateAccessToken</span><span class="p">())</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$auth</span><span class="o">-&gt;</span><span class="na">accessTokenUpdated</span><span class="p">())</span> <span class="p">{</span>
        <span class="nv">$accessTokenData</span> <span class="o">=</span> <span class="nv">$auth</span><span class="o">-&gt;</span><span class="na">getAccessTokenData</span><span class="p">();</span>

        <span class="c1">//store access token data however you want
</span>    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>The OAuth 1a method is recommended for servers that are not behind https.  Note that OAuth 1a access tokens do not expire. </p>

<p>OAuth 1a can be a complicated method due to the need to generate a signature for the request. If anything is off with the signature, the request will not be validated.</p>

<h4 id="authorization">Authorization</h4>

<h5 id="step-one---obtain-a-request-token">Step One - Obtain a Request Token</h5>

<p>The first step is to obtain a request token that will be used when directing the user to the authorization page. </p>

<p>Make a POST to the request token endpoint <code class="prettyprint">/oauth/v1/request_token</code>:</p>

<pre class="inline">
POST /oauth/v1/request_token
Authorization: 
        OAuth oauth_callback="https%3A%2F%2Fyour-callback-uri.com",
              oauth_consumer_key="CONSUMER_KEY",
              oauth_nonce="UNIQUE_STRING",
              oauth_signature="GENERATED_REQUEST_SIGNATURE",
              oauth_signature_method="HMAC-SHA1",
              oauth_timestamp="1318467427",
              oauth_version="1.0"
</pre>

<p>(note that the header has been wrapped for legibility)</p>

<p>Review <a href="#generating-the-authorization-header">Generating the Authorization Header</a> on the specifics of generating the OAuth header.</p>

<p>The response will be a query string:</p>

<pre class="inline">
oauth_token=REQUEST_TOKEN&oauth_token_secret=REQUEST_TOKEN_SECRET&oauth_expires_in=3600
</pre>

<p>Parse the string and use the parameters in the next step as indicated. </p>

<aside class="notice">
These must be preserved in some kind of persistent storage as they will be used when obtaining the access token.
</aside>

<p>Note that the refresh token is only good for the number of seconds specified in <code class="prettyprint">oauth_expires_in</code>. </p>

<h5 id="step-two---authorization">Step Two - Authorization</h5>

<p>Now redirect the user to the authorization endpoint <code class="prettyprint">oauth/v1/authorize</code> with the request token as part of the URL&rsquo;s query.</p>

<p>If the callback is something different than what is configured in Mautic, url encode it and include in the query as <code class="prettyprint">oauth_callback</code>.</p>

<pre class="inline">
/oauth/v1/authorize?oauth_token=REQUEST_TOKEN&oauth_callback=https%3A%2F%2Fyour-callback-uri.com
</pre>

<p>The user will login and Mautic will redirect back to the either the consumer&rsquo;s configured callback or to the <code class="prettyprint">oauth_callback</code> included in the query.</p>

<p>The callback will include <code class="prettyprint">oauth_token</code> and <code class="prettyprint">oauth_verifier</code> in the URL&rsquo;s query. </p>

<p>Compare the <code class="prettyprint">oauth_token</code> in the query with that obtained in step two to ensure they are the same and prevent cross-site request forgery.</p>

<p><code class="prettyprint">oauth_verifier</code> will need to be part of the header generated in step three.</p>

<h5 id="step-three---obtain-an-access-token">Step Three - Obtain an Access Token</h5>

<p><a href="#generating-the-authorization-header">Generate the Authorization header</a> and make a POST to the access token endpoint <code class="prettyprint">/oauth/v1/access_token</code>.</p>

<p>When generating the header, the <code class="prettyprint">oauth_token_secret</code> returned in step two should be used as the <code class="prettyprint">TOKEN_SECRET</code> in the composite key. </p>

<p><code class="prettyprint">oauth_verifier</code> from step two should be part of the Authorization header generated.</p>

<pre class="inline">
POST /oauth/v1/access_token
Authorization: 
        OAuth oauth_callback="https%3A%2F%2Fyour-callback-uri.com",
              oauth_consumer_key="CONSUMER_KEY",
              oauth_nonce="UNIQUE_STRING",
              oauth_signature="GENERATED_REQUEST_SIGNATURE",
              oauth_signature_method="HMAC-SHA1",
              oauth_timestamp="1318467427",
              oauth_verifier="OAUTH_VERIFIER_FROM_STEP_TWO"
              oauth_version="1.0"
</pre>

<p>(note that the header has been wrapped for legibility)</p>

<p>The response should include a query string with the access token:</p>

<pre class="inline">
oauth_token=ACCESS_TOKEN&oauth_token_secret=ACCESS_TOKEN_SECRET
</pre>

<aside class="notice">
Mautic&rsquo;s OAuth 1a access tokens do not expire but the user can deauthorize them. If the access token is invalid, a `401` response will be returned.
</aside>

<p>The <code class="prettyprint">oauth_token</code> can be included in the authorize header and the <code class="prettyprint">oauth_token_secret</code> should be used as the <code class="prettyprint">TOKEN_SECRET</code> in the composite key when signing API requests.</p>

<h4 id="generating-the-authorization-header">Generating the Authorization Header</h4>

<p>The OAuth header may include the following parameters:</p>

<table><thead>
<tr>
<th>Key</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>oauth_callback</td>
<td>Optional, URL encoded callback to redirect the user to after authorization. If the callback URL is set in Mautic, this must match.</td>
</tr>
<tr>
<td>oauth_consumer_key</td>
<td>The consumer key obtained from Mautic&rsquo;s API Credentials</td>
</tr>
<tr>
<td>oauth_nonce</td>
<td>Uniquely generated string that should be used only once</td>
</tr>
<tr>
<td>oauth_signature</td>
<td>Signature generated from all applicable data for the request</td>
</tr>
<tr>
<td>oauth_signature_method</td>
<td>Method for creating the signature. Currently, only <code class="prettyprint">HMAC-SHA1</code> is supported.</td>
</tr>
<tr>
<td>oauth_timestamp</td>
<td>Current unix timestamp</td>
</tr>
<tr>
<td>oauth_token</td>
<td>The access token</td>
</tr>
<tr>
<td>oauth_verifier</td>
<td>Returned after authorization and used when requesting an access token</td>
</tr>
<tr>
<td>oauth_version</td>
<td>Should always be <code class="prettyprint">1.0</code></td>
</tr>
</tbody></table>

<aside class="notice">
When making a GET or POST request with parameters, all parameters should be included in the header as well.  
</aside>

<h5 id="step-one---build-the-base-string">Step One - Build the Base String</h5>

<p>The base string is used to generate the oauth_signature. </p>

<p>The structure of the base string is as follows:</p>

<pre class="inline">
METHOD&URL_ENCODED_URI&NORMALIZED_PARAMETERS
</pre>

<p><code class="prettyprint">METHOD</code> should be the request method and should always be capitalized.</p>

<p><code class="prettyprint">URL_ENCODED_URI</code> should be the base URI the request is made to. It should not include any query parameters (query parameters should be part of <code class="prettyprint">NORMALIZED_PARAMETERS</code>).</p>

<p><code class="prettyprint">NORMALIZED_PARAMETERS</code> should be a url encoded, alphabetically sorted query string of the above oauth parameters (except <code class="prettyprint">oauth_signature</code>) plus the parameters of the request (query/post body). </p>

<p>Each key and each value of the parameters must be url encoded individually as well. </p>

<aside class="warning">
PHP should use <code>rawurlencode()</code> instead of <code>urlencode()</code>.
</aside>

<p>Then each url encoded key/value pair should be concatenated into a single string with an ampersand (&amp;) as the glue character.</p>

<p>For example, let&rsquo;s say a request includes a query of <code class="prettyprint">title=Mr&amp;firstname=Joe&amp;lastname=Smith</code>. The process would look something like the following (replacing <code class="prettyprint">urlencode()</code> with whatever function is appropriate for the language being used).  Of course realistically, natural sort and loop functions would be used.</p>

<pre class="inline">
urlencode(
    urlencode(firstname)=urlencode(Joe)
    &urlencode(lastname)=urlencode(smith)
    &urlencode(oauth_callback)=urlencode(https%3A%2F%2Fyour-callback-uri.com)
    &urlencode(oauth_consumer_key)=urlencode(kdjafs7fsdf86ads7a98a87df6ad9fsf98ad7f)
    &urlencode(oauth_nonce)=urlencode(ak877asdf6adf68asd9fas)
    &urlencode(oauth_signature_method)=urlencode(HMAC-SHA1)
    &urlencode(oauth_timestamp)=urlencode(1437604736)
    &urlencode(oauth_version)=urlencode(1.0)
    &urlencode(title)=urlencode(Mr)
)
</pre>

<aside class="notice">
Multidimensional arrays should use <code>foo=baz&foo=bar</code> rather than <code>foo[bar]=baz&foo[baz]=bar</code> when generating the normalized parameters string.
</aside>

<aside class="notice">
Notice that <code>oauth_callback</code>, if included, is DOUBLE url encoded.
</aside>

<p>Put all together, a base string might look like:</p>

<pre class="inline">
GET&http%3A%2F%2Fyour-mautic.com%2Fapi&firstname%3DJoe%26lastName%3DSmith%26oauth_callback%3Dhttps%253A%252F%252Fyour-callback-uri.com%26oauth_consumer_key%3Dkdjafs7fsdf86ads7a98a87df6ad9fsf98ad7f%26oauth_nonce%3Dak877asdf6adf68asd9fas%26oauth_signature_method%3DHMAC-SHA1%26oauth_timestamp%3D1437604736%26oauth_version%3D1.0%26title%3DMr
</pre>

<h5 id="step-two---build-the-composite-key">Step Two - Build the Composite Key</h5>

<p>The composite key is used to encrypt the base string. It is composed of the consumer secret and the token secret if available (post authorization) combined with an ampersand (&amp;).  </p>

<pre class="inline">
CLIENT_SECRET&TOKEN_SECRET
</pre>

<p>If the token secret is not available, i.e. during the request token process, then an ampersand (&amp;) should still be used.</p>

<p><pre class="inline">
 CLIENT_SECRET&amp;
 </pre></p>

<p><aside class="notice"><code>TOKEN_SECRET</code> Sources<br />
 For <code>/oauth/v1/request_token</code>, <code>TOKEN_SECRET</code> is empty.<br /><br />
 For <code>/oauth/v1/access_token</code>, <code>TOKEN_SECRET</code> will be the <code>oauth_token_secret</code> returned by the request to <code>/oauth/v1/request_token</code><br /><br />
 For all other API endpoints, <code>TOKEN_SECRET</code> will be the <code>oauth_token_secret</code> returned by the request to <code>/oauth/v1/access_token</code>
 </aside></p>

<h5 id="step-three---generate-the-signature">Step Three - Generate the Signature</h5>

<p>Now, using the base string and the composite key, the signature can be generated using the appropriate HMAC function available to the language used. The signature generated should then be base64 encoded prior to being used in the Authorization header.</p>

<p><pre class="inline">
 base64_encode(
    hmac_sha1(BASE_STRING, COMPOSITE_KEY)
 )
 </pre></p>

<p>The resulting string should then be used included in the header as <code class="prettyprint">oauth_signature</code>.</p>

<h4 id="signing-the-api-request">Signing the API Request</h4>

<p>To sign the API request, <a href="#generating-the-authorization-header">generate the Authorization header</a> using the obtained access token.</p>

<pre class="inline">
POST /api/leads/new
Authorization: 
        OAuth oauth_callback="https%3A%2F%2Fyour-callback-uri.com",
              oauth_consumer_key="CONSUMER_KEY",
              oauth_nonce="UNIQUE_STRING",
              oauth_signature="GENERATED_REQUEST_SIGNATURE",
              oauth_signature_method="HMAC-SHA1",
              oauth_timestamp="1318467427",
              oauth_token="ACCESS_TOKEN"
              oauth_version="1.0"
              
title=Mr&firstname=Joe&lastname=Smith
</pre>

<p>(note that the header has been wrapped for legibility)</p>

          <h3 id="oauth-2">OAuth 2</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">Mautic\Auth\ApiAuth</span>

<span class="c1">// ApiAuth::initiate will accept an array of OAuth settings
</span><span class="nv">$settings</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">'baseUrl'</span>      <span class="o">=&gt;</span> <span class="s1">'https://your-mautic.com'</span><span class="p">,</span>
    <span class="s1">'version'</span>      <span class="o">=&gt;</span> <span class="s1">'OAuth2'</span>
    <span class="s1">'clientKey'</span>    <span class="o">=&gt;</span> <span class="s1">'5ad6fa7asfs8fa7sdfa6sfas5fas6asdf8'</span><span class="p">,</span>
    <span class="s1">'clientSecret'</span> <span class="o">=&gt;</span> <span class="s1">'adf8asf7sf54asf3as4f5sf6asfasf97dd'</span><span class="p">,</span> 
    <span class="s1">'callback'</span>     <span class="o">=&gt;</span> <span class="s1">'https://your-callback.com'</span>
<span class="p">);</span>

<span class="c1">// Initiate the auth object
</span><span class="nv">$auth</span> <span class="o">=</span> <span class="nx">ApiAuth</span><span class="o">::</span><span class="na">initiate</span><span class="p">(</span><span class="nv">$settings</span><span class="p">);</span>

<span class="c1">// Initiate process for obtaining an access token; this will redirect the user to the authorize endpoint and/or set the tokens when the user is redirected back after granting authorization
</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$auth</span><span class="o">-&gt;</span><span class="na">validateAccessToken</span><span class="p">())</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$auth</span><span class="o">-&gt;</span><span class="na">accessTokenUpdated</span><span class="p">())</span> <span class="p">{</span>
        <span class="nv">$accessTokenData</span> <span class="o">=</span> <span class="nv">$auth</span><span class="o">-&gt;</span><span class="na">getAccessTokenData</span><span class="p">();</span>

        <span class="c1">//store access token data however you want
</span>    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<h4 id="authorization">Authorization</h4>

<h5 id="step-one---obtain-authorization-code">Step One - Obtain Authorization Code</h5>

<aside class="warning">
Mautic supports only the authorization_code and refresh_token grant types.
</aside>

<p>Redirect the user to the authorize endpoint <code class="prettyprint">oauth/v2/authorize</code>:</p>

<pre class="inline">
GET /oauth/v2/authorize?
    client_id=CLIENT_ID
    &grant_type=authorization_code
    &redirect_uri=https%3A%2F%2Fyour-redirect-uri.com%2Fcallback
    &response_type=code
    &state=UNIQUE_STATE_STRING
</pre>                

<p>(note that the query has been wrapped for legibility)</p>

<aside class="notice">
The state is optional but recommended to prevent CSRF attacks. It should be a uniquely generated string and stored locally in session, cookie, etc. to be compared with the returned value. 
</aside>

<aside class="notice">
Note that the redirect_uri should be URL encoded.
</aside>

<aside class="notice">
As of 1.1.2, Mautic does not leverage OAuth2 scopes.
</aside>

<p>The user will be prompted to login. Once they do, Mautic will redirect back to the URL specified in redirect_uri with a code appended to the query.</p>

<p>It may look something like:
<code class="prettyprint">https://your-redirect-uri.com?code=UNIQUE_CODE_STRING&amp;state=UNIQUE_STATE_STRING</code></p>

<p>The state returned should be compared against the original to ensure nothing has been tampered with. </p>

<h5 id="step-two---replace-with-an-access-token">Step Two - Replace with an Access Token</h5>

<p>Obtain the value of the code from Step One then immediately POST it back to the access token endpoint <code class="prettyprint">oauth/v2/token</code> with:</p>

<pre class="inline">
POST /oauth/v2/token

client_id=CLIENT_ID
    &client_secret=CLIENT_SECRET
    &grant_type=authorization_code
    &redirect_uri=https%3A%2F%2Fyour-redirect-uri.com%2Fcallback
    &code=UNIQUE_CODE_STRING
</pre>   

<p>(note that the post body has been wrapped for legibility)</p>

<p>The response returned should be a JSON encoded string:</p>

<pre class="inline">
    {
        access_token: "ACCESS_TOKEN",
        expires_in: 3600,
        token_type: "bearer",
        scope: "",
        refresh_token: "REFRESH_TOKEN"
    }
</pre>

<p>This data should be stored in a secure location and used to authenticate API requests.</p>

<h4 id="refresh-tokens">Refresh Tokens</h4>

<p>The response&rsquo;s <code class="prettyprint">expires_in</code> is the number of seconds the access token is good for and may differ based on what is configured in Mautic. The code handling the authorization process should generate an expiration timestamp based on that value. For example <code class="prettyprint">&lt;?php $expiration = time() + $response[&#39;expires_in&#39;]; ?&gt;</code>. If the access token has expired, the refresh_token should be used to obtain a new access token.</p>

<p>The refresh token is by default good for 14 days in which the user will need to reauthorize the application with Mautic. However, the refresh token&rsquo;s expiration time is configurable through Mautic&rsquo;s Configuration. </p>

<aside class="notice">
The application should monitor for a <code>400 Bad Response</code> response when requesting a new access token and redirect the user back through the authorization process.
</aside>

<p>To obtain a new access token, a POST should be made to the access token&rsquo;s endpoint <code class="prettyprint">oauth/v2/token</code> using the <code class="prettyprint">refresh_token</code> grant type.</p>

<pre class="inline">
POST /oauth/v2/token
    
client_id=CLIENT_ID
    &client_secret=CLIENT_SECRET
    &grant_type=refresh_token
    &refresh_token=REFRESH_TOKEN
    &redirect_uri=https%3A%2F%2Fyour-redirect-uri.com%2Fcallback
</pre>

<p>(note that the post body has been wrapped for legibility)</p>

<p>The response returned should be a JSON encoded string:</p>

<pre class="inline">
    {
        access_token: "NEW_ACCESS_TOKEN",
        expires_in: 3600,
        token_type: "bearer",
        scope: "",
        refresh_token: "REFRESH_TOKEN"
    }
</pre>

<h4 id="authenticating-the-api-request">Authenticating the API Request</h4>

<p>Authenticating the API request with OAuth2 is easy. Choose one of the following methods that is appropriate for the application&rsquo;s needs.</p>

<h5 id="authorization-header">Authorization Header</h5>

<p>By using an authorization header, any request method can be authenticated.</p>

<p>However, note that this method requires that the server Mautic is installed on passes headers to PHP or has access to the <code class="prettyprint">apache_request_headers()</code> function. <code class="prettyprint">apache_request_headers()</code> is not available to PHP running under fcgi. </p>

<pre class="inline">
Authorization: Bearer ACCESS_TOKEN
</pre>

<h5 id="method-specific">Method Specific</h5>

<p>The access token can also be appended to the query or included in the body of a POST.</p>

<pre class="inline">
GET https://your-mautic.com/api/leads?access_token=ACCESS_TOKEN
</pre>

<pre class="inline">
POST https://your-mautic.com/api/leads/new

firstname=John&lastname=Smith&access_token=ACCESS_TOKEN
</pre>

          <h2 id="libraries">Libraries</h2>

<h3 id="php-library">PHP Library</h3>

<p>Mautic provides a <a href="https://packagist.org/packages/mautic/api-library">PHP library on Github</a>. It is recommended that it be used in PHP projects. Other languages will need to use custom means and/or a 3rd party library to handle the OAuth/request processes.</p>

<h4 id="install-via-composer">Install via Composer</h4>

<p>To install using composer, simply run <code class="prettyprint">composer require mautic/api-library</code>.</p>

<h4 id="install-manually">Install Manually</h4>

<p><a href="https://github.com/mautic/api-library/archive/master.zip">Download the package from Github</a>. Extract then include the following code in your project (of course change the file path if needed):</p>

<pre class="inline">
require_once __DIR__ . '/lib/Mautic/MauticApi.php';
</pre>

<aside class="notice">
Refer to the README in the Github repository for further instructions on how to use the library or review the code examples included throughout this section.
</aside>

          <h2 id="endpoints">Endpoints</h2>

<aside class="notice">
All responses are JSON encoded.
</aside>

<aside class="notice">
Base API Endpoint: <br />
<code>https://your-mautic.com/api</code>
</aside>

          <h2 id="leads">Leads</h2>

<p>Use this endpoint to manipulate and obtain details on Mautic&rsquo;s leads.</p>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">Mautic\MauticApi</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Mautic\Auth\ApiAuth</span><span class="p">;</span>

<span class="c1">// ...
</span><span class="nv">$auth</span>     <span class="o">=</span> <span class="nx">ApiAuth</span><span class="o">::</span><span class="na">initiate</span><span class="p">(</span><span class="nv">$settings</span><span class="p">);</span>
<span class="nv">$apiUrl</span>   <span class="o">=</span> <span class="s2">"https://your-mautic.com"</span><span class="p">;</span> 
<span class="nv">$leadApi</span>  <span class="o">=</span> <span class="nx">MauticApi</span><span class="o">::</span><span class="na">getContext</span><span class="p">(</span><span class="s2">"leads"</span><span class="p">,</span> <span class="nv">$auth</span><span class="p">,</span> <span class="nv">$apiUrl</span><span class="p">);</span>
</code></pre>

<h3 id="get-lead">Get Lead</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>

<span class="c1">//...
</span><span class="nv">$lead</span> <span class="o">=</span> <span class="nv">$leadApi</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
</code></pre>
<pre><code class="highlight json"><span class="w">    </span><span class="s2">"lead"</span><span class="err">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">47</span><span class="p">,</span><span class="w">
        </span><span class="s2">"dateAdded"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-07-21T12:27:12-05:00"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"createdBy"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
        </span><span class="s2">"createdByUser"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Joe Smith"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"dateModified"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-07-21T14:12:03-05:00"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"modifiedBy"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
        </span><span class="s2">"modifiedByUser"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Joe Smith"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"owner"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
            </span><span class="s2">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"joesmith"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"firstName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Joe"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"lastName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Smith"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"points"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
        </span><span class="s2">"lastActive"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-07-21T14:19:37-05:00"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"dateIdentified"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-07-21T12:27:12-05:00"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"color"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ab5959"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"ipAddresses"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"111.111.111.111"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="s2">"ipAddress"</span><span class="p">:</span><span class="w"> </span><span class="s2">"111.111.111.111"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"ipDetails"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"city"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"region"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"country"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"latitude"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"longitude"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"isp"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"organization"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"timezone"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"fields"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"core"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Title"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"title"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"lookup"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"group"</span><span class="p">:</span><span class="w"> </span><span class="s2">"core"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Mr"</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="s2">"firstname"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"First Name"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"firstname"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"text"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"group"</span><span class="p">:</span><span class="w"> </span><span class="s2">"core"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Jim"</span><span class="w">
                </span><span class="p">},</span><span class="w">

                </span><span class="s2">"..."</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"..."</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"..."</span><span class="w">
                </span><span class="p">}</span><span class="w">

            </span><span class="p">},</span><span class="w">
            </span><span class="s2">"social"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="s2">"twitter"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"17"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Twitter"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"twitter"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"text"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"group"</span><span class="p">:</span><span class="w"> </span><span class="s2">"social"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"jimlead"</span><span class="w">
                </span><span class="p">},</span><span class="w">

                </span><span class="s2">"..."</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"..."</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"..."</span><span class="w">
                </span><span class="p">}</span><span class="w">

            </span><span class="p">},</span><span class="w">
            </span><span class="s2">"personal"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
            </span><span class="s2">"professional"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
            </span><span class="s2">"all"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Mr"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"firstname"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Jim"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"twitter"</span><span class="p">:</span><span class="w"> </span><span class="s2">"jimlead"</span><span class="p">,</span><span class="w">

                </span><span class="s2">"..."</span><span class="p">:</span><span class="w"> </span><span class="s2">"..."</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Get an individual lead by ID.</p>

<h4 id="http-request">HTTP Request</h4>

<p><code class="prettyprint">GET /leads/ID</code></p>

<h4 id="response">Response</h4>

<p><code class="prettyprint">Expected Response Code: 200</code></p>

<p>See JSON code example.</p>

<p><strong>Lead Properties</strong></p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>int</td>
<td>ID of the lead</td>
</tr>
<tr>
<td>dateAdded</td>
<td>datetime</td>
<td>Date/time lead was created</td>
</tr>
<tr>
<td>createdBy</td>
<td>int</td>
<td>ID of the user that created the lead</td>
</tr>
<tr>
<td>createdByUser</td>
<td>string</td>
<td>Name of the user that created the lead</td>
</tr>
<tr>
<td>dateModified</td>
<td>datetime/null</td>
<td>Date/time lead was last modified</td>
</tr>
<tr>
<td>modifiedBy</td>
<td>int</td>
<td>ID of the user that last modified the lead</td>
</tr>
<tr>
<td>modifiedByUser</td>
<td>string</td>
<td>Name of the user that last modified the lead</td>
</tr>
<tr>
<td>owner</td>
<td>object</td>
<td>User object that owns the lead.</td>
</tr>
<tr>
<td>points</td>
<td>int</td>
<td>Lead&rsquo;s current number of points</td>
</tr>
<tr>
<td>lastActive</td>
<td>datetime/null</td>
<td>Date/time for when the lead was last recorded as active</td>
</tr>
<tr>
<td>dateIdentified</td>
<td>datetime/null</td>
<td>Date/time when the lead identified themselves</td>
</tr>
<tr>
<td>color</td>
<td>string</td>
<td>Hex value given to lead from Point Trigger definitions based on the number of points the lead has been awarded</td>
</tr>
<tr>
<td>ipAddresses</td>
<td>array</td>
<td>Array of IPs currently associated with this lead</td>
</tr>
<tr>
<td>fields</td>
<td>array</td>
<td>Array of all lead fields with data grouped by field group. See JSON code example for format. This array includes an &ldquo;all&rdquo; key that includes an single level array of fieldAlias =&gt; leadValue pairs.</td>
</tr>
</tbody></table>

<h3 id="list-leads">List Leads</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>

<span class="c1">//...
</span><span class="nv">$leads</span> <span class="o">=</span> <span class="nv">$leadApi</span><span class="o">-&gt;</span><span class="na">getList</span><span class="p">(</span><span class="nv">$searchFilter</span><span class="p">,</span> <span class="nv">$start</span><span class="p">,</span> <span class="nv">$limit</span><span class="p">,</span> <span class="nv">$orderBy</span><span class="p">,</span> <span class="nv">$orderByDir</span><span class="p">);</span>
</code></pre>
<pre><code class="highlight json"><span class="p">{</span><span class="w">
    </span><span class="s2">"total"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"leads"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">47</span><span class="p">,</span><span class="w">
            </span><span class="s2">"isPublished"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
            </span><span class="s2">"dateAdded"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-07-21T12:27:12-05:00"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"createdBy"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
            </span><span class="s2">"createdByUser"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Joe Smith"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"dateModified"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-07-21T14:12:03-05:00"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"modifiedBy"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
            </span><span class="s2">"modifiedByUser"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Joe Smith"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"owner"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
                </span><span class="s2">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"joesmith"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"firstName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Joe"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"lastName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Smith"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="s2">"points"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
            </span><span class="s2">"lastActive"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-07-21T14:19:37-05:00"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"dateIdentified"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-07-21T12:27:12-05:00"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"color"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ab5959"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"ipAddresses"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="s2">"111.111.111.111"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"ipAddress"</span><span class="p">:</span><span class="w"> </span><span class="s2">"111.111.111.111"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"ipDetails"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                        </span><span class="s2">"city"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"region"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"country"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"latitude"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"longitude"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"isp"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"organization"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"timezone"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="w">
                    </span><span class="p">}</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="s2">"fields"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="s2">"core"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                        </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Title"</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"title"</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"lookup"</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"group"</span><span class="p">:</span><span class="w"> </span><span class="s2">"core"</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Mr"</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="s2">"firstname"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                        </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2"</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"First Name"</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"firstname"</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"text"</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"group"</span><span class="p">:</span><span class="w"> </span><span class="s2">"core"</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Jim"</span><span class="w">
                    </span><span class="p">},</span><span class="w">

                    </span><span class="s2">"..."</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                        </span><span class="s2">"..."</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"..."</span><span class="w">
                    </span><span class="p">}</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="s2">"social"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"twitter"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                        </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"17"</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Twitter"</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"twitter"</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"text"</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"group"</span><span class="p">:</span><span class="w"> </span><span class="s2">"social"</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"jimlead"</span><span class="w">
                    </span><span class="p">},</span><span class="w">

                    </span><span class="s2">"..."</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                        </span><span class="s2">"..."</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"..."</span><span class="w">
                    </span><span class="p">}</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="s2">"personal"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
                </span><span class="s2">"professional"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
                </span><span class="s2">"all"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Mr"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"firstname"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Jim"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"twitter"</span><span class="p">:</span><span class="w"> </span><span class="s2">"jimlead"</span><span class="p">,</span><span class="w">

                    </span><span class="s2">"..."</span><span class="p">:</span><span class="w"> </span><span class="s2">"..."</span><span class="w">    
                </span><span class="p">}</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Get a list of leads.</p>

<h4 id="http-request">HTTP Request</h4>

<p><code class="prettyprint">GET /leads</code></p>

<p><strong>Query Parameters</strong></p>

<table><thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>search</td>
<td>String or search command to filter entities by.</td>
</tr>
<tr>
<td>start</td>
<td>Starting row for the entities returned. Defaults to 0.</td>
</tr>
<tr>
<td>limit</td>
<td>Limit number of entities to return. Defaults to the system configuration for pagination (30).</td>
</tr>
<tr>
<td>orderBy</td>
<td>Column to sort by. Can use any column listed in the response.</td>
</tr>
<tr>
<td>orderByDir</td>
<td>Sort direction: asc or desc.</td>
</tr>
<tr>
<td>publishedOnly</td>
<td>Only return currently published entities.</td>
</tr>
</tbody></table>

<h4 id="response">Response</h4>

<p><code class="prettyprint">Expected Response Code: 200</code></p>

<p>See JSON code example.</p>

<p><strong>Properties</strong></p>

<p>Same as <a href="#get-lead">Get Lead</a>.</p>

<h3 id="create-lead">Create Lead</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span> 

<span class="nv">$data</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">'firstname'</span> <span class="o">=&gt;</span> <span class="s1">'Jim'</span><span class="p">,</span>
    <span class="s1">'lastname'</span>  <span class="o">=&gt;</span> <span class="s1">'Lead'</span><span class="p">,</span>
    <span class="s1">'email'</span>     <span class="o">=&gt;</span> <span class="s1">'jim@his-site.com'</span><span class="p">,</span>
    <span class="s1">'ipAddress'</span> <span class="o">=&gt;</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'REMOTE_ADDR'</span><span class="p">]</span>
<span class="p">);</span>

<span class="nv">$lead</span> <span class="o">=</span> <span class="nv">$leadApi</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
</code></pre>

<p>Create a new lead.</p>

<h4 id="http-request">HTTP Request</h4>

<p><code class="prettyprint">POST /leads/new</code></p>

<p><strong>Post Parameters</strong></p>

<table><thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>*</td>
<td>Any lead field alias can be posted as a parameter.  For example, firstname, lastname, email, etc.</td>
</tr>
<tr>
<td>ipAddress</td>
<td>IP address to associate with the lead</td>
</tr>
<tr>
<td>lastActive</td>
<td>Date/time in UTC; preferablly in the format of Y-m-d H:m:i but if that format fails, the string will be sent through PHP&rsquo;s strtotime then formatted</td>
</tr>
<tr>
<td>owner</td>
<td>ID of a Mautic user to assign this lead to</td>
</tr>
</tbody></table>

<h4 id="response">Response</h4>

<p><code class="prettyprint">Expected Response Code: 201</code></p>

<p><strong>Properties</strong></p>

<p>Same as <a href="#get-lead">Get Lead</a>.</p>

<h3 id="edit-lead">Edit Lead</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>

<span class="nv">$id</span>   <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="nv">$data</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">'email'</span>     <span class="o">=&gt;</span> <span class="s1">'jim-new-address@his-site.com'</span><span class="p">,</span>
    <span class="s1">'ipAddress'</span> <span class="o">=&gt;</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'REMOTE_ADDR'</span><span class="p">]</span>
<span class="p">);</span>

<span class="c1">// Create new a lead of ID 1 is not found?
</span><span class="nv">$createIfNotFound</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

<span class="nv">$lead</span> <span class="o">=</span> <span class="nv">$leadApi</span><span class="o">-&gt;</span><span class="na">edit</span><span class="p">(</span><span class="nv">$id</span><span class="p">,</span> <span class="nv">$data</span><span class="p">,</span> <span class="nv">$createIfNotFound</span><span class="p">);</span>
</code></pre>

<p>Edit a new lead.  Note that this supports PUT or PATCH depending on the desired behavior for when a lead cannot be found based on the ID given.</p>

<h4 id="http-request">HTTP Request</h4>

<p>To edit a lead and return a 404 if the lead is not found:</p>

<p><code class="prettyprint">PATCH /leads/ID/edit</code></p>

<p>To edit a lead and create a new one if the lead is not found:</p>

<p><code class="prettyprint">PUT /leads/ID/edit</code></p>

<p><strong>Post Parameters</strong></p>

<table><thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>*</td>
<td>Any lead field alias can be posted as a parameter.  For example, firstname, lastname, email, etc.</td>
</tr>
<tr>
<td>ipAddress</td>
<td>IP address to associate with the lead</td>
</tr>
<tr>
<td>lastActive</td>
<td>Date/time in UTC; preferablly in the format of Y-m-d H:m:i but if that format fails, the string will be sent through PHP&rsquo;s strtotime then formatted</td>
</tr>
<tr>
<td>owner</td>
<td>ID of a Mautic user to assign this lead to</td>
</tr>
</tbody></table>

<h4 id="response">Response</h4>

<p>If <code class="prettyprint">PUT</code>, the expected response code is <code class="prettyprint">200</code> if the lead was edited or <code class="prettyprint">201</code> if created.</p>

<p>If <code class="prettyprint">PATCH</code>, the expected response code is <code class="prettyprint">200</code>.</p>

<p><strong>Properties</strong></p>

<p>Same as <a href="#get-lead">Get Lead</a>.</p>

<h3 id="delete-lead">Delete Lead</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>

<span class="nv">$lead</span> <span class="o">=</span> <span class="nv">$leadApi</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
</code></pre>

<p>Delete a lead.</p>

<h4 id="http-request">HTTP Request</h4>

<p><code class="prettyprint">DELETE /leads/ID</code></p>

<h4 id="response">Response</h4>

<p><code class="prettyprint">Expected Response Code: 200</code></p>

<p><strong>Properties</strong></p>

<p>Same as <a href="#get-lead">Get Lead</a>.</p>

<h3 id="list-available-owners">List Available Owners</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>

<span class="nv">$owners</span> <span class="o">=</span> <span class="nv">$leadApi</span><span class="o">-&gt;</span><span class="na">getOwners</span><span class="p">();</span>
</code></pre>
<pre><code class="highlight json"><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="s2">"firstName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Joe"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"lastName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Smith"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
    </span><span class="s2">"firstName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Jane"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"lastName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Smith"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>

<p>Get a list of owners that can be used to assign leads to when creating/editing.</p>

<h4 id="http-request">HTTP Request</h4>

<p><code class="prettyprint">GET /leads/list/owners</code></p>

<h4 id="response">Response</h4>

<p><code class="prettyprint">Expected Response Code: 200</code></p>

<p><strong>Owner Properties</strong></p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>int</td>
<td>ID of the Mautic user</td>
</tr>
<tr>
<td>firstName</td>
<td>string</td>
<td>First name of the Mautic user</td>
</tr>
<tr>
<td>lastName</td>
<td>string</td>
<td>Last name of the Mautic user</td>
</tr>
</tbody></table>

<h3 id="list-available-fields">List Available Fields</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>

<span class="nv">$fields</span> <span class="o">=</span> <span class="nv">$leadApi</span><span class="o">-&gt;</span><span class="na">getFieldList</span><span class="p">();</span>
</code></pre>
<pre><code class="highlight json"><span class="p">{</span><span class="w">
    </span><span class="s2">"1"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
        </span><span class="s2">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Title"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"title"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"lookup"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"group"</span><span class="p">:</span><span class="w"> </span><span class="s2">"core"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"order"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"2"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
        </span><span class="s2">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"First Name"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"firstname"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"text"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"group"</span><span class="p">:</span><span class="w"> </span><span class="s2">"core"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"order"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"3"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
        </span><span class="s2">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Last Name"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"lastname"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"text"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"group"</span><span class="p">:</span><span class="w"> </span><span class="s2">"core"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"order"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="w">
    </span><span class="p">},</span><span class="w">

    </span><span class="s2">"..."</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"..."</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"..."</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Get a list of available lead fields including custom ones.</p>

<h4 id="http-request">HTTP Request</h4>

<p><code class="prettyprint">GET /leads/list/fields</code></p>

<h4 id="response">Response</h4>

<p><code class="prettyprint">Expected Response Code: 200</code></p>

<p><strong>Field Properties</strong></p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>int</td>
<td>ID of the field</td>
</tr>
<tr>
<td>label</td>
<td>string</td>
<td>Field label</td>
</tr>
<tr>
<td>alias</td>
<td>string</td>
<td>Field alias used as the column name in the database</td>
</tr>
<tr>
<td>type</td>
<td>string</td>
<td>Type of field.  I.e. text, lookup, etc</td>
</tr>
<tr>
<td>group</td>
<td>string</td>
<td>Group the field belongs to</td>
</tr>
<tr>
<td>order</td>
<td>int</td>
<td>Field order</td>
</tr>
</tbody></table>

<h3 id="list-lead-notes">List Lead Notes</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>

<span class="nv">$notes</span> <span class="o">=</span> <span class="nv">$leadApi</span><span class="o">-&gt;</span><span class="na">getLeadNotes</span><span class="p">(</span><span class="nv">$id</span><span class="p">,</span> <span class="nv">$searchFilter</span><span class="p">,</span> <span class="nv">$start</span><span class="p">,</span> <span class="nv">$limit</span><span class="p">,</span> <span class="nv">$orderBy</span><span class="p">,</span> <span class="nv">$orderByDir</span><span class="p">);</span>
<span class="sb">``</span><span class="err">`</span><span class="nx">json</span>
<span class="p">{</span>
    <span class="s2">"total"</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">"notes"</span><span class="o">:</span> <span class="p">[</span>
        <span class="p">{</span>
              <span class="s2">"id"</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
              <span class="s2">"text"</span><span class="o">:</span> <span class="s2">"&lt;p&gt;Jim is super cool!&lt;/p&gt;"</span><span class="p">,</span>
              <span class="s2">"type"</span><span class="o">:</span> <span class="s2">"general"</span><span class="p">,</span>
              <span class="s2">"dateTime"</span><span class="o">:</span> <span class="s2">"2015-07-23T13:14:00-05:00"</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</code></pre>

<p>Get a list of notes for a specific lead.</p>

<h4 id="http-request">HTTP Request</h4>

<p><code class="prettyprint">GET /leads/ID/notes</code></p>

<p><strong>Query Parameters</strong></p>

<table><thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>search</td>
<td>String or search command to filter entities by.</td>
</tr>
<tr>
<td>start</td>
<td>Starting row for the entities returned. Defaults to 0.</td>
</tr>
<tr>
<td>limit</td>
<td>Limit number of entities to return. Defaults to the system configuration for pagination (30).</td>
</tr>
<tr>
<td>orderBy</td>
<td>Column to sort by. Can use any column listed in the response.</td>
</tr>
<tr>
<td>orderByDir</td>
<td>Sort direction: asc or desc.</td>
</tr>
</tbody></table>

<h4 id="response">Response</h4>

<p><code class="prettyprint">Expected response code: 200</code></p>

<p><strong>Note Properties</strong></p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>int</td>
<td>ID of the note</td>
</tr>
<tr>
<td>text</td>
<td>string</td>
<td>Body of the note</td>
</tr>
<tr>
<td>type</td>
<td>string</td>
<td>Type of note. Options are &ldquo;general&rdquo;, &ldquo;email&rdquo;, &ldquo;call&rdquo;, &ldquo;meeting&rdquo;</td>
</tr>
<tr>
<td>dateTime</td>
<td>datetime</td>
<td>Date/time string of when the note was created.</td>
</tr>
</tbody></table>

<h3 id="get-list-memberships">Get List Memberships</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>

<span class="nv">$lists</span> <span class="o">=</span> <span class="nv">$leadApi</span><span class="o">-&gt;</span><span class="na">getLeadLists</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
<span class="sb">``</span><span class="err">`</span><span class="nx">json</span>
<span class="p">{</span>
    <span class="s2">"total"</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">"lists"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">"3"</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">"id"</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span>
            <span class="s2">"name"</span><span class="o">:</span> <span class="s2">"New Leads"</span><span class="p">,</span>
            <span class="s2">"alias"</span><span class="o">:</span> <span class="s2">"newleads"</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>Get a list of lead lists the lead is a member of.</p>

<h4 id="http-request">HTTP Request</h4>

<p><code class="prettyprint">GET /leads/ID/lists</code></p>

<h4 id="response">Response</h4>

<p><code class="prettyprint">Expected response code: 200</code></p>

<p><strong>List Properties</strong></p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>int</td>
<td>ID of the list</td>
</tr>
<tr>
<td>name</td>
<td>string</td>
<td>Name of the list</td>
</tr>
<tr>
<td>alias</td>
<td>string</td>
<td>Alias of the list used with search commands.</td>
</tr>
<tr>
<td>dateAdded</td>
<td>datetime</td>
<td>Date/time string for when the lead was added to the list</td>
</tr>
<tr>
<td>manuallyAdded</td>
<td>bool</td>
<td>True if the lead was manually added to the list versus being added by a filter</td>
</tr>
<tr>
<td>manuallyRemoved</td>
<td>bool</td>
<td>True if the lead was manually removed from the list even though the list&rsquo;s filter is a match</td>
</tr>
</tbody></table>

<h3 id="change-list-memberships">Change List Memberships</h3>

<p>See <a href="#lists">Lists</a>.</p>

<h3 id="get-campaign-memberships">Get Campaign Memberships</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>

<span class="nv">$lists</span> <span class="o">=</span> <span class="nv">$leadApi</span><span class="o">-&gt;</span><span class="na">getLeadCampaigns</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
<span class="sb">``</span><span class="err">`</span><span class="nx">json</span>
<span class="p">{</span>
    <span class="s2">"total"</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">"campaigns"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">"1"</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">"id"</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">"name"</span><span class="o">:</span> <span class="s2">"Welcome Campaign"</span><span class="p">,</span>
            <span class="s2">"dateAdded"</span><span class="o">:</span> <span class="s2">"2015-07-21T14:11:47-05:00"</span><span class="p">,</span>
            <span class="s2">"manuallyRemoved"</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
            <span class="s2">"manuallyAdded"</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
            <span class="s2">"list_membership"</span><span class="o">:</span> <span class="p">[</span>
                <span class="mi">3</span>
            <span class="p">]</span>            
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>Get a list of campaigns the lead is a member of.</p>

<h4 id="http-request">HTTP Request</h4>

<p><code class="prettyprint">GET /leads/ID/campaigns</code></p>

<h4 id="response">Response</h4>

<p><code class="prettyprint">Expected response code: 200</code></p>

<p><strong>List Properties</strong></p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>int</td>
<td>ID of the campaign</td>
</tr>
<tr>
<td>name</td>
<td>string</td>
<td>Name of the campaign</td>
</tr>
<tr>
<td>dateAdded</td>
<td>datetime</td>
<td>Date/time string for when the lead was added to the campaign</td>
</tr>
<tr>
<td>manuallyAdded</td>
<td>bool</td>
<td>True if the lead was manually added to the campaign versus being added by a lead list</td>
</tr>
<tr>
<td>manuallyRemoved</td>
<td>bool</td>
<td>True if the lead was manually removed from the campaign when the lead&rsquo;s list is assigned to the campaign</td>
</tr>
<tr>
<td>listMembership</td>
<td>array</td>
<td>Array of lead list IDs this lead belongs to that is also associated with this campaign</td>
</tr>
</tbody></table>

<h3 id="change-campaign-memberships">Change Campaign Memberships</h3>

<p>See <a href="#campaigns">Campaigns</a>.</p>

          <h2 id="assets">Assets</h2>

<p>Use this endpoint to obtain details on Mautic&rsquo;s assets. </p>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">Mautic\MauticApi</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Mautic\Auth\ApiAuth</span><span class="p">;</span>

<span class="c1">// ...
</span><span class="nv">$auth</span>     <span class="o">=</span> <span class="nx">ApiAuth</span><span class="o">::</span><span class="na">initiate</span><span class="p">(</span><span class="nv">$settings</span><span class="p">);</span>
<span class="nv">$apiUrl</span>   <span class="o">=</span> <span class="s2">"https://your-mautic.com"</span><span class="p">;</span> 
<span class="nv">$assetApi</span> <span class="o">=</span> <span class="nx">MauticApi</span><span class="o">::</span><span class="na">getContext</span><span class="p">(</span><span class="s2">"assets"</span><span class="p">,</span> <span class="nv">$auth</span><span class="p">,</span> <span class="nv">$apiUrl</span><span class="p">);</span>
</code></pre>

<h3 id="get-asset">Get Asset</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>

<span class="c1">//...
</span><span class="nv">$asset</span> <span class="o">=</span> <span class="nv">$assetApi</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
</code></pre>
<pre><code class="highlight json"><span class="p">{</span><span class="w">
    </span><span class="s2">"asset"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
        </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Product Whitepaper"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Some description"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"whitepaper"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"language"</span><span class="p">:</span><span class="w"> </span><span class="s2">"en"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"isPublished"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="s2">"publishUp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-06-07T06:28:27+00:00"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"publishDown"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-06-30T06:28:27+00:00"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"dateAdded"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-06-07T06:28:27+00:00"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"createdBy"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
        </span><span class="s2">"createdByUser"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Joe Smith"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"dateModified"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-06-010T09:30:47+00:00"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"modifiedBy"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
        </span><span class="s2">"modifiedByUser"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Joe Smith"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"downloadCount"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
        </span><span class="s2">"uniqueDownloadCount"</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w">
        </span><span class="s2">"revision"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
        </span><span class="s2">"category"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Whitepapers"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"extension"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pdf"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"mime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"application/pdf"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"size"</span><span class="p">:</span><span class="w"> </span><span class="mi">269128</span><span class="p">,</span><span class="w">
        </span><span class="s2">"downloadUrl"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://your-mautic.com/asset/1:whitepaper"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Get an individual asset by ID.</p>

<h4 id="http-request">HTTP Request</h4>

<p><code class="prettyprint">GET /assets/ID</code></p>

<h4 id="response">Response</h4>

<p><code class="prettyprint">Expected Response Code: 200</code></p>

<p>See JSON code example.</p>

<p><strong>Asset Properties</strong></p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>int</td>
<td>ID of the asset</td>
</tr>
<tr>
<td>title</td>
<td>string</td>
<td>Title/name of the asset</td>
</tr>
<tr>
<td>description</td>
<td>string/null</td>
<td>Description of the asset</td>
</tr>
<tr>
<td>alias</td>
<td>string</td>
<td>Used to generate the URL for the asset</td>
</tr>
<tr>
<td>language</td>
<td>string</td>
<td>Locale of the asset</td>
</tr>
<tr>
<td>isPublished</td>
<td>bool</td>
<td>Published state</td>
</tr>
<tr>
<td>publishUp</td>
<td>datetime/null</td>
<td>Date/time when the asset should be published</td>
</tr>
<tr>
<td>publishDown</td>
<td>datetime/null</td>
<td>Date/time the asset should be un published</td>
</tr>
<tr>
<td>dateAdded</td>
<td>datetime</td>
<td>Date/time asset was created</td>
</tr>
<tr>
<td>createdBy</td>
<td>int</td>
<td>ID of the user that created the asset</td>
</tr>
<tr>
<td>createdByUser</td>
<td>string</td>
<td>Name of the user that created the asset</td>
</tr>
<tr>
<td>dateModified</td>
<td>datetime/null</td>
<td>Date/time asset was last modified</td>
</tr>
<tr>
<td>modifiedBy</td>
<td>int</td>
<td>ID of the user that last modified the asset</td>
</tr>
<tr>
<td>modifiedByUser</td>
<td>string</td>
<td>Name of the user that last modified the asset</td>
</tr>
<tr>
<td>downloadCount</td>
<td>int</td>
<td>Total number of downloads</td>
</tr>
<tr>
<td>uniqueDownloadCount</td>
<td>int</td>
<td>Unique number of downloads</td>
</tr>
<tr>
<td>revision</td>
<td>int</td>
<td>Revision version</td>
</tr>
<tr>
<td>category</td>
<td>string/null</td>
<td>Name of the category</td>
</tr>
<tr>
<td>extension</td>
<td>string</td>
<td>Extension of the asset</td>
</tr>
<tr>
<td>mime</td>
<td>string</td>
<td>Mime type of the asset</td>
</tr>
<tr>
<td>size</td>
<td>int</td>
<td>Filesize of the asset in bytes</td>
</tr>
<tr>
<td>downloadUrl</td>
<td>string</td>
<td>Public download URL for the asset</td>
</tr>
</tbody></table>

<h3 id="list-assets">List Assets</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="c1">// ...
</span>
<span class="nv">$assets</span> <span class="o">=</span> <span class="nv">$assetApi</span><span class="o">-&gt;</span><span class="na">getList</span><span class="p">(</span><span class="nv">$searchFilter</span><span class="p">,</span> <span class="nv">$start</span><span class="p">,</span> <span class="nv">$limit</span><span class="p">,</span> <span class="nv">$orderBy</span><span class="p">,</span> <span class="nv">$orderByDir</span><span class="p">);</span>
</code></pre>
<pre><code class="highlight json"><span class="p">{</span><span class="w">
    </span><span class="s2">"total"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="s2">"assets"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
            </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Product Whitepaper"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Some description"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"whitepaper"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"language"</span><span class="p">:</span><span class="w"> </span><span class="s2">"en"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"isPublished"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
            </span><span class="s2">"publishUp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-06-07T06:28:27+00:00"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"publishDown"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-06-30T06:28:27+00:00"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"dateAdded"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-06-07T06:28:27+00:00"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"createdBy"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
            </span><span class="s2">"createdByUser"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Joe Smith"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"dateModified"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-06-010T09:30:47+00:00"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"modifiedBy"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
            </span><span class="s2">"modifiedByUser"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Joe Smith"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"downloadCount"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
            </span><span class="s2">"uniqueDownloadCount"</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w">
            </span><span class="s2">"revision"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
            </span><span class="s2">"category"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Whitepapers"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"extension"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pdf"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"mime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"application/pdf"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"size"</span><span class="p">:</span><span class="w"> </span><span class="mi">269128</span><span class="p">,</span><span class="w">
            </span><span class="s2">"downloadUrl"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://your-mautic.com/asset/1:whitepaper"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h4 id="http-request">HTTP Request</h4>

<p><code class="prettyprint">GET /assets</code></p>

<p><strong>Query Parameters</strong></p>

<table><thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>search</td>
<td>String or search command to filter entities by.</td>
</tr>
<tr>
<td>start</td>
<td>Starting row for the entities returned. Defaults to 0.</td>
</tr>
<tr>
<td>limit</td>
<td>Limit number of entities to return. Defaults to the system configuration for pagination (30).</td>
</tr>
<tr>
<td>orderBy</td>
<td>Column to sort by. Can use any column listed in the response.</td>
</tr>
<tr>
<td>orderByDir</td>
<td>Sort direction: asc or desc.</td>
</tr>
<tr>
<td>publishedOnly</td>
<td>Only return currently published entities.</td>
</tr>
</tbody></table>

<h4 id="response">Response</h4>

<p><code class="prettyprint">Expected Response Code: 200</code></p>

<p>See JSON code example.</p>

<p><strong>Properties</strong></p>

<p>Same as <a href="#get-asset">Get Asset</a>.</p>

          <h2 id="campaigns">Campaigns</h2>

<p>Use this endpoint to obtain details on Mautic&rsquo;s campaigns.</p>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">Mautic\MauticApi</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Mautic\Auth\ApiAuth</span><span class="p">;</span>

<span class="c1">// ...
</span><span class="nv">$auth</span>     <span class="o">=</span> <span class="nx">ApiAuth</span><span class="o">::</span><span class="na">initiate</span><span class="p">(</span><span class="nv">$settings</span><span class="p">);</span>
<span class="nv">$apiUrl</span>   <span class="o">=</span> <span class="s2">"https://your-mautic.com"</span><span class="p">;</span> 
<span class="nv">$campaignApi</span> <span class="o">=</span> <span class="nx">MauticApi</span><span class="o">::</span><span class="na">getContext</span><span class="p">(</span><span class="s2">"campaigns"</span><span class="p">,</span> <span class="nv">$auth</span><span class="p">,</span> <span class="nv">$apiUrl</span><span class="p">);</span>
</code></pre>

<h3 id="get-campaign">Get Campaign</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>

<span class="c1">//...
</span><span class="nv">$campaign</span> <span class="o">=</span> <span class="nv">$campaignApi</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
</code></pre>
<pre><code class="highlight json"><span class="p">{</span><span class="w">
    </span><span class="s2">"campaign"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
        </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Email A/B Test"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"description"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
        </span><span class="s2">"isPublished"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="s2">"publishUp"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
        </span><span class="s2">"publishDown"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
        </span><span class="s2">"dateAdded"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-07-15T15:06:02-05:00"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"createdBy"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
        </span><span class="s2">"createdByUser"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Joe Smith"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"dateModified"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-07-20T13:11:56-05:00"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"modifiedBy"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
        </span><span class="s2">"modifiedByUser"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Joe Smith"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"category"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
        </span><span class="s2">"events"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"28"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">28</span><span class="p">,</span><span class="w">
                </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"lead.changepoints"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"eventType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"action"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Adjust lead points"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"description"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"order"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
                </span><span class="s2">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                  </span><span class="s2">"points"</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="s2">"triggerDate"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"triggerInterval"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
                </span><span class="s2">"triggerIntervalUnit"</span><span class="p">:</span><span class="w"> </span><span class="s2">"d"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"triggerMode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"immediate"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"children"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
                </span><span class="s2">"parent"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"decisionPath"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Get an individual campaign by ID.</p>

<h4 id="http-request">HTTP Request</h4>

<p><code class="prettyprint">GET /campaigns/ID</code></p>

<h4 id="response">Response</h4>

<p><code class="prettyprint">Expected Response Code: 200</code></p>

<p>See JSON code example.</p>

<p><strong>Campaign Properties</strong></p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>int</td>
<td>ID of the campaign</td>
</tr>
<tr>
<td>name</td>
<td>string</td>
<td>Name of the campaign</td>
</tr>
<tr>
<td>description</td>
<td>string/null</td>
<td>Description of the campaign</td>
</tr>
<tr>
<td>alias</td>
<td>string</td>
<td>Used to generate the URL for the campaign</td>
</tr>
<tr>
<td>isPublished</td>
<td>bool</td>
<td>Published state</td>
</tr>
<tr>
<td>publishUp</td>
<td>datetime/null</td>
<td>Date/time when the campaign should be published</td>
</tr>
<tr>
<td>publishDown</td>
<td>datetime/null</td>
<td>Date/time the campaign should be un published</td>
</tr>
<tr>
<td>dateAdded</td>
<td>datetime</td>
<td>Date/time campaign was created</td>
</tr>
<tr>
<td>createdBy</td>
<td>int</td>
<td>ID of the user that created the campaign</td>
</tr>
<tr>
<td>createdByUser</td>
<td>string</td>
<td>Name of the user that created the campaign</td>
</tr>
<tr>
<td>dateModified</td>
<td>datetime/null</td>
<td>Date/time campaign was last modified</td>
</tr>
<tr>
<td>modifiedBy</td>
<td>int</td>
<td>ID of the user that last modified the campaign</td>
</tr>
<tr>
<td>modifiedByUser</td>
<td>string</td>
<td>Name of the user that last modified the campaign</td>
</tr>
<tr>
<td>events</td>
<td>array</td>
<td>Array of Event entities for the campaign. See below.</td>
</tr>
</tbody></table>

<p><strong>Event Properties</strong></p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>int</td>
<td>ID of the event</td>
</tr>
<tr>
<td>name</td>
<td>string</td>
<td>Name of the event</td>
</tr>
<tr>
<td>description</td>
<td>string</td>
<td>Optional description for the event</td>
</tr>
<tr>
<td>type</td>
<td>string</td>
<td>Type of event</td>
</tr>
<tr>
<td>eventType</td>
<td>string</td>
<td>&ldquo;action&rdquo; or &ldquo;decision&rdquo;</td>
</tr>
<tr>
<td>order</td>
<td>int</td>
<td>Order in relation to the other events (used for levels)</td>
</tr>
<tr>
<td>properties</td>
<td>object</td>
<td>Configured properties for the event</td>
</tr>
<tr>
<td>triggerMode</td>
<td>string</td>
<td>&ldquo;immediate&rdquo;, &ldquo;interval&rdquo; or &ldquo;date&rdquo;</td>
</tr>
<tr>
<td>triggerDate</td>
<td>datetime/null</td>
<td>Date/time of when the event should trigger if triggerMode is &ldquo;date&rdquo;</td>
</tr>
<tr>
<td>triggerInterval</td>
<td>int/null</td>
<td>Interval for when the event should trigger</td>
</tr>
<tr>
<td>triggerIntervalUnit</td>
<td>string</td>
<td>Interval unit for when the event should trigger. Options are i = minutes, h = hours, d = days, m = months, y = years</td>
</tr>
<tr>
<td>children</td>
<td>array</td>
<td>Array of this event&rsquo;s children ,</td>
</tr>
<tr>
<td>parent</td>
<td>object/null</td>
<td>This event&rsquo;s parent</td>
</tr>
<tr>
<td>decisionPath</td>
<td>string/null</td>
<td>If the event is connected into an action, this will be &ldquo;no&rdquo; for the non-decision path or &ldquo;yes&rdquo; for the actively followed path.</td>
</tr>
</tbody></table>

<h3 id="list-campaigns">List Campaigns</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="c1">// ...
</span>
<span class="nv">$campaigns</span> <span class="o">=</span> <span class="nv">$campaignApi</span><span class="o">-&gt;</span><span class="na">getList</span><span class="p">(</span><span class="nv">$searchFilter</span><span class="p">,</span> <span class="nv">$start</span><span class="p">,</span> <span class="nv">$limit</span><span class="p">,</span> <span class="nv">$orderBy</span><span class="p">,</span> <span class="nv">$orderByDir</span><span class="p">);</span>
</code></pre>
<pre><code class="highlight json"><span class="p">{</span><span class="w">
    </span><span class="s2">"total"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="s2">"campaigns"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
            </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Welcome Campaign"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"description"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
            </span><span class="s2">"isPublished"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
            </span><span class="s2">"publishUp"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
            </span><span class="s2">"publishDown"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
            </span><span class="s2">"dateAdded"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-07-15T15:06:02-05:00"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"createdBy"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
            </span><span class="s2">"createdByUser"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Joe Smith"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"dateModified"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-07-20T13:11:56-05:00"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"modifiedBy"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
            </span><span class="s2">"modifiedByUser"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Joe Smith"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"category"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
            </span><span class="s2">"events"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="s2">"22"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">22</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"email.send"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"eventType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"action"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Send welcome email"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"description"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"order"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                        </span><span class="s2">"email"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="s2">"triggerMode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"immediate"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"triggerDate"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"triggerInterval"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"triggerIntervalUnit"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"children"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
                    </span><span class="s2">"parent"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"decisionPath"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="s2">"28"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">28</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"lead.changepoints"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"eventType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"action"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Adjust lead points"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"description"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"order"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                        </span><span class="s2">"points"</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="s2">"triggerMode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"immediate"</span><span class="p">,</span><span class="w">                
                    </span><span class="s2">"triggerDate"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"triggerInterval"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"triggerIntervalUnit"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"children"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
                    </span><span class="s2">"parent"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"decisionPath"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h4 id="http-request">HTTP Request</h4>

<p><code class="prettyprint">GET /campaigns</code></p>

<p><strong>Query Parameters</strong></p>

<table><thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>search</td>
<td>String or search command to filter entities by.</td>
</tr>
<tr>
<td>start</td>
<td>Starting row for the entities returned. Defaults to 0.</td>
</tr>
<tr>
<td>limit</td>
<td>Limit number of entities to return. Defaults to the system configuration for pagination (30).</td>
</tr>
<tr>
<td>orderBy</td>
<td>Column to sort by. Can use any column listed in the response.</td>
</tr>
<tr>
<td>orderByDir</td>
<td>Sort direction: asc or desc.</td>
</tr>
<tr>
<td>publishedOnly</td>
<td>Only return currently published entities.</td>
</tr>
</tbody></table>

<h4 id="response">Response</h4>

<p><code class="prettyprint">Expected Response Code: 200</code></p>

<p>See JSON code example.</p>

<p><strong>Properties</strong></p>

<p>Same as <a href="#get-campaign">Get Campaign</a>.</p>

<h3 id="add-lead-to-a-campaign">Add Lead to a Campaign</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>

<span class="c1">//...
</span><span class="nv">$response</span> <span class="o">=</span> <span class="nv">$campaignApi</span><span class="o">-&gt;</span><span class="na">addLead</span><span class="p">(</span><span class="nv">$leadId</span><span class="p">,</span> <span class="nv">$campaignId</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$response</span><span class="p">[</span><span class="s1">'success'</span><span class="p">]))</span> <span class="p">{</span>
    <span class="c1">// handle error
</span><span class="p">}</span>
</code></pre>
<pre><code class="highlight json"><span class="p">{</span><span class="w">
    </span><span class="s2">"success"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Manually add a lead to a specific campaign.</p>

<h4 id="http-request">HTTP Request</h4>

<p><code class="prettyprint">POST /campaigns/CAMPAIGN_ID/lead/add/LEAD_ID</code></p>

<h4 id="response">Response</h4>

<p><code class="prettyprint">Expected Response Code: 200</code></p>

<p>See JSON code example.</p>

<h3 id="remove-lead-from-a-campaign">Remove Lead from a Campaign</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>

<span class="c1">//...
</span><span class="nv">$response</span> <span class="o">=</span> <span class="nv">$listApi</span><span class="o">-&gt;</span><span class="na">removeLead</span><span class="p">(</span><span class="nv">$leadId</span><span class="p">,</span> <span class="nv">$listId</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$response</span><span class="p">[</span><span class="s1">'success'</span><span class="p">]))</span> <span class="p">{</span>
    <span class="c1">// handle error
</span><span class="p">}</span>
</code></pre>
<pre><code class="highlight json"><span class="p">{</span><span class="w">
    </span><span class="s2">"success"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Manually remove a lead from a specific campaign.</p>

<h4 id="http-request">HTTP Request</h4>

<p><code class="prettyprint">POST /campaigns/CAMPAIGN_ID/lead/remove/LEAD_ID</code></p>

<h4 id="response">Response</h4>

<p><code class="prettyprint">Expected Response Code: 200</code></p>

<p>See JSON code example.</p>

          <h2 id="forms">Forms</h2>

<p>Use this endpoint to obtain details on Mautic&rsquo;s forms.</p>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">Mautic\MauticApi</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Mautic\Auth\ApiAuth</span><span class="p">;</span>

<span class="c1">// ...
</span><span class="nv">$auth</span>    <span class="o">=</span> <span class="nx">ApiAuth</span><span class="o">::</span><span class="na">initiate</span><span class="p">(</span><span class="nv">$settings</span><span class="p">);</span>
<span class="nv">$apiUrl</span>  <span class="o">=</span> <span class="s2">"https://your-mautic.com"</span><span class="p">;</span> 
<span class="nv">$formApi</span> <span class="o">=</span> <span class="nx">MauticApi</span><span class="o">::</span><span class="na">getContext</span><span class="p">(</span><span class="s2">"forms"</span><span class="p">,</span> <span class="nv">$auth</span><span class="p">,</span> <span class="nv">$apiUrl</span><span class="p">);</span>
</code></pre>

<h3 id="get-form">Get Form</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>

<span class="c1">//...
</span><span class="nv">$form</span> <span class="o">=</span> <span class="nv">$formApi</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
</code></pre>
<pre><code class="highlight json"><span class="p">{</span><span class="w">
    </span><span class="s2">"form"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
        </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Newlsetter"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"newsletter"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"description"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
        </span><span class="s2">"isPublished"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="s2">"publishUp"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
        </span><span class="s2">"publishDown"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
        </span><span class="s2">"dateAdded"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-07-15T15:06:02-05:00"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"createdBy"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
        </span><span class="s2">"createdByUser"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Joe Smith"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"dateModified"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-07-20T13:11:56-05:00"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"modifiedBy"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
        </span><span class="s2">"modifiedByUser"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Joe Smith"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"category"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
        </span><span class="s2">"cachedHtml"</span><span class="p">:</span><span class="w"> </span><span class="s2">"\n\n&lt;script..."</span><span class="p">,</span><span class="w">
        </span><span class="s2">"template"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
        </span><span class="s2">"submissionCount"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
        </span><span class="s2">"fields"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"26"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">26</span><span class="p">,</span><span class="w">
                </span><span class="s2">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Email"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"showLabel"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="s2">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"email"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"text"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"defaultValue"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"isRequired"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
                </span><span class="s2">"validationMessage"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Email is required"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"helpMessage"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"order"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
                </span><span class="s2">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"placeholder"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Email address"</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="s2">"labelAttributes"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"inputAttributes"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"containerAttributes"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="s2">"27"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">27</span><span class="p">,</span><span class="w">
                </span><span class="s2">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Submit"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"showLabel"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
                </span><span class="s2">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"submit"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"button"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"defaultValue"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"isRequired"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="s2">"validationMessage"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"helpMessage"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"order"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
                </span><span class="s2">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
                </span><span class="s2">"labelAttributes"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"inputAttributes"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"containerAttributes"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"actions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"4"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
                </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"email.send.lead"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Send thank you email"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"description"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"order"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
                </span><span class="s2">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"email"</span><span class="p">:</span><span class="w"> </span><span class="mi">21</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Get an individual form by ID.</p>

<h4 id="http-request">HTTP Request</h4>

<p><code class="prettyprint">GET /forms/ID</code></p>

<h4 id="response">Response</h4>

<p><code class="prettyprint">Expected Response Code: 200</code></p>

<p>See JSON code example.</p>

<p><strong>Form Properties</strong></p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>int</td>
<td>ID of the form</td>
</tr>
<tr>
<td>name</td>
<td>string</td>
<td>Name of the form</td>
</tr>
<tr>
<td>description</td>
<td>string/null</td>
<td>Description of the form</td>
</tr>
<tr>
<td>alias</td>
<td>string</td>
<td>Used to generate the URL for the form</td>
</tr>
<tr>
<td>isPublished</td>
<td>bool</td>
<td>Published state</td>
</tr>
<tr>
<td>publishUp</td>
<td>datetime/null</td>
<td>Date/time when the form should be published</td>
</tr>
<tr>
<td>publishDown</td>
<td>datetime/null</td>
<td>Date/time the form should be un published</td>
</tr>
<tr>
<td>dateAdded</td>
<td>datetime</td>
<td>Date/time form was created</td>
</tr>
<tr>
<td>createdBy</td>
<td>int</td>
<td>ID of the user that created the form</td>
</tr>
<tr>
<td>createdByUser</td>
<td>string</td>
<td>Name of the user that created the form</td>
</tr>
<tr>
<td>dateModified</td>
<td>datetime/null</td>
<td>Date/time form was last modified</td>
</tr>
<tr>
<td>modifiedBy</td>
<td>int</td>
<td>ID of the user that last modified the form</td>
</tr>
<tr>
<td>modifiedByUser</td>
<td>string</td>
<td>Name of the user that last modified the form</td>
</tr>
<tr>
<td>cachedHtml</td>
<td>string</td>
<td>Cached HTML for the form</td>
</tr>
<tr>
<td>template</td>
<td>string/null</td>
<td>Name of the template used to generate the HTML</td>
</tr>
<tr>
<td>submissionCount</td>
<td>Number of times the form has been submitted</td>
<td></td>
</tr>
<tr>
<td>fields</td>
<td>array</td>
<td>Array of Field entities for the form. See below.</td>
</tr>
<tr>
<td>actions</td>
<td>array</td>
<td>Array of Action entities for the form. See below.</td>
</tr>
</tbody></table>

<p><strong>Field Properties</strong></p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>int</td>
<td>ID of the field</td>
</tr>
<tr>
<td>label</td>
<td>string</td>
<td>Label of the field</td>
</tr>
<tr>
<td>showLabel</td>
<td>bool</td>
<td>Display the label of the field</td>
</tr>
<tr>
<td>alias</td>
<td>string</td>
<td>Alias of the field (used as the database column)</td>
</tr>
<tr>
<td>type</td>
<td>string</td>
<td>Field type</td>
</tr>
<tr>
<td>defaultValue</td>
<td>string</td>
<td>Default value</td>
</tr>
<tr>
<td>isRequired</td>
<td>bool</td>
<td>Field is required</td>
</tr>
<tr>
<td>validationMessage</td>
<td>string</td>
<td>Validation message if required field is left empty</td>
</tr>
<tr>
<td>helpMessage</td>
<td>string</td>
<td>Help message for the field</td>
</tr>
<tr>
<td>order</td>
<td>int</td>
<td>Order of the field</td>
</tr>
<tr>
<td>properties</td>
<td>array</td>
<td>Configured properties for the field</td>
</tr>
<tr>
<td>labelAttributes</td>
<td>string/null</td>
<td>Custom HTML attributes for the label</td>
</tr>
<tr>
<td>inputAttributes</td>
<td>Custom HTML attributes for the input</td>
<td></td>
</tr>
<tr>
<td>containerAttributes</td>
<td>Custom HTML attributes for the container</td>
<td></td>
</tr>
</tbody></table>

<p><strong>Action Properties</strong></p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>int</td>
<td>ID of the action</td>
</tr>
<tr>
<td>type</td>
<td>string</td>
<td>Action type</td>
</tr>
<tr>
<td>name</td>
<td>string</td>
<td>Name of the action</td>
</tr>
<tr>
<td>description</td>
<td>string/null</td>
<td>Description of the action</td>
</tr>
<tr>
<td>orde</td>
<td>int</td>
<td>Action order</td>
</tr>
<tr>
<td>propertie</td>
<td>array</td>
<td>Configured properties for the action</td>
</tr>
</tbody></table>

<h3 id="list-forms">List Forms</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="c1">// ...
</span>
<span class="nv">$forms</span> <span class="o">=</span> <span class="nv">$formApi</span><span class="o">-&gt;</span><span class="na">getList</span><span class="p">(</span><span class="nv">$searchFilter</span><span class="p">,</span> <span class="nv">$start</span><span class="p">,</span> <span class="nv">$limit</span><span class="p">,</span> <span class="nv">$orderBy</span><span class="p">,</span> <span class="nv">$orderByDir</span><span class="p">);</span>
</code></pre>
<pre><code class="highlight json"><span class="p">{</span><span class="w">
    </span><span class="s2">"total"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="s2">"forms"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
            </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Newlsetter"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"newsletter"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"description"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
            </span><span class="s2">"isPublished"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
            </span><span class="s2">"publishUp"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
            </span><span class="s2">"publishDown"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
            </span><span class="s2">"dateAdded"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-07-15T15:06:02-05:00"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"createdBy"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
            </span><span class="s2">"createdByUser"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Joe Smith"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"dateModified"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-07-20T13:11:56-05:00"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"modifiedBy"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
            </span><span class="s2">"modifiedByUser"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Joe Smith"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"category"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
            </span><span class="s2">"cachedHtml"</span><span class="p">:</span><span class="w"> </span><span class="s2">"\n\n&lt;script..."</span><span class="p">,</span><span class="w">
            </span><span class="s2">"template"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
            </span><span class="s2">"submissionCount"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
            </span><span class="s2">"fields"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="s2">"26"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">26</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Email"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"showLabel"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"email"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"text"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"defaultValue"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"isRequired"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"validationMessage"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Email is required"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"helpMessage"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"order"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                        </span><span class="s2">"placeholder"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Email address"</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="s2">"labelAttributes"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"inputAttributes"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"containerAttributes"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="s2">"27"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">27</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Submit"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"showLabel"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"submit"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"button"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"defaultValue"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"isRequired"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"validationMessage"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"helpMessage"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"order"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
                    </span><span class="s2">"labelAttributes"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"inputAttributes"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"containerAttributes"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="s2">"actions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="s2">"4"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"email.send.lead"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Send thank you email"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"description"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"order"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                        </span><span class="s2">"email"</span><span class="p">:</span><span class="w"> </span><span class="mi">21</span><span class="w">
                    </span><span class="p">}</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h4 id="http-request">HTTP Request</h4>

<p><code class="prettyprint">GET /forms</code></p>

<p><strong>Query Parameters</strong></p>

<table><thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>search</td>
<td>String or search command to filter entities by.</td>
</tr>
<tr>
<td>start</td>
<td>Starting row for the entities returned. Defaults to 0.</td>
</tr>
<tr>
<td>limit</td>
<td>Limit number of entities to return. Defaults to the system configuration for pagination (30).</td>
</tr>
<tr>
<td>orderBy</td>
<td>Column to sort by. Can use any column listed in the response.</td>
</tr>
<tr>
<td>orderByDir</td>
<td>Sort direction: asc or desc.</td>
</tr>
<tr>
<td>publishedOnly</td>
<td>Only return currently published entities.</td>
</tr>
</tbody></table>

<h4 id="response">Response</h4>

<p><code class="prettyprint">Expected Response Code: 200</code></p>

<p>See JSON code example.</p>

<p><strong>Properties</strong></p>

<p>Same as <a href="#get-form">Get Form</a>.</p>

          <h2 id="lists">Lists</h2>

<p>Use this endpoint to obtain details on Mautic&rsquo;s lead lists or to manipulate lead memberships.</p>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">Mautic\MauticApi</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Mautic\Auth\ApiAuth</span><span class="p">;</span>

<span class="c1">// ...
</span><span class="nv">$auth</span>     <span class="o">=</span> <span class="nx">ApiAuth</span><span class="o">::</span><span class="na">initiate</span><span class="p">(</span><span class="nv">$settings</span><span class="p">);</span>
<span class="nv">$apiUrl</span>   <span class="o">=</span> <span class="s2">"https://your-mautic.com"</span><span class="p">;</span> 
<span class="nv">$listApi</span> <span class="o">=</span> <span class="nx">MauticApi</span><span class="o">::</span><span class="na">getContext</span><span class="p">(</span><span class="s2">"lists"</span><span class="p">,</span> <span class="nv">$auth</span><span class="p">,</span> <span class="nv">$apiUrl</span><span class="p">);</span>
</code></pre>

<h3 id="list-lead-lists">List Lead Lists</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>

<span class="c1">//...
</span><span class="nv">$lists</span> <span class="o">=</span> <span class="nv">$listApi</span><span class="o">-&gt;</span><span class="na">getList</span><span class="p">();</span>
</code></pre>
<pre><code class="highlight json"><span class="p">{</span><span class="w">
  </span><span class="s2">"1"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"New Leads"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"new"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"2"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
    </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Region A Leads"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"region-a-laeds"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"3"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
    </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Region B Leads"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"region-b-leads"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Returns a list of lead lists available to the user. This list is not filterable.</p>

<h4 id="http-request">HTTP Request</h4>

<p><code class="prettyprint">GET /lists</code></p>

<h4 id="response">Response</h4>

<p><code class="prettyprint">Expected Response Code: 200</code></p>

<p>See JSON code example.</p>

<p><strong>List Properties</strong></p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>int</td>
<td>ID of the list</td>
</tr>
<tr>
<td>name</td>
<td>string</td>
<td>Name of the list</td>
</tr>
<tr>
<td>alias</td>
<td>string</td>
<td>Alias of the list</td>
</tr>
</tbody></table>

<h3 id="add-lead-to-a-list">Add Lead to a List</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>

<span class="c1">//...
</span><span class="nv">$response</span> <span class="o">=</span> <span class="nv">$listApi</span><span class="o">-&gt;</span><span class="na">addLead</span><span class="p">(</span><span class="nv">$leadId</span><span class="p">,</span> <span class="nv">$listId</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$response</span><span class="p">[</span><span class="s1">'success'</span><span class="p">]))</span> <span class="p">{</span>
    <span class="c1">// handle error
</span><span class="p">}</span>
</code></pre>
<pre><code class="highlight json"><span class="p">{</span><span class="w">
    </span><span class="s2">"success"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Manually add a lead to a specific list.</p>

<h4 id="http-request">HTTP Request</h4>

<p><code class="prettyprint">POST /lists/LIST_ID/lead/add/LEAD_ID</code></p>

<h4 id="response">Response</h4>

<p><code class="prettyprint">Expected Response Code: 200</code></p>

<p>See JSON code example.</p>

<h3 id="remove-lead-from-a-list">Remove Lead from a List</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>

<span class="c1">//...
</span><span class="nv">$response</span> <span class="o">=</span> <span class="nv">$listApi</span><span class="o">-&gt;</span><span class="na">removeLead</span><span class="p">(</span><span class="nv">$leadId</span><span class="p">,</span> <span class="nv">$listId</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$response</span><span class="p">[</span><span class="s1">'success'</span><span class="p">]))</span> <span class="p">{</span>
    <span class="c1">// handle error
</span><span class="p">}</span>
</code></pre>
<pre><code class="highlight json"><span class="p">{</span><span class="w">
    </span><span class="s2">"success"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Manually remove a lead to a specific list.</p>

<h4 id="http-request">HTTP Request</h4>

<p><code class="prettyprint">POST /lists/LIST_ID/lead/remove/LEAD_ID</code></p>

<h4 id="response">Response</h4>

<p><code class="prettyprint">Expected Response Code: 200</code></p>

<p>See JSON code example.</p>

          <h2 id="pages">Pages</h2>

<p>Use this endpoint to obtain details on Mautic&rsquo;s landing pages.</p>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">Mautic\MauticApi</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Mautic\Auth\ApiAuth</span><span class="p">;</span>

<span class="c1">// ...
</span><span class="nv">$auth</span>    <span class="o">=</span> <span class="nx">ApiAuth</span><span class="o">::</span><span class="na">initiate</span><span class="p">(</span><span class="nv">$settings</span><span class="p">);</span>
<span class="nv">$apiUrl</span>  <span class="o">=</span> <span class="s2">"https://your-mautic.com"</span><span class="p">;</span> 
<span class="nv">$pageApi</span> <span class="o">=</span> <span class="nx">MauticApi</span><span class="o">::</span><span class="na">getContext</span><span class="p">(</span><span class="s2">"pages"</span><span class="p">,</span> <span class="nv">$auth</span><span class="p">,</span> <span class="nv">$apiUrl</span><span class="p">);</span>
</code></pre>

<h3 id="get-page">Get Page</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>

<span class="c1">//...
</span><span class="nv">$page</span> <span class="o">=</span> <span class="nv">$pageApi</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
</code></pre>
<pre><code class="highlight json"><span class="p">{</span><span class="w">
    </span><span class="s2">"page"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
        </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Webinar Landing Page"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"description"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
        </span><span class="s2">"isPublished"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="s2">"publishUp"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
        </span><span class="s2">"publishDown"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
        </span><span class="s2">"dateAdded"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-07-15T15:06:02-05:00"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"createdBy"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
        </span><span class="s2">"createdByUser"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Joe Smith"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"dateModified"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-07-20T13:11:56-05:00"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"modifiedBy"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
        </span><span class="s2">"modifiedByUser"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Joe Smith"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"category"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Events"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"language"</span><span class="p">:</span><span class="w"> </span><span class="s2">"en"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"hits"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
        </span><span class="s2">"uniqueHits"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
        </span><span class="s2">"variantHits"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
        </span><span class="s2">"revision"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
        </span><span class="s2">"metaDescription"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
        </span><span class="s2">"redirectType"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
        </span><span class="s2">"redirectUrl"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
        </span><span class="s2">"translationChildren"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
        </span><span class="s2">"translationParent"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
        </span><span class="s2">"variantChildren"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
        </span><span class="s2">"variantParent"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
        </span><span class="s2">"variantSettings"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
        </span><span class="s2">"variantStartDate"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Get an individual page by ID.</p>

<h4 id="http-request">HTTP Request</h4>

<p><code class="prettyprint">GET /pages/ID</code></p>

<h4 id="response">Response</h4>

<p><code class="prettyprint">Expected Response Code: 200</code></p>

<p>See JSON code example.</p>

<p><strong>Page Properties</strong></p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>int</td>
<td>ID of the page</td>
</tr>
<tr>
<td>title</td>
<td>string</td>
<td>Title of the page</td>
</tr>
<tr>
<td>description</td>
<td>string/null</td>
<td>Description of the page</td>
</tr>
<tr>
<td>alias</td>
<td>string</td>
<td>Used to generate the URL for the page</td>
</tr>
<tr>
<td>isPublished</td>
<td>bool</td>
<td>Published state</td>
</tr>
<tr>
<td>publishUp</td>
<td>datetime/null</td>
<td>Date/time when the page should be published</td>
</tr>
<tr>
<td>publishDown</td>
<td>datetime/null</td>
<td>Date/time the page should be un published</td>
</tr>
<tr>
<td>dateAdded</td>
<td>datetime</td>
<td>Date/time page was created</td>
</tr>
<tr>
<td>createdBy</td>
<td>int</td>
<td>ID of the user that created the page</td>
</tr>
<tr>
<td>createdByUser</td>
<td>string</td>
<td>Name of the user that created the page</td>
</tr>
<tr>
<td>dateModified</td>
<td>datetime/null</td>
<td>Date/time page was last modified</td>
</tr>
<tr>
<td>modifiedBy</td>
<td>int</td>
<td>ID of the user that last modified the page</td>
</tr>
<tr>
<td>modifiedByUser</td>
<td>string</td>
<td>Name of the user that last modified the page</td>
</tr>
<tr>
<td>language</td>
<td>string</td>
<td>Language locale of the page</td>
</tr>
<tr>
<td>hits</td>
<td>int</td>
<td>Total page hit count</td>
</tr>
<tr>
<td>uniqueHits</td>
<td>int</td>
<td>Unique page hit count</td>
</tr>
<tr>
<td>revision</td>
<td>int</td>
<td>Page revision</td>
</tr>
<tr>
<td>metaDescription</td>
<td>Meta description for the page&rsquo;s <head></td>
<td></td>
</tr>
<tr>
<td>redirectType</td>
<td>int</td>
<td>If unpublished, redirect with 301 or 302</td>
</tr>
<tr>
<td>redirectUrl</td>
<td>string</td>
<td>If unpublished, the URL to redirect to if redirectType is set</td>
</tr>
<tr>
<td>translationChildren</td>
<td>array</td>
<td>Array of Page entities for translations of this landing page</td>
</tr>
<tr>
<td>translationParent</td>
<td>object</td>
<td>The parent/main page if this is a translation</td>
</tr>
<tr>
<td>variantHits</td>
<td>Hit count since variantStartDate</td>
<td></td>
</tr>
<tr>
<td>variantChildren</td>
<td>array</td>
<td>Array of Page entities for variants of this landing page</td>
</tr>
<tr>
<td>variantParent</td>
<td>object</td>
<td>The parent/main page if this is a variant (A/B test)</td>
</tr>
<tr>
<td>variantSettings</td>
<td>array</td>
<td>The properties of the A/B test</td>
</tr>
<tr>
<td>variantStartDate</td>
<td>datetime/null</td>
<td>The date/time the A/B test began</td>
</tr>
</tbody></table>

<h3 id="list-pages">List Pages</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="c1">// ...
</span>
<span class="nv">$pages</span> <span class="o">=</span> <span class="nv">$pageApi</span><span class="o">-&gt;</span><span class="na">getList</span><span class="p">(</span><span class="nv">$searchFilter</span><span class="p">,</span> <span class="nv">$start</span><span class="p">,</span> <span class="nv">$limit</span><span class="p">,</span> <span class="nv">$orderBy</span><span class="p">,</span> <span class="nv">$orderByDir</span><span class="p">);</span>
</code></pre>
<pre><code class="highlight json"><span class="p">{</span><span class="w">
    </span><span class="s2">"total"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="s2">"pages"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
            </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Webinar Landing Page"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"description"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
            </span><span class="s2">"isPublished"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
            </span><span class="s2">"publishUp"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
            </span><span class="s2">"publishDown"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
            </span><span class="s2">"dateAdded"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-07-15T15:06:02-05:00"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"createdBy"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
            </span><span class="s2">"createdByUser"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Joe Smith"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"dateModified"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-07-20T13:11:56-05:00"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"modifiedBy"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
            </span><span class="s2">"modifiedByUser"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Joe Smith"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"category"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Events"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"language"</span><span class="p">:</span><span class="w"> </span><span class="s2">"en"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"hits"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="s2">"uniqueHits"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="s2">"variantHits"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="s2">"revision"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
            </span><span class="s2">"metaDescription"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
            </span><span class="s2">"redirectType"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
            </span><span class="s2">"redirectUrl"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
            </span><span class="s2">"translationChildren"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
            </span><span class="s2">"translationParent"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
            </span><span class="s2">"variantChildren"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
            </span><span class="s2">"variantParent"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
            </span><span class="s2">"variantSettings"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
            </span><span class="s2">"variantStartDate"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h4 id="http-request">HTTP Request</h4>

<p><code class="prettyprint">GET /pages</code></p>

<p><strong>Query Parameters</strong></p>

<table><thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>search</td>
<td>String or search command to filter entities by.</td>
</tr>
<tr>
<td>start</td>
<td>Starting row for the entities returned. Defaults to 0.</td>
</tr>
<tr>
<td>limit</td>
<td>Limit number of entities to return. Defaults to the system configuration for pagination (30).</td>
</tr>
<tr>
<td>orderBy</td>
<td>Column to sort by. Can use any column listed in the response.</td>
</tr>
<tr>
<td>orderByDir</td>
<td>Sort direction: asc or desc.</td>
</tr>
<tr>
<td>publishedOnly</td>
<td>Only return currently published entities.</td>
</tr>
</tbody></table>

<h4 id="response">Response</h4>

<p><code class="prettyprint">Expected Response Code: 200</code></p>

<p>See JSON code example.</p>

<p><strong>Properties</strong></p>

<p>Same as <a href="#get-page">Get Page</a>.</p>

          <h2 id="point-actions">Point Actions</h2>

<p>Use this endpoint to obtain details on Mautic&rsquo;s point actions.</p>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">Mautic\MauticApi</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Mautic\Auth\ApiAuth</span><span class="p">;</span>

<span class="c1">// ...
</span><span class="nv">$auth</span>     <span class="o">=</span> <span class="nx">ApiAuth</span><span class="o">::</span><span class="na">initiate</span><span class="p">(</span><span class="nv">$settings</span><span class="p">);</span>
<span class="nv">$apiUrl</span>   <span class="o">=</span> <span class="s2">"https://your-mautic.com"</span><span class="p">;</span> 
<span class="nv">$pointApi</span> <span class="o">=</span> <span class="nx">MauticApi</span><span class="o">::</span><span class="na">getContext</span><span class="p">(</span><span class="s2">"points"</span><span class="p">,</span> <span class="nv">$auth</span><span class="p">,</span> <span class="nv">$apiUrl</span><span class="p">);</span>
</code></pre>

<h3 id="get-point-action">Get Point Action</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>

<span class="c1">//...
</span><span class="nv">$point</span> <span class="o">=</span> <span class="nv">$pointApi</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
</code></pre>
<pre><code class="highlight json"><span class="p">{</span><span class="w">
    </span><span class="s2">"point"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
        </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Opens Email"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"description"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
        </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"email.send"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"isPublished"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="s2">"publishUp"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
        </span><span class="s2">"publishDown"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
        </span><span class="s2">"dateAdded"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-07-19T00:34:11-05:00"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"createdBy"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
        </span><span class="s2">"createdByUser"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Joe Smith"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"dateModified"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-07-19T00:41:44-05:00"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"modifiedBy"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
        </span><span class="s2">"modifiedByUser"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Joe Smith"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"delta"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
        </span><span class="s2">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"emails"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="mi">35</span><span class="w">
            </span><span class="p">]</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"category"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Get an individual point action by ID.</p>

<h4 id="http-request">HTTP Request</h4>

<p><code class="prettyprint">GET /points/ID</code></p>

<h4 id="response">Response</h4>

<p><code class="prettyprint">Expected Response Code: 200</code></p>

<p>See JSON code example.</p>

<p><strong>Point Action Properties</strong></p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>int</td>
<td>ID of the point</td>
</tr>
<tr>
<td>name</td>
<td>string</td>
<td>Name of the point</td>
</tr>
<tr>
<td>description</td>
<td>string/null</td>
<td>Description of the point</td>
</tr>
<tr>
<td>category</td>
<td>string</td>
<td>Category name</td>
</tr>
<tr>
<td>type</td>
<td>string</td>
<td>Point action type</td>
</tr>
<tr>
<td>isPublished</td>
<td>bool</td>
<td>Published state</td>
</tr>
<tr>
<td>publishUp</td>
<td>datetime/null</td>
<td>Date/time when the point should be published</td>
</tr>
<tr>
<td>publishDown</td>
<td>datetime/null</td>
<td>Date/time the point should be un published</td>
</tr>
<tr>
<td>dateAdded</td>
<td>datetime</td>
<td>Date/time point was created</td>
</tr>
<tr>
<td>createdBy</td>
<td>int</td>
<td>ID of the user that created the point</td>
</tr>
<tr>
<td>createdByUser</td>
<td>string</td>
<td>Name of the user that created the point</td>
</tr>
<tr>
<td>dateModified</td>
<td>datetime/null</td>
<td>Date/time point was last modified</td>
</tr>
<tr>
<td>modifiedBy</td>
<td>int</td>
<td>ID of the user that last modified the point</td>
</tr>
<tr>
<td>modifiedByUser</td>
<td>string</td>
<td>Name of the user that last modified the point</td>
</tr>
<tr>
<td>delta</td>
<td>int</td>
<td>The number of points to give the lead when executing this action</td>
</tr>
<tr>
<td>properties</td>
<td>array</td>
<td>Configured properties for this point action</td>
</tr>
</tbody></table>

<h3 id="list-point-actions">List Point Actions</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="c1">// ...
</span>
<span class="nv">$points</span> <span class="o">=</span> <span class="nv">$pointApi</span><span class="o">-&gt;</span><span class="na">getList</span><span class="p">(</span><span class="nv">$searchFilter</span><span class="p">,</span> <span class="nv">$start</span><span class="p">,</span> <span class="nv">$limit</span><span class="p">,</span> <span class="nv">$orderBy</span><span class="p">,</span> <span class="nv">$orderByDir</span><span class="p">);</span>
</code></pre>
<pre><code class="highlight json"><span class="p">{</span><span class="w">
    </span><span class="s2">"total"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="s2">"points"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
            </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Opens Email"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"description"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
            </span><span class="s2">"category"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
            </span><span class="s2">"type"</span><span class="err">:</span><span class="w"> </span><span class="s2">"email.send"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"isPublished"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
            </span><span class="s2">"publishUp"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
            </span><span class="s2">"publishDown"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
            </span><span class="s2">"dateAdded"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-07-19T00:34:11-05:00"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"createdBy"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
            </span><span class="s2">"createdByUser"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Joe Smith"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"dateModified"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-07-19T00:41:44-05:00"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"modifiedBy"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
            </span><span class="s2">"modifiedByUser"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Joe Smith"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"delta"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
            </span><span class="s2">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="s2">"emails"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                    </span><span class="mi">35</span><span class="w">
                </span><span class="p">]</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h4 id="http-request">HTTP Request</h4>

<p><code class="prettyprint">GET /points</code></p>

<p><strong>Query Parameters</strong></p>

<table><thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>search</td>
<td>String or search command to filter entities by.</td>
</tr>
<tr>
<td>start</td>
<td>Starting row for the entities returned. Defaults to 0.</td>
</tr>
<tr>
<td>limit</td>
<td>Limit number of entities to return. Defaults to the system configuration for pagination (30).</td>
</tr>
<tr>
<td>orderBy</td>
<td>Column to sort by. Can use any column listed in the response.</td>
</tr>
<tr>
<td>orderByDir</td>
<td>Sort direction: asc or desc.</td>
</tr>
<tr>
<td>publishedOnly</td>
<td>Only return currently published entities.</td>
</tr>
</tbody></table>

<h4 id="response">Response</h4>

<p><code class="prettyprint">Expected Response Code: 200</code></p>

<p>See JSON code example.</p>

<p><strong>Properties</strong></p>

<p>Same as <a href="#get-point-action">Get Point Action</a>.</p>

          <h2 id="point-triggers">Point Triggers</h2>

<p>Use this endpoint to obtain details on Mautic&rsquo;s point triggers.</p>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">Mautic\MauticApi</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Mautic\Auth\ApiAuth</span><span class="p">;</span>

<span class="c1">// ...
</span><span class="nv">$auth</span>     <span class="o">=</span> <span class="nx">ApiAuth</span><span class="o">::</span><span class="na">initiate</span><span class="p">(</span><span class="nv">$settings</span><span class="p">);</span>
<span class="nv">$apiUrl</span>   <span class="o">=</span> <span class="s2">"https://your-mautic.com"</span><span class="p">;</span> 
<span class="nv">$pointApi</span> <span class="o">=</span> <span class="nx">MauticApi</span><span class="o">::</span><span class="na">getContext</span><span class="p">(</span><span class="s2">"pointTriggers"</span><span class="p">,</span> <span class="nv">$auth</span><span class="p">,</span> <span class="nv">$apiUrl</span><span class="p">);</span>
</code></pre>

<h3 id="get-point-trigger">Get Point Trigger</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>

<span class="c1">//...
</span><span class="nv">$trigger</span> <span class="o">=</span> <span class="nv">$pointApi</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
</code></pre>
<pre><code class="highlight json"><span class="p">{</span><span class="w">
    </span><span class="s2">"trigger"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
         </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
         </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Trigger test"</span><span class="p">,</span><span class="w">
         </span><span class="s2">"description"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
         </span><span class="s2">"category"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">      
         </span><span class="s2">"isPublished"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">      
         </span><span class="s2">"publishUp"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
         </span><span class="s2">"publishDown"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
         </span><span class="s2">"dateAdded"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-07-23T03:20:42-05:00"</span><span class="p">,</span><span class="w">
         </span><span class="s2">"createdBy"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
         </span><span class="s2">"createdByUser"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Joe Smith"</span><span class="p">,</span><span class="w">
         </span><span class="s2">"dateModified"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
         </span><span class="s2">"modifiedBy"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
         </span><span class="s2">"modifiedByUser"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="err">l,</span><span class="w">
         </span><span class="s2">"points"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
         </span><span class="s2">"color"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ab5959"</span><span class="p">,</span><span class="w">
         </span><span class="s2">"events"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
             </span><span class="s2">"1"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                 </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
                 </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"email.send"</span><span class="p">,</span><span class="w">
                 </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Send email"</span><span class="p">,</span><span class="w">
                 </span><span class="s2">"description"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                 </span><span class="s2">"order"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
                 </span><span class="s2">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"email"</span><span class="p">:</span><span class="w"> </span><span class="mi">21</span><span class="w">
                 </span><span class="p">}</span><span class="w">
             </span><span class="p">}</span><span class="w">
         </span><span class="p">}</span><span class="w">
     </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Get an individual point trigger by ID.</p>

<h4 id="http-request">HTTP Request</h4>

<p><code class="prettyprint">GET /points/triggers/ID</code></p>

<h4 id="response">Response</h4>

<p><code class="prettyprint">Expected Response Code: 200</code></p>

<p>See JSON code example.</p>

<p><strong>Point Trigger Properties</strong></p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>int</td>
<td>ID of the point</td>
</tr>
<tr>
<td>name</td>
<td>string</td>
<td>Name of the point</td>
</tr>
<tr>
<td>description</td>
<td>string/null</td>
<td>Description of the point</td>
</tr>
<tr>
<td>category</td>
<td>string</td>
<td>Category name</td>
</tr>
<tr>
<td>isPublished</td>
<td>bool</td>
<td>Published state</td>
</tr>
<tr>
<td>publishUp</td>
<td>datetime/null</td>
<td>Date/time when the point should be published</td>
</tr>
<tr>
<td>publishDown</td>
<td>datetime/null</td>
<td>Date/time the point should be un published</td>
</tr>
<tr>
<td>dateAdded</td>
<td>datetime</td>
<td>Date/time point was created</td>
</tr>
<tr>
<td>createdBy</td>
<td>int</td>
<td>ID of the user that created the point</td>
</tr>
<tr>
<td>createdByUser</td>
<td>string</td>
<td>Name of the user that created the point</td>
</tr>
<tr>
<td>dateModified</td>
<td>datetime/null</td>
<td>Date/time point was last modified</td>
</tr>
<tr>
<td>modifiedBy</td>
<td>int</td>
<td>ID of the user that last modified the point</td>
</tr>
<tr>
<td>modifiedByUser</td>
<td>string</td>
<td>Name of the user that last modified the point</td>
</tr>
<tr>
<td>points</td>
<td>int</td>
<td>The minimum number of points before the trigger events are executed</td>
</tr>
<tr>
<td>color</td>
<td>string</td>
<td>Color hex to highlight the lead with. This value does NOT include the pound sign (#)</td>
</tr>
<tr>
<td>events</td>
<td>array</td>
<td>Array of TriggerEvent entities for this trigger. See below.</td>
</tr>
</tbody></table>

<p><strong>Trigger Event Properties</strong></p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>int</td>
<td>ID of the event</td>
</tr>
<tr>
<td>type</td>
<td>string</td>
<td>Event type</td>
</tr>
<tr>
<td>name</td>
<td>string</td>
<td>Name of the event</td>
</tr>
<tr>
<td>description</td>
<td>string</td>
<td>Description of the event</td>
</tr>
<tr>
<td>order</td>
<td>int</td>
<td>Event order</td>
</tr>
<tr>
<td>properties</td>
<td>array</td>
<td>Configured properties for the event</td>
</tr>
</tbody></table>

<h3 id="list-point-triggers">List Point Triggers</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="c1">// ...
</span>
<span class="nv">$triggers</span> <span class="o">=</span> <span class="nv">$pointApi</span><span class="o">-&gt;</span><span class="na">getList</span><span class="p">(</span><span class="nv">$searchFilter</span><span class="p">,</span> <span class="nv">$start</span><span class="p">,</span> <span class="nv">$limit</span><span class="p">,</span> <span class="nv">$orderBy</span><span class="p">,</span> <span class="nv">$orderByDir</span><span class="p">);</span>
</code></pre>
<pre><code class="highlight json"><span class="p">{</span><span class="w">
    </span><span class="s2">"total"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="s2">"triggers"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
            </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Trigger test"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"description"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
            </span><span class="s2">"category"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">      
            </span><span class="s2">"isPublished"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">      
            </span><span class="s2">"publishUp"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
            </span><span class="s2">"publishDown"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
            </span><span class="s2">"dateAdded"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-07-23T03:20:42-05:00"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"createdBy"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
            </span><span class="s2">"createdByUser"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Joe Smith"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"dateModified"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
            </span><span class="s2">"modifiedBy"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
            </span><span class="s2">"modifiedByUser"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="err">l,</span><span class="w">
            </span><span class="s2">"points"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
            </span><span class="s2">"color"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ab5959"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"events"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="s2">"1"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"email.send"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Send email"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"description"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"order"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                        </span><span class="s2">"email"</span><span class="p">:</span><span class="w"> </span><span class="mi">21</span><span class="w">
                    </span><span class="p">}</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h4 id="http-request">HTTP Request</h4>

<p><code class="prettyprint">GET /points/triggers</code></p>

<p><strong>Query Parameters</strong></p>

<table><thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>search</td>
<td>String or search command to filter entities by.</td>
</tr>
<tr>
<td>start</td>
<td>Starting row for the entities returned. Defaults to 0.</td>
</tr>
<tr>
<td>limit</td>
<td>Limit number of entities to return. Defaults to the system configuration for pagination (30).</td>
</tr>
<tr>
<td>orderBy</td>
<td>Column to sort by. Can use any column listed in the response.</td>
</tr>
<tr>
<td>orderByDir</td>
<td>Sort direction: asc or desc.</td>
</tr>
<tr>
<td>publishedOnly</td>
<td>Only return currently published entities.</td>
</tr>
</tbody></table>

<h4 id="response">Response</h4>

<p><code class="prettyprint">Expected Response Code: 200</code></p>

<p>See JSON code example.</p>

<p><strong>Properties</strong></p>

<p>Same as <a href="#get-point-trigger">Get Point Trigger</a>.</p>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="php">php</a>
                <a href="#" data-language-name="json">json</a>
          </div>
      </div>
    </div>
  </body>
</html>
