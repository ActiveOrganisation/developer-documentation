<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Mautic Developer Documentation</title>

    <link href="stylesheets/screen.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" type="text/css" media="print" />

      <script src="javascripts/all.js" type="text/javascript"></script>

      <script>
        $(function() {
          setupLanguages(["php"]);
        });
      </script>
  </head>

  <body class="index">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <a class="mautic-brand" href="#">
          <!-- logo figure -->
          <svg version="1.1" class="mautic-logo-figure" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 128 128" enable-background="new 0 0 128 128" xml:space="preserve">
                  <path class="circle" d="M64,119.843c-30.937,0-56.108-25.17-56.108-56.108C7.893,32.799,33.063,7.629,64,7.629
                  c7.474,0,14.734,1.446,21.578,4.301c1.936,0.807,2.85,3.03,2.041,4.964c-0.805,1.937-3.029,2.849-4.963,2.043
                  C76.742,16.472,70.465,15.221,64,15.221c-26.751,0-48.514,21.763-48.514,48.514c0,26.752,21.763,48.516,48.514,48.516
                  c26.751,0,48.513-21.764,48.513-48.516c0-5.735-0.988-11.345-2.939-16.677c-0.723-1.968,0.289-4.149,2.258-4.869
                  c1.971-0.721,4.15,0.291,4.871,2.259c2.258,6.171,3.404,12.661,3.404,19.287C120.107,94.673,94.938,119.843,64,119.843"></path>
              <polygon class="m" points="88.545,57.987 79.807,67.055 84.664,87.332 95.621,87.332 "></polygon>
              <polygon class="m-arrow" points="84.982,31.157 88.004,34.176 63.933,59.605 43.446,38.475 31.664,87.332 42.621,87.332
                  49.122,60.198 63.933,76.399 95.699,41.815 98.738,44.875 101.75,27.784 "></polygon>
              </svg>
          <!--/ logo figure -->
          <!-- logo text -->
          <svg version="1.1" class="mautic-logo-text mnl-3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 260 65" enable-background="new 0 0 260 65" xml:space="preserve">
                  <g>
                      <path class="m" d="M39.336,57.983V37.951c0-4.932-2.58-9.409-7.664-9.409
                      c-5.008,0-7.967,4.477-7.967,9.409v20.032h-9.258V20.498h8.575l0.683,4.553c1.972-3.794,6.298-5.16,9.864-5.16
                      c4.477,0,8.955,1.822,11.079,6.981c3.339-5.311,7.664-6.829,12.521-6.829c10.623,0,15.859,6.526,15.859,17.756v20.185H63.77V37.799
                      c0-4.932-2.049-9.106-7.057-9.106s-8.119,4.326-8.119,9.258v20.032H39.336z"></path>
                      <path class="a" d="M109.031,20.574h8.879v37.41h-8.728l-0.456-5.464
                      c-2.124,4.402-7.967,6.527-12.14,6.604c-11.079,0.074-19.275-6.754-19.275-19.883c0-12.898,8.575-19.652,19.502-19.577
                      c5.01,0,9.789,2.352,11.913,6.07L109.031,20.574z M86.569,39.24c0,7.134,4.934,11.384,11.079,11.384
                      c14.569,0,14.569-22.689,0-22.689C91.503,27.935,86.569,32.108,86.569,39.24"></path>
                      <path class="u" d="M133.101,20.574v19.578c0,5.69,3.11,10.016,9.03,10.016
                      c5.69,0,9.561-4.781,9.561-10.471V20.574h9.181v37.486h-8.27l-0.607-5.084c-3.871,3.794-7.437,5.614-12.672,5.614
                      c-8.954,0-15.48-6.754-15.48-18.363V20.574H133.101z"></path>
                      <path class="t" d="M182.123,10.026V20.65h10.319v7.967h-10.396V44.78
                      c0,3.567,1.973,5.313,4.855,5.313c1.443,0,3.112-0.455,4.479-1.14l2.58,7.893c-2.656,1.062-4.857,1.518-7.664,1.594
                      c-8.12,0.303-13.432-4.326-13.432-13.659V28.617h-6.98V20.65h6.98v-9.637L182.123,10.026z"></path>
                      <path class="i" d="M209.441,10.026c0,7.209-10.929,7.209-10.929,0 C198.513,2.818,209.441,2.818,209.441,10.026 M199.348,57.984h9.259V20.422h-9.259V57.984z"></path>
                      <path class="c" d="M247.803,53.203c-4.326,4.249-8.879,5.92-14.418,5.92
                      c-10.853,0-19.881-6.526-19.881-19.807c0-13.279,9.028-19.805,19.881-19.805c5.312,0,9.409,1.518,13.507,5.54l-5.843,6.146
                      c-2.2-1.973-4.934-2.959-7.514-2.959c-6.221,0-10.773,4.553-10.773,11.078c0,7.133,4.855,10.927,10.623,10.927
                      c2.959,0,5.919-0.834,8.194-3.11L247.803,53.203z"></path>
                  </g>
              </svg>
          <!--/ logo text -->
      </a>
        <div class="lang-selector">
              <a href="#" data-language-name="php">php</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
        <ul class="toc-footer">
            <li><a href='https://github.com/mautic/mautic'>Download Mautic source</a></li>
            <li><a href='http://github.com/tripit/slate'>Documentation powered by Slate</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        
          <h1 id="introduction">Introduction</h1>

<p>Welcome to the Mautic Developer Documentation. This documentation will go over how to build a Mautic Addon that extends the features of Mautic and how to integration applications outside of Mautic using its REST API. </p>

<h2 id="submitting-code-to-mautic">Submitting Code to Mautic</h2>

<p>Development is open and available to any member of the Mautic community. All fixes and improvements are done through pull requests to the code on <a href="https://github.com/mautic/mautic">GitHub</a>. This code is open source and publicly available. </p>

<p>Read more about the PR process on the Mautic <a href="https://www.mautic.org/about/governance">Governance</a> page.</p>

<p>The code should try to follow <a href="http://symfony.com/doc/current/contributing/code/standards.html">Symfony&rsquo;s Coding Standards</a></p>

<h2 id="symfony">Symfony</h2>

<p>Mautic is built on <a href="http://symfony.com">Symfony</a>, the popular PHP framework (Mautic 1.0.x uses Symfony version 2.5). This document will go over the basics but most of <a href="http://symfony.com/doc/2.5/book/index.html">their documentation</a> applies to Mautic as well which can be used to obtain more advanced Symfony functionality.</p>

<p>There are some structural differences between Mautic and standard Symfony. Below is a list of where you will find some of standard Symfony locations in Mautic:</p>

<table><thead>
<tr>
<th>Symfony</th>
<th>Mautic</th>
</tr>
</thead><tbody>
<tr>
<td>src/</td>
<td>app/bundles (Mautic core) or addons/ (Mautic addons)</td>
</tr>
<tr>
<td>web/</td>
<td>/</td>
</tr>
<tr>
<td>AcmeBundle/Resources/config</td>
<td>AcmeBundle/Config</td>
</tr>
<tr>
<td>AcmeBundle/Resources/views</td>
<td>AcmeBundle/Views</td>
</tr>
<tr>
<td>AcmeBundle/Resources/public</td>
<td>AcmeBundle/Assets</td>
</tr>
<tr>
<td>AcmeBundle/Resources/translations/domain.en_US.ini</td>
<td>AcmeBundle/Translations/en_US/domain.ini</td>
</tr>
</tbody></table>

<p>Most of Symfony&rsquo;s standard locations, such as the Resources/views and Resources/translations directories, should still function with Mautic. However, it may be required to handle service registration, etc with native Symfony processes if not using the Mautic methods defined in this document. </p>

<h2 id="development-environment">Development Environment</h2>

<h3 id="setup">Setup</h3>

<p>It is assumed that the system already has <a href="https://getcomposer.org">composer</a> and <a href="http://git-scm.com">git</a> installed and configured.</p>

<p>To setup the developer environment, simply fork and clone the source from <a href="https://github.com/mautic/mautic">GitHub</a>. Then Run <code class="prettyprint">composer install</code> on the source. </p>

<p>Open your browser and complete the installation through the Mautic installer.</p>

<h3 id="environments">Environments</h3>

<p>There are three environments in Mautic: prod, dev, and test.</p>

<p><strong>prod</strong> is used when accessing the site through index.php.</p>

<p><strong>dev</strong> is used when accessing the site through index_dev.php. Using Mautic in the dev environment will activate Symfony&rsquo;s profiler toolbar, has more strict error handling, will display information about exceptions, and will not cache as much (see below). Note that steps should be taken to ensure index_dev.php is not accessible to the public as it could potentially reveal sensitive information. It is restricted to localhost by default.</p>

<p><strong>test</strong> is used mainly for PHP Unit Tests.</p>

<h3 id="cache">Cache</h3>

<p>Symfony makes heavy use of a filesystem cache. Frequently clearing this cache will be required when developing for Mautic. By default, the cache is located in app/cache/ENV where ENV is the environment currently accessed (i.e. dev or prod). To rebuild the cache, the ENV can just be deleted or run the Symfony command <code class="prettyprint">php app/console cache:clear --env=ENV</code> If a specific environment is not passed to the command via <code class="prettyprint">--env=ENV</code>, the dev environment will be used by default.</p>

<p>In the dev environment, translations, views, and assets are not cached. However, changes to these files will require the cache to be cleared for them to take effect in the prod environment. Changes to Mautic config files, Symfony config files, etc will require the cache to be cleared regardless of environment.</p>

<p><aside class="notice">
 The typical rule of thumb is, if Mautic is not acting as you expect after making changes, try clearing your cache.
 </aside></p>

<p><aside class="warning">
 If you get class could not be found or cannot redeclare class errors when using the cache:clear command, manually delete the app/cache/ENV folder then run the command and/or browse to the site to rebuild.
 </aside></p>

          <h1 id="addons">Addons</h1>

<p>Addons are bundles that can extend the functionality of Mautic. They can be very simple or very complex and have access to leverage pretty much all that Symfony offers. Just as as reminder, the basics are covered in this document. If more advanced processes are required, the <a href="http://symfony.com/doc/2.5/book/index.html">Symfony book</a> and <a href="http://symfony.com/doc/2.5/cookbook/index.html">cookbook</a> will be valuable resources.</p>

<aside class="notice">
Mautic addons are located in the addons/ directory and must be namespaced with MauticAddons.
 </aside>

          <h2 id="addon-directory-structure">Addon Directory Structure</h2>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="c1">// addons/HelloWorldBundle/HelloWorldBundle.php
</span>
<span class="k">namespace</span> <span class="nx">MauticAddon\HelloWorldBundle</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Mautic\AddonBundle\Bundle\AddonBundleBase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">HelloWorldBundle</span> <span class="k">extends</span> <span class="nx">AddonBundleBase</span>
<span class="p">{</span>
    <span class="c1">// Nothing more required
</span><span class="p">}</span>

</code></pre>

<p>The directory structure of an addon will vary based on the features implemented. </p>

<p>At a minimum, the following structure is required:</p>

<p>HelloWorldBundle/<br />
- - - Config/<br />
- - - - - config.php<br />
- - - HelloWorldBundle.php</p>

<p>Read more about the <a href="#addon-config-file">config file</a>.</p>

<p>The HelloWorldBundle.php file registers the bundle with Symfony. See the code block for the minimum required code.</p>

<p>A typical MVC addon may look something like:</p>

<p>HelloWorldBundle/<br />
- - - <a href="#asset-helper">Assets/</a><br />
- - - - - - images/
- - - - - - - - - earth.png
- - - - - - - - - mars.png
- - - - - - helloworld.js<br />
- - - - - - helloworld.css<br />
- - - <a href="#addon-config-file">Config/</a><br />
- - - - - - config.php<br />
- - - <a href="#controllers">Controller/</a><br />
- - - - - - DefaultController.php<br />
- - - <a href="#models">Model/</a><br />
- - - - - - ContactModel.php<br />
- - - - - - WorldModel.php<br />
- - - <a href="#translations">Translations/</a>/<br />
- - - - - - en_US/<br />
- - - - - - - - - flashes.ini<br />
- - - - - - - - - messages.ini<br />
- - - <a href="#views">Views/</a><br />
- - - - - - Contact/<br />
- - - - - - - - - form.html.php<br />
- - - - - - World/<br />
- - - - - - - - - index.html.php<br />
- - - - - - - - - list.html.php<br />
- - - HelloWorldBundle.php</p>

<p>Each of the other directories and files are explained elsewhere in the document. </p>

          <h2 id="install/upgrade">Install/Upgrade</h2>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="c1">// addons/HelloWorldBundle/HelloWorldBundle.php
</span>
<span class="k">namespace</span> <span class="nx">MauticAddon\HelloWorldBundle</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Mautic\AddonBundle\Bundle\AddonBundleBase</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Mautic\AddonBundle\Entity\Addon</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Mautic\CoreBundle\Factory\MauticFactory</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">HelloWorldBundle</span> <span class="k">extends</span> <span class="nx">AddonBundleBase</span>
<span class="p">{</span>

    <span class="sd">/**
     * Called by AddonController::reloadAction when adding a new addon that's not already installed
     *
     * @param MauticFactory $factory
     */</span>
    <span class="k">static</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">onInstall</span><span class="p">(</span><span class="nx">MauticFactory</span> <span class="nv">$factory</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Execute install stuff such as installing database schema
</span>    <span class="p">}</span>

    <span class="sd">/**
     * Called by AddonController::reloadAction when the addon version does not match what's installed
     *
     * @param Addon         $addon
     * @param MauticFactory $factory
     */</span>
    <span class="k">static</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">onUpdate</span><span class="p">(</span><span class="nx">Addon</span> <span class="nv">$addon</span><span class="p">,</span> <span class="nx">MauticFactory</span> <span class="nv">$factory</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Execute update stuff such as upgrading the database schema
</span>        <span class="c1">// $addon is the Addon entity with details of what was installed previously
</span>    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>Currently, addons are installed by uploading the addon to the addons folder. Then, the admin must click the Install/Upgrade Addons button. When that happens, new addons found will have the static method <code class="prettyprint">onInstall()</code> called from the <a href="#addon-directory-structure">addon&rsquo;s bundle file</a>. If the addon has already been installed, and the version has changed, then <code class="prettyprint">onUpdate()</code> is called.</p>

          <h2 id="addon-config-file">Addon Config File</h2>

<p>Mautic leverages a simple array config file that will register routes, menu items, services and custom configuration parameters.</p>

<h3 id="general">General</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="c1">// addons/HelloWorldBundle/Config/config.php
</span>
<span class="k">return</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">'name'</span>        <span class="o">=&gt;</span> <span class="s1">'Hello World'</span><span class="p">,</span>
    <span class="s1">'description'</span> <span class="o">=&gt;</span> <span class="s1">'This is an example config file for a simple Hellow World addon.'</span><span class="p">,</span>
    <span class="s1">'author'</span>      <span class="o">=&gt;</span> <span class="s1">'Marty Mautibot'</span><span class="p">,</span>
    <span class="s1">'version'</span>     <span class="o">=&gt;</span> <span class="s1">'1.0.0'</span><span class="p">,</span>
</code></pre>

<p>The general config options will define what should be listed in the Addon manager.</p>

<p>The version should be &ldquo;<a href="http://php.net/manual/en/function.version-compare.php">PHP-standardized</a>&rdquo; as the Addon manager will use version_compare() to determine if the <a href="#update">onUpdate callback</a> should be executed.  </p>

<h3 id="routes">Routes</h3>

<blockquote>
<p>If copying, do not copy <code class="prettyprint">&lt;?php //continued</code> as it is simply used to force sytax highlighting.</p>
</blockquote>
<pre><code class="highlight php"><span class="cp">&lt;?php</span> <span class="c1">// continued
</span>
    <span class="s1">'routes'</span>   <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">'main'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">'addon_helloworld_world'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">'path'</span>       <span class="o">=&gt;</span> <span class="s1">'/hello/{world}'</span><span class="p">,</span>
                <span class="s1">'controller'</span> <span class="o">=&gt;</span> <span class="s1">'HelloWorldBundle:Default:world'</span><span class="p">,</span>
                <span class="s1">'defaults'</span>    <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                    <span class="s1">'world'</span> <span class="o">=&gt;</span> <span class="s1">'earth'</span>
                <span class="p">),</span>
                <span class="s1">'requirements'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                    <span class="s1">'world'</span> <span class="o">=&gt;</span> <span class="s1">'earth|mars'</span>
                <span class="p">)</span>
            <span class="p">),</span>
            <span class="s1">'addon_helloworld_list'</span>  <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">'path'</span>       <span class="o">=&gt;</span> <span class="s1">'/hello/{page}'</span><span class="p">,</span>
                <span class="s1">'controller'</span> <span class="o">=&gt;</span> <span class="s1">'HelloWorldBundle:Default:index'</span>
             <span class="p">),</span>
            <span class="s1">'addon_helloworld_admin'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">'path'</span>       <span class="o">=&gt;</span> <span class="s1">'/hello/admin'</span><span class="p">,</span>
                <span class="s1">'controller'</span> <span class="o">=&gt;</span> <span class="s1">'HelloWorldBundle:Default:admin'</span>
            <span class="p">),</span>
        <span class="p">),</span>
        <span class="s1">'public'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">'addon_helloworld_goodbye'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">'path'</span>       <span class="o">=&gt;</span> <span class="s1">'/hello/goodbye'</span><span class="p">,</span>
                <span class="s1">'controller'</span> <span class="o">=&gt;</span> <span class="s1">'HelloWorldBundle:Default:goodbye'</span>
            <span class="p">),</span>
            <span class="s1">'addon_helloworld_contact'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">'path'</span>       <span class="o">=&gt;</span> <span class="s1">'/hello/contact'</span><span class="p">,</span>
                <span class="s1">'controller'</span> <span class="o">=&gt;</span> <span class="s1">'HelloWorldBundle:Default:contact'</span>
            <span class="p">)</span>
        <span class="p">),</span>
        <span class="s1">'api'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">'addon_helloworld_api'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">'path'</span>       <span class="o">=&gt;</span> <span class="s1">'/hello'</span><span class="p">,</span>
                <span class="s1">'controller'</span> <span class="o">=&gt;</span> <span class="s1">'HelloWorldBundle:Api:howdy'</span><span class="p">,</span>
                <span class="s1">'method'</span>     <span class="o">=&gt;</span> <span class="s1">'GET'</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="p">),</span>
</code></pre>

<p>Routes define the URL paths that will be used to execute the addon&rsquo;s controller actions. See <a href="#routing">Routing</a> for specifics on how routes work.</p>

<h4 id="firewalls">Firewalls</h4>

<p>There are three firewalls to define the routes behind.</p>

<table><thead>
<tr>
<th>Firewall</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>main</strong></td>
<td>Secure area of Mautic (/s/ will be auto prepended to the path). The user will be required to login to access this path.</td>
</tr>
<tr>
<td><strong>public</strong></td>
<td>Public access without needing authentication. The URL will be appended directly to Mautic&rsquo;s base URL.</td>
</tr>
<tr>
<td><strong>api</strong></td>
<td>Secure API area of Mautic (/api/ will be auto prepended to the path). OAuth authorization will be required to access the path.</td>
</tr>
</tbody></table>

<p>Each firewall accepts an array of defined routes. Each key, the route&rsquo;s name, must be unique across all bundles and firewalls. Paths must be unique across the same firewall.  <strong>Order does matter</strong> as the first matching route will be used.</p>

<h4 id="route-definitions">Route definitions</h4>

<table><thead>
<tr>
<th>Array Key</th>
<th>Required</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>path</strong></td>
<td>REQUIRED</td>
<td>string</td>
<td>Defines the path for the URL. Placeholders can be defined using curly brackets. Parameters are passed into the controller function as arguments.</td>
</tr>
<tr>
<td><strong>controller</strong></td>
<td>REQUIRED</td>
<td>string</td>
<td>Defines the controller and function to call when the path is accessed. This should be in Symfony&rsquo;s controller notation of BundleName:ControllerClass:controllerMethod. See <a href="#controllers">Controllers</a> for more information.</td>
</tr>
<tr>
<td><strong>method</strong></td>
<td>OPTIONAL</td>
<td>string</td>
<td>Restricts the route to a specific method, i.e. GET, POST, etc</td>
</tr>
<tr>
<td><strong>defaults</strong></td>
<td>OPTIONAL</td>
<td>array</td>
<td>Defines default values for path placeholders. If a default is defined, it is not required in the URL. In the code example, /hello will be the same as /hello/earth and the controller&rsquo;s $world argument will default to &lsquo;earth&rsquo; as well.</td>
</tr>
<tr>
<td><strong>requirements</strong></td>
<td>OPTIONAL</td>
<td>array</td>
<td>Defines regex matches placeholders must match in order for the route to be recognized. For example, for addon_helloworld_world in the code example, world is restricted to earth or mars.  Anything else will not be recognized by the route.</td>
</tr>
<tr>
<td><strong>format</strong></td>
<td>OPTIONAL</td>
<td>string</td>
<td>Sets the request format for the Request response, i.e. Content-Type header. The api firewall will automatically set this to json.</td>
</tr>
<tr>
<td><strong>condition</strong></td>
<td>OPTIONAL</td>
<td>string</td>
<td>Very flexible expression to set when the route should match. Refer to <a href="http://symfony.com/doc/2.5/book/routing.html#completely-customized-route-matching-with-conditions">Symfony docs</a>.</td>
</tr>
</tbody></table>

<p>Note that there are some internally used placeholders that Mautic will set defaults and requirements for (if not overridden by the route)</p>

<p>{page} will default to 1 with a requirement of \d+</p>

<p>{objectId} will default to 0 </p>

<p>{id} will have a requirement of \d+ if under the api firewall</p>

<aside class="notice">
Each route&rsquo;s name must be unique across all bundles and firewalls and paths must be unique with the same firewall.
</aside>

<aside class="notice">
Order does matter.  The first route the path matches will be used.
</aside>

<p><strong>Debugging Routes</strong>
There are a few CLI commands that make help with debugging routes.</p>

<pre class="inline">
php app/console router:debug
</pre>

<pre class="inline">
php app/console router:debug article_show
</pre>

<pre class="inline">
php app/console router:match /blog/my-latest-post
</pre>

<h3 id="menu">Menu</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span> <span class="c1">// continued
</span>
    <span class="s1">'menu'</span>     <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">'main'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">'priority'</span> <span class="o">=&gt;</span> <span class="mi">4</span><span class="p">,</span>
            <span class="s1">'items'</span>    <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">'addon.helloworld.index'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                    <span class="s1">'id'</span>        <span class="o">=&gt;</span> <span class="s1">'addon_helloworld_index'</span><span class="p">,</span>
                    <span class="s1">'iconClass'</span> <span class="o">=&gt;</span> <span class="s1">'fa-globe'</span><span class="p">,</span>
                    <span class="s1">'access'</span>    <span class="o">=&gt;</span> <span class="s1">'addon:helloworld:worlds:view'</span><span class="p">,</span>
                    <span class="s1">'children'</span>  <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                        <span class="s1">'addon.helloworld.manage_worlds'</span>     <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                            <span class="s1">'route'</span> <span class="o">=&gt;</span> <span class="s1">'addon_helloworld_list'</span>
                        <span class="p">),</span>
                        <span class="s1">'mautic.category.menu.index'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                            <span class="s1">'bundle'</span> <span class="o">=&gt;</span> <span class="s1">'addon:helloWorld'</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="s1">'admin'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">'addon.helloworld.admin'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">'route'</span>     <span class="o">=&gt;</span> <span class="s1">'addon_helloworld_admin'</span><span class="p">,</span>
                <span class="s1">'iconClass'</span> <span class="o">=&gt;</span> <span class="s1">'fa-gears'</span><span class="p">,</span>
                <span class="s1">'access'</span>    <span class="o">=&gt;</span> <span class="s1">'admin'</span><span class="p">,</span>
                <span class="s1">'checks'</span>    <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                    <span class="s1">'parameters'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                        <span class="s1">'helloworld_api_enabled'</span> <span class="o">=&gt;</span> <span class="kc">true</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="p">),</span>
</code></pre>

<p>Menu defines the menu items to display in the main left menu and/or admin menu.</p>

<p>The main and admin arrays are configured exactly the same.</p>

<h4 id="priority">Priority</h4>

<p>To control the placement of the menu items, set an array with &#39;priority&rsquo; and &#39;items&rsquo; keys. Priority can be negative to position the items lower than others or positive to position them higher. If the menu items are returned without setting priority, like the admin menu in the code example, priority is treated as 9999.</p>

<h4 id="items">Items</h4>

<p>The menu item&rsquo;s name should be the <a href="#translations">language string key</a> that will be displayed as the item&rsquo;s link. </p>

<p>Item definitions:</p>

<table><thead>
<tr>
<th>Array Key</th>
<th>Required</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>route</strong></td>
<td>OPTIONAL</td>
<td>string</td>
<td>The route name as defined in <a href="#routes">routes</a>. Do not set a route to treat the item as a parent to activate a submenu.</td>
</tr>
<tr>
<td><strong>routeParameters</strong></td>
<td>OPTIONAL</td>
<td>array</td>
<td>Route placeholder values to use when generating the URL</td>
</tr>
<tr>
<td><strong>id</strong></td>
<td>OPTIONAL</td>
<td>string</td>
<td>Sets the id of the &lt;a /&gt; attribute. This will default to what is set as route.</td>
</tr>
<tr>
<td><strong>iconClass</strong></td>
<td>OPTIONAL</td>
<td>string</td>
<td>Font Awesome class to set the icon for the menu item.</td>
</tr>
<tr>
<td><strong>access</strong></td>
<td>OPTIONAL</td>
<td>string</td>
<td>Set the <a href="#security">permission</a> required for this item to display to the user currently logged in. Can also set &#39;admin&rsquo; to restrict to Administrators only.</td>
</tr>
<tr>
<td><strong>checks</strong></td>
<td>OPTIONAL</td>
<td>array</td>
<td>Restricts display of the link based on either configured parameters or the GET request. It will accept a &#39;parameters&rsquo; and/or &#39;request&rsquo; array of key =&gt; value pairs that must be true to display the menu item.</td>
</tr>
<tr>
<td><strong>bundle</strong></td>
<td>OPTIONAL</td>
<td>string</td>
<td>Required only for <a href="#categories">category integration</a>.</td>
</tr>
</tbody></table>

<h3 id="services">Services</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span> <span class="c1">// continued 
</span>
    <span class="s1">'services'</span>    <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">'events'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">'addon.helloworld.leadbundle.subscriber'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">'class'</span> <span class="o">=&gt;</span> <span class="s1">'MauticAddon\HelloWorldBundle\EventListener\LeadSubscriber'</span>
            <span class="p">)</span>
        <span class="p">),</span>
        <span class="s1">'forms'</span>  <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">'addon.helloworld.form'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">'class'</span> <span class="o">=&gt;</span> <span class="s1">'MauticAddon\HelloWorldBundle\Form\Type\HelloWorldType'</span><span class="p">,</span>
                <span class="s1">'alias'</span> <span class="o">=&gt;</span> <span class="s1">'helloworld'</span>
            <span class="p">)</span>
        <span class="p">),</span>
        <span class="s1">'helpers'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">'mautic.helper.helloworld'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">'class'</span>     <span class="o">=&gt;</span> <span class="s1">'MauticAddon\HelloWorldBundle\Helper\HelloWorldHelper'</span><span class="p">,</span>
                <span class="s1">'arguments'</span> <span class="o">=&gt;</span> <span class="s1">'mautic.factory'</span><span class="p">,</span>
                <span class="s1">'alias'</span>     <span class="o">=&gt;</span> <span class="s1">'helloworld'</span>
            <span class="p">)</span>
        <span class="p">),</span>
        <span class="s1">'other'</span>   <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">'addon.helloworld.mars.validator'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">'class'</span>     <span class="o">=&gt;</span> <span class="s1">'MauticAddon\HelloWorldBundle\Form\Validator\Constraints\MarsValidator'</span><span class="p">,</span>
                <span class="s1">'arguments'</span> <span class="o">=&gt;</span> <span class="s1">'mautic.factory'</span><span class="p">,</span>
                <span class="s1">'tag'</span>       <span class="o">=&gt;</span> <span class="s1">'validator.constraint_validator'</span><span class="p">,</span>
                <span class="s1">'alias'</span>     <span class="o">=&gt;</span> <span class="s1">'helloworld_mars'</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="p">),</span>

</code></pre>

<p>Services are PHP objects stored in the service container and are used all throughout Mautic. They can be as simple or as complex as required. Read more about Symfony&rsquo;s service container <a href="http://symfony.com/doc/2.5/book/service_container.html">here</a>. </p>

<h4 id="service-types">Service types</h4>

<p>Mautic allows easy configuration for four types of services:</p>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>events</strong></td>
<td>Defines event subscriber classes used to listen to events dispatched throughout Mautic and auto-tagged with &#39;kernel.event_subscriber.&rsquo; The defined class must extend \Mautic\CoreBundle\EventListener\CommonSubscriber. Read more about subscribers <a href="#subscribers">here</a>.</td>
</tr>
<tr>
<td><strong>forms</strong></td>
<td>Defines custom <a href="#forms">form types</a> and auto-tagged with &#39;form.type.&rsquo;</td>
</tr>
<tr>
<td><strong>helpers</strong></td>
<td>Defines custom template helpers available through the $view variable in <a href="#views">views</a>. These services are auto-tagged with &#39;templating.helper.&rsquo;</td>
</tr>
<tr>
<td><strong>other</strong></td>
<td>All other custom services.</td>
</tr>
</tbody></table>

<h4 id="service-definitions">Service definitions</h4>

<p>Each key within the service types array is the name of the service and must be unique. Use the following to define the service:</p>

<table><thead>
<tr>
<th>Array Key</th>
<th>Required</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>class</strong></td>
<td>REQUIRED</td>
<td>string</td>
<td>Namespace to the service class (not that it does not start with a backslash)</td>
</tr>
<tr>
<td><strong>arguments</strong></td>
<td>OPTIONAL</td>
<td>string or array</td>
<td>String of a single argument to pass to the construct or an array of arguments to pass. Arguments enclosed with %% will be treated as a <a href="#parameters">parameter</a>. To pass a specific string, enclose the argument with double quotations &ldquo;&rdquo;. Anything else that is not a boolean or a namespaced class (string with \ in it) will be treated as the name of another registered service. Often, this will simply be <a href="#factory-service">mautic.factory</a>.</td>
</tr>
<tr>
<td><strong>alias</strong></td>
<td>OPTIONAL</td>
<td>string</td>
<td>Sets the alias used by the service. For example, the key for the template helpers, $view, array or the string to retrieve a specific form type.</td>
</tr>
<tr>
<td><strong>tag</strong></td>
<td>OPTIONAL</td>
<td>string</td>
<td><a href="http://symfony.com/doc/2.5/components/dependency_injection/tags.html">Tags</a> the service used by bundles to get a list of specific services (for example form types and event subscribers).</td>
</tr>
<tr>
<td><strong>tags</strong></td>
<td>OPTIONAL</td>
<td>array</td>
<td>Array of of tags</td>
</tr>
<tr>
<td><strong>tagArguments</strong></td>
<td>OPTIONAL</td>
<td>array</td>
<td>Array of attributes for the tag. See <a href="http://symfony.com/doc/2.5/components/dependency_injection/tags.html#adding-additional-attributes-on-tags">Symfony docs</a> for more information.</td>
</tr>
<tr>
<td><strong>scope</strong></td>
<td>OPTIONAL</td>
<td>string</td>
<td>Defines the <a href="http://symfony.com/doc/2.5/cookbook/service_container/scopes.html">service scope</a></td>
</tr>
<tr>
<td><strong>factoryService</strong></td>
<td>OPTIONAL</td>
<td>string</td>
<td><a href="http://symfony.com/doc/2.5/components/dependency_injection/factories.html">Factory class</a> for managing creating the service</td>
</tr>
<tr>
<td><strong>factoryMethod</strong></td>
<td>OPTIONAL</td>
<td>string</td>
<td>Method name in the <a href="http://symfony.com/doc/2.5/components/dependency_injection/factories.html">factory service</a> called to create the service</td>
</tr>
<tr>
<td><strong>methodCalls</strong></td>
<td>OPTIONAL</td>
<td>array</td>
<td>Array of methods to be called after a service is created passing in the array of arguments provided. Should be in the format of &#39;methodName&rsquo; =&gt; array(&#39;service_name&rsquo;, &rsquo;%parameter%&rsquo;)</td>
</tr>
</tbody></table>

<h3 id="parameters">Parameters</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span> <span class="c1">// continued
</span>
    <span class="s1">'parameters'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">'helloworld_api_enabled'</span> <span class="o">=&gt;</span> <span class="kc">false</span>
    <span class="p">)</span>
<span class="p">);</span>
</code></pre>

<p>The parameters array define and set default values for <a href="#custom-config-params">custom configuration parameters</a> specific to the addon. </p>

<aside class="notice">
Any parameter to be written to the system&rsquo;s local config file should be defined here.
</aside>

          <h2 id="translations">Translations</h2>

<p>Mautic uses INI files for translations.</p>

<p>HelloWorldBundle/<br />
- - - Translations/<br />
- - - - - - en_US/<br />
- - - - - - - - - messages.ini</p>

<aside class="notice">
All addons should include strings for the United States English locale (en_US) as it is the default for the system. 
</aside>

<p>The directory structure for translations should be <code class="prettyprint">Translations/locale/domain.ini</code>.</p>

<h3 id="domains">Domains</h3>

<p>Language strings can be organized into domains. Each domain should be its own file in the addon&rsquo;s language locale folder(s). The addon can use any domain it wants but Mautic makes consistent use of three domains:</p>

<table><thead>
<tr>
<th>Domain</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>messages</td>
<td>Default domain for the translator service when no domain is specified</td>
</tr>
<tr>
<td>flashes</td>
<td>Domain for <a href="#flash-messages">flash messages</a></td>
</tr>
<tr>
<td>validators</td>
<td>Domain for <a href="#validation">form validation</a> messages</td>
</tr>
</tbody></table>

<h3 id="ini-files">INI files</h3>

<blockquote>
<p>Sample INI files</p>
</blockquote>
<pre><code class="highlight plaintext">; addons/HelloWorldBundle/Translations/en_US/messages.ini

addon.helloworld.contact_us="Contact Us"
addon.helloworld.goodbye="Goodbye and have a good day!"
addon.helloworld.greeting="Hello %name%!"
addon.helloworld.index="Hello World"
addon.helloworld.manage_worlds="Manage Worlds"
addon.helloworld.number_of_planets="{0}0 planets|{1}1 planet|]1,Inf[%planets% planets"
addon.helloworld.world="World"
addon.helloworld.worlds="%world% Description"
</code></pre>
<pre><code class="highlight plaintext">; addons/HelloWorldBundle/Translations/en_US/flashes.ini

addon.helloworld.notice.thank_you="Thank you %name% for your interest! We will be in contact soon." 
addon.helloworld.notice.planet_demoted="%planet% has been demoted to a dwarf planet." 
addon.helloworld.error.planet_demotion_failed="%planet% could not be demoted because the scientists say so."
</code></pre>

<p>General guidelines for the translation keys:</p>

<ol>
<li>Segment the key using a period</li>
<li>Use underscores to separate words</li>
<li>Must be unique</li>
<li>Be short yet descriptive</li>
<li>Use all lowercase letters and numbers (no punctuation in the key other than period or underscore)</li>
</ol>

<p>Guidelines for translation strings:</p>

<ol>
<li>Wrap placeholders with %%</li>
<li>Use a single key for duplicate translation strings.</li>
<li>Use &ldquo; for double quotes</li>
<li>HTML is allowed</li>
</ol>

<h3 id="using-the-translator">Using the translator</h3>

<p>Refer to the <a href="#translator">translator service</a> to learn how to use translations in the code.</p>

          <h2 id="mvc">MVC</h2>

<p>Mautic uses a Model-View-Controller structure to manage user interaction on the frontend (views) with the underlying code processes (controllers and models). (<a href="#database">Entity and Repository classes</a> are also used to manage interaction with the database).</p>

<p>In Symfony, and thus Mautic, the controller is the center of the MVC structure. The route requested by the user determines the controller method to call. The controller will then communicate with the model to get or manipulate data then display it to the user through the view.</p>

          <h3 id="controllers">Controllers</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="c1">// addons/HelloWorldBundle/Controller/DefaultController.php
</span>
<span class="k">namespace</span> <span class="nx">MauticAddons\HelloWorldBundle\Controller</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Mautic\CoreBundle\Controller\FormController</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">DefaultController</span> <span class="k">extends</span> <span class="nx">FormController</span>
<span class="p">{</span>
    <span class="sd">/**
     * Display the world view
     *
     * @param string $world
     *
     * @return JsonResponse|\Symfony\Component\HttpFoundation\Response
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">worldAction</span><span class="p">(</span><span class="nv">$world</span> <span class="o">=</span> <span class="s1">'earth'</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="sd">/** @var \MauticAddon\HelloBundleBundle\Model\WorldModel $model */</span>
        <span class="nv">$model</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">factory</span><span class="o">-&gt;</span><span class="na">getModel</span><span class="p">(</span><span class="s1">'addon.helloWorld.world'</span><span class="p">);</span>

        <span class="c1">// Retrieve details about the world
</span>        <span class="nv">$worldDetails</span> <span class="o">=</span> <span class="nv">$model</span><span class="o">-&gt;</span><span class="na">getWorldDetails</span><span class="p">(</span><span class="nv">$world</span><span class="p">);</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">delegateView</span><span class="p">(</span>
            <span class="k">array</span><span class="p">(</span>
                <span class="s1">'viewParameters'</span>  <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                    <span class="s1">'world'</span>   <span class="o">=&gt;</span> <span class="nv">$world</span><span class="p">,</span>
                    <span class="s1">'details'</span> <span class="o">=&gt;</span> <span class="nv">$worldDetails</span>
                <span class="p">),</span>
                <span class="s1">'contentTemplate'</span> <span class="o">=&gt;</span> <span class="s1">'HelloWorldBundle:World:details.html.php'</span><span class="p">,</span>
                <span class="s1">'passthroughVars'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                    <span class="s1">'activeLink'</span>    <span class="o">=&gt;</span> <span class="s1">'addon_helloworld_world'</span><span class="p">,</span>
                    <span class="s1">'route'</span>         <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">generateUrl</span><span class="p">(</span><span class="s1">'addon_helloworld_world'</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'world'</span> <span class="o">=&gt;</span> <span class="nv">$world</span><span class="p">)),</span>
                    <span class="s1">'mauticContent'</span> <span class="o">=&gt;</span> <span class="s1">'helloWorldDetails'</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**
     * Contact form
     *
     * @return JsonResponse|\Symfony\Component\HttpFoundation\Response
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">contactAction</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// Create the form object
</span>        <span class="nv">$form</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'form.factory'</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">(</span><span class="s1">'helloworld_contact'</span><span class="p">);</span>

        <span class="c1">// Handle form submission if POST        
</span>        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">getMethod</span><span class="p">()</span> <span class="o">==</span> <span class="s1">'POST'</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$flashes</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>

            <span class="c1">// isFormCancelled() checks if the cancel button was clicked
</span>            <span class="k">if</span> <span class="p">(</span><span class="nv">$cancelled</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">isFormCancelled</span><span class="p">(</span><span class="nv">$form</span><span class="p">))</span> <span class="p">{</span>

                <span class="c1">// isFormValid() will bind the request to the form object and validate the data
</span>                <span class="k">if</span> <span class="p">(</span><span class="nv">$valid</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">isFormValid</span><span class="p">(</span><span class="nv">$form</span><span class="p">))</span> <span class="p">{</span>

                    <span class="sd">/** @var \MauticAddon\HelloBundleBundle\Model\ContactModel $model */</span>
                    <span class="nv">$model</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">factory</span><span class="o">-&gt;</span><span class="na">getModel</span><span class="p">(</span><span class="s1">'addon.helloWorld.contact'</span><span class="p">);</span>

                    <span class="c1">// Send the email
</span>                    <span class="nv">$model</span><span class="o">-&gt;</span><span class="na">sendContactEmail</span><span class="p">(</span><span class="nv">$form</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">());</span>

                    <span class="c1">// Set success flash message
</span>                    <span class="nv">$flashes</span><span class="p">[]</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
                        <span class="s1">'type'</span>    <span class="o">=&gt;</span> <span class="s1">'notice'</span><span class="p">,</span>
                        <span class="s1">'msg'</span>     <span class="o">=&gt;</span> <span class="s1">'addon.helloworld.notice.thank_you'</span><span class="p">,</span>
                        <span class="s1">'msgVars'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                            <span class="s1">'%name%'</span> <span class="o">=&gt;</span> <span class="nv">$form</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">()</span>
                        <span class="p">)</span>
                    <span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="nv">$cancelled</span> <span class="o">||</span> <span class="nv">$valid</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// Redirect to /hello/world
</span>
                <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">postActionRedirect</span><span class="p">(</span>
                    <span class="k">array</span><span class="p">(</span>
                        <span class="s1">'returnUrl'</span>       <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">generateUrl</span><span class="p">(</span><span class="s1">'addon_helloworld_world'</span><span class="p">),</span>
                        <span class="s1">'contentTemplate'</span> <span class="o">=&gt;</span> <span class="s1">'HelloWorldBundle:Default:world'</span><span class="p">,</span>
                        <span class="s1">'flashes'</span>         <span class="o">=&gt;</span> <span class="nv">$flashes</span>
                    <span class="p">)</span>
                <span class="p">);</span>
            <span class="p">}</span> <span class="c1">// Otherwise show the form again with validation error messages
</span>        <span class="p">}</span>

        <span class="c1">// Display the form
</span>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">delegateView</span><span class="p">(</span>
            <span class="k">array</span><span class="p">(</span>
                <span class="s1">'viewParameters'</span>  <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                    <span class="s1">'form'</span> <span class="o">=&gt;</span> <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">createView</span><span class="p">()</span>
                <span class="p">),</span>
                <span class="s1">'contentTemplate'</span> <span class="o">=&gt;</span> <span class="s1">'HelloWorldBundle:Contact:form.html.php'</span><span class="p">,</span>
                <span class="s1">'passthroughVars'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                    <span class="s1">'activeLink'</span> <span class="o">=&gt;</span> <span class="s1">'addon_helloworld_contact'</span><span class="p">,</span>
                    <span class="s1">'route'</span>      <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">generateUrl</span><span class="p">(</span><span class="s1">'addon_helloworld_contact'</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<h4 id="matching-routes-to-controller-methods">Matching Routes to Controller Methods</h4>

<p>The controller method called is determined by the <a href="#routes">route defined in the config</a>. Take this example,</p>

<pre class="inline">
addon_helloworld_admin' => array(
    'path'       => '/hello/admin',
    'controller' => 'HelloWorldBundle:Default:admin'
 ),
</pre>

<p>The controller is noted as <code class="prettyprint">HelloWorldBundle:Default:admin</code>. Broken down, that will translate to:</p>

<table>
<tr>
    <td>HelloWorldBundle</td>
    <td>\MauticAddons\HelloWorldBundle\Controller</td>
</tr>
<tr>
    <td>Default</td>
     <td>DefaultController</td>
<tr>
<tr>
    <td>admin</td>
    <td>adminAction()</td>
</tr>
</table>

<aside class="notice">
Controller notation is in the format of <code>BundleName:ControllerName:controllerMethod</code>. To use a controller within a subfolder of Controller, use <code>BundleName:Subdirectory\ControllerName:controllerMethod</code>.
</aside>

<p>Thus when a browser calls up <code class="prettyprint">/hello/admin</code>, <code class="prettyprint">\MauticAddons\HelloWorldBundle\Controller\DefaultController\adminAction()</code> will be called.</p>

<p>What about route placeholders? Symfony is super smart and will pass those into the controller&rsquo;s method as arguments (the method&rsquo;s arguments must be the same as the route&rsquo;s placeholders to be matched up).</p>

<pre class="inline">
'addon_helloworld_world' => array(
    'path'       => '/hello/{world}',
    'controller' => 'HelloWorldBundle:Default:world',
    'defaults'    => array(
        'world' => 'earth'
    ),
    'requirements' => array(
        'world' => 'earth|mars'
    )
),
</pre>

<p>The matching method for that route will look be <code class="prettyprint">public function worldAction($world = &#39;earth&#39;)</code>.</p>

<p>Notice that because the route defines a default for <code class="prettyprint">name</code>, the controller method must also set the same default. If the route looked like this instead:</p>

<pre class="inline">
'addon_helloworld_world' => array(
    'path'       => '/hello/{world}',
    'controller' => 'HelloWorldBundle:Default:world',
    'requirements' => array(
        'world' => 'earth|mars'
    )
),
</pre>

<p>Then the method would need to be <code class="prettyprint">public function worldAction($world)</code>.</p>

<h4 id="extending-mautic&#39;s-controllers">Extending Mautic&rsquo;s Controllers</h4>

<p>Mautic has several controllers that provide some helper functions.</p>

<h5 id="mautic\corebundle\controller\commoncontroller">Mautic\CoreBundle\Controller\CommonController</h5>

<p>Controllers extending this will make <a href="#factory-service">MauticFactory</a> available via <code class="prettyprint">$this-&gt;factory</code> and <a href="#request">Request</a> via <code class="prettyprint">$this-&gt;request</code>. </p>

<p>It also provides the following helper methods:</p>

<h6 id="delegateview($args)">delegateView($args)</h6>

<p>Mautic is ajax driven and thus must support both http requests and ajax requests for content. <code class="prettyprint">delegateView</code> is wrapper method that determines if the request is for ajax content or the full DOM then generates and returns the appropriate response. </p>

<p>The $args argument is an array with the required elements for generating the view, ajax or http. It will accept the following parameters:</p>

<table><thead>
<tr>
<th>Key</th>
<th>Required</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>contentTemplate</td>
<td>REQUIRED</td>
<td>string</td>
<td>Defines the view template to load. This should be in view notation of BundleName:ViewName:template.html.php. Refer to <a href="#views">views</a> for more information.</td>
</tr>
<tr>
<td>viewParameters</td>
<td>OPTIONAL</td>
<td>array</td>
<td>Array of variables with values made available to the template. Each key will be a variable available to the template.</td>
</tr>
<tr>
<td>passthroughVars</td>
<td>OPTIONAL</td>
<td>array</td>
<td>Array of variables returned as part of the ajax response used by Mautic and/or the addon&rsquo;s onLoad JS callback.</td>
</tr>
</tbody></table>

<p>Due to the use of ajax, there are some elements of the <code class="prettyprint">passthroughVars</code> array that Mautic will use internally to manipulate the user interface. For responses that include main content, i.e. routes a user would click to, should set at least <code class="prettyprint">activeLink</code> and <code class="prettyprint">route</code>.</p>

<table><thead>
<tr>
<th>Key</th>
<th>Required</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>activeLink</td>
<td>OPTIONAL</td>
<td>string</td>
<td>The <a href="#items">ID of the menu item</a> that should be activated dynamically to match the ajax response</td>
</tr>
<tr>
<td>route</td>
<td>OPTIONAL</td>
<td>string</td>
<td>The route that should be pushed to the browser&rsquo;s address bar to match the ajax response</td>
</tr>
<tr>
<td>mauticContent</td>
<td>OPTIONAL</td>
<td>string</td>
<td>Used to generate the Javascript method to call after the ajax content has been injected into the DOM. The same function will also be called on a page refresh/full page load if set via <code class="prettyprint">$view[&#39;slots&#39;]</code> in the template. For example, if this is set as <code class="prettyprint">helloWorldDetails</code>, Mautic will check for the existence of and executes <code class="prettyprint">Mautic.helloWorldDetailsOnLoad()</code>. Refer to <a href="#processing-ajax-content">Processing Ajax Content</a> for more information regarding this and <a href="#asset-helper">Asset Helper</a> for injecting assets into the head for ajax generated content.</td>
</tr>
<tr>
<td>callback</td>
<td>OPTIONAL</td>
<td>string</td>
<td>A Mautic namespaced JS function that will be executed before the response is injected into the DOM. If set, Mautic will pass the response to the function and not process the content. It will be up to the callback function to handle the rest of the process.</td>
</tr>
<tr>
<td>redirect</td>
<td>OPTIONAL</td>
<td>string</td>
<td>The URL to force a page redirect rather than inject ajax content.</td>
</tr>
<tr>
<td>target</td>
<td>OPTIONAL</td>
<td>string</td>
<td>jQuery selector to inject the content into. By default, the app&rsquo;s main content selector will be used.</td>
</tr>
<tr>
<td>replaceContent</td>
<td>OPTIONAL</td>
<td>string</td>
<td>Determines if Mautic should replace the target selector with the ajax content or set as its inner HTML. Return &lsquo;true&rsquo; as a string to replace the selector.</td>
</tr>
</tbody></table>

<h6 id="delegateredirect($url)">delegateRedirect($url)</h6>

<p>Delegates the appropriate response for redirects. </p>

<p>If an ajax request, a json response with <code class="prettyprint">{redirect: $url}</code> will be returned allowing the executing JS code to force the redirect.</p>

<p>If an http request, then a redirect response is returned (i.e redirect header).</p>

<h6 id="postactionredirect($args)">postActionRedirect($args)</h6>

<p>Similar to delegateView(), this method will delegate the appropriate response based on the request. This method can be used after performing some action, such as saving a form. It accepts the same elements in the $args array as delegateView() but also accepts the following:</p>

<table><thead>
<tr>
<th>Key</th>
<th>Required</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>returnUrl</td>
<td>OPTIONAL</td>
<td>string</td>
<td>The URL to redirect to. It will default to /s/dashboard if not set. This will also auto-populate passthroughVars[route] if not set.</td>
</tr>
<tr>
<td>flashes</td>
<td>OPTIONAL</td>
<td>array</td>
<td>Array of flash messages to display after redirecting. See <a href="#flash-messages">Flash Messages</a> for more information.</td>
</tr>
<tr>
<td>forwardController</td>
<td>OPTIONAL</td>
<td>bool</td>
<td>By default, the request is forwarded to a controller method rather than directly loading a view template. This means that contentTemplate should be in controller notation (BundleName:ControllerName:controllerMethod) rather than view notation (BundleName:ViewName:template.html.php). Set this to false to directly load a view template rather than forwarding to another controller.</td>
</tr>
</tbody></table>

<h5 id="mautic\corebundle\controller\formcontroller">Mautic\CoreBundle\Controller\FormController</h5>

<p>This controller extends CommonController and provides helper methods for managing forms. See <a href="#forms">Forms</a> for more information.</p>

<h5 id="mautic\corebundle\controller\ajaxcontroller">Mautic\CoreBundle\Controller\AjaxController</h5>

<p>This controller also extends CommonController and is a companion to some of the built-in Javascript helpers. See  <a href="#javascript-methods">Javascript methods</a> for more information.</p>

          <h3 id="models">Models</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="c1">// addons/HelloWorldBundle/Model/ContactModel.php
</span>
<span class="k">namespace</span> <span class="nx">MauticAddons\HelloWorldBundle\Model</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Mautic\CoreBundle\Model\CommonModel</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ContactModel</span> <span class="k">extends</span> <span class="nx">CommonModel</span>
<span class="p">{</span>

    <span class="sd">/**
     * Send contact email
     * 
     * @param array $data
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">sendContactEmail</span><span class="p">(</span><span class="nv">$data</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Get mailer helper
</span>        <span class="nv">$mailer</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">factory</span><span class="o">-&gt;</span><span class="na">getMailer</span><span class="p">();</span>

        <span class="nv">$mailer</span><span class="o">-&gt;</span><span class="na">message</span><span class="o">-&gt;</span><span class="na">addTo</span><span class="p">(</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">factory</span><span class="o">-&gt;</span><span class="na">getParameter</span><span class="p">(</span><span class="s1">'mailer_from_email'</span><span class="p">)</span>
        <span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">message</span><span class="o">-&gt;</span><span class="na">setFrom</span><span class="p">(</span>
            <span class="k">array</span><span class="p">(</span><span class="nv">$data</span><span class="p">[</span><span class="s1">'email'</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="nv">$data</span><span class="p">[</span><span class="s1">'name'</span><span class="p">])</span>
        <span class="p">);</span>

        <span class="nv">$mailer</span><span class="o">-&gt;</span><span class="na">message</span><span class="o">-&gt;</span><span class="na">setSubject</span><span class="p">(</span><span class="nv">$data</span><span class="p">[</span><span class="s1">'subject'</span><span class="p">]);</span>

        <span class="nv">$mailer</span><span class="o">-&gt;</span><span class="na">message</span><span class="o">-&gt;</span><span class="na">setBody</span><span class="p">(</span><span class="nv">$data</span><span class="p">[</span><span class="s1">'message'</span><span class="p">]);</span>

        <span class="nv">$mailer</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>Models are used to retrieve and process data between controllers and views. Models aren&rsquo;t required for addons but, if used, Mautic provides means to easily obtain the model objects and some commonly used methods.</p>

<h4 id="model-classes">Model Classes</h4>

<p>Custom models should extend one of two Mautic base models.</p>

<h5 id="\mautic\corebundle\model\commonmodel">\Mautic\CoreBundle\Model\CommonModel</h5>

<p>This is the basic model that mainly provides access to services frequently used with models.</p>

<table><thead>
<tr>
<th>Property</th>
<th>Service</th>
</tr>
</thead><tbody>
<tr>
<td>$this-&gt;factory</td>
<td><a href="#factory-service">Mautic&rsquo;s factory service</a></td>
</tr>
<tr>
<td>$this-&gt;em</td>
<td><a href="#database">Entity manager service</a></td>
</tr>
<tr>
<td>$this-&gt;security</td>
<td><a href="#security">Mautic&rsquo;s security service</a></td>
</tr>
<tr>
<td>$this-&gt;dispatcher</td>
<td><a href="#events">Event dispatcher service</a></td>
</tr>
<tr>
<td>$this-&gt;translator</td>
<td><a href="#translator">Translator service</a></td>
</tr>
</tbody></table>

<h5 id="\mautic\corebundle\model\formmodel">\Mautic\CoreBundle\Model\FormModel</h5>

<p>The FormModel extends CommonModel and provides a set of helper methods for interacting with entities and repositories. To read more about these methods, refer to the <a href="#database">Database</a> section. </p>

<h4 id="getting-model-objects">Getting Model Objects</h4>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>

<span class="sd">/** @var \Mautic\LeadBundle\Model\LeadModel $leadModel */</span>
<span class="nv">$leadModel</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">factory</span><span class="o">-&gt;</span><span class="na">getModel</span><span class="p">(</span><span class="s1">'lead'</span><span class="p">);</span>

<span class="sd">/** @var \Mautic\LeadBundle\Model\ListModel $leadListModel */</span>
<span class="nv">$leadListModel</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">factory</span><span class="o">-&gt;</span><span class="na">getModel</span><span class="p">(</span><span class="s1">'lead.list'</span><span class="p">);</span>

<span class="sd">/** @var \MauticAddons\HelloWorldBundle\Model\ContactModel $contactModel */</span>
<span class="nv">$contactModel</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">factory</span><span class="o">-&gt;</span><span class="na">getModel</span><span class="p">(</span><span class="s1">'addon.helloWorld.contact'</span><span class="p">);</span>
</code></pre>

<p>To get a model object, use the MauticFactory&rsquo;s <code class="prettyprint">getModel()</code> method. </p>

<p>The <code class="prettyprint">getModel()</code> method accepts the name of the model in a special notation of <code class="prettyprint">bundleName.modelName</code> for Mautic core bundles or <code class="prettyprint">addon.bundleName.modelName</code> for addons. If the <code class="prettyprint">bundleName</code> and <code class="prettyprint">modelName</code> happens to be the same, then <code class="prettyprint">bundleName</code> (core bundles) or <code class="prettyprint">addon.bundleName</code> (addons) are also accepted.</p>

          <h3 id="views">Views</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="c1">//addons/HelloWorldBundle/Views/World/details.html.php
</span>
<span class="c1">// Check if the request is Ajax
</span><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">getRequest</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">isXmlHttpRequest</span><span class="p">())</span> <span class="p">{</span>

    <span class="c1">// Set tmpl for parent template
</span>    <span class="nv">$view</span><span class="p">[</span><span class="s1">'slots'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">'tmpl'</span><span class="p">,</span> <span class="s1">'Details'</span><span class="p">);</span>

    <span class="c1">// Extend index.html.php as the parent
</span>    <span class="nv">$view</span><span class="o">-&gt;</span><span class="na">extend</span><span class="p">(</span><span class="s1">'HelloWorldBundle:World:index.html.php'</span><span class="p">);</span>
<span class="p">}</span>
<span class="cp">?&gt;</span>

<span class="nt">&lt;div&gt;</span>
    <span class="c">&lt;!-- Desired content/markup --&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="c1">// addons/HelloWorldBundle/Views/World/index.html.php
</span>
<span class="c1">// Extend the base content
</span><span class="nv">$view</span><span class="o">-&gt;</span><span class="na">extend</span><span class="p">(</span><span class="s1">'MauticCoreBundle:Default:content.html.php'</span><span class="p">);</span>

<span class="c1">// Get tmpl from sub-template
</span><span class="nv">$tmpl</span> <span class="o">=</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">'slots'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'tmpl'</span><span class="p">,</span> <span class="s1">'Details'</span><span class="p">);</span>

<span class="c1">// Tell Mautic to call JS onLoad method
</span><span class="nv">$view</span><span class="p">[</span><span class="s1">'slots'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">'mauticContent'</span><span class="p">,</span> <span class="s1">'helloWorld'</span><span class="o">.</span><span class="nv">$tmpl</span><span class="p">);</span>

<span class="c1">// Set the page and header title
</span><span class="nv">$header</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$tmpl</span> <span class="o">==</span> <span class="s1">'World'</span><span class="p">)</span>
    <span class="o">?</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">'translator'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">trans</span><span class="p">(</span>
        <span class="s1">'addon.helloworld.worlds'</span><span class="p">,</span>
        <span class="k">array</span><span class="p">(</span><span class="s1">'%world%'</span> <span class="o">=&gt;</span> <span class="nb">ucfirst</span><span class="p">(</span><span class="nv">$world</span><span class="p">))</span>
    <span class="p">)</span> <span class="o">:</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">'translator'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">trans</span><span class="p">(</span><span class="s1">'addon.helloworld.manage_worlds'</span><span class="p">);</span>
<span class="nv">$view</span><span class="p">[</span><span class="s1">'slots'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">'headerTitle'</span><span class="p">,</span> <span class="nv">$header</span><span class="p">);</span>
<span class="cp">?&gt;</span>

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"helloworld-content"</span><span class="nt">&gt;</span>
    <span class="cp">&lt;?php</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">'slots'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">output</span><span class="p">(</span><span class="s1">'_content'</span><span class="p">);</span> <span class="cp">?&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre>

<p>Views take data given it from the controller and displays the content to the user. Templates can be called from the controller or from within other templates.</p>

<p>It was discussed in the Controller&rsquo;s <a href="#delegateredirect($url)">delegateView() method</a> how to render a view from a controller. Remember that delegateView uses contentTemplate to determine what view to render.</p>

<p>Similar to controller notation, views are noted as <code class="prettyprint">HelloWorldBundle:Contact:form.html.php</code> which will point to the file <code class="prettyprint">/path/to/mautic/addons/HelloWorldBundle/Views/Contact/form.html.php</code>. </p>

<aside class="notice">
View notation is in the format of <code>BundleName:ViewName:template.html.php</code>. To use a view that has been nested in Views, use <code>BundleName:ViewName\Subfolder:template.html.php</code>.
</aside>

<h4 id="view-parameters">View Parameters</h4>

<p>Remember the array passed via viewParameters in the Controller&rsquo;s <a href="#delegateview($args)">delegateView() method</a>? Here is where the elements of that array will be made available as variables.  </p>

<p>For example, <code class="prettyprint">$world</code> will be available and assigned the value of <code class="prettyprint">mars</code> from the following example: </p>

<p><pre class="inline">
 &#39;viewParameters&#39;  =&gt; array(
     &#39;world&#39; =&gt; &#39;mars&#39;
 ),
 </pre></p>

<p>By default there are a couple variables available and should not be overridden by the controller</p>

<table><thead>
<tr>
<th>Variable</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>$view</strong></td>
<td>Contains all the helper objects available to templates along with providing methods for extending and/or rendering other templates.</td>
</tr>
<tr>
<td><strong>$app</strong></td>
<td>Gives access to request and session to views via <code class="prettyprint">$app-&gt;getRequest()</code> and <code class="prettyprint">$app-&gt;getSession()</code></td>
</tr>
</tbody></table>

<h4 id="extending-views">Extending Views</h4>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>

<span class="c1">// Extends the full document with menu, page header, etc
</span><span class="nv">$view</span><span class="o">-&gt;</span><span class="na">extend</span><span class="p">(</span><span class="s1">'MauticCoreBundle:Default:content.html.php'</span><span class="p">);</span>
</code></pre>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>

<span class="c1">// Extends the "slim" document which includes just the head and body with main content; does not include menu, page header, etc.
</span><span class="nv">$view</span><span class="o">-&gt;</span><span class="na">extend</span><span class="p">(</span><span class="s1">'MauticCoreBundle:Default:content.html.php'</span><span class="p">);</span>
</code></pre>

<p>Because of the use of Ajax, views must also be able to return main content vs the entire document. This is done by extending Mautic&rsquo;s base templates. Notice the notation is the same as what is used in controllers.</p>

<p>To determine if the request is Ajax or not, use <code class="prettyprint">$app-&gt;getRequest()-&gt;isXmlHttpRequest()</code>. Another option is to make the determination in the controller and pass it in the <code class="prettyprint">viewParameters</code> array.</p>

<p>Of course, this can also be used to extend custom templates as demonstrated in <a href="#views">this code example</a>.</p>

<aside>
The controller should call the sub-template.
</aside>

<aside class="notice">
It may help to note that extended templates are rendered inside out. So if <code>HelloWorldBundle:World:details.html.php</code> extends <code>HelloWorldBundle:World:index.html.php</code> which extends <code>MauticCoreBundle:Default:content.html.php</code>, the content of details.html.php will be rendered first and injected into index.html.php as it is rendered. <code>HelloWorldBundle:World:template1.html.php</code> will be rendered last.
</aside>

<p>To include the content from the sub-template in the parent template, use <code class="prettyprint">$view[&#39;slots&#39;]-&gt;output(&#39;_content&#39;);</code>. See the <a href="#slots-helper">Slots Helper</a> for more information.</p>

<h4 id="rendering-views-within-views">Rendering Views within Views</h4>

<p>To render the content of another template from within a template, simply use <code class="prettyprint">echo $view-&gt;render(&#39;BundleName:ViewName:template.html.php&#39;, array(&#39;parameter&#39; =&gt; &#39;value&#39;));</code></p>

<h4 id="template-helpers">Template Helpers</h4>

<p>There are a number of template helper objects and helper view templates that are built into Mautic.</p>

<h5 id="slots-helper">Slots Helper</h5>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>

<span class="c1">// Set a slot with content; will overwrite if slot already exists 
</span><span class="nv">$view</span><span class="p">[</span><span class="s1">'slots'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">'name'</span><span class="p">,</span> <span class="s1">'the content'</span><span class="p">);</span>

<span class="c1">// Append content to slot rather than overwrite
</span><span class="nv">$view</span><span class="p">[</span><span class="s1">'slots'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">append</span><span class="p">(</span><span class="s1">'name'</span><span class="p">,</span> <span class="s1">' and more content'</span><span class="p">);</span>
<span class="nv">$view</span><span class="p">[</span><span class="s1">'slots'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">append</span><span class="p">(</span><span class="s1">'existingArray'</span><span class="p">,</span> 
    <span class="k">array</span><span class="p">(</span>
        <span class="s1">'append'</span> <span class="o">=&gt;</span> <span class="s1">'me'</span>
    <span class="p">)</span>
<span class="p">);</span>

<span class="c1">// Get the slot content
</span><span class="nv">$content</span> <span class="o">=</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">'slots'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'name'</span><span class="p">,</span> <span class="s1">'default value'</span><span class="p">);</span>

<span class="c1">// Output the content; note that echo is not required
</span><span class="nv">$view</span><span class="p">[</span><span class="s1">'slots'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">output</span><span class="p">(</span><span class="s1">'name'</span><span class="p">);</span>

<span class="c1">// Check if a slot exists
</span><span class="k">if</span> <span class="p">(</span><span class="nv">$view</span><span class="p">[</span><span class="s1">'slots'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">has</span><span class="p">(</span><span class="s1">'name'</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// Do something
</span><span class="p">}</span>
</code></pre>

<p>As seen with extending views, the slots helper is used to pass content up through parent templates. Remember that extended templates are rendered inside out. So, content can be set in a sub template and accessed from the parent template but content set in a parent template, will not be available to the sub-template.</p>

<div class="clear-right"></div>

<h5 id="asset-helper">Asset Helper</h5>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>

<span class="c1">// Generate relative URL to image
</span><span class="k">echo</span> <span class="s1">'&lt;img src="'</span> <span class="o">.</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">'assets'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">getUrl</span><span class="p">(</span><span class="s1">'addons/HelloWorldBundle/assets/images/earth.png'</span><span class="p">)</span> <span class="o">.</span> <span class="s1">'" /&gt;'</span><span class="p">;</span>

<span class="c1">// Dynamically insert script into head
</span><span class="nv">$view</span><span class="p">[</span><span class="s1">'assets'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">includeScript</span><span class="p">(</span><span class="s1">'addons/HelloWorldBundle/assets/helloworld.js'</span><span class="p">);</span>

<span class="c1">// Dynamically insert stylesheet into head
</span><span class="nv">$view</span><span class="p">[</span><span class="s1">'assets'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">includeScript</span><span class="p">(</span><span class="s1">'addons/HelloWorldBundle/assets/helloworld.css'</span><span class="p">);</span>
</code></pre>

<p>The asset helper, accessed via <code class="prettyprint">$view[&#39;assets&#39;]</code>, is used to load assets into the DOM including images, script and stylesheets. </p>

<aside class="notice">
<code>$view['assets']</code> should always be used to ensure that assets work with Mautic installed in the web root, installed in a subdirectory, ran under the dev environment (index_dev.php), and/or ran under the prod environment.
</aside>

<p>The asset helper also provides a way to insert scripts and stylesheets into the head for ajax loaded content using <code class="prettyprint">$view[&#39;assets&#39;]-&gt;loadScript()</code> and <code class="prettyprint">$view[&#39;assets&#39;]-&gt;loadStylesheet()</code>.</p>

<div class="clear-right"></div>

<h5 id="router-helper">Router Helper</h5>
<pre><code class="highlight php"><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">'router'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">generate</span><span class="p">(</span><span class="s1">'addon_helloworld_world'</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'world'</span> <span class="o">=&gt;</span> <span class="s1">'mars'</span><span class="p">));</span> <span class="cp">?&gt;</span><span class="s">"</span> <span class="na">data-toggle=</span><span class="s">"ajax"</span> <span class="nt">/&gt;</span>Mars<span class="nt">&lt;/a&gt;</span>
</code></pre>

<p>The router helper, <code class="prettyprint">$view[&#39;router&#39;]</code>, works as explained in the <a href="#router">Router</a>.</p>

<div class="clear-right"></div>

<h5 id="translation-helper">Translation Helper</h5>
<pre><code class="highlight php"><span class="nt">&lt;h1&gt;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">'translator'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">trans</span><span class="p">(</span><span class="s1">'addon.helloworld.worlds'</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'%world%'</span><span class="p">,</span> <span class="s1">'Mars'</span><span class="p">);</span> <span class="cp">?&gt;</span><span class="nt">&lt;/h1&gt;</span>
</code></pre>

<p>The translation helper, <code class="prettyprint">$view[&#39;translator&#39;]</code>, works as explained in the <a href="#translator">Translator</a> section.</p>

<div class="clear-right"></div>

<h5 id="date-helper">Date Helper</h5>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>

<span class="c1">// Can be string or \DateTime object; if string, it's assumed local time unless noted otherwise via third argument to helper methods
</span><span class="nv">$datetime</span> <span class="o">=</span> <span class="s1">'2015-04-12 20:56:00'</span><span class="p">;</span>

<span class="c1">// Formats per full date system config setting 
</span><span class="nv">$fullDateTime</span> <span class="o">=</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">'date'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">toFull</span><span class="p">(</span><span class="nv">$datetime</span><span class="p">);</span>

<span class="c1">// Formats per short date system config setting
</span><span class="nv">$shortDateTime</span> <span class="o">=</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">'date'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">toShort</span><span class="p">(</span><span class="nv">$datetime</span><span class="p">);</span>

<span class="c1">// Formats per date only system config setting
</span><span class="nv">$date</span> <span class="o">=</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">'date'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">toDate</span><span class="p">(</span><span class="nv">$datetime</span><span class="p">);</span>

<span class="c1">// Formats per time only system config setting
</span><span class="nv">$time</span> <span class="o">=</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">'date'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">toTime</span><span class="p">(</span><span class="nv">$datetime</span><span class="p">);</span>

<span class="c1">// Formats as date only config setting + time only config setting
</span><span class="nv">$datetime</span> <span class="o">=</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">'date'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">toFullConcat</span><span class="p">(</span><span class="nv">$datetime</span><span class="p">);</span>

<span class="c1">// Formats date as Yesterday, 8:02 pm (Today or Tomorrow); otherwise 'x days ago'  
</span><span class="nv">$text</span> <span class="o">=</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">'date'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">toText</span><span class="p">(</span><span class="nv">$datetime</span><span class="p">);</span>

<span class="c1">// Format a string that is not already in local time
</span><span class="nv">$fullDateTime</span> <span class="o">=</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">'date'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">toFull</span><span class="p">(</span><span class="nv">$datetime</span><span class="p">,</span> <span class="s1">'Y-m-d H:i:s'</span><span class="p">,</span> <span class="s1">'UTC'</span><span class="p">);</span>
</code></pre>

<p>The date helper can be used to format dates based on system and/or user settings. </p>

<p>The first argument to the various methods can either be a date/time string or a \DateTime object. If a string, it is expected to be formatted as &lsquo;Y-m-d H:i:s&rsquo; and already in the user&rsquo;s and/or system&rsquo;s local time. If it is not, pass the format as the second argument and the timezone (string) as the third.</p>

<div class="clear-right"></div>

<h5 id="form-helper">Form Helper</h5>
<pre><code class="highlight php"><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">'form'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">form</span><span class="p">(</span><span class="nv">$form</span><span class="p">);</span> <span class="cp">?&gt;</span>
</code></pre>

<p>The form helper, <code class="prettyprint">$view[&#39;form&#39;]</code>, works as explained in the <a href="#form-template-helper">Form</a> section.</p>

<div class="clear-right"></div>

<h4 id="view-helper-templates">View Helper Templates</h4>

<p>@todo</p>

<div class="clear-right"></div>

<h4 id="processing-ajax-content">Processing Ajax Content</h4>

<p>Mautic provides built in ways to ajaxify links, modals, and forms.</p>

<h5 id="ajax-links">Ajax Links</h5>
<pre><code class="highlight php"><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">'router'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">generate</span><span class="p">(</span><span class="s1">'addon_helloworld_world'</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'world'</span> <span class="o">=&gt;</span> <span class="s1">'mars'</span><span class="p">));</span> <span class="cp">?&gt;</span><span class="s">"</span> <span class="na">data-toggle=</span><span class="s">"ajax"</span> <span class="nt">/&gt;</span>Mars<span class="nt">&lt;/a&gt;</span>
</code></pre>

<p>To ajaxify a link, set the attribute <code class="prettyprint">data-target=&quot;ajax&quot;</code></p>

<h5 id="ajax-modals">Ajax Modals</h5>
<pre><code class="highlight php"><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">'router'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">generate</span><span class="p">(</span><span class="s1">'addon_helloworld_world'</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'world'</span> <span class="o">=&gt;</span> <span class="s1">'mars'</span><span class="p">));</span> <span class="cp">?&gt;</span><span class="s">"</span> 
   <span class="na">data-toggle=</span><span class="s">"ajaxmodal"</span>
   <span class="na">data-target=</span><span class="s">"#MauticSharedModal"</span>
   <span class="na">data-header=</span><span class="s">"</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">'translator'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">trans</span><span class="p">(</span><span class="s1">'addon.helloworld.worlds'</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'%world%'</span><span class="p">,</span> <span class="s1">'Mars'</span><span class="p">));</span> <span class="cp">?&gt;</span><span class="s">"</span><span class="nt">&gt;</span>Mars<span class="nt">&lt;/a&gt;</span>
</code></pre>

<p>Mautic uses Bootstrap modals but Bootstrap lacks an easy way to dynamically retrieve content more than once. Thus, Mautic provides the attribute <code class="prettyprint">data-toggle=&quot;ajaxmodal&quot;</code> to help with this.</p>

<p><code class="prettyprint">data-target</code> should be the selector of the model to inject the content into. Mautic has a modal, <code class="prettyprint">#MauticSharedModal</code> on standby to be used for this very purpose.</p>

<p><code class="prettyprint">data-header</code> will set the modal&rsquo;s header.</p>

<h5 id="ajax-forms">Ajax Forms</h5>

<p>When using Symfony&rsquo;s <a href="#forms">form services</a>, the form will be auto-ajaxified.</p>

<h5 id="ajax-content-callbacks">Ajax Content Callbacks</h5>
<pre><code class="highlight plaintext">Mautic.helloWorldDetailsOnLoad = function(container, response) {
    // Manipulate content 
};

Mautic.helloWorldDetailsOnUnload = function(container, response) {
    // Manipulate content 
};
</code></pre>

<p>Mautic provides a way to execute a javascript function after it injects ajax content into the DOM. This can be useful to activate various JS driven features such as typeaheads, charts, bind events, etc.</p>

<p>To take advantage of this, utilize the mauticContent element in the passthroughVars array from the controller&rsquo;s <a href="#delegateView($args)">delegateView()</a>. The value of this variable will determine what function should be called after the content has been injected.</p>

<p>For example, the method <code class="prettyprint">Mautic.helloWorldDetailsOnLoad()</code> will be called for the following: </p>

<p><pre class='inline'>
 &#39;passthroughVars&#39; =&gt; array(
     &#39;activeLink&#39;    =&gt; &#39;addon_helloworld_world&#39;,
     &#39;route&#39;         =&gt; $this-&gt;generateUrl(&#39;addon_helloworld_world&#39;, array(&#39;world&#39; =&gt; $world)),
     &#39;mauticContent&#39; =&gt; &#39;helloWorldDetails&#39;
 )
 </pre></p>

<p>When the user browses away from the page, <code class="prettyprint">Mautic.helloWorldDetailsOnUnload()</code> will be called to give opportunity to destroy objects if necessary.</p>

<p>Both the OnLoad and OnUnload methods are passed two arguments.</p>

<table><thead>
<tr>
<th>Argument</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>container</td>
<td>The selector that was used as the target of the ajax content.</td>
</tr>
<tr>
<td>response</td>
<td>The object from the ajax response, i.e. set in the passthroughVars from the Controller</td>
</tr>
</tbody></table>

<p><code class="prettyprint">mauticContent</code> should also be set via <code class="prettyprint">$view[&#39;slots&#39;]</code> in the <a href="#slots-helper">view&rsquo;s</a> main page. </p>

<pre class="inline">
$view['slots']->set('mauticContent', 'helloBundleDetails');
</pre>

<p>Doing so will ensure <code class="prettyprint">Mautic.helloWorldDetailsOnLoad()</code> is also called when there is a page refresh.</p>

          <h2 id="factory-service">Factory Service</h2>

<p>Mautic&rsquo;s factory service gives quick access to the most commonly used services such as the router, request, translator, database, etc along with providing a few helper methods.</p>

<p>For <a href="#controllers">controllers</a>, extend either <code class="prettyprint">\Mautic\CoreBundle\Controller\CommonController</code> or <code class="prettyprint">\Mautic\CoreBundle\Controller\FormController</code> and it will be available via <code class="prettyprint">$this-&gt;factory</code> by default. Otherwise, obtain the factory from the service container via <code class="prettyprint">$factory = $this-&gt;container-&gt;get(&#39;mautic.factory&#39;);</code></p>

<p>For <a href="#models">models</a>, it will be available via <code class="prettyprint">$this-&gt;factory</code> by default.</p>

<p>For custom <a href="#services">services</a>, pass &lsquo;mautic.factory&rsquo; as an argument and MauticFactory will be passed into the __construct of the service.</p>

<h3 id="user">User</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="nv">$user</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">factory</span><span class="o">-&gt;</span><span class="na">getUser</span><span class="p">();</span>

<span class="nv">$firstName</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getFirstname</span><span class="p">();</span>
<span class="nv">$lastName</span>  <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getLastname</span><span class="p">();</span>
<span class="nv">$email</span>     <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getEmail</span><span class="p">();</span>
<span class="nv">$profile</span>   <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getProfile</span><span class="p">();</span>

<span class="nv">$role</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getRole</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getName</span><span class="p">();</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$role</span><span class="o">-&gt;</span><span class="na">isAdmin</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">// do something
</span><span class="p">}</span>
</code></pre>

<p><code class="prettyprint">getUser()</code> will return the <a href="#database">entity</a>, \Mautic\UserBundle\Entity\User that can then be used to get information about the currently logged in user.</p>

<h3 id="security">Security</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>

<span class="nv">$security</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">factory</span><span class="o">-&gt;</span><span class="na">getSecurity</span><span class="p">();</span>

<span class="c1">// Check if user is granted a single permission
</span><span class="k">if</span> <span class="p">(</span><span class="nv">$security</span><span class="o">-&gt;</span><span class="na">isGranted</span><span class="p">(</span><span class="s1">'addon:helloWorld:worlds:view'</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// do something
</span><span class="p">}</span>

<span class="c1">// Check if user is granted multiple permissions (must be granted to all to be true)
</span><span class="k">if</span> <span class="p">(</span><span class="nv">$security</span><span class="o">-&gt;</span><span class="na">isGranted</span><span class="p">(</span>
    <span class="k">array</span><span class="p">(</span>
        <span class="s1">'addon:helloWorld:worlds:view'</span><span class="p">,</span>
        <span class="s1">'addon:helloWorld:worlds:create'</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="p">)</span> <span class="p">{</span>
    <span class="c1">//do something
</span><span class="p">}</span>

<span class="c1">// Check if user is granted to at least one permission
</span><span class="k">if</span> <span class="p">(</span><span class="nv">$security</span><span class="o">-&gt;</span><span class="na">isGranted</span><span class="p">(</span>
    <span class="k">array</span><span class="p">(</span>
        <span class="s1">'addon:helloWorld:worlds:view'</span><span class="p">,</span>
        <span class="s1">'addon:helloWorld:worlds:edit'</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="s1">'MATCH_ONE'</span>
<span class="p">)</span>
<span class="p">)</span> <span class="p">{</span>
    <span class="c1">//do something
</span><span class="p">}</span>

<span class="c1">// Get an array of user permissions
</span><span class="nv">$permissions</span> <span class="o">=</span> <span class="nv">$security</span><span class="o">-&gt;</span><span class="na">isGranted</span><span class="p">(</span>
    <span class="k">array</span><span class="p">(</span>
        <span class="s1">'addon:helloWorld:worlds:view'</span><span class="p">,</span>
        <span class="s1">'addon:helloWorld:worlds:edit'</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="s1">'RETURN_ARRAY'</span>
<span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$permissions</span><span class="p">[</span><span class="s1">'addon:helloWorld:worlds:view'</span><span class="p">])</span> <span class="p">{</span>
    <span class="c1">// do something
</span><span class="p">}</span>

<span class="c1">// Check to see if a user is anonymous (not logged in)
</span><span class="k">if</span> <span class="p">(</span><span class="nv">$security</span><span class="o">-&gt;</span><span class="na">isAnonymous</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">// do something
</span><span class="p">}</span>

<span class="c1">// Get object of currently logged in user
</span><span class="nv">$user</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">factory</span><span class="o">-&gt;</span><span class="na">getUser</span><span class="p">();</span>
</code></pre>

<p>Obtain the security service from <a href="#factory-service">Mautic&rsquo;s factory service</a> via <code class="prettyprint">$this-&gt;factory-&gt;getSecurity()</code>.</p>

<p>Using the service to check permissions is explained more in <a href="#using-permissions">Using Permissions</a>.</p>

<h3 id="translator">Translator</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span> 
<span class="c1">// Simple string
</span><span class="k">echo</span> <span class="nv">$translator</span><span class="o">-&gt;</span><span class="na">trans</span><span class="p">(</span><span class="s1">'addon.helloworld.goodbye'</span><span class="p">);</span>

<span class="c1">// Simple string with placeholders
</span><span class="k">echo</span> <span class="nv">$translator</span><span class="o">-&gt;</span><span class="na">trans</span><span class="p">(</span><span class="s1">'addon.helloworld.greeting'</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'%name%'</span> <span class="o">=&gt;</span> <span class="nv">$name</span><span class="p">));</span>

<span class="c1">// String from a domain other than messages (will use planets.ini)
</span><span class="k">echo</span> <span class="nv">$translator</span><span class="o">-&gt;</span><span class="na">trans</span><span class="p">(</span><span class="s1">'addon.helloworld.worlds'</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'%world%'</span> <span class="o">=&gt;</span> <span class="nv">$world</span><span class="p">),</span> <span class="s1">'planets'</span><span class="p">);</span>

<span class="c1">// Plural translations
</span><span class="nv">$planetCount</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="k">echo</span> <span class="nv">$translator</span><span class="o">-&gt;</span><span class="na">transChoice</span><span class="p">(</span><span class="s1">'addon.helloworld.number_of_planets'</span><span class="p">,</span> <span class="nv">$planetCount</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'%planets%'</span> <span class="o">=&gt;</span> <span class="nv">$planetCount</span><span class="p">));</span>

<span class="c1">// Check to see if a translation key exists
</span><span class="k">if</span> <span class="p">(</span><span class="nv">$translator</span><span class="o">-&gt;</span><span class="na">hasId</span><span class="p">(</span><span class="s1">'addon.helloworld.goodbye'</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$translator</span><span class="o">-&gt;</span><span class="na">trans</span><span class="p">(</span><span class="s1">'addon.helloworld.goodbye'</span><span class="p">);</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// other logic
</span><span class="p">}</span>

<span class="c1">// Use the first key if it exists, otherwise use the second (helpful to prevent managing duplicate keys with the same string)
</span><span class="k">echo</span> <span class="nv">$translator</span><span class="o">-&gt;</span><span class="na">transConditional</span><span class="p">(</span><span class="s1">'addon.helloworld.planets.'</span> <span class="o">.</span> <span class="nv">$planet</span><span class="p">,</span> <span class="s1">'addon.helloworld.dwarf_planets. '</span> <span class="o">.</span> <span class="nv">$planet</span><span class="p">);</span>
</code></pre>

<p>Use the translator service to include translated strings in the code. Depending on where the translation is necessary will determine how to obtain the service.</p>

<p>From controllers, models, and any service that has access to <a href="#factory-service">Mautic&rsquo;s factory service</a> (mautic.factory), simply use <code class="prettyprint">$translator = $this-&gt;factory-&gt;getTranslator();</code>.</p>

<p>To use the template service in view templates, simply use the <a href="#translation-helper">template helper</a>, <code class="prettyprint">$view[&#39;translator&#39;]</code>.</p>

<p>The translator service has the following functions to help with translating strings:</p>

<p><strong>Simple translation</strong><br />
<code class="prettyprint">trans($id, array $parameters = array(), $domain = null, $locale = null)</code></p>

<p><strong><a href="http://symfony.com/doc/current/components/translation/usage.html#pluralization">Pluralization</a></strong><br /> 
<code class="prettyprint">transChoice($id, $number, array $parameters = array(), $domain = null, $locale = null)</code></p>

<p><strong>Check to see if a key exists</strong><br />
<code class="prettyprint">hasId($id, $domain = null, $locale = null)</code></p>

<p><strong>Use the $preferred key if it exists, if not, use $alternative</strong><br />
<code class="prettyprint">transConditional($preferred, $alternative, $parameters = array(), $domain = null, $locale = null)</code></p>

<h3 id="router">Router</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span> 

<span class="nv">$router</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">factory</span><span class="o">-&gt;</span><span class="na">getRouter</span><span class="p">();</span>

<span class="c1">// Relative URL
</span><span class="nv">$url</span> <span class="o">=</span> <span class="nv">$router</span><span class="o">-&gt;</span><span class="na">generateUrl</span><span class="p">(</span><span class="s1">'addon_helloworld_admin'</span><span class="p">);</span>

<span class="c1">// URL with placeholders
</span><span class="nv">$url</span> <span class="o">=</span> <span class="nv">$router</span><span class="o">-&gt;</span><span class="na">generateUrl</span><span class="p">(</span><span class="s1">'addon_helloworld_world'</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'%world%'</span><span class="p">,</span> <span class="s1">'mars'</span><span class="p">));</span>

<span class="c1">// Absolute URL
</span><span class="nv">$absoluteUrl</span> <span class="o">=</span> <span class="nv">$router</span><span class="o">-&gt;</span><span class="na">generateUrl</span><span class="p">(</span><span class="s1">'addon_helloworld_admin'</span><span class="p">,</span> <span class="k">array</span><span class="p">(),</span> <span class="kc">true</span><span class="p">);</span>
</code></pre>
<pre><code class="highlight php"><span class="cp">&lt;?php</span> 

<span class="c1">// Generate a URL in a view template
</span><span class="nv">$url</span> <span class="o">=</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">'router'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">generate</span><span class="p">(</span><span class="s1">'addon_helloworld_admin'</span><span class="p">);</span>

</code></pre>

<p>For controllers, models, and services with <a href="#factory-service">Mautic&rsquo;s factory service</a> set as an argument, the router service can be easily obtained from using <code class="prettyprint">$this-&gt;factory-&gt;getRouter()</code>.</p>

<p>For views, use the <code class="prettyprint">$view[&#39;router&#39;]</code> helper. The difference with the <a href="#router-helper">template helper</a> is that <code class="prettyprint">generate()</code> is used instead of <code class="prettyprint">generateUrl</code>.</p>

<h3 id="request">Request</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>

<span class="c1">// $_GET
</span><span class="nv">$get</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">();</span>

<span class="c1">// $_POST
</span><span class="nv">$post</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">();</span>

<span class="c1">// $_COOKIE
</span><span class="nv">$cookies</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">cookies</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">();</span>

<span class="c1">// $_SERVER
</span><span class="nv">$server</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">server</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">();</span>

<span class="c1">// Headers
</span><span class="nv">$headers</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">headers</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">();</span>

<span class="c1">// Attributes - custom parameters
</span><span class="nv">$headers</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">attributes</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">();</span>

<span class="c1">// Check if a parameter exists
</span><span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">has</span><span class="p">(</span><span class="s1">'hello'</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// do something
</span><span class="p">}</span>

<span class="c1">// Retrieve value of a specific parameter setting mars as default
</span><span class="nv">$world</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'world'</span><span class="p">,</span> <span class="s1">'mars'</span><span class="p">);</span>

<span class="c1">// Set custom request value
</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">attributes</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">'hello'</span><span class="p">,</span> <span class="s1">'world'</span><span class="p">);</span>

<span class="c1">// Get the value of a nested array
</span><span class="nv">$mars</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'world[mars]'</span><span class="p">,</span> <span class="k">array</span><span class="p">(),</span> <span class="kc">true</span><span class="p">);</span>
</code></pre>

<p>There are multiple ways to obtain the request service.</p>

<p>If the controller is extending one of <a href="#controllers">Mautic&rsquo;s controllers</a>, it is already available via <code class="prettyprint">$this-&gt;request</code>.</p>

<p>Otherwise, if from with a model or a service with access to <a href="#factory-service">Mautic&rsquo;s factory service</a>, use <code class="prettyprint">$this-&gt;factory-&gt;getRequest()</code>.</p>

<p>From within a view, use <code class="prettyprint">$app-&gt;getRequest()</code>.</p>

<h3 id="session">Session</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>

<span class="nv">$session</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getSession</span><span class="p">();</span>

<span class="c1">// Get all session parameters
</span><span class="nv">$all</span> <span class="o">=</span> <span class="nv">$session</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">();</span>

<span class="c1">// Get specific parameter setting mars as default
</span><span class="nv">$world</span> <span class="o">=</span> <span class="nv">$session</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'helloworld.world'</span><span class="p">,</span> <span class="s1">'mars'</span><span class="p">);</span>

<span class="c1">// Check if a parameter exists
</span><span class="k">if</span> <span class="p">(</span><span class="nv">$session</span><span class="o">-&gt;</span><span class="na">has</span><span class="p">(</span><span class="s1">'helloworld.world'</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// do something
</span><span class="p">}</span>

<span class="c1">// Set a session parameter
</span><span class="nv">$session</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">'helloworld.world'</span><span class="p">,</span> <span class="s1">'mars'</span><span class="p">);</span>

<span class="c1">// Remove a session parameter
</span><span class="nv">$session</span><span class="o">-&gt;</span><span class="na">remove</span><span class="p">(</span><span class="s1">'helloworld.world'</span><span class="p">);</span>

<span class="c1">// Clear the whole session
</span><span class="nv">$session</span><span class="o">-&gt;</span><span class="na">clear</span><span class="p">();</span>
</code></pre>

<p>To obtain the session service from a controller, model, or a service with access to <a href="#factory-service">Mautic&rsquo;s factory service</a>, use <code class="prettyprint">$this-&gt;factory-&gt;getSession()</code>.</p>

<p>From within a view, use <code class="prettyprint">$app-&gt;getSession()</code>.</p>

<h3 id="entity">Entity</h3>

          <h2 id="database">Database</h2>

<p><strong>@todo - refer to <a href="http://symfony.com/doc/current/book/doctrine.html">Symfony&rsquo;s</a> and <a href="http://doctrine-orm.readthedocs.org/en/latest">Doctrine&rsquo;s</a> until this section is complete.</strong> </p>

<p>Mautic uses <a href="#http://doctrine-orm.readthedocs.org/en/latest/">Doctrine</a>, a database object relational mapper (ORM) and database abstraction layer (DBAL) library.</p>

<p>Most of Mautic use entity and repository classes to define the schema and interact with the database. </p>

<h3 id="metadata">Metadata</h3>

<p>In 1.0.x, Mautic uses <a href="#http://doctrine-orm.readthedocs.org/en/latest/reference/basic-mapping.html">Doctrine annotations driver </a> to map entity metadata.</p>

<p>A problem with this method for many shared hosts is the number of cache files it generates (can be 800+ files). Thus in 1.1, metadata mapping will be switched to using the Doctrine&rsquo;s <a href="#http://doctrine-orm.readthedocs.org/en/latest/reference/php-mapping.html#static-function">PHP driver</a> by leveraging the entity&rsquo;s static <code class="prettyprint">loadMetadata()</code> function.  </p>

          <h2 id="roles-and-permissions">Roles and Permissions</h2>

<p>Mautic provides a means of defining custom permissions for roles through Permission objects.</p>

<h3 id="how-permissions-work">How Permissions Work</h3>

<p>Permissions are calculated based on bits assigned to an addon&rsquo;s level and permission. Bits are integers that increase by doubling the value. 1, 2, 4, 8, 16, 32, 64, 128, 512, 1024, and so forth. The bits should never be assigned numbers in between such as 3 or 5 as the permission will not be correctly calculated in such cases.</p>

<p>For example, let&rsquo;s say HelloWorldBundle needs to manage access to user&rsquo;s Worlds entity. A permission set for <code class="prettyprint">addon:helloWorld:worlds</code> might look like</p>

<table><thead>
<tr>
<th>Permission</th>
<th>Bit</th>
</tr>
</thead><tbody>
<tr>
<td>view</td>
<td>1</td>
</tr>
<tr>
<td>edit</td>
<td>2</td>
</tr>
<tr>
<td>create</td>
<td>4</td>
</tr>
<tr>
<td>delete</td>
<td>8</td>
</tr>
<tr>
<td>full</td>
<td>16</td>
</tr>
</tbody></table>

<aside class="notice">
<code>addon:helloWorld:worlds:view</code> is a typically notation for requesting permission in Mautic. The notation tells Mautic to check for the `view` permission for the addon, HelloWorldBundle, within the `worlds` level. Levels allow addon&rsquo;s to set permissions for multiple areas.
</aside>

<p>Mautic will take the summation of the bits for the permissions given to a role and store it in the database. For example, if a role is given view and edit access, the stored bit is 3. If given view and create access, the stored bit is 5.</p>

<p>When a permission check is required, e.g. <code class="prettyprint">addon:helloWorld:worlds:create</code>, Mautic will check if bit of 4 is set in the role&rsquo;s generated bit for <code class="prettyprint">addon:helloWorld:worlds</code>. If so, permission is granted.</p>

<aside class="notice">
The permission <code>full</code> is reserved to grant access to all previous permissions within the level and thus should always be the highest bit.
</aside>

<h3 id="using-permissions">Using Permissions</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>

<span class="nv">$security</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">factory</span><span class="o">-&gt;</span><span class="na">getSecurity</span><span class="p">();</span>

<span class="c1">// Check if user is granted a single permission
</span><span class="k">if</span> <span class="p">(</span><span class="nv">$security</span><span class="o">-&gt;</span><span class="na">isGranted</span><span class="p">(</span><span class="s1">'addon:helloWorld:worlds:view'</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// do something
</span><span class="p">}</span>

<span class="c1">// Check if user is granted multiple permissions (must be granted to all to be true)
</span><span class="k">if</span> <span class="p">(</span><span class="nv">$security</span><span class="o">-&gt;</span><span class="na">isGranted</span><span class="p">(</span>
    <span class="k">array</span><span class="p">(</span>
        <span class="s1">'addon:helloWorld:worlds:view'</span><span class="p">,</span>
        <span class="s1">'addon:helloWorld:worlds:create'</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="p">)</span> <span class="p">{</span>
    <span class="c1">//do something
</span><span class="p">}</span>

<span class="c1">// Check if user is granted to at least one permission
</span><span class="k">if</span> <span class="p">(</span><span class="nv">$security</span><span class="o">-&gt;</span><span class="na">isGranted</span><span class="p">(</span>
    <span class="k">array</span><span class="p">(</span>
        <span class="s1">'addon:helloWorld:worlds:view'</span><span class="p">,</span>
        <span class="s1">'addon:helloWorld:worlds:edit'</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="s1">'MATCH_ONE'</span>
<span class="p">)</span>
<span class="p">)</span> <span class="p">{</span>
    <span class="c1">//do something
</span><span class="p">}</span>

<span class="c1">// Get an array of user permissions
</span><span class="nv">$permissions</span> <span class="o">=</span> <span class="nv">$security</span><span class="o">-&gt;</span><span class="na">isGranted</span><span class="p">(</span>
    <span class="k">array</span><span class="p">(</span>
        <span class="s1">'addon:helloWorld:worlds:view'</span><span class="p">,</span>
        <span class="s1">'addon:helloWorld:worlds:edit'</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="s1">'RETURN_ARRAY'</span>
<span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$permissions</span><span class="p">[</span><span class="s1">'addon:helloWorld:worlds:view'</span><span class="p">])</span> <span class="p">{</span>
    <span class="c1">// do something
</span><span class="p">}</span>

<span class="c1">// Check if user has access to view leads
</span><span class="k">if</span> <span class="p">(</span><span class="nv">$security</span><span class="o">-&gt;</span><span class="na">isGranted</span><span class="p">(</span><span class="s1">'lead:leads:viewother'</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// do something
</span><span class="p">}</span>
</code></pre>

<p>To determine if a user has a specific permission, use Mautic&rsquo;s security service which can be obtained from the <a href="#factory-service">factory service</a> via <code class="prettyprint">$this-&gt;factory-&gt;getSecurity()</code>.</p>

<p>As suggested above, Mautic uses a special permission notation to refer to a specific permission. For core bundles, <code class="prettyprint">bundleName:permissionLevel:permission</code> is used.  For addons, append <code class="prettyprint">addon:</code>, i.e. <code class="prettyprint">addon:bundleName:permissionLevel:permission</code>. <code class="prettyprint">addon:</code> tells Mautic to look for the permission class in the addons/ directory and <code class="prettyprint">MauticAddons</code> namespace. </p>

<p>The permission level and permissions are set by the core bundle or addon. For example, Mautic&rsquo;s core UserBundle has <code class="prettyprint">users</code> and <code class="prettyprint">roles</code> levels with <code class="prettyprint">view</code>, <code class="prettyprint">edit</code>, <code class="prettyprint">create</code>, <code class="prettyprint">delete</code> and <code class="prettyprint">full</code> permissions for each. </p>

<p>To check if a user has permission to edit roles, use <code class="prettyprint">$this-&gt;factory-&gt;getSecurity()-&gt;isGranted(&#39;user:roles:edit&#39;);</code></p>

<h3 id="creating-custom-permissions">Creating Custom Permissions</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="c1">// addons/HelloWorldBundle/Security/Permissions/HelloWorldPermissions.php
</span>
<span class="k">namespace</span> <span class="nx">MauticAddons\HelloWorldBundle\Security\Permissions</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Component\Form\FormBuilderInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Mautic\CoreBundle\Security\Permissions\AbstractPermissions</span><span class="p">;</span>

<span class="sd">/**
 * Class HelloWorldPermissions
 */</span>
<span class="k">class</span> <span class="nc">HelloWorldPermissions</span> <span class="k">extends</span> <span class="nx">AbstractPermissions</span>
<span class="p">{</span>

    <span class="sd">/**
     * Define available permissions
     *
     * @param $params
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nv">$params</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">__construct</span><span class="p">(</span><span class="nv">$params</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">permissions</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>

            <span class="c1">// Custom level
</span>            <span class="s1">'worlds'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>

                <span class="c1">// Custom permissions
</span>                <span class="s1">'use_telescope'</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s1">'send_probe'</span>    <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span>
                <span class="s1">'visit'</span>         <span class="o">=&gt;</span> <span class="mi">4</span><span class="p">,</span>
                <span class="c1">// Full will almost always be included and should be significantly higher than the
</span>                <span class="c1">// others in case new permissions need to be added later 
</span>                <span class="s1">'full'</span>          <span class="o">=&gt;</span> <span class="mi">1024</span>
            <span class="p">)</span>
        <span class="p">);</span>

        <span class="c1">// Add standard category permissions
</span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">addStandardPermissions</span><span class="p">(</span><span class="s1">'categories'</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**
     * Append the permission form fields to the Role form
     *
     * @param FormBuilderInterface $builder
     * @param array                $options
     * @param array                $data
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">buildForm</span><span class="p">(</span><span class="nx">FormBuilderInterface</span> <span class="o">&amp;</span><span class="nv">$builder</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$options</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$data</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Add standard category form fields
</span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">addStandardFormFields</span><span class="p">(</span><span class="s1">'helloWorld'</span><span class="p">,</span> <span class="s1">'categories'</span><span class="p">,</span> <span class="nv">$builder</span><span class="p">,</span> <span class="nv">$data</span><span class="p">);</span>

        <span class="c1">// Add custom 'worlds' level form fields
</span>        <span class="nv">$builder</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span>

            <span class="c1">// Form element name should be bundleName:permissionLevel
</span>            <span class="s1">'helloWorld:worlds'</span><span class="p">,</span>

            <span class="c1">// Should always be permissionlist type
</span>            <span class="s1">'permissionlist'</span><span class="p">,</span>
            <span class="k">array</span><span class="p">(</span>
                <span class="s1">'choices'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                    <span class="s1">'use_telescope'</span> <span class="o">=&gt;</span> <span class="s1">'addon.helloworld.permissions.use_telescope'</span><span class="p">,</span>
                    <span class="s1">'send_probe'</span>    <span class="o">=&gt;</span> <span class="s1">'addon.helloworld.permissions.send_probe'</span><span class="p">,</span>
                    <span class="s1">'visit'</span>         <span class="o">=&gt;</span> <span class="s1">'addon.helloworld.permissions.visit'</span><span class="p">,</span>
                    <span class="s1">'full'</span>          <span class="o">=&gt;</span> <span class="s1">'mautic.core.permissions.full'</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="s1">'label'</span>   <span class="o">=&gt;</span> <span class="s1">'addon.helloworld.permissions'</span><span class="p">,</span>

                <span class="c1">// Set existing data
</span>                <span class="s1">'data'</span>    <span class="o">=&gt;</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$data</span><span class="p">[</span><span class="s1">'worlds'</span><span class="p">])</span> <span class="o">?</span> <span class="nv">$data</span><span class="p">[</span><span class="s1">'worlds'</span><span class="p">]</span> <span class="o">:</span> <span class="k">array</span><span class="p">()),</span>

                <span class="c1">// Bundle name (used to build frontend form)
</span>                <span class="s1">'bundle'</span>  <span class="o">=&gt;</span> <span class="s1">'helloWorld'</span><span class="p">,</span>

                <span class="c1">// Permission level (used to build frontend form)
</span>                <span class="s1">'level'</span>   <span class="o">=&gt;</span> <span class="s1">'worlds'</span>
            <span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**
     * Permission set identifier; should be bundleName
     * 
     * @return string
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getName</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s1">'helloWorld'</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>An addon can create it&rsquo;s own set of permissions by creating a Permission class. See the code example for a skeleton outline of what the class will look like.</p>

<p>Each permission class should extend <code class="prettyprint">Mautic\CoreBundle\Security\Permissions\AbstractPermissions</code>.</p>

<p>Then, for most permission classes, three methods are needed: <code class="prettyprint">__construct()</code>, <code class="prettyprint">buildForm()</code> and <code class="prettyprint">getName()</code>.</p>

<p><strong>__construct()</strong></p>

<p>The construct method should do two things. It should call <code class="prettyprint">parent::__construct($params)</code> or it should set <code class="prettyprint">$this-&gt;params = $params;</code>. </p>

<p>Then it should define <code class="prettyprint">$this-&gt;permissions</code>. <code class="prettyprint">$this-&gt;permissions</code> is an array of permission levels that are each arrays with permissions assigned to bits.  For example, in the code block, a custom permission level of <code class="prettyprint">worlds</code> is defined with the permissions of <code class="prettyprint">use_telescope</code>, <code class="prettyprint">send_probe</code>, <code class="prettyprint">visit</code> and <code class="prettyprint">full</code>. To check to see if a user has permission to the level <code class="prettyprint">worlds</code> and permission <code class="prettyprint">send_probe</code>, <code class="prettyprint">$this-&gt;factory-&gt;getSecurity()-&gt;isGranted(&#39;addon:helloWorld:worlds:send_probe&#39;)</code> would be used.</p>

<p>Mautic provides a few helper methods for common permission sets:</p>

<table><thead>
<tr>
<th>Method</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>addStandardPermissions()</td>
<td>Set view, edit, create, delete, publish (with option to exclude), and full permissions.</td>
</tr>
<tr>
<td>addExtendedPermissions()</td>
<td>Set creator level restrictions: viewown, viewother, editown, editother, create, deleteown, deleteother, publishown (with option to exclude), publishother (with option to exclude), and full</td>
</tr>
<tr>
<td>addManagePermission</td>
<td>Set single manage permission</td>
</tr>
</tbody></table>

<p><strong>buildForm()</strong></p>

<p>The buildForm method will append the permission toggles to the Role&rsquo;s form (see <a href="#forms">Forms</a> for details on form builders). Review the comments in the code sample.</p>

<p>There are complimentary helper methods for the common permission sets:</p>

<table><thead>
<tr>
<th>Method</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>addStandardFormFields()</td>
<td>Appends the standard permission sets to the form</td>
</tr>
<tr>
<td>addExtendedFormFields()</td>
<td>Appends the extended, aka creator restricted, permissions to the form</td>
</tr>
<tr>
<td>addManageFormFields()</td>
<td>Appends the single manager element to the form</td>
</tr>
</tbody></table>

<p><strong>getName()</strong>
This method is absolutely required and should match both the bundleName and the name of the file. For example, if <code class="prettyprint">HelloWorldBundle</code> is the bundle&rsquo;s name, then this would be <code class="prettyprint">helloWorld</code> with a filename of <code class="prettyprint">HelloWorldPermissions.php</code>.</p>

<div class="clear-right"></div> 

<h4 id="permission-aliases">Permission Aliases</h4>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>

    <span class="k">protected</span> <span class="k">function</span> <span class="nf">getSynonym</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$level</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$name</span> <span class="o">==</span> <span class="s1">'send_satellite'</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Set real permission name
</span>            <span class="nv">$name</span> <span class="o">=</span> <span class="s1">'send_probe'</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="k">array</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$level</span><span class="p">);</span>
    <span class="p">}</span>
</code></pre>

<p>To add a permission alias, use the <code class="prettyprint">getSynonym()</code> method. Basically this method is called before each requested permission is determined giving opportunity to change the permission level or name as needed.</p>

<p>For example, <code class="prettyprint">parent::getSynonym()</code> will recognize <code class="prettyprint">editown</code> as <code class="prettyprint">edit</code> if <code class="prettyprint">editown</code> isn&rsquo;t defined in the permission class&rsquo; <code class="prettyprint">$this-&gt;permissions</code> property for the requested level.</p>

<div class="clear-right"></div>

<h4 id="manipulating-permissions-before-saving">Manipulating Permissions before Saving</h4>
<pre><code class="highlight php"> <span class="cp">&lt;?php</span>

     <span class="sd">/**
      * @param array $permissions     Addon specific permissions
      * @param       $allPermissions  All role permissions
      * @param bool  $isSecondRound   Is round two after permissions have been updated by all permission classes 
      *
      * @return bool Return true if a second round is required; default false
      */</span>
     <span class="k">public</span> <span class="k">function</span> <span class="nf">analyzePermissions</span><span class="p">(</span><span class="k">array</span> <span class="o">&amp;</span><span class="nv">$permissions</span><span class="p">,</span> <span class="nv">$allPermissions</span><span class="p">,</span> <span class="nv">$isSecondRound</span> <span class="o">=</span> <span class="kc">false</span><span class="p">)</span>
     <span class="p">{</span>
         <span class="k">foreach</span> <span class="p">(</span><span class="nv">$permissions</span> <span class="k">as</span> <span class="nv">$level</span> <span class="o">=&gt;</span> <span class="o">&amp;</span><span class="nv">$perms</span><span class="p">)</span> <span class="p">{</span>
             <span class="k">foreach</span> <span class="p">(</span><span class="nv">$perms</span> <span class="k">as</span> <span class="nv">$perm</span><span class="p">)</span> <span class="p">{</span>
                 <span class="nv">$include</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
                 <span class="k">switch</span> <span class="p">(</span><span class="nv">$perm</span><span class="p">)</span> <span class="p">{</span>
                     <span class="k">case</span> <span class="s1">'send_probe'</span><span class="o">:</span>
                         <span class="nv">$include</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">'use_telescope'</span><span class="p">);</span>
                         <span class="k">break</span><span class="p">;</span>
                     <span class="k">case</span> <span class="s1">'visit'</span><span class="o">:</span>
                         <span class="nv">$include</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">'use_telescope'</span><span class="p">,</span> <span class="s1">'send_probe'</span><span class="p">);</span>
                         <span class="k">break</span><span class="p">;</span>
                 <span class="p">}</span>
                 <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$include</span><span class="p">))</span> <span class="p">{</span>
                     <span class="k">foreach</span> <span class="p">(</span><span class="nv">$include</span> <span class="k">as</span> <span class="nv">$r</span><span class="p">)</span> <span class="p">{</span>
                         <span class="k">list</span><span class="p">(</span><span class="nv">$ignore</span><span class="p">,</span> <span class="nv">$r</span><span class="p">)</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getSynonym</span><span class="p">(</span><span class="nv">$level</span><span class="p">,</span> <span class="nv">$r</span><span class="p">);</span>
                         <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">isSupported</span><span class="p">(</span><span class="nv">$level</span><span class="p">,</span> <span class="nv">$r</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$r</span><span class="p">,</span> <span class="nv">$perms</span><span class="p">))</span> <span class="p">{</span>
                             <span class="nv">$perms</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$r</span><span class="p">;</span>
                         <span class="p">}</span>
                     <span class="p">}</span>
                 <span class="p">}</span>
             <span class="p">}</span>
         <span class="p">}</span>

         <span class="c1">// Return true if this method needs a second round after all the other bundles have adjusted permissions
</span>         <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
     <span class="p">}</span>
</code></pre>

<p>Addon&rsquo;s can adjust permissions based on other selected permissions in order to prevent &lsquo;user error.&rsquo; For example, if a user has permission to <code class="prettyprint">edit</code>, then the user also needs permission to <code class="prettyprint">view</code> whether that was selected in the Role form or not. The method <code class="prettyprint">analyzePermissions()</code>  can be be used for this which gives opportunity to the addon to modify permissions based on other selections before persisting to the database. </p>

<p>Sometimes, it may be necessary to re-adjust based on a permission that is outside the addon&rsquo;s control. In this case, <code class="prettyprint">analyzePermissions()</code> can return true and it will be called again after all the permissions have been analyzed by the other bundles and addons. In this case, the argument <code class="prettyprint">$isSecondRound</code> will be true.</p>

<h4 id="advanced-isgranted-logic">Advanced isGranted Logic</h4>

<p>If it is necessary to perform some logic other than simply comparing bits, the permission class can override the parent&rsquo;s <code class="prettyprint">public function isGranted($userPermissions, $name, $level)</code> and do whatever is necessary for it&rsquo;s own permission levels and individual permissions.</p>

<h4 id="advanced-issupported-logic">Advanced isSupported Logic</h4>

<p>The same can be applied for the method <code class="prettyprint">isSupported()</code> which is used to determine if a bundle or addon includes the requested permission and permission level. This can also be used to provide BC support.</p>

          <h2 id="custom-config-params">Custom Config Params</h2>

<p>Mautic&rsquo;s configuration is stored in app/config/local.php. Addon&rsquo;s can leverage custom config parameters to use within it&rsquo;s code.</p>

<p>Each configuration option desired should be defined and have a default set in the <a href="#parameters">addon&rsquo;s config file</a>. This prevents Symfony from throwing errors if the parameter is used during cache compilation or if accessed directly from the container without checking if it exists first. Defining the parameters in the addon&rsquo;s config file will ensure that it always exists.</p>

<p>To add config options to the Configuration page, an <a href="#subscribers">event subscriber</a>, a config <a href="#forms">form type</a>, and a <a href="#views">specific view</a> are required.</p>

<aside class="notice">
To translate the addon&rsquo;s tab in the configuration form, be sure to include <code>mautic.config.tab.helloworld_config</code> in the addon&rsquo;s messages.ini file. Of course replace helloworld_config with whatever is used as the formAlias when registering the form in the event subscriber (explained below).
</aside>

<h3 id="config-event-subscriber">Config Event Subscriber</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="c1">// addons/HelloWorldBundle/EventListener/ConfigSubscriber.php
</span>
<span class="k">namespace</span> <span class="nx">MauticAddons\HelloWorldBundle\EventListener</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Mautic\ConfigBundle\Event\ConfigEvent</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Mautic\CoreBundle\EventListener\CommonSubscriber</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Mautic\ConfigBundle\ConfigEvents</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Mautic\ConfigBundle\Event\ConfigBuilderEvent</span><span class="p">;</span>

<span class="sd">/**
 * Class ConfigSubscriber
 */</span>
<span class="k">class</span> <span class="nc">ConfigSubscriber</span> <span class="k">extends</span> <span class="nx">CommonSubscriber</span>
<span class="p">{</span>

    <span class="sd">/**
     * @return array
     */</span>
    <span class="k">static</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">getSubscribedEvents</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">array</span><span class="p">(</span>
            <span class="nx">ConfigEvents</span><span class="o">::</span><span class="na">CONFIG_ON_GENERATE</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'onConfigGenerate'</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="nx">ConfigEvents</span><span class="o">::</span><span class="na">CONFIG_PRE_SAVE</span>    <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'onConfigSave'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**
     * @param ConfigBuilderEvent $event
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">onConfigGenerate</span><span class="p">(</span><span class="nx">ConfigBuilderEvent</span> <span class="nv">$event</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">addForm</span><span class="p">(</span>
            <span class="k">array</span><span class="p">(</span>
                <span class="s1">'formAlias'</span>  <span class="o">=&gt;</span> <span class="s1">'helloworld_config'</span><span class="p">,</span>
                <span class="s1">'formTheme'</span>  <span class="o">=&gt;</span> <span class="s1">'HelloWorldBundle:FormTheme\Config'</span><span class="p">,</span>
                <span class="s1">'parameters'</span> <span class="o">=&gt;</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getParametersFromConfig</span><span class="p">(</span><span class="s1">'HelloWorldBundle'</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**
     * @param ConfigEvent $event
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">onConfigSave</span><span class="p">(</span><span class="nx">ConfigEvent</span> <span class="nv">$event</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="sd">/** @var array $values */</span>
        <span class="nv">$values</span> <span class="o">=</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getConfig</span><span class="p">();</span>

        <span class="c1">// Manipulate the values
</span>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$values</span><span class="p">[</span><span class="s1">'helloworld_config'</span><span class="p">][</span><span class="s1">'custom_config_option'</span><span class="p">]))</span> <span class="p">{</span>
            <span class="nv">$values</span><span class="p">[</span><span class="s1">'helloworld_config'</span><span class="p">][</span><span class="s1">'custom_config_option'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="nv">$values</span><span class="p">[</span><span class="s1">'helloworld_config'</span><span class="p">][</span><span class="s1">'custom_config_option'</span><span class="p">]);</span>
        <span class="p">}</span>

        <span class="c1">// Set updated values 
</span>        <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">setConfig</span><span class="p">(</span><span class="nv">$values</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>The event subscriber will listen to the <code class="prettyprint">ConfigEvents::CONFIG_ON_GENERATE</code> and <code class="prettyprint">ConfigEvents::CONFIG_PRE_SAVE</code> events.  </p>

<p>The <code class="prettyprint">ConfigEvents::CONFIG_ON_GENERATE</code> is dispatched when the configuration form is built giving the addon an opportunity to inject it&rsquo;s own tab and config options.</p>

<p>To do this, the addon must register it&rsquo;s configuration details through the method assigned to the <code class="prettyprint">ConfigEvents::CONFIG_ON_GENERATE</code> event. The \Mautic\ConfigBundle\Event\ConfigBuilderEvent object is passed into the method and expects the method to call <code class="prettyprint">addForm()</code>. <code class="prettyprint">addForm()</code> expects an array with the following elements:</p>

<table><thead>
<tr>
<th>Key</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>formAlias</strong></td>
<td>Alias of the form type class that sets the expected form elements</td>
</tr>
<tr>
<td><strong>formTheme</strong></td>
<td>View to format the configuration form elements, i.e, <code class="prettyprint">HelloWorldBundle:FormTheme\Config</code></td>
</tr>
<tr>
<td><strong>parameters</strong></td>
<td>Array of custom config elements. <code class="prettyprint">$event-&gt;getParametersFromConfig(&#39;HelloWorldBundle&#39;)))</code> can be used to glean them from the addon&rsquo;s config file.</td>
</tr>
</tbody></table>

<p>The <code class="prettyprint">ConfigEvents::CONFIG_PRE_SAVE</code> is called before the values from the form are rendered and saved to the local.php file. This gives the addon an opportunity to clean up or manipulate the data before it is written.</p>

<p>Remember that the subscriber must be registered through the addon&rsquo;s config in the <code class="prettyprint">services[events]</code> <a href="#services">section</a>.</p>

<h3 id="config-form">Config Form</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="c1">// addons/HelloWorldBundle/Form/Type/ConfigType.php
</span>
<span class="k">namespace</span> <span class="nx">MauticAddons\HelloWorldBundle\Form\Type</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Component\Form\AbstractType</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Form\FormBuilderInterface</span><span class="p">;</span>

<span class="sd">/**
 * Class ConfigType
 */</span>
<span class="k">class</span> <span class="nc">ConfigType</span> <span class="k">extends</span> <span class="nx">AbstractType</span>
<span class="p">{</span>
    <span class="sd">/**
     * @param FormBuilderInterface $builder
     * @param array                $options
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">buildForm</span><span class="p">(</span><span class="nx">FormBuilderInterface</span> <span class="nv">$builder</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$options</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$builder</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span>
            <span class="s1">'custom_config_option'</span><span class="p">,</span>
            <span class="s1">'text'</span><span class="p">,</span>
            <span class="k">array</span><span class="p">(</span>
                <span class="s1">'label'</span> <span class="o">=&gt;</span> <span class="s1">'addon.helloworld.config.custom_config_option'</span><span class="p">,</span>
                <span class="s1">'data'</span>  <span class="o">=&gt;</span> <span class="nv">$options</span><span class="p">[</span><span class="s1">'data'</span><span class="p">][</span><span class="s1">'custom_config_option'</span><span class="p">],</span>
                <span class="s1">'attr'</span>  <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                    <span class="s1">'tooltip'</span> <span class="o">=&gt;</span> <span class="s1">'addon.helloworld.config.custom_config_option_tooltip'</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**
     * {@inheritdoc}
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getName</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s1">'helloworld_config'</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>The form type is used to generate the form fields in the main configuration form. Refer to <a href="#forms">Forms</a> for more information on using form types.</p>

<p>Remember that the form type must be registered through the addon&rsquo;s config in the <code class="prettyprint">services[forms]</code> <a href="#services">section</a>.</p>

<h3 id="config-template">Config Template</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="c1">// addons/HelloWorldBundle/Views/FormTheme/Config/_config_helloworld_config_widget.html.php
</span>
<span class="cp">?&gt;</span>

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"panel panel-primary"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"panel-heading"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;h3</span> <span class="na">class=</span><span class="s">"panel-title"</span><span class="nt">&gt;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">'translator'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">trans</span><span class="p">(</span><span class="s1">'mautic.config.tab.helloworld_config'</span><span class="p">);</span> <span class="cp">?&gt;</span><span class="nt">&lt;/h3&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"panel-body"</span><span class="nt">&gt;</span>
        <span class="cp">&lt;?php</span> <span class="k">foreach</span> <span class="p">(</span><span class="nv">$form</span><span class="o">-&gt;</span><span class="na">children</span> <span class="k">as</span> <span class="nv">$f</span><span class="p">)</span><span class="o">:</span> <span class="cp">?&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-md-6"</span><span class="nt">&gt;</span>
                    <span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">'form'</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">row</span><span class="p">(</span><span class="nv">$f</span><span class="p">);</span> <span class="cp">?&gt;</span>
                <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="cp">&lt;?php</span> <span class="k">endforeach</span><span class="p">;</span> <span class="cp">?&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre>

<p>Registering a formTheme as <code class="prettyprint">HelloWorldBundle:FormTheme\Config</code> in the event listener told the ConfigBundle to look in the HelloWorldBundle&rsquo;s Views/FormTheme/Config folder for templates. Specifically, it will look for a template named <code class="prettyprint">_config_{formAlias}_widget.html.php</code> where <code class="prettyprint">{formAlias}</code> is the same as <code class="prettyprint">formAlias</code> set in the addon&rsquo;s <code class="prettyprint">ConfigEvents::CONFIG_ON_GENERATE</code> event listener.</p>

<p>The template should be in a panel format to match the rest of the config UI.</p>

          <h2 id="miscellaneous">Miscellaneous</h2>

          <h3 id="flash-messages">Flash Messages</h3>

<h3 id="notifications">Notifications</h3>

          <h3 id="helpers">Helpers</h3>

<h4 id="input-helper">Input Helper</h4>

<h4 id="cookie-helper">Cookie Helper</h4>

<h4 id="date/time-helper">Date/Time Helper</h4>

<h4 id="mail-helper">Mail Helper</h4>

          <h3 id="forms">Forms</h3>

<h4 id="form-types">Form Types</h4>

<h4 id="validation">Validation</h4>

<h4 id="form-themes">Form Themes</h4>

<h4 id="form-template-helper">Form Template Helper</h4>

          <h3 id="events">Events</h3>

<h4 id="subscribers">Subscribers</h4>

<h4 id="custom-events">Custom Events</h4>

          <h3 id="event-reference">Event Reference</h3>

          <h3 id="javascript-methods">Javascript Methods</h3>

          <h2 id="extending-mautic">Extending Mautic</h2>

          <h3 id="extending-api">Extending API</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="c1">// addons/HelloWorldBundle/Config/config.php
</span>
<span class="k">return</span> <span class="k">array</span><span class="p">(</span>
    <span class="c1">// ...
</span>
    <span class="s1">'routes'</span>   <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>

        <span class="c1">// ...
</span>
        <span class="s1">'api'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">'addon_helloworld_api'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">'path'</span>       <span class="o">=&gt;</span> <span class="s1">'/hello/worlds'</span><span class="p">,</span>
                <span class="s1">'controller'</span> <span class="o">=&gt;</span> <span class="s1">'HelloWorldBundle:Api:worlds'</span><span class="p">,</span>
                <span class="s1">'method'</span>     <span class="o">=&gt;</span> <span class="s1">'GET'</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="p">),</span>

    <span class="c1">// ...
</span><span class="p">);</span>
</code></pre>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="c1">// addons/HelloWorldBundle/Controller/ApiController.php
</span>
<span class="k">namespace</span> <span class="nx">Mautic\LeadBundle\Controller\Api</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">FOS\RestBundle\Util\Codes</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Mautic\ApiBundle\Controller\CommonApiController</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ApiController</span> <span class="k">extends</span> <span class="nx">CommonApiController</span>
<span class="p">{</span>

    <span class="sd">/**
     * Get a list of worlds
     * 
     * @return \Symfony\Component\HttpFoundation\Response
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getWorldsAction</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">factory</span><span class="o">-&gt;</span><span class="na">getSecurity</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">isGranted</span><span class="p">(</span><span class="s1">'addon:helloWorld:worlds:view'</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">accessDenied</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="nv">$filter</span>  <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'filter'</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
        <span class="nv">$limit</span>   <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'limit'</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
        <span class="nv">$start</span>   <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'start'</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>

        <span class="sd">/** @var \MauticAddons\HelloWorldBundle\Model\WorldsModel $model */</span>
        <span class="nv">$model</span>   <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">factory</span><span class="o">-&gt;</span><span class="na">getModel</span><span class="p">(</span><span class="s1">'addon.helloWorld.worlds'</span><span class="p">);</span>

        <span class="nv">$worlds</span>  <span class="o">=</span> <span class="nv">$model</span><span class="o">-&gt;</span><span class="na">getWorlds</span><span class="p">(</span><span class="nv">$filter</span><span class="p">,</span> <span class="nv">$limit</span><span class="p">,</span> <span class="nv">$start</span><span class="p">);</span>
        <span class="nv">$worlds</span>  <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">view</span><span class="p">(</span><span class="nv">$worlds</span><span class="p">,</span> <span class="nx">Codes</span><span class="o">::</span><span class="na">HTTP_OK</span><span class="p">);</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">handleView</span><span class="p">(</span><span class="nv">$worlds</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>To add custom API endpoints, simply define the routes under the API firewall in the <a href="#routes">addon&rsquo;s config file</a>. This will place the route behind /api which will only be accessible if the requester has been authorized via OAuth.</p>

<p>The api controller(s), should extend <code class="prettyprint">Mautic\ApiBundle\Controller\CommonApiController</code> to leverage the helper methods provided and to utilize the REST views.</p>

          <h3 id="extending-campaigns">Extending Campaigns</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="c1">// addons/HelloWorldBundle/EventListener/CampaignSubscriber.php
</span>
<span class="k">namespace</span> <span class="nx">MauticAddons\HelloWorldBundle\Events</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Mautic\CoreBundle\EventListener\CommonSubscriber</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Mautic\CampaignBundle\Event</span> <span class="k">as</span> <span class="nx">Events</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Mautic\CampaignBundle\CampaignEvents</span><span class="p">;</span>

<span class="sd">/**
* Class CampaignSubscriber
*/</span>
<span class="k">class</span> <span class="nc">CampaignSubscriber</span> <span class="k">extends</span> <span class="nx">CommonSubscriber</span>
<span class="p">{</span>

    <span class="sd">/**
     * @return array
     */</span>
    <span class="k">static</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">getSubscribedEvents</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">array</span><span class="p">(</span>
            <span class="nx">CampaignEvents</span><span class="o">::</span><span class="na">CAMPAIGN_ON_BUILD</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'onCampaignBuild'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**
     * Add campaign decision and actions
     *
     * @param Events\CampaignBuilderEvent $event
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">onCampaignBuild</span><span class="p">(</span><span class="nx">Events\CampaignBuilderEvent</span> <span class="nv">$event</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Register custom action
</span>        <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">addAction</span><span class="p">(</span>
            <span class="s1">'helloworld.send_offworld'</span><span class="p">,</span>
            <span class="k">array</span><span class="p">(</span>
                <span class="s1">'label'</span>           <span class="o">=&gt;</span> <span class="s1">'addon.helloworld.campaign.send_offworld'</span><span class="p">,</span>
                <span class="s1">'description'</span>     <span class="o">=&gt;</span> <span class="s1">'addon.helloworld.campaign.send_offworld_descr'</span><span class="p">,</span>
                <span class="c1">// Set custom parameters to configure the decision
</span>                <span class="s1">'formType'</span>        <span class="o">=&gt;</span> <span class="s1">'helloworld_worlds'</span><span class="p">,</span>
                <span class="c1">// Set a custom formTheme to customize the layout of elements in formType
</span>                <span class="s1">'formTheme'</span>       <span class="o">=&gt;</span> <span class="s1">'HelloWorldBundle:FormTheme\SubmitAction'</span>
                <span class="c1">// Set custom options to pass to the form type, if applicable 
</span>                <span class="s1">'formTypeOptions'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                    <span class="s1">'world'</span> <span class="o">=&gt;</span> <span class="s1">'mars'</span>
                <span class="p">),</span>
                <span class="c1">// Static callback function to execute this action
</span>                <span class="s1">'callback'</span>        <span class="o">=&gt;</span> <span class="s1">'\MauticAddons\HelloWorldBundle\Helper\CampaignEventHelper::sendLeadOffworld'</span>
            <span class="p">)</span>
        <span class="p">);</span>

        <span class="c1">// Register custom decision (executes when a lead "makes a decision" i.e. executes some direct action 
</span>        <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">addLeadDecision</span><span class="p">(</span>
            <span class="s1">'helloworld.visits_mars'</span><span class="p">,</span>
            <span class="k">array</span><span class="p">(</span>
                <span class="s1">'label'</span>           <span class="o">=&gt;</span> <span class="s1">'addon.helloworld.campaign.visits_mars'</span><span class="p">,</span>
                <span class="s1">'description'</span>     <span class="o">=&gt;</span> <span class="s1">'addon.helloworld.campaign.visits_mars_descr'</span><span class="p">,</span>
                <span class="c1">// Same as registering an action
</span>                <span class="s1">'formType'</span>        <span class="o">=&gt;</span> <span class="kc">false</span><span class="p">,</span>
                <span class="s1">'formTypeOptions'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(),</span>
                <span class="c1">// Optional static callback function to validate whether the decision should be executed or not 
</span>                <span class="s1">'callback'</span>        <span class="o">=&gt;</span> <span class="s1">'\MauticAddons\HelloWorldBundle\Helper\CampaignEventHelper::validateVisitation'</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>Addons can add their own campaign actions and decisions by listening to the <code class="prettyprint">\Mautic\CampaignBundle\CampaignEvents::CAMPAIGN_ON_BUILD</code> event.  Read more about <a href="#events">listeners and subscribers</a>. </p>

<h4 id="campaign-actions">Campaign Actions</h4>

<p>To add an action, use the <code class="prettyprint">$event-&gt;addAction($identifier, $parameters)</code> method. <code class="prettyprint">$identifier</code> must be something unique. The <code class="prettyprint">$parameters</code> array can contain the following elements:</p>

<table><thead>
<tr>
<th>Key</th>
<th>Required</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>label</strong></td>
<td>REQUIRED</td>
<td>string</td>
<td>The language string to use for the draggable&rsquo;s label</td>
</tr>
<tr>
<td><strong>description</strong></td>
<td>OPTIONAL</td>
<td>string</td>
<td>The language string to use for the draggable&rsquo;s tooltip</td>
</tr>
<tr>
<td><strong>callback</strong></td>
<td>REQUIRED</td>
<td>mixed</td>
<td>Static callback function that will be called for the action and should contain the logic to execute the custom action</td>
</tr>
<tr>
<td><strong>formType</strong></td>
<td>OPTIONAL</td>
<td>string</td>
<td>The alias of a custom form type used to set config options for the decision</td>
</tr>
<tr>
<td><strong>formTypeOptions</strong></td>
<td>OPTIONAL</td>
<td>array</td>
<td>Array of options to include into the formType&rsquo;s $options argument</td>
</tr>
<tr>
<td><strong>formTypeCleanMasks</strong></td>
<td>OPTIONAL</td>
<td>array</td>
<td>Array of input masks to clean a values from formType</td>
</tr>
<tr>
<td><strong>formTypeTheme</strong></td>
<td>OPTIONAL</td>
<td>string</td>
<td>Theme to customize elements for formType</td>
</tr>
</tbody></table>

<p>The action&rsquo;s callback can accept the following variables (determined via ReflectionMethod::invokeArgs()):</p>

<table><thead>
<tr>
<th>Variable</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>config</strong></td>
<td>array</td>
<td>Options configured by user for the custom formType</td>
</tr>
<tr>
<td><strong>event</strong></td>
<td>array</td>
<td>Details of the current event executed</td>
</tr>
<tr>
<td><strong>lead</strong></td>
<td>\Mautic\LeadBundle\Entity\Lead</td>
<td>The lead executing the event</td>
</tr>
<tr>
<td><strong>factory</strong></td>
<td>\Mautic\CoreBundle\Factory\MauticFactory</td>
<td><a href="#factory-service">Mautic&rsquo;s factory service</a></td>
</tr>
<tr>
<td><strong>eventDetails</strong></td>
<td>mixed</td>
<td>Whatever the triggering decision passes into the triggerEvent method. It could be the Email entity that was opened, an array, null, etc.</td>
</tr>
<tr>
<td><strong>systemTriggered</strong></td>
<td>boolean</td>
<td>Notes if the action was executed directly by the lead (false) or by the system (true)</td>
</tr>
</tbody></table>

<h4 id="campaign-decisions">Campaign Decisions</h4>
<pre><code class="highlight php"> <span class="cp">&lt;?php</span>
 <span class="c1">// Trigger configured 'helloworld.visits_mars' decisions
</span>
 <span class="sd">/** @var \Mautic\CampaignBundle\Model\CampaignModel $campaignModel */</span>
 <span class="nv">$campaignModel</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">factory</span><span class="o">-&gt;</span><span class="na">getModel</span><span class="p">(</span><span class="s1">'campaign.event'</span><span class="p">);</span>

 <span class="c1">// Can be anything and passed into action callbacks as $eventDetails
</span> <span class="nv">$customPassthrough</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>

 <span class="c1">// Some optional unique identifier for this specific trigger that is used mainly for debug logging; for example, can be a concatenation of the decision name + lead ID
</span> <span class="nv">$uniqueTriggerId</span>   <span class="o">=</span> <span class="s1">'something_something'</span><span class="p">;</span>

 <span class="nv">$campaignModel</span><span class="o">-&gt;</span><span class="na">triggerEvent</span><span class="p">(</span><span class="s1">'helloworld.visits_mars'</span><span class="p">,</span> <span class="nv">$customPassthroughToActions</span><span class="p">,</span> <span class="nv">$uniqueTriggerId</span><span class="p">);</span>
</code></pre>

<p>Campaign decisions are registered exactly as a campaign action except it uses the <code class="prettyprint">$event-&gt;addLeadDecision($identifier, $parameters)</code> method. The only difference in the <code class="prettyprint">$parameters</code> arguments is that the function defined in the <code class="prettyprint">callback</code> element is used to validate the decision rather than execute some action. For example, if the decision is configured to only apply to a specific ID chosen by the user (defined in the <code class="prettyprint">formType</code>), the callback function may could compare the decision&rsquo;s <code class="prettyprint">$eventDetails[&#39;id&#39;]</code> (see below) with the event&rsquo;s<code class="prettyprint">$config[&#39;id&#39;]</code>. If the decision should execue the actions associated with it, return <code class="prettyprint">true</code>.  Otherwise return <code class="prettyprint">false</code> and nothing will be executed or logged.</p>

<p>For custom decisions to work, there must be a trigger executed when the lead makes the decision. Thus, where ever is appropriate in the addon&rsquo;s code logic, add something similar to what&rsquo;s in the example code block. </p>

<p>The <code class="prettyprint">triggerEvent()</code> method will pull all the triggered decisions (<code class="prettyprint">helloworld.visits_mars</code> in the code example) for published campaigns the lead is in, execute the decisions callback (if configured) for validation, then execute the associated actions if appropriate.</p>

          <h3 id="extending-categories">Extending Categories</h3>

<p>Mautic has a CategoryBundle that can be leveraged to incorporate categories into an addon.</p>

<h4 id="configuring-categories-for-menu">Configuring Categories for Menu</h4>

<p>To add a category menu item for the addon, simply add the following to <code class="prettyprint">menu</code> <a href="#menu">config</a> for whichever menu the item should appear (<code class="prettyprint">main</code> or <code class="prettyprint">admin</code>):</p>

<pre class="inline">
    'mautic.category.menu.index' => array(
        'bundle' => 'addon:helloWorld'
    )
</pre>

<p>The <code class="prettyprint">bundle</code> value needs be prefixed with <code class="prettyprint">addon:</code> as it is used in determining permissions to manage categories. The <code class="prettyprint">helloWorld</code> should be the bundle name of the addon.</p>

<h4 id="configuring-categories-for-routes">Configuring Categories for Routes</h4>

<p>There is no need to add custom routes for categories. However, when <a href="#router">generating a URL</a> to the addon&rsquo;s category list, use</p>

<pre class="inline">
$categoryUrl = $router->generateUrl('mautic_category_index', array('bundle' => 'addon:helloWorld'));
</pre>

<h4 id="including-category-in-forms">Including Category in Forms</h4>

<p>To add a category select list to a <a href="#forms">form</a>, use <code class="prettyprint">category</code> as the form type and pass <code class="prettyprint">bundle</code> as an option:</p>

<pre class="inline">
    //add category
    $builder->add('category', 'category', array(
        'bundle' => 'addon:helloWorld'
    ));
</pre>

<h4 id="restricting-category-management">Restricting Category Management</h4>

<p>To restrict access to catgories, use the following in the addon&rsquo;s <a href="#roles-and-permissions">Permission class</a>.</p>

<p>In <code class="prettyprint">__construct()</code> add <code class="prettyprint">$this-&gt;addStandardPermissions(&#39;categories&#39;);</code> then in <code class="prettyprint">buildForm()</code>, add <code class="prettyprint">$this-&gt;addStandardFormFields(&#39;helloWorld&#39;, &#39;categories&#39;, $builder, $data);</code>.</p>

<p>See a code example in <a href="#roles-and-permissions">Roles and Permissions</a>.</p>

<p>The two standard helper methods will add the permissions of <code class="prettyprint">view</code>, <code class="prettyprint">edit</code>, <code class="prettyprint">create</code>, <code class="prettyprint">delete</code>, <code class="prettyprint">publish</code>, and <code class="prettyprint">full</code> for categories.</p>

          <h3 id="extending-emails">Extending Emails</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="c1">// addons/HelloWorldBundle/EventListener/EmailSubscriber.php
</span>
<span class="k">namespace</span> <span class="nx">MauticAddons\HelloWorldBundle\EventListener</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Mautic\CoreBundle\EventListener\CommonSubscriber</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Mautic\EmailBundle\EmailEvents</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Mautic\EmailBundle\Event\EmailBuilderEvent</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Mautic\EmailBundle\Event\EmailSendEvent</span><span class="p">;</span>

<span class="sd">/**
 * Class EmailSubscriber
 */</span>
<span class="k">class</span> <span class="nc">EmailSubscriber</span> <span class="k">extends</span> <span class="nx">CommonSubscriber</span>
<span class="p">{</span>

    <span class="sd">/**
     * @return array
     */</span>
    <span class="k">static</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">getSubscribedEvents</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">array</span><span class="p">(</span>
            <span class="nx">EmailEvents</span><span class="o">::</span><span class="na">EMAIL_ON_BUILD</span>   <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'onEmailBuild'</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="nx">EmailEvents</span><span class="o">::</span><span class="na">EMAIL_ON_SEND</span>    <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'onEmailGenerate'</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="nx">EmailEvents</span><span class="o">::</span><span class="na">EMAIL_ON_DISPLAY</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'onEmailGenerate'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**
     * Register the tokens and a custom A/B test winner
     *
     * @param EmailBuilderEvent $event
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">onEmailBuild</span><span class="p">(</span><span class="nx">EmailBuilderEvent</span> <span class="nv">$event</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Add email tokens
</span>        <span class="nv">$content</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">templating</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">'HelloWorldBundle:SubscribedEvents\EmailToken:token.html.php'</span><span class="p">);</span>
        <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">addTokenSection</span><span class="p">(</span><span class="s1">'helloworld.token'</span><span class="p">,</span> <span class="s1">'addon.helloworld.header'</span><span class="p">,</span> <span class="nv">$content</span><span class="p">);</span>

        <span class="c1">// Add AB Test Winner Criteria
</span>        <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">addAbTestWinnerCriteria</span><span class="p">(</span>
            <span class="s1">'helloworld.planetvisits'</span><span class="p">,</span>
            <span class="k">array</span><span class="p">(</span>
                <span class="c1">// Label to group by
</span>                <span class="s1">'group'</span>    <span class="o">=&gt;</span> <span class="s1">'addon.helloworld.header'</span><span class="p">,</span>

                <span class="c1">// Label for this specific a/b test winning criteria
</span>                <span class="s1">'label'</span>    <span class="o">=&gt;</span> <span class="s1">'addon.helloworld.emailtokens.'</span><span class="p">,</span>

                <span class="c1">// Static callback function that will be used to determine the winner
</span>                <span class="s1">'callback'</span> <span class="o">=&gt;</span> <span class="s1">'\MauticAddons\HelloWorldBundle\Helper\AbTestHelper::determinePlanetVisitWinner'</span>
            <span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**
     * Search and replace tokens with content
     *
     * @param EmailSendEvent $event
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">onEmailGenerate</span><span class="p">(</span><span class="nx">EmailSendEvent</span> <span class="nv">$event</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Get content
</span>        <span class="nv">$content</span> <span class="o">=</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getContent</span><span class="p">();</span>

        <span class="c1">// Search and replace tokens
</span>        <span class="nv">$content</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s1">'{hello}'</span><span class="p">,</span> <span class="s1">'world!'</span><span class="p">,</span> <span class="nv">$content</span><span class="p">);</span>

        <span class="c1">// Set updated content
</span>        <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">setContent</span><span class="p">(</span><span class="nv">$content</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>There are two way to extend emails: email tokens used to insert dynamic content into an email and a/b test winning criteria . Both leverage the <code class="prettyprint">\Mautic\EmailBundle\EmailEvents::EMAIL_ON_BUILD</code> event. Read more about <a href="#events">listeners and subscribers</a>.</p>

<h4 id="email-tokens">Email Tokens</h4>

<p>Email tokens are placeholders that are inserted into an email that can be replaced by dynamic content when the email is sent or viewed in the browser.</p>

<p><code class="prettyprint">$event-&gt;addTokenSection($uniqueId, $headerTranslationKey, $htmlContent)</code> is used to generate the section for drag and drop tokens in the email builder.  </p>

<p><code class="prettyprint">$uniqueId</code> must be unique. </p>

<p><code class="prettyprint">$headerTranslationKey</code> is the translation key that will be used to create the section&rsquo;s header.</p>

<p><code class="prettyprint">$htmlContent</code> is the HTML that will be inserted into the builder&rsquo;s token list for this token&rsquo;s section. <code class="prettyprint">$this-&gt;templating-&gt;render()</code> can be used to render a specific view&rsquo;s content (using <a href="#views">view notation</a>. There is free reign as to what the HTML will look like but the important part is that the elements representing the tokens must have the attribute <code class="prettyprint">data-token=&quot;{token_text}&quot;</code> in order for the builder to recognize them.</p>

<p>For example, <code class="prettyprint">&lt;a href=&quot;#&quot; data-token=&quot;{hello}&quot; class=&quot;btn btn-default btn-block&quot;&gt;Translated Token Text&lt;/a&gt;</code></p>

<h5 id="custom-token-handling">Custom Token Handling</h5>

<p>To convert the token into a link while requesting what the links text should be, use the attributes <code class="prettyprint">data-token=&#39;&lt;a href=&quot;%url={hello}%&quot;&gt;%text%&lt;/a&gt;&#39; data-drop=&quot;showBuilderLinkModal&quot;</code> (replacing <code class="prettyprint">hello</code> with the addon&rsquo;s custom token).</p>

<p>To request simple feedback from the user and inject it into the token, use the attributes <code class="prettyprint">data-token=&#39;{hello=%world%}&#39; data-drop=&quot;showBuilderFeedbackModal&quot;</code>. A modal will appear with a simple input box. Whatever the user inputs will replace <code class="prettyprint">%world%</code>.</p>

<p>If you need more control or more customization, create and define a custom JS function within the Mautic namespace (i.e. <code class="prettyprint">Mautic.customFunction</code> and use the attribute <code class="prettyprint">data-drop=&quot;customFunction&quot;</code>. When a user drops the token, <code class="prettyprint">Mautic.customFunction()</code> passing the arguments event (jQuery Event), ui (jQuery UI object with draggable, helper, etc), editorId (ID of the inline CkEditor).</p>

<pre class="inline">
Mautic.customFunction = function (event, ui, editorId) {
    var token  = mQuery(ui.draggable).data('token');
    
    // Do something fancy then insert token
        
    Mautic.insertBuilderEditorToken(editorId, token);
};
</pre>

<h4 id="email-a/b-test-winner-criteria">Email A/B Test Winner Criteria</h4>

<p>To add a custom an a/b test winner criteria, i.e. a test to compare specific aspects of an email to determine what made it more successful over it&rsquo;s variants, use <code class="prettyprint">$event-&gt;addAbTestWinnerCriteria($uniqueId, $parameters)</code>.</p>

<p><code class="prettyprint">$parameters</code> can have the following elements:</p>

<table><thead>
<tr>
<th>Key</th>
<th>Required</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>group</strong></td>
<td>REQUIRED</td>
<td>string</td>
<td>Translation string to group criteria by in the dropdown select list</td>
</tr>
<tr>
<td><strong>label</strong></td>
<td>OPTIONAL</td>
<td>string</td>
<td>Label for this option in the drop down list</td>
</tr>
<tr>
<td><strong>callback</strong></td>
<td>REQUIRED</td>
<td>mixed</td>
<td>Static callback function that will be called to determine the winner when the email detail page is viewed</td>
</tr>
<tr>
<td><strong>formType</strong></td>
<td>OPTIONAL</td>
<td>string</td>
<td>The alias of a custom form type used to set config options for the decision</td>
</tr>
<tr>
<td><strong>formTypeOptions</strong></td>
<td>OPTIONAL</td>
<td>array</td>
<td>Array of options to include into the formType&rsquo;s $options argument</td>
</tr>
<tr>
<td><strong>formTypeCleanMasks</strong></td>
<td>OPTIONAL</td>
<td>array</td>
<td>Array of input masks to clean a values from formType</td>
</tr>
<tr>
<td><strong>formTypeTheme</strong></td>
<td>OPTIONAL</td>
<td>string</td>
<td>Theme to customize elements for formType</td>
</tr>
</tbody></table>

<p>The callback can accept the following variables (determined via ReflectionMethod::invokeArgs()):</p>

<table><thead>
<tr>
<th>Variable</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>$properties</strong></td>
<td>array</td>
<td>Array of elements saved from the configured formType; keyed by email ID in the case of multiple variants</td>
</tr>
<tr>
<td><strong>$factory</strong></td>
<td>Mautic\CoreBundle\Factory\MauticFactory</td>
<td><a href="#factory-service">Mautic&rsquo;s factory service</a></td>
</tr>
<tr>
<td><strong>$email</strong></td>
<td>Mautic\EmailBundle\Entity\Email</td>
<td>Email entity for the displayed email</td>
</tr>
<tr>
<td><strong>$parent</strong></td>
<td>Mautic\EmailBundle\Entity\Email</td>
<td>Email entity for the parent of the email entity</td>
</tr>
<tr>
<td><strong>$children</strong></td>
<td>Doctrine\Common\Collections\ArrayCollection</td>
<td>All variants of the parent email</td>
</tr>
</tbody></table>

<p>The callback function should return an array keyed with the following elements:</p>

<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>winners</strong></td>
<td>array</td>
<td>Array of IDs of the winners (array in case of a tie)</td>
</tr>
<tr>
<td><strong>support</strong></td>
<td>mixed</td>
<td>Passed to the view defined by supportTemplate below in order to render visual support for the winners (such as a graph, etc)</td>
</tr>
<tr>
<td><strong>supportTemplate</strong></td>
<td>string</td>
<td>View notation to render content for the A/B stats modal. For example, <code class="prettyprint">HelloWorldBundle:SubscribedEvents\AbTest:graph.html.php</code></td>
</tr>
</tbody></table>

<pre class="inline">
return array(
   'winners'         => $winners,
   'support'         => $support,
   'supportTemplate' => 'HelloWorldBundle:SubscribedEvents\AbTest:graph.html.php'
);
</pre>

          <h3 id="extending-forms">Extending Forms</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="c1">// addons/HelloWorldBundle/EventListener/FormSubscriber.php
</span>
<span class="k">namespace</span> <span class="nx">MauticAddon\HelloWorldBundle\EventListener</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Mautic\CoreBundle\EventListener\CommonSubscriber</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Mautic\FormBundle\Event</span> <span class="k">as</span> <span class="nx">Events</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Mautic\FormBundle\FormEvents</span><span class="p">;</span>

<span class="sd">/**
 * Class FormSubscriber
 */</span>
<span class="k">class</span> <span class="nc">FormSubscriber</span> <span class="k">extends</span> <span class="nx">CommonSubscriber</span>
<span class="p">{</span>

    <span class="sd">/**
     * {@inheritdoc}
     */</span>
    <span class="k">static</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">getSubscribedEvents</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">array</span><span class="p">(</span>
            <span class="nx">FormEvents</span><span class="o">::</span><span class="na">FORM_ON_BUILD</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'onFormBuilder'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**
     * Add a simple email form
     *
     * @param FormBuilderEvent $event
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">onFormBuilder</span><span class="p">(</span><span class="nx">Events\FormBuilderEvent</span> <span class="nv">$event</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Register a form submit actions
</span>        <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">addSubmitAction</span><span class="p">(</span>
            <span class="s1">'helloworld.sendemail'</span><span class="p">,</span>
            <span class="k">array</span><span class="p">(</span>
                <span class="c1">// Label to group by in the dropdown
</span>                <span class="s1">'group'</span>       <span class="o">=&gt;</span> <span class="s1">'addon.helloworld.header'</span><span class="p">,</span>

                <span class="c1">// Label to list by in the dropdown
</span>                <span class="s1">'label'</span>       <span class="o">=&gt;</span> <span class="s1">'addon.helloworld.formaction.send_email'</span><span class="p">,</span>
                <span class="s1">'description'</span> <span class="o">=&gt;</span> <span class="s1">'addon.helloworld.formaction.send_email_descr'</span><span class="p">,</span>

                <span class="c1">// Form service for custom config options
</span>                <span class="s1">'formType'</span>    <span class="o">=&gt;</span> <span class="s1">'helloworld_worlds'</span><span class="p">,</span>
                <span class="s1">'formTheme'</span>   <span class="o">=&gt;</span> <span class="s1">'HelloWorldBundle:FormTheme\SubmitAction'</span><span class="p">,</span>

                <span class="c1">// Custom validation callback
</span>                <span class="s1">'validator'</span>   <span class="o">=&gt;</span> <span class="s1">'\MauticAddons\HelloWorldBundle\Helper\FormSubmitHelper::validateForm'</span><span class="p">,</span>

                <span class="c1">// Callback method to be executed after the submission 
</span>                <span class="s1">'callback'</span>    <span class="o">=&gt;</span> <span class="s1">'\MauticAddons\HelloWorldBundle\Helper\FormSubmitHelper::sendEmail'</span>
            <span class="p">)</span>
        <span class="p">);</span>

        <span class="c1">// Register a custom form field
</span>        <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">addFormField</span><span class="p">(</span>
            <span class="s1">'helloworld.customfield'</span><span class="p">,</span>
            <span class="k">array</span><span class="p">(</span>
                <span class="c1">// Field label
</span>                <span class="s1">'label'</span>    <span class="o">=&gt;</span> <span class="s1">'addon.helloworld.formfield.customfield'</span><span class="p">,</span>

                <span class="c1">// Form service for the field's configuration
</span>                <span class="s1">'formType'</span> <span class="o">=&gt;</span> <span class="s1">'helloworld_worlds'</span><span class="p">,</span>

                <span class="c1">// Template to use to render the formType
</span>                <span class="s1">'template'</span> <span class="o">=&gt;</span> <span class="s1">'HelloWorldBundle:SubscribedEvents\FormField:customfield.html.php'</span>
            <span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>Forms can be extended by listening to the <code class="prettyprint">\Mautic\FormBundle\FormEvents::FORM_ON_BUILD</code> event.  Read more about <a href="#events">listeners and subscribers</a>. </p>

<h4 id="form-fields">Form Fields</h4>

<p>To add a custom form field, use the <code class="prettyprint">$event-&gt;addFormField($identifier, $parameters)</code> method. <code class="prettyprint">$identifier</code> must be something unique. The <code class="prettyprint">$parameters</code> array can contain the following elements:</p>

<table><thead>
<tr>
<th>Key</th>
<th>Required</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>label</strong></td>
<td>REQUIRED</td>
<td>string</td>
<td>The language string for the option in the dropdown</td>
</tr>
<tr>
<td><strong>formType</strong></td>
<td>REQUIRED</td>
<td>string</td>
<td>The alias of a custom form type used to set config options</td>
</tr>
<tr>
<td><strong>formTypeOptions</strong></td>
<td>OPTIONAL</td>
<td>array</td>
<td>Array of options to include into the formType&rsquo;s $options argument</td>
</tr>
<tr>
<td><strong>formTypeCleanMasks</strong></td>
<td>OPTIONAL</td>
<td>array</td>
<td>Array of input masks to clean a values from formType</td>
</tr>
<tr>
<td><strong>formTypeTheme</strong></td>
<td>OPTIONAL</td>
<td>string</td>
<td>Theme to customize elements for formType</td>
</tr>
<tr>
<td><strong>template</strong></td>
<td>REQUIRED</td>
<td>string</td>
<td>View template used to render the formType</td>
</tr>
<tr>
<td><strong>valueFilter</strong></td>
<td>OPTIONAL</td>
<td>mixed</td>
<td>Filter to use to clean the submitted value as supported by InputHelper or a callback function that accepts the arguments <code class="prettyprint">\Mautic\FormBundle\Entity\Field $field</code> and <code class="prettyprint">$value</code>.</td>
</tr>
<tr>
<td><strong>valueConstraints</strong></td>
<td>OPTIONAL</td>
<td>mixed</td>
<td>Callback function to use to validate the value; the function should accept the arguments <code class="prettyprint">\Mautic\FormBundle\Entity\Field $field</code> and <code class="prettyprint">$filteredValue</code>.</td>
</tr>
<tr>
<td><strong>builderOptions</strong></td>
<td>OPTIONAL</td>
<td>array</td>
<td>Array of boolean options for the form builder: <br />addHelpMessage = true/false<br />addShowLabel = true/false<br />addDefaultValue = true/false<br />addLabelAttributes = true/false<br />addInputAttributes = true/false<br />addIsRequired = true/false</td>
</tr>
</tbody></table>

<h4 id="form-submit-actions">Form Submit Actions</h4>

<p>To add an action, use the <code class="prettyprint">$event-&gt;addSubmitAction($identifier, $parameters)</code> method. <code class="prettyprint">$identifier</code> must be something unique. The <code class="prettyprint">$parameters</code> array can contain the following elements:</p>

<table><thead>
<tr>
<th>Key</th>
<th>Required</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>label</strong></td>
<td>REQUIRED</td>
<td>string</td>
<td>The language string for the option in the dropdown</td>
</tr>
<tr>
<td><strong>description</strong></td>
<td>OPTIONAL</td>
<td>string</td>
<td>The language string to use for the option&rsquo;s tooltip</td>
</tr>
<tr>
<td><strong>validator</strong></td>
<td>OPTIONAL</td>
<td>mixed</td>
<td>Static callback function called to validate the form submission</td>
</tr>
<tr>
<td><strong>callback</strong></td>
<td>REQUIRED</td>
<td>mixed</td>
<td>Static callback function called after a submission (submit action logic goes here)</td>
</tr>
<tr>
<td><strong>formType</strong></td>
<td>OPTIONAL</td>
<td>string</td>
<td>The alias of a custom form type used to set config options</td>
</tr>
<tr>
<td><strong>formTypeOptions</strong></td>
<td>OPTIONAL</td>
<td>array</td>
<td>Array of options to include into the formType&rsquo;s $options argument</td>
</tr>
<tr>
<td><strong>formTypeCleanMasks</strong></td>
<td>OPTIONAL</td>
<td>array</td>
<td>Array of input masks to clean a values from formType</td>
</tr>
<tr>
<td><strong>formTypeTheme</strong></td>
<td>OPTIONAL</td>
<td>string</td>
<td>Theme to customize elements for formType</td>
</tr>
<tr>
<td><strong>template</strong></td>
<td>OPTIONAL</td>
<td>string</td>
<td>View template used to render the formType</td>
</tr>
</tbody></table>

<p>The <code class="prettyprint">callback</code> and <code class="prettyprint">validator</code> functions can accept the following variables (determined via ReflectionMethod::invokeArgs()):</p>

<table><thead>
<tr>
<th>Variable</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>config</strong></td>
<td>array</td>
<td>Values saved from the custom config options in <code class="prettyprint">formType</code></td>
</tr>
<tr>
<td><strong>post</strong></td>
<td>array</td>
<td>$_POST</td>
</tr>
<tr>
<td><strong>server</strong></td>
<td>array</td>
<td>$_SERVER</td>
</tr>
<tr>
<td><strong>factory</strong></td>
<td>Mautic\CoreBundle\Factory\MauticFactory</td>
<td><a href="#factory-service">Mautic&rsquo;s factory service</a></td>
</tr>
<tr>
<td><strong>fields</strong></td>
<td>array</td>
<td>Array of the form&rsquo;s fields</td>
</tr>
<tr>
<td><strong>form</strong></td>
<td>Mautic\FormBundle\Entity\Form</td>
<td>Form entity</td>
</tr>
<tr>
<td><strong>action</strong></td>
<td>Mautic\FormBundle\Entity\Action</td>
<td>Action entity</td>
</tr>
<tr>
<td><strong>submission</strong></td>
<td>Mautic\FormBundle\Entity\Submission</td>
<td>Submission entity for this submission</td>
</tr>
</tbody></table>

          <h3 id="extending-integrations">Extending Integrations</h3>

          <h3 id="extending-landing-pages">Extending Landing Pages</h3>
<pre><code class="highlight php"><span class="cp">&lt;?php</span>
<span class="c1">// addons/HelloWorldBundle/EventListener/PageSubscriber.php
</span>
<span class="k">namespace</span> <span class="nx">MauticAddons\HelloWorldBundle\EventListener</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Mautic\CoreBundle\EventListener\CommonSubscriber</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Mautic\PageBundle\PageEvents</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Mautic\PageBundle\Event\PageBuilderEvent</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Mautic\PageBundle\Event\PageSendEvent</span><span class="p">;</span>

<span class="sd">/**
 * Class PageSubscriber
 */</span>
<span class="k">class</span> <span class="nc">PageSubscriber</span> <span class="k">extends</span> <span class="nx">CommonSubscriber</span>
<span class="p">{</span>

    <span class="sd">/**
     * @return array
     */</span>
    <span class="k">static</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">getSubscribedEvents</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">array</span><span class="p">(</span>
            <span class="nx">PageEvents</span><span class="o">::</span><span class="na">PAGE_ON_BUILD</span>   <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'onPageBuild'</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="nx">PageEvents</span><span class="o">::</span><span class="na">PAGE_ON_DISPLAY</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'onPageDisplay'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**
     * Register the tokens and a custom A/B test winner
     *
     * @param PageBuilderEvent $event
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">onPageBuild</span><span class="p">(</span><span class="nx">PageBuilderEvent</span> <span class="nv">$event</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Add page tokens
</span>        <span class="nv">$content</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">templating</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">'HelloWorldBundle:SubscribedEvents\PageToken:token.html.php'</span><span class="p">);</span>
        <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">addTokenSection</span><span class="p">(</span><span class="s1">'helloworld.token'</span><span class="p">,</span> <span class="s1">'addon.helloworld.header'</span><span class="p">,</span> <span class="nv">$content</span><span class="p">);</span>

        <span class="c1">// Add AB Test Winner Criteria
</span>        <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">addAbTestWinnerCriteria</span><span class="p">(</span>
            <span class="s1">'helloworld.planetvisits'</span><span class="p">,</span>
            <span class="k">array</span><span class="p">(</span>
                <span class="c1">// Label to group by
</span>                <span class="s1">'group'</span>    <span class="o">=&gt;</span> <span class="s1">'addon.helloworld.header'</span><span class="p">,</span>

                <span class="c1">// Label for this specific a/b test winning criteria
</span>                <span class="s1">'label'</span>    <span class="o">=&gt;</span> <span class="s1">'addon.helloworld.pagetokens.'</span><span class="p">,</span>

                <span class="c1">// Static callback function that will be used to determine the winner
</span>                <span class="s1">'callback'</span> <span class="o">=&gt;</span> <span class="s1">'\MauticAddons\HelloWorldBundle\Helper\AbTestHelper::determinePlanetVisitWinner'</span>
            <span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**
     * Search and replace tokens with content
     *
     * @param PageSendEvent $event
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">onPageDisplay</span><span class="p">(</span><span class="nx">PageSendEvent</span> <span class="nv">$event</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Get content
</span>        <span class="nv">$content</span> <span class="o">=</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getContent</span><span class="p">();</span>

        <span class="c1">// Search and replace tokens
</span>        <span class="nv">$content</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s1">'{hello}'</span><span class="p">,</span> <span class="s1">'world!'</span><span class="p">,</span> <span class="nv">$content</span><span class="p">);</span>

        <span class="c1">// Set updated content
</span>        <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">setContent</span><span class="p">(</span><span class="nv">$content</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>There are two way to extend pages: page tokens used to insert dynamic content into a page and a/b test winning criteria . Both leverage the <code class="prettyprint">\Mautic\PageBundle\PageEvents::PAGE_ON_BUILD</code> event. Read more about <a href="#events">listeners and subscribers</a>.</p>

<h4 id="page-tokens">Page Tokens</h4>

<p>Page tokens are handled exactly the same as <a href="#page-tokens">Email Tokens</a>.</p>

<h4 id="page-a/b-test-winner-criteria">Page A/B Test Winner Criteria</h4>

<p>Custom landing page A/B test winner criteria is handled exactly the same as <a href="#page-a/b-test-winner-criteria">page A/B test winner criteria</a> with the only differences being that the <code class="prettyprint">callback</code> function is passed <code class="prettyprint">Mautic\PageBundle\Entity\Page $page</code> and <code class="prettyprint">Mautic\PageBundle\Entity\Page $parent</code> instead. Of course <code class="prettyprint">$children</code> is an ArrayCollection of Page entities as well.</p>

          <h3 id="extending-points">Extending Points</h3>

<p>Custom point actions and triggers can be added by listening to their respective on build events. Read more about <a href="#events">listeners and subscribers</a>.</p>

<h4 id="point-actions">Point Actions</h4>

<p>To add a custom point action used to give a lead x points for doing a certain action, add a listener to the <code class="prettyprint">\Mautic\PointBundle\PointEvents::POINT_ON_BUILD</code> event then configure the custom point action with <code class="prettyprint">$event-&gt;addAction($identifier, $parameters)</code> method. <code class="prettyprint">$identifier</code> must be something unique. The <code class="prettyprint">$parameters</code> array can contain the following elements:</p>

<table><thead>
<tr>
<th>Key</th>
<th>Required</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>label</strong></td>
<td>REQUIRED</td>
<td>string</td>
<td>The language string for the option in the dropdown</td>
</tr>
<tr>
<td><strong>formType</strong></td>
<td>OPTIONAL</td>
<td>string</td>
<td>The alias of a custom form type used to set config options.</td>
</tr>
<tr>
<td><strong>formTypeOptions</strong></td>
<td>OPTIONAL</td>
<td>array</td>
<td>Array of options to include into the formType&rsquo;s $options argument</td>
</tr>
<tr>
<td><strong>formTypeCleanMasks</strong></td>
<td>OPTIONAL</td>
<td>array</td>
<td>Array of input masks to clean a values from formType</td>
</tr>
<tr>
<td><strong>formTypeTheme</strong></td>
<td>OPTIONAL</td>
<td>string</td>
<td>Theme to customize elements for formType</td>
</tr>
<tr>
<td><strong>template</strong></td>
<td>OPTIONAL</td>
<td>string</td>
<td>View template used to render the formType</td>
</tr>
<tr>
<td><strong>callback</strong></td>
<td>OPTIONAL</td>
<td>mixed</td>
<td>Static callback function used to validate the action. Return true to add the points to the lead.</td>
</tr>
</tbody></table>

<p>In order for the custom point action to work, add something like the following in the code logic when the lead executes the custom action:</p>

<p>$this-&gt;factory-&gt;getModel(&lsquo;point&rsquo;)-&gt;triggerAction(&#39;page.hit&rsquo;, $event-&gt;getHit());</p>

<h4 id="point-triggers">Point Triggers</h4>

<p>TRIGGER_ON_BUILD</p>

          <h3 id="extending-reports">Extending Reports</h3>

          <h3 id="manipulating-leads">Manipulating Leads</h3>

          <h1 id="themes">Themes</h1>

          <h2 id="theme-directory-structure">Theme Directory Structure</h2>

          <h2 id="theme-config-file">Theme Config File</h2>

          <h2 id="feature-files">Feature Files</h2>

          <h1 id="rest-api">REST API</h1>

          <h3 id="authentication">Authentication</h3>

          <h3 id="assets">Assets</h3>

          <h3 id="campaigns">Campaigns</h3>

          <h3 id="forms">Forms</h3>

          <h3 id="leads">Leads</h3>

          <h3 id="lists">Lists</h3>

          <h3 id="pages">Pages</h3>

          <h3 id="points">Points</h3>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="php">php</a>
          </div>
      </div>
    </div>
  </body>
</html>
